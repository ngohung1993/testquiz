
jQuery(function ($) {
    'use strict';
    function iCheckLine() {
        var self = $(this),
            label = self.parent().text();

        self.parent().empty().append(self);

        self.iCheck({
            checkboxClass: 'icheckbox_' + cl,
            radioClass: 'iradio_' + cl,
            insert: '<div class="icheck_line-icon"></div>' + label
        });
    }

    var styles = {
        'flat': [
            null,
            'aero',
            'blue',
            'green',
            'grey',
            'orange',
            'pink',
            'purple',
            'red',
            'yellow'
        ],
        'futurico': [null],
        'line': [
            null,
            'aero',
            'blue',
            'green',
            'grey',
            'orange',
            'pink',
            'purple',
            'red',
            'yellow'
        ],
        'minimal': [
            null,
            'aero',
            'blue',
            'green',
            'grey',
            'orange',
            'pink',
            'purple',
            'red',
            'yellow'
        ],
        'polaris': [null],
        'square': [
            null,
            'aero',
            'blue',
            'green',
            'grey',
            'orange',
            'pink',
            'purple',
            'red',
            'yellow'
        ]
    };
    var j, name, cl, style;
    var $ichecks = $('input.icheck');
    for (name in styles) {
        style = styles[name];
        for (j = 0; j < style.length; j++) {
            cl = name;
            if (style[j]) cl += '-' + style[j];

            if (name == 'line') {
                $ichecks.filter('.' + cl).each(iCheckLine);
            } else {
                $ichecks.filter('.' + cl).iCheck({
                    checkboxClass: 'icheckbox_' + cl,
                    radioClass: 'iradio_' + cl
                });
            }
        }
    }
    $ichecks.on('ifChanged', function (event) {
        //ThaoDTP
        if ($(this).attr('type') == 'checkbox') {
            var attr = $(this).attr('checked');
            if (typeof attr !== typeof undefined && attr !== false) {
                $(this).removeAttr('checked');
            } else {
                $(this).attr('checked', true);
            }
            $(this).trigger("change");
        }
    });

    $ichecks.on('ifChecked', function (event) {
        //ThaoDTP
        if ($(this).attr('type') == 'radio') {
            var attr = $(this).attr('checked');
            if (typeof attr !== typeof undefined && attr !== false) {
            } else {
                $(this).attr('checked', true);
            }
            $(this).trigger("change");
        }
    });
});

// Spectrum Colorpicker v1.8.0
// https://github.com/bgrins/spectrum
// Author: Brian Grinstead
// License: MIT

(function (factory) {
    "use strict";

    if (typeof define === 'function' && define.amd) { // AMD
        define(['jquery'], factory);
    }
    else if (typeof exports == "object" && typeof module == "object") { // CommonJS
        module.exports = factory(require('jquery'));
    }
    else { // Browser
        factory(jQuery);
    }
})(function($, undefined) {
    "use strict";

    var defaultOpts = {

        // Callbacks
        beforeShow: noop,
        move: noop,
        change: noop,
        show: noop,
        hide: noop,

        // Options
        color: false,
        flat: false,
        showInput: false,
        allowEmpty: false,
        showButtons: true,
        clickoutFiresChange: true,
        showInitial: false,
        showPalette: false,
        showPaletteOnly: false,
        hideAfterPaletteSelect: false,
        togglePaletteOnly: false,
        showSelectionPalette: true,
        localStorageKey: false,
        appendTo: "body",
        maxSelectionSize: 7,
        cancelText: "cancel",
        chooseText: "choose",
        togglePaletteMoreText: "more",
        togglePaletteLessText: "less",
        clearText: "Clear Color Selection",
        noColorSelectedText: "No Color Selected",
        preferredFormat: false,
        className: "", // Deprecated - use containerClassName and replacerClassName instead.
        containerClassName: "",
        replacerClassName: "",
        showAlpha: false,
        theme: "sp-light",
        palette: [["#ffffff", "#000000", "#ff0000", "#ff8000", "#ffff00", "#008000", "#0000ff", "#4b0082", "#9400d3"]],
        selectionPalette: [],
        disabled: false,
        offset: null
    },
    spectrums = [],
    IE = !!/msie/i.exec( window.navigator.userAgent ),
    rgbaSupport = (function() {
        function contains( str, substr ) {
            return !!~('' + str).indexOf(substr);
        }

        var elem = document.createElement('div');
        var style = elem.style;
        style.cssText = 'background-color:rgba(0,0,0,.5)';
        return contains(style.backgroundColor, 'rgba') || contains(style.backgroundColor, 'hsla');
    })(),
    replaceInput = [
        "<div class='sp-replacer'>",
            "<div class='sp-preview'><div class='sp-preview-inner'></div></div>",
            "<div class='sp-dd'>&#9660;</div>",
        "</div>"
    ].join(''),
    markup = (function () {

        // IE does not support gradients with multiple stops, so we need to simulate
        //  that for the rainbow slider with 8 divs that each have a single gradient
        var gradientFix = "";
        if (IE) {
            for (var i = 1; i <= 6; i++) {
                gradientFix += "<div class='sp-" + i + "'></div>";
            }
        }

        return [
            "<div class='sp-container sp-hidden'>",
                "<div class='sp-palette-container'>",
                    "<div class='sp-palette sp-thumb sp-cf'></div>",
                    "<div class='sp-palette-button-container sp-cf'>",
                        "<button type='button' class='sp-palette-toggle'></button>",
                    "</div>",
                "</div>",
                "<div class='sp-picker-container'>",
                    "<div class='sp-top sp-cf'>",
                        "<div class='sp-fill'></div>",
                        "<div class='sp-top-inner'>",
                            "<div class='sp-color'>",
                                "<div class='sp-sat'>",
                                    "<div class='sp-val'>",
                                        "<div class='sp-dragger'></div>",
                                    "</div>",
                                "</div>",
                            "</div>",
                            "<div class='sp-clear sp-clear-display'>",
                            "</div>",
                            "<div class='sp-hue'>",
                                "<div class='sp-slider'></div>",
                                gradientFix,
                            "</div>",
                        "</div>",
                        "<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>",
                    "</div>",
                    "<div class='sp-input-container sp-cf'>",
                        "<input class='sp-input' type='text' spellcheck='false'  />",
                    "</div>",
                    "<div class='sp-initial sp-thumb sp-cf'></div>",
                    "<div class='sp-button-container sp-cf'>",
                        "<div class='button-group'>",
                            "<a class='sp-cancel ui-button ui-button--size-small' href='#'></a>",
                            "<button type='button' class='sp-choose ui-button ui-button--primary ui-button--size-small'></button>",
                         "</div>",
                    "</div>",
                "</div>",
            "</div>"
        ].join("");
    })();

    function paletteTemplate (p, color, className, opts) {
        var html = [];
        for (var i = 0; i < p.length; i++) {
            var current = p[i];
            if(current) {
                var tiny = tinycolor(current);
                var c = tiny.toHsl().l < 0.5 ? "sp-thumb-el sp-thumb-dark" : "sp-thumb-el sp-thumb-light";
                c += (tinycolor.equals(color, current)) ? " sp-thumb-active" : "";
                var formattedString = tiny.toString(opts.preferredFormat || "rgb");
                var swatchStyle = rgbaSupport ? ("background-color:" + tiny.toRgbString()) : "filter:" + tiny.toFilter();
                html.push('<span title="' + formattedString + '" data-color="' + tiny.toRgbString() + '" class="' + c + '"><span class="sp-thumb-inner" style="' + swatchStyle + ';" /></span>');
            } else {
                var cls = 'sp-clear-display';
                html.push($('<div />')
                    .append($('<span data-color="" style="background-color:transparent;" class="' + cls + '"></span>')
                        .attr('title', opts.noColorSelectedText)
                    )
                    .html()
                );
            }
        }
        return "<div class='sp-cf " + className + "'>" + html.join('') + "</div>";
    }

    function hideAll() {
        for (var i = 0; i < spectrums.length; i++) {
            if (spectrums[i]) {
                spectrums[i].hide();
            }
        }
    }

    function instanceOptions(o, callbackContext) {
        var opts = $.extend({}, defaultOpts, o);
        opts.callbacks = {
            'move': bind(opts.move, callbackContext),
            'change': bind(opts.change, callbackContext),
            'show': bind(opts.show, callbackContext),
            'hide': bind(opts.hide, callbackContext),
            'beforeShow': bind(opts.beforeShow, callbackContext)
        };

        return opts;
    }

    function spectrum(element, o) {

        var opts = instanceOptions(o, element),
            flat = opts.flat,
            showSelectionPalette = opts.showSelectionPalette,
            localStorageKey = opts.localStorageKey,
            theme = opts.exam,
            callbacks = opts.callbacks,
            resize = throttle(reflow, 10),
            visible = false,
            isDragging = false,
            dragWidth = 0,
            dragHeight = 0,
            dragHelperHeight = 0,
            slideHeight = 0,
            slideWidth = 0,
            alphaWidth = 0,
            alphaSlideHelperWidth = 0,
            slideHelperHeight = 0,
            currentHue = 0,
            currentSaturation = 0,
            currentValue = 0,
            currentAlpha = 1,
            palette = [],
            paletteArray = [],
            paletteLookup = {},
            selectionPalette = opts.selectionPalette.slice(0),
            maxSelectionSize = opts.maxSelectionSize,
            draggingClass = "sp-dragging",
            shiftMovementDirection = null;

        var doc = element.ownerDocument,
            body = doc.body,
            boundElement = $(element),
            disabled = false,
            container = $(markup, doc).addClass(theme),
            pickerContainer = container.find(".sp-picker-container"),
            dragger = container.find(".sp-color"),
            dragHelper = container.find(".sp-dragger"),
            slider = container.find(".sp-hue"),
            slideHelper = container.find(".sp-slider"),
            alphaSliderInner = container.find(".sp-alpha-inner"),
            alphaSlider = container.find(".sp-alpha"),
            alphaSlideHelper = container.find(".sp-alpha-handle"),
            textInput = container.find(".sp-input"),
            paletteContainer = container.find(".sp-palette"),
            initialColorContainer = container.find(".sp-initial"),
            cancelButton = container.find(".sp-cancel"),
            clearButton = container.find(".sp-clear"),
            chooseButton = container.find(".sp-choose"),
            toggleButton = container.find(".sp-palette-toggle"),
            isInput = boundElement.is("input"),
            isInputTypeColor = isInput && boundElement.attr("type") === "color" && inputTypeColorSupport(),
            shouldReplace = isInput && !flat,
            replacer = (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName) : $([]),
            offsetElement = (shouldReplace) ? replacer : boundElement,
            previewElement = replacer.find(".sp-preview-inner"),
            initialColor = opts.color || (isInput && boundElement.val()),
            colorOnShow = false,
            currentPreferredFormat = opts.preferredFormat,
            clickoutFiresChange = !opts.showButtons || opts.clickoutFiresChange,
            isEmpty = !initialColor,
            allowEmpty = opts.allowEmpty && !isInputTypeColor;

        function applyOptions() {

            if (opts.showPaletteOnly) {
                opts.showPalette = true;
            }

            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);

            if (opts.palette) {
                palette = opts.palette.slice(0);
                paletteArray = $.isArray(palette[0]) ? palette : [palette];
                paletteLookup = {};
                for (var i = 0; i < paletteArray.length; i++) {
                    for (var j = 0; j < paletteArray[i].length; j++) {
                        var rgb = tinycolor(paletteArray[i][j]).toRgbString();
                        paletteLookup[rgb] = true;
                    }
                }
            }

            container.toggleClass("sp-flat", flat);
            container.toggleClass("sp-input-disabled", !opts.showInput);
            container.toggleClass("sp-alpha-enabled", opts.showAlpha);
            container.toggleClass("sp-clear-enabled", allowEmpty);
            container.toggleClass("sp-buttons-disabled", !opts.showButtons);
            container.toggleClass("sp-palette-buttons-disabled", !opts.togglePaletteOnly);
            container.toggleClass("sp-palette-disabled", !opts.showPalette);
            container.toggleClass("sp-palette-only", opts.showPaletteOnly);
            container.toggleClass("sp-initial-disabled", !opts.showInitial);
            container.addClass(opts.className).addClass(opts.containerClassName);

            reflow();
        }

        function initialize() {

            if (IE) {
                container.find("*:not(input)").attr("unselectable", "on");
            }

            applyOptions();

            if (shouldReplace) {
                boundElement.after(replacer).hide();
            }

            if (!allowEmpty) {
                clearButton.hide();
            }

            if (flat) {
                boundElement.after(container).hide();
            }
            else {

                var appendTo = opts.appendTo === "parent" ? boundElement.parent() : $(opts.appendTo);
                if (appendTo.length !== 1) {
                    appendTo = $("body");
                }

                appendTo.append(container);
            }

            updateSelectionPaletteFromStorage();

            offsetElement.bind("click.spectrum touchstart.spectrum", function (e) {
                if (!disabled) {
                    toggle();
                }

                e.stopPropagation();

                if (!$(e.target).is("input")) {
                    e.preventDefault();
                }
            });

            if(boundElement.is(":disabled") || (opts.disabled === true)) {
                disable();
            }

            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.
            container.click(stopPropagation);

            // Handle user typed input
            textInput.change(setFromTextInput);
            textInput.bind("paste", function () {
                setTimeout(setFromTextInput, 1);
            });
            textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });

            cancelButton.text(opts.cancelText);
            cancelButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                revert();
                hide();
            });

            clearButton.attr("title", opts.clearText);
            clearButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();
                isEmpty = true;
                move();

                if(flat) {
                    //for the flat style, this is a change event
                    updateOriginalInput(true);
                }
            });

            chooseButton.text(opts.chooseText);
            chooseButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();

                if (IE && textInput.is(":focus")) {
                    textInput.trigger('change');
                }

                if (isValid()) {
                    updateOriginalInput(true);
                    hide();
                }
            });

            toggleButton.text(opts.showPaletteOnly ? opts.togglePaletteMoreText : opts.togglePaletteLessText);
            toggleButton.bind("click.spectrum", function (e) {
                e.stopPropagation();
                e.preventDefault();

                opts.showPaletteOnly = !opts.showPaletteOnly;

                // To make sure the Picker area is drawn on the right, next to the
                // Palette area (and not below the palette), first move the Palette
                // to the left to make space for the picker, plus 5px extra.
                // The 'applyOptions' function puts the whole container back into place
                // and takes care of the button-text and the sp-palette-only CSS class.
                if (!opts.showPaletteOnly && !flat) {
                    container.css('left', '-=' + (pickerContainer.outerWidth(true) + 5));
                }
                applyOptions();
            });

            draggable(alphaSlider, function (dragX, dragY, e) {
                currentAlpha = (dragX / alphaWidth);
                isEmpty = false;
                if (e.shiftKey) {
                    currentAlpha = Math.round(currentAlpha * 10) / 10;
                }

                move();
            }, dragStart, dragStop);

            draggable(slider, function (dragX, dragY) {
                currentHue = parseFloat(dragY / slideHeight);
                isEmpty = false;
                if (!opts.showAlpha) {
                    currentAlpha = 1;
                }
                move();
            }, dragStart, dragStop);

            draggable(dragger, function (dragX, dragY, e) {

                // shift+drag should snap the movement to either the x or y axis.
                if (!e.shiftKey) {
                    shiftMovementDirection = null;
                }
                else if (!shiftMovementDirection) {
                    var oldDragX = currentSaturation * dragWidth;
                    var oldDragY = dragHeight - (currentValue * dragHeight);
                    var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);

                    shiftMovementDirection = furtherFromX ? "x" : "y";
                }

                var setSaturation = !shiftMovementDirection || shiftMovementDirection === "x";
                var setValue = !shiftMovementDirection || shiftMovementDirection === "y";

                if (setSaturation) {
                    currentSaturation = parseFloat(dragX / dragWidth);
                }
                if (setValue) {
                    currentValue = parseFloat((dragHeight - dragY) / dragHeight);
                }

                isEmpty = false;
                if (!opts.showAlpha) {
                    currentAlpha = 1;
                }

                move();

            }, dragStart, dragStop);

            if (!!initialColor) {
                set(initialColor);

                // In case color was black - update the preview UI and set the format
                // since the set function will not run (default color is black).
                updateUI();
                currentPreferredFormat = opts.preferredFormat || tinycolor(initialColor).format;

                addColorToSelectionPalette(initialColor);
            }
            else {
                updateUI();
            }

            if (flat) {
                show();
            }

            function paletteElementClick(e) {
                if (e.data && e.data.ignore) {
                    set($(e.target).closest(".sp-thumb-el").data("color"));
                    move();
                }
                else {
                    set($(e.target).closest(".sp-thumb-el").data("color"));
                    move();
                    updateOriginalInput(true);
                    if (opts.hideAfterPaletteSelect) {
                      hide();
                    }
                }

                return false;
            }

            var paletteEvent = IE ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
            paletteContainer.delegate(".sp-thumb-el", paletteEvent, paletteElementClick);
            initialColorContainer.delegate(".sp-thumb-el:nth-child(1)", paletteEvent, { ignore: true }, paletteElementClick);
        }

        function updateSelectionPaletteFromStorage() {

            if (localStorageKey && window.localStorage) {

                // Migrate old palettes over to new format.  May want to remove this eventually.
                try {
                    var oldPalette = window.localStorage[localStorageKey].split(",#");
                    if (oldPalette.length > 1) {
                        delete window.localStorage[localStorageKey];
                        $.each(oldPalette, function(i, c) {
                             addColorToSelectionPalette(c);
                        });
                    }
                }
                catch(e) { }

                try {
                    selectionPalette = window.localStorage[localStorageKey].split(";");
                }
                catch (e) { }
            }
        }

        function addColorToSelectionPalette(color) {
            if (showSelectionPalette) {
                var rgb = tinycolor(color).toRgbString();
                if (!paletteLookup[rgb] && $.inArray(rgb, selectionPalette) === -1) {
                    selectionPalette.push(rgb);
                    while(selectionPalette.length > maxSelectionSize) {
                        selectionPalette.shift();
                    }
                }

                if (localStorageKey && window.localStorage) {
                    try {
                        window.localStorage[localStorageKey] = selectionPalette.join(";");
                    }
                    catch(e) { }
                }
            }
        }

        function getUniqueSelectionPalette() {
            var unique = [];
            if (opts.showPalette) {
                for (var i = 0; i < selectionPalette.length; i++) {
                    var rgb = tinycolor(selectionPalette[i]).toRgbString();

                    if (!paletteLookup[rgb]) {
                        unique.push(selectionPalette[i]);
                    }
                }
            }

            return unique.reverse().slice(0, opts.maxSelectionSize);
        }

        function drawPalette() {

            var currentColor = get();

            var html = $.map(paletteArray, function (palette, i) {
                return paletteTemplate(palette, currentColor, "sp-palette-row sp-palette-row-" + i, opts);
            });

            updateSelectionPaletteFromStorage();

            if (selectionPalette) {
                html.push(paletteTemplate(getUniqueSelectionPalette(), currentColor, "sp-palette-row sp-palette-row-selection", opts));
            }

            paletteContainer.html(html.join(""));
        }

        function drawInitial() {
            if (opts.showInitial) {
                var initial = colorOnShow;
                var current = get();
                initialColorContainer.html(paletteTemplate([initial, current], current, "sp-palette-row-initial", opts));
            }
        }

        function dragStart() {
            if (dragHeight <= 0 || dragWidth <= 0 || slideHeight <= 0) {
                reflow();
            }
            isDragging = true;
            container.addClass(draggingClass);
            shiftMovementDirection = null;
            boundElement.trigger('dragstart.spectrum', [ get() ]);
        }

        function dragStop() {
            isDragging = false;
            container.removeClass(draggingClass);
            boundElement.trigger('dragstop.spectrum', [ get() ]);
        }

        function setFromTextInput() {

            var value = textInput.val();

            if ((value === null || value === "") && allowEmpty) {
                set(null);
                updateOriginalInput(true);
            }
            else {
                var tiny = tinycolor(value);
                if (tiny.isValid()) {
                    set(tiny);
                    updateOriginalInput(true);
                }
                else {
                    textInput.addClass("sp-validation-error");
                }
            }
        }

        function toggle() {
            if (visible) {
                hide();
            }
            else {
                show();
            }
        }

        function show() {
            var event = $.Event('beforeShow.spectrum');

            if (visible) {
                reflow();
                return;
            }

            boundElement.trigger(event, [ get() ]);

            if (callbacks.beforeShow(get()) === false || event.isDefaultPrevented()) {
                return;
            }

            hideAll();
            visible = true;

            $(doc).bind("keydown.spectrum", onkeydown);
            $(doc).bind("click.spectrum", clickout);
            $(window).bind("resize.spectrum", resize);
            replacer.addClass("sp-active");
            container.removeClass("sp-hidden");

            reflow();
            updateUI();

            colorOnShow = get();

            drawInitial();
            callbacks.show(colorOnShow);
            boundElement.trigger('show.spectrum', [ colorOnShow ]);
        }

        function onkeydown(e) {
            // Close on ESC
            if (e.keyCode === 27) {
                hide();
            }
        }

        function clickout(e) {
            // Return on right click.
            if (e.button == 2) { return; }

            // If a drag event was happening during the mouseup, don't hide
            // on click.
            if (isDragging) { return; }

            if (clickoutFiresChange) {
                updateOriginalInput(true);
            }
            else {
                revert();
            }
            hide();
        }

        function hide() {
            // Return if hiding is unnecessary
            if (!visible || flat) { return; }
            visible = false;

            $(doc).unbind("keydown.spectrum", onkeydown);
            $(doc).unbind("click.spectrum", clickout);
            $(window).unbind("resize.spectrum", resize);

            replacer.removeClass("sp-active");
            container.addClass("sp-hidden");

            callbacks.hide(get());
            boundElement.trigger('hide.spectrum', [ get() ]);
        }

        function revert() {
            set(colorOnShow, true);
        }

        function set(color, ignoreFormatChange) {
            if (tinycolor.equals(color, get())) {
                // Update UI just in case a validation error needs
                // to be cleared.
                updateUI();
                return;
            }

            var newColor, newHsv;
            if (!color && allowEmpty) {
                isEmpty = true;
            } else {
                isEmpty = false;
                newColor = tinycolor(color);
                newHsv = newColor.toHsv();

                currentHue = (newHsv.h % 360) / 360;
                currentSaturation = newHsv.s;
                currentValue = newHsv.v;
                currentAlpha = newHsv.a;
            }
            updateUI();

            if (newColor && newColor.isValid() && !ignoreFormatChange) {
                currentPreferredFormat = opts.preferredFormat || newColor.getFormat();
            }
        }

        function get(opts) {
            opts = opts || { };

            if (allowEmpty && isEmpty) {
                return null;
            }

            return tinycolor.fromRatio({
                h: currentHue,
                s: currentSaturation,
                v: currentValue,
                a: Math.round(currentAlpha * 100) / 100
            }, { format: opts.format || currentPreferredFormat });
        }

        function isValid() {
            return !textInput.hasClass("sp-validation-error");
        }

        function move() {
            updateUI();

            callbacks.move(get());
            boundElement.trigger('move.spectrum', [ get() ]);
        }

        function updateUI() {

            textInput.removeClass("sp-validation-error");

            updateHelperLocations();

            // Update dragger background color (gradients take care of saturation and value).
            var flatColor = tinycolor.fromRatio({ h: currentHue, s: 1, v: 1 });
            dragger.css("background-color", flatColor.toHexString());

            // Get a format that alpha will be included in (hex and names ignore alpha)
            var format = currentPreferredFormat;
            if (currentAlpha < 1 && !(currentAlpha === 0 && format === "name")) {
                if (format === "hex" || format === "hex3" || format === "hex6" || format === "name") {
                    format = "rgb";
                }
            }

            var realColor = get({ format: format }),
                displayColor = '';

             //reset background info for preview element
            previewElement.removeClass("sp-clear-display");
            previewElement.css('background-color', 'transparent');

            if (!realColor && allowEmpty) {
                // Update the replaced elements background with icon indicating no color selection
                previewElement.addClass("sp-clear-display");
            }
            else {
                var realHex = realColor.toHexString(),
                    realRgb = realColor.toRgbString();

                // Update the replaced elements background color (with actual selected color)
                if (rgbaSupport || realColor.alpha === 1) {
                    previewElement.css("background-color", realRgb);
                }
                else {
                    previewElement.css("background-color", "transparent");
                    previewElement.css("filter", realColor.toFilter());
                }

                if (opts.showAlpha) {
                    var rgb = realColor.toRgb();
                    rgb.a = 0;
                    var realAlpha = tinycolor(rgb).toRgbString();
                    var gradient = "linear-gradient(left, " + realAlpha + ", " + realHex + ")";

                    if (IE) {
                        alphaSliderInner.css("filter", tinycolor(realAlpha).toFilter({ gradientType: 1 }, realHex));
                    }
                    else {
                        alphaSliderInner.css("background", "-webkit-" + gradient);
                        alphaSliderInner.css("background", "-moz-" + gradient);
                        alphaSliderInner.css("background", "-ms-" + gradient);
                        // Use current syntax gradient on unprefixed property.
                        alphaSliderInner.css("background",
                            "linear-gradient(to right, " + realAlpha + ", " + realHex + ")");
                    }
                }

                displayColor = realColor.toString(format);
            }

            // Update the text entry input as it changes happen
            if (opts.showInput) {
                textInput.val(displayColor);
            }

            if (opts.showPalette) {
                drawPalette();
            }

            drawInitial();
        }

        function updateHelperLocations() {
            var s = currentSaturation;
            var v = currentValue;

            if(allowEmpty && isEmpty) {
                //if selected color is empty, hide the helpers
                alphaSlideHelper.hide();
                slideHelper.hide();
                dragHelper.hide();
            }
            else {
                //make sure helpers are visible
                alphaSlideHelper.show();
                slideHelper.show();
                dragHelper.show();

                // Where to show the little circle in that displays your current selected color
                var dragX = s * dragWidth;
                var dragY = dragHeight - (v * dragHeight);
                dragX = Math.max(
                    -dragHelperHeight,
                    Math.min(dragWidth - dragHelperHeight, dragX - dragHelperHeight)
                );
                dragY = Math.max(
                    -dragHelperHeight,
                    Math.min(dragHeight - dragHelperHeight, dragY - dragHelperHeight)
                );
                dragHelper.css({
                    "top": dragY + "px",
                    "left": dragX + "px"
                });

                var alphaX = currentAlpha * alphaWidth;
                alphaSlideHelper.css({
                    "left": (alphaX - (alphaSlideHelperWidth / 2)) + "px"
                });

                // Where to show the bar that displays your current selected hue
                var slideY = (currentHue) * slideHeight;
                slideHelper.css({
                    "top": (slideY - slideHelperHeight) + "px"
                });
            }
        }

        function updateOriginalInput(fireCallback) {
            var color = get(),
                displayColor = '',
                hasChanged = !tinycolor.equals(color, colorOnShow);

            if (color) {
                displayColor = color.toString(currentPreferredFormat);
                // Update the selection palette with the current color
                addColorToSelectionPalette(color);
            }

            if (isInput) {
                boundElement.val(displayColor);
            }

            if (fireCallback && hasChanged) {
                callbacks.change(color);
                boundElement.trigger('change', [ color ]);
            }
        }

        function reflow() {
            if (!visible) {
                return; // Calculations would be useless and wouldn't be reliable anyways
            }
            dragWidth = dragger.width();
            dragHeight = dragger.height();
            dragHelperHeight = dragHelper.height();
            slideWidth = slider.width();
            slideHeight = slider.height();
            slideHelperHeight = slideHelper.height();
            alphaWidth = alphaSlider.width();
            alphaSlideHelperWidth = alphaSlideHelper.width();

            if (!flat) {
                container.css("position", "absolute");
                if (opts.offset) {
                    container.offset(opts.offset);
                } else {
                    container.offset(getOffset(container, offsetElement));
                }
            }

            updateHelperLocations();

            if (opts.showPalette) {
                drawPalette();
            }

            boundElement.trigger('reflow.spectrum');
        }

        function destroy() {
            boundElement.show();
            offsetElement.unbind("click.spectrum touchstart.spectrum");
            container.remove();
            replacer.remove();
            spectrums[spect.id] = null;
        }

        function option(optionName, optionValue) {
            if (optionName === undefined) {
                return $.extend({}, opts);
            }
            if (optionValue === undefined) {
                return opts[optionName];
            }

            opts[optionName] = optionValue;

            if (optionName === "preferredFormat") {
                currentPreferredFormat = opts.preferredFormat;
            }
            applyOptions();
        }

        function enable() {
            disabled = false;
            boundElement.attr("disabled", false);
            offsetElement.removeClass("sp-disabled");
        }

        function disable() {
            hide();
            disabled = true;
            boundElement.attr("disabled", true);
            offsetElement.addClass("sp-disabled");
        }

        function setOffset(coord) {
            opts.offset = coord;
            reflow();
        }

        initialize();

        var spect = {
            show: show,
            hide: hide,
            toggle: toggle,
            reflow: reflow,
            option: option,
            enable: enable,
            disable: disable,
            offset: setOffset,
            set: function (c) {
                set(c);
                updateOriginalInput();
            },
            get: get,
            destroy: destroy,
            container: container
        };

        spect.id = spectrums.push(spect) - 1;

        return spect;
    }

    /**
    * checkOffset - get the offset below/above and left/right element depending on screen position
    * Thanks https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js
    */
    function getOffset(picker, input) {
        var extraY = 0;
        var dpWidth = picker.outerWidth();
        var dpHeight = picker.outerHeight();
        var inputHeight = input.outerHeight();
        var doc = picker[0].ownerDocument;
        var docElem = doc.documentElement;
        var viewWidth = docElem.clientWidth + $(doc).scrollLeft();
        var viewHeight = docElem.clientHeight + $(doc).scrollTop();
        var offset = input.offset();
        offset.top += inputHeight;

        offset.left -=
            Math.min(offset.left, (offset.left + dpWidth > viewWidth && viewWidth > dpWidth) ?
            Math.abs(offset.left + dpWidth - viewWidth) : 0);

        offset.top -=
            Math.min(offset.top, ((offset.top + dpHeight > viewHeight && viewHeight > dpHeight) ?
            Math.abs(dpHeight + inputHeight - extraY) : extraY));

        return offset;
    }

    /**
    * noop - do nothing
    */
    function noop() {

    }

    /**
    * stopPropagation - makes the code only doing this a little easier to read in line
    */
    function stopPropagation(e) {
        e.stopPropagation();
    }

    /**
    * Create a function bound to a given object
    * Thanks to underscore.js
    */
    function bind(func, obj) {
        var slice = Array.prototype.slice;
        var args = slice.call(arguments, 2);
        return function () {
            return func.apply(obj, args.concat(slice.call(arguments)));
        };
    }

    /**
    * Lightweight drag helper.  Handles containment within the element, so that
    * when dragging, the x is within [0,element.width] and y is within [0,element.height]
    */
    function draggable(element, onmove, onstart, onstop) {
        onmove = onmove || function () { };
        onstart = onstart || function () { };
        onstop = onstop || function () { };
        var doc = document;
        var dragging = false;
        var offset = {};
        var maxHeight = 0;
        var maxWidth = 0;
        var hasTouch = ('ontouchstart' in window);

        var duringDragEvents = {};
        duringDragEvents["selectstart"] = prevent;
        duringDragEvents["dragstart"] = prevent;
        duringDragEvents["touchmove mousemove"] = move;
        duringDragEvents["touchend mouseup"] = stop;

        function prevent(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.returnValue = false;
        }

        function move(e) {
            if (dragging) {
                // Mouseup happened outside of window
                if (IE && doc.documentMode < 9 && !e.button) {
                    return stop();
                }

                var t0 = e.originalEvent && e.originalEvent.touches && e.originalEvent.touches[0];
                var pageX = t0 && t0.pageX || e.pageX;
                var pageY = t0 && t0.pageY || e.pageY;

                var dragX = Math.max(0, Math.min(pageX - offset.left, maxWidth));
                var dragY = Math.max(0, Math.min(pageY - offset.top, maxHeight));

                if (hasTouch) {
                    // Stop scrolling in iOS
                    prevent(e);
                }

                onmove.apply(element, [dragX, dragY, e]);
            }
        }

        function start(e) {
            var rightclick = (e.which) ? (e.which == 3) : (e.button == 2);

            if (!rightclick && !dragging) {
                if (onstart.apply(element, arguments) !== false) {
                    dragging = true;
                    maxHeight = $(element).height();
                    maxWidth = $(element).width();
                    offset = $(element).offset();

                    $(doc).bind(duringDragEvents);
                    $(doc.body).addClass("sp-dragging");

                    move(e);

                    prevent(e);
                }
            }
        }

        function stop() {
            if (dragging) {
                $(doc).unbind(duringDragEvents);
                $(doc.body).removeClass("sp-dragging");

                // Wait a tick before notifying observers to allow the click event
                // to fire in Chrome.
                setTimeout(function() {
                    onstop.apply(element, arguments);
                }, 0);
            }
            dragging = false;
        }

        $(element).bind("touchstart mousedown", start);
    }

    function throttle(func, wait, debounce) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var throttler = function () {
                timeout = null;
                func.apply(context, args);
            };
            if (debounce) clearTimeout(timeout);
            if (debounce || !timeout) timeout = setTimeout(throttler, wait);
        };
    }

    function inputTypeColorSupport() {
        return $.fn.spectrum.inputTypeColorSupport();
    }

    /**
    * Define a jQuery plugin
    */
    var dataID = "spectrum.id";
    $.fn.spectrum = function (opts, extra) {

        if (typeof opts == "string") {

            var returnValue = this;
            var args = Array.prototype.slice.call( arguments, 1 );

            this.each(function () {
                var spect = spectrums[$(this).data(dataID)];
                if (spect) {
                    var method = spect[opts];
                    if (!method) {
                        throw new Error( "Spectrum: no such method: '" + opts + "'" );
                    }

                    if (opts == "get") {
                        returnValue = spect.get();
                    }
                    else if (opts == "container") {
                        returnValue = spect.container;
                    }
                    else if (opts == "option") {
                        returnValue = spect.option.apply(spect, args);
                    }
                    else if (opts == "destroy") {
                        spect.destroy();
                        $(this).removeData(dataID);
                    }
                    else {
                        method.apply(spect, args);
                    }
                }
            });

            return returnValue;
        }

        // Initializing a new instance of spectrum
        return this.spectrum("destroy").each(function () {
            var options = $.extend({}, opts, $(this).data());
            var spect = spectrum(this, options);
            $(this).data(dataID, spect.id);
        });
    };

    $.fn.spectrum.load = true;
    $.fn.spectrum.loadOpts = {};
    $.fn.spectrum.draggable = draggable;
    $.fn.spectrum.defaults = defaultOpts;
    $.fn.spectrum.inputTypeColorSupport = function inputTypeColorSupport() {
        if (typeof inputTypeColorSupport._cachedResult === "undefined") {
            var colorInput = $("<input type='color'/>")[0]; // if color element is supported, value will default to not null
            inputTypeColorSupport._cachedResult = colorInput.type === "color" && colorInput.value !== "";
        }
        return inputTypeColorSupport._cachedResult;
    };

    $.spectrum = { };
    $.spectrum.localization = { };
    $.spectrum.palettes = { };

    $.fn.spectrum.processNativeColorInputs = function () {
        var colorInputs = $("input[type=color]");
        if (colorInputs.length && !inputTypeColorSupport()) {
            colorInputs.spectrum({
                preferredFormat: "hex6"
            });
        }
    };

    // TinyColor v1.1.2
    // https://github.com/bgrins/TinyColor
    // Brian Grinstead, MIT License

    (function() {

    var trimLeft = /^[\s,#]+/,
        trimRight = /\s+$/,
        tinyCounter = 0,
        math = Math,
        mathRound = math.round,
        mathMin = math.min,
        mathMax = math.max,
        mathRandom = math.random;

    var tinycolor = function(color, opts) {

        color = (color) ? color : '';
        opts = opts || { };

        // If input is already a tinycolor, return itself
        if (color instanceof tinycolor) {
           return color;
        }
        // If we are called as a function, call using new instead
        if (!(this instanceof tinycolor)) {
            return new tinycolor(color, opts);
        }

        var rgb = inputToRGB(color);
        this._originalInput = color,
        this._r = rgb.r,
        this._g = rgb.g,
        this._b = rgb.b,
        this._a = rgb.a,
        this._roundA = mathRound(100*this._a) / 100,
        this._format = opts.format || rgb.format;
        this._gradientType = opts.gradientType;

        // Don't let the range of [0,255] come back in [0,1].
        // Potentially lose a little bit of precision here, but will fix issues where
        // .5 gets interpreted as half of the total, instead of half of 1
        // If it was supposed to be 128, this was already taken care of by `inputToRgb`
        if (this._r < 1) { this._r = mathRound(this._r); }
        if (this._g < 1) { this._g = mathRound(this._g); }
        if (this._b < 1) { this._b = mathRound(this._b); }

        this._ok = rgb.ok;
        this._tc_id = tinyCounter++;
    };

    tinycolor.prototype = {
        isDark: function() {
            return this.getBrightness() < 128;
        },
        isLight: function() {
            return !this.isDark();
        },
        isValid: function() {
            return this._ok;
        },
        getOriginalInput: function() {
          return this._originalInput;
        },
        getFormat: function() {
            return this._format;
        },
        getAlpha: function() {
            return this._a;
        },
        getBrightness: function() {
            var rgb = this.toRgb();
            return (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
        },
        setAlpha: function(value) {
            this._a = boundAlpha(value);
            this._roundA = mathRound(100*this._a) / 100;
            return this;
        },
        toHsv: function() {
            var hsv = rgbToHsv(this._r, this._g, this._b);
            return { h: hsv.h * 360, s: hsv.s, v: hsv.v, a: this._a };
        },
        toHsvString: function() {
            var hsv = rgbToHsv(this._r, this._g, this._b);
            var h = mathRound(hsv.h * 360), s = mathRound(hsv.s * 100), v = mathRound(hsv.v * 100);
            return (this._a == 1) ?
              "hsv("  + h + ", " + s + "%, " + v + "%)" :
              "hsva(" + h + ", " + s + "%, " + v + "%, "+ this._roundA + ")";
        },
        toHsl: function() {
            var hsl = rgbToHsl(this._r, this._g, this._b);
            return { h: hsl.h * 360, s: hsl.s, l: hsl.l, a: this._a };
        },
        toHslString: function() {
            var hsl = rgbToHsl(this._r, this._g, this._b);
            var h = mathRound(hsl.h * 360), s = mathRound(hsl.s * 100), l = mathRound(hsl.l * 100);
            return (this._a == 1) ?
              "hsl("  + h + ", " + s + "%, " + l + "%)" :
              "hsla(" + h + ", " + s + "%, " + l + "%, "+ this._roundA + ")";
        },
        toHex: function(allow3Char) {
            return rgbToHex(this._r, this._g, this._b, allow3Char);
        },
        toHexString: function(allow3Char) {
            return '#' + this.toHex(allow3Char);
        },
        toHex8: function() {
            return rgbaToHex(this._r, this._g, this._b, this._a);
        },
        toHex8String: function() {
            return '#' + this.toHex8();
        },
        toRgb: function() {
            return { r: mathRound(this._r), g: mathRound(this._g), b: mathRound(this._b), a: this._a };
        },
        toRgbString: function() {
            return (this._a == 1) ?
              "rgb("  + mathRound(this._r) + ", " + mathRound(this._g) + ", " + mathRound(this._b) + ")" :
              "rgba(" + mathRound(this._r) + ", " + mathRound(this._g) + ", " + mathRound(this._b) + ", " + this._roundA + ")";
        },
        toPercentageRgb: function() {
            return { r: mathRound(bound01(this._r, 255) * 100) + "%", g: mathRound(bound01(this._g, 255) * 100) + "%", b: mathRound(bound01(this._b, 255) * 100) + "%", a: this._a };
        },
        toPercentageRgbString: function() {
            return (this._a == 1) ?
              "rgb("  + mathRound(bound01(this._r, 255) * 100) + "%, " + mathRound(bound01(this._g, 255) * 100) + "%, " + mathRound(bound01(this._b, 255) * 100) + "%)" :
              "rgba(" + mathRound(bound01(this._r, 255) * 100) + "%, " + mathRound(bound01(this._g, 255) * 100) + "%, " + mathRound(bound01(this._b, 255) * 100) + "%, " + this._roundA + ")";
        },
        toName: function() {
            if (this._a === 0) {
                return "transparent";
            }

            if (this._a < 1) {
                return false;
            }

            return hexNames[rgbToHex(this._r, this._g, this._b, true)] || false;
        },
        toFilter: function(secondColor) {
            var hex8String = '#' + rgbaToHex(this._r, this._g, this._b, this._a);
            var secondHex8String = hex8String;
            var gradientType = this._gradientType ? "GradientType = 1, " : "";

            if (secondColor) {
                var s = tinycolor(secondColor);
                secondHex8String = s.toHex8String();
            }

            return "progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")";
        },
        toString: function(format) {
            var formatSet = !!format;
            format = format || this._format;

            var formattedString = false;
            var hasAlpha = this._a < 1 && this._a >= 0;
            var needsAlphaFormat = !formatSet && hasAlpha && (format === "hex" || format === "hex6" || format === "hex3" || format === "name");

            if (needsAlphaFormat) {
                // Special case for "transparent", all other non-alpha formats
                // will return rgba when there is transparency.
                if (format === "name" && this._a === 0) {
                    return this.toName();
                }
                return this.toRgbString();
            }
            if (format === "rgb") {
                formattedString = this.toRgbString();
            }
            if (format === "prgb") {
                formattedString = this.toPercentageRgbString();
            }
            if (format === "hex" || format === "hex6") {
                formattedString = this.toHexString();
            }
            if (format === "hex3") {
                formattedString = this.toHexString(true);
            }
            if (format === "hex8") {
                formattedString = this.toHex8String();
            }
            if (format === "name") {
                formattedString = this.toName();
            }
            if (format === "hsl") {
                formattedString = this.toHslString();
            }
            if (format === "hsv") {
                formattedString = this.toHsvString();
            }

            return formattedString || this.toHexString();
        },

        _applyModification: function(fn, args) {
            var color = fn.apply(null, [this].concat([].slice.call(args)));
            this._r = color._r;
            this._g = color._g;
            this._b = color._b;
            this.setAlpha(color._a);
            return this;
        },
        lighten: function() {
            return this._applyModification(lighten, arguments);
        },
        brighten: function() {
            return this._applyModification(brighten, arguments);
        },
        darken: function() {
            return this._applyModification(darken, arguments);
        },
        desaturate: function() {
            return this._applyModification(desaturate, arguments);
        },
        saturate: function() {
            return this._applyModification(saturate, arguments);
        },
        greyscale: function() {
            return this._applyModification(greyscale, arguments);
        },
        spin: function() {
            return this._applyModification(spin, arguments);
        },

        _applyCombination: function(fn, args) {
            return fn.apply(null, [this].concat([].slice.call(args)));
        },
        analogous: function() {
            return this._applyCombination(analogous, arguments);
        },
        complement: function() {
            return this._applyCombination(complement, arguments);
        },
        monochromatic: function() {
            return this._applyCombination(monochromatic, arguments);
        },
        splitcomplement: function() {
            return this._applyCombination(splitcomplement, arguments);
        },
        triad: function() {
            return this._applyCombination(triad, arguments);
        },
        tetrad: function() {
            return this._applyCombination(tetrad, arguments);
        }
    };

    // If input is an object, force 1 into "1.0" to handle ratios properly
    // String input requires "1.0" as input, so 1 will be treated as 1
    tinycolor.fromRatio = function(color, opts) {
        if (typeof color == "object") {
            var newColor = {};
            for (var i in color) {
                if (color.hasOwnProperty(i)) {
                    if (i === "a") {
                        newColor[i] = color[i];
                    }
                    else {
                        newColor[i] = convertToPercentage(color[i]);
                    }
                }
            }
            color = newColor;
        }

        return tinycolor(color, opts);
    };

    // Given a string or object, convert that input to RGB
    // Possible string inputs:
    //
    //     "red"
    //     "#f00" or "f00"
    //     "#ff0000" or "ff0000"
    //     "#ff000000" or "ff000000"
    //     "rgb 255 0 0" or "rgb (255, 0, 0)"
    //     "rgb 1.0 0 0" or "rgb (1, 0, 0)"
    //     "rgba (255, 0, 0, 1)" or "rgba 255, 0, 0, 1"
    //     "rgba (1.0, 0, 0, 1)" or "rgba 1.0, 0, 0, 1"
    //     "hsl(0, 100%, 50%)" or "hsl 0 100% 50%"
    //     "hsla(0, 100%, 50%, 1)" or "hsla 0 100% 50%, 1"
    //     "hsv(0, 100%, 100%)" or "hsv 0 100% 100%"
    //
    function inputToRGB(color) {

        var rgb = { r: 0, g: 0, b: 0 };
        var a = 1;
        var ok = false;
        var format = false;

        if (typeof color == "string") {
            color = stringInputToObject(color);
        }

        if (typeof color == "object") {
            if (color.hasOwnProperty("r") && color.hasOwnProperty("g") && color.hasOwnProperty("b")) {
                rgb = rgbToRgb(color.r, color.g, color.b);
                ok = true;
                format = String(color.r).substr(-1) === "%" ? "prgb" : "rgb";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("v")) {
                color.s = convertToPercentage(color.s);
                color.v = convertToPercentage(color.v);
                rgb = hsvToRgb(color.h, color.s, color.v);
                ok = true;
                format = "hsv";
            }
            else if (color.hasOwnProperty("h") && color.hasOwnProperty("s") && color.hasOwnProperty("l")) {
                color.s = convertToPercentage(color.s);
                color.l = convertToPercentage(color.l);
                rgb = hslToRgb(color.h, color.s, color.l);
                ok = true;
                format = "hsl";
            }

            if (color.hasOwnProperty("a")) {
                a = color.a;
            }
        }

        a = boundAlpha(a);

        return {
            ok: ok,
            format: color.format || format,
            r: mathMin(255, mathMax(rgb.r, 0)),
            g: mathMin(255, mathMax(rgb.g, 0)),
            b: mathMin(255, mathMax(rgb.b, 0)),
            a: a
        };
    }


    // Conversion Functions
    // --------------------

    // `rgbToHsl`, `rgbToHsv`, `hslToRgb`, `hsvToRgb` modified from:
    // <http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript>

    // `rgbToRgb`
    // Handle bounds / percentage checking to conform to CSS color spec
    // <http://www.w3.org/TR/css3-color/>
    // *Assumes:* r, g, b in [0, 255] or [0, 1]
    // *Returns:* { r, g, b } in [0, 255]
    function rgbToRgb(r, g, b){
        return {
            r: bound01(r, 255) * 255,
            g: bound01(g, 255) * 255,
            b: bound01(b, 255) * 255
        };
    }

    // `rgbToHsl`
    // Converts an RGB color value to HSL.
    // *Assumes:* r, g, and b are contained in [0, 255] or [0, 1]
    // *Returns:* { h, s, l } in [0,1]
    function rgbToHsl(r, g, b) {

        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);

        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, l = (max + min) / 2;

        if(max == min) {
            h = s = 0; // achromatic
        }
        else {
            var d = max - min;
            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }

            h /= 6;
        }

        return { h: h, s: s, l: l };
    }

    // `hslToRgb`
    // Converts an HSL color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and l are contained [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
    function hslToRgb(h, s, l) {
        var r, g, b;

        h = bound01(h, 360);
        s = bound01(s, 100);
        l = bound01(l, 100);

        function hue2rgb(p, q, t) {
            if(t < 0) t += 1;
            if(t > 1) t -= 1;
            if(t < 1/6) return p + (q - p) * 6 * t;
            if(t < 1/2) return q;
            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        }

        if(s === 0) {
            r = g = b = l; // achromatic
        }
        else {
            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            var p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
        }

        return { r: r * 255, g: g * 255, b: b * 255 };
    }

    // `rgbToHsv`
    // Converts an RGB color value to HSV
    // *Assumes:* r, g, and b are contained in the set [0, 255] or [0, 1]
    // *Returns:* { h, s, v } in [0,1]
    function rgbToHsv(r, g, b) {

        r = bound01(r, 255);
        g = bound01(g, 255);
        b = bound01(b, 255);

        var max = mathMax(r, g, b), min = mathMin(r, g, b);
        var h, s, v = max;

        var d = max - min;
        s = max === 0 ? 0 : d / max;

        if(max == min) {
            h = 0; // achromatic
        }
        else {
            switch(max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6;
        }
        return { h: h, s: s, v: v };
    }

    // `hsvToRgb`
    // Converts an HSV color value to RGB.
    // *Assumes:* h is contained in [0, 1] or [0, 360] and s and v are contained in [0, 1] or [0, 100]
    // *Returns:* { r, g, b } in the set [0, 255]
     function hsvToRgb(h, s, v) {

        h = bound01(h, 360) * 6;
        s = bound01(s, 100);
        v = bound01(v, 100);

        var i = math.floor(h),
            f = h - i,
            p = v * (1 - s),
            q = v * (1 - f * s),
            t = v * (1 - (1 - f) * s),
            mod = i % 6,
            r = [v, q, p, p, t, v][mod],
            g = [t, v, v, q, p, p][mod],
            b = [p, p, t, v, v, q][mod];

        return { r: r * 255, g: g * 255, b: b * 255 };
    }

    // `rgbToHex`
    // Converts an RGB color to hex
    // Assumes r, g, and b are contained in the set [0, 255]
    // Returns a 3 or 6 character hex
    function rgbToHex(r, g, b, allow3Char) {

        var hex = [
            pad2(mathRound(r).toString(16)),
            pad2(mathRound(g).toString(16)),
            pad2(mathRound(b).toString(16))
        ];

        // Return a 3 character hex if possible
        if (allow3Char && hex[0].charAt(0) == hex[0].charAt(1) && hex[1].charAt(0) == hex[1].charAt(1) && hex[2].charAt(0) == hex[2].charAt(1)) {
            return hex[0].charAt(0) + hex[1].charAt(0) + hex[2].charAt(0);
        }

        return hex.join("");
    }
        // `rgbaToHex`
        // Converts an RGBA color plus alpha transparency to hex
        // Assumes r, g, b and a are contained in the set [0, 255]
        // Returns an 8 character hex
        function rgbaToHex(r, g, b, a) {

            var hex = [
                pad2(convertDecimalToHex(a)),
                pad2(mathRound(r).toString(16)),
                pad2(mathRound(g).toString(16)),
                pad2(mathRound(b).toString(16))
            ];

            return hex.join("");
        }

    // `equals`
    // Can be called with any tinycolor input
    tinycolor.equals = function (color1, color2) {
        if (!color1 || !color2) { return false; }
        return tinycolor(color1).toRgbString() == tinycolor(color2).toRgbString();
    };
    tinycolor.random = function() {
        return tinycolor.fromRatio({
            r: mathRandom(),
            g: mathRandom(),
            b: mathRandom()
        });
    };


    // Modification Functions
    // ----------------------
    // Thanks to less.js for some of the basics here
    // <https://github.com/cloudhead/less.js/blob/master/lib/less/functions.js>

    function desaturate(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s -= amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    }

    function saturate(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.s += amount / 100;
        hsl.s = clamp01(hsl.s);
        return tinycolor(hsl);
    }

    function greyscale(color) {
        return tinycolor(color).desaturate(100);
    }

    function lighten (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l += amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    }

    function brighten(color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var rgb = tinycolor(color).toRgb();
        rgb.r = mathMax(0, mathMin(255, rgb.r - mathRound(255 * - (amount / 100))));
        rgb.g = mathMax(0, mathMin(255, rgb.g - mathRound(255 * - (amount / 100))));
        rgb.b = mathMax(0, mathMin(255, rgb.b - mathRound(255 * - (amount / 100))));
        return tinycolor(rgb);
    }

    function darken (color, amount) {
        amount = (amount === 0) ? 0 : (amount || 10);
        var hsl = tinycolor(color).toHsl();
        hsl.l -= amount / 100;
        hsl.l = clamp01(hsl.l);
        return tinycolor(hsl);
    }

    // Spin takes a positive or negative amount within [-360, 360] indicating the change of hue.
    // Values outside of this range will be wrapped into this range.
    function spin(color, amount) {
        var hsl = tinycolor(color).toHsl();
        var hue = (mathRound(hsl.h) + amount) % 360;
        hsl.h = hue < 0 ? 360 + hue : hue;
        return tinycolor(hsl);
    }

    // Combination Functions
    // ---------------------
    // Thanks to jQuery xColor for some of the ideas behind these
    // <https://github.com/infusion/jQuery-xcolor/blob/master/jquery.xcolor.js>

    function complement(color) {
        var hsl = tinycolor(color).toHsl();
        hsl.h = (hsl.h + 180) % 360;
        return tinycolor(hsl);
    }

    function triad(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 120) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 240) % 360, s: hsl.s, l: hsl.l })
        ];
    }

    function tetrad(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 90) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 180) % 360, s: hsl.s, l: hsl.l }),
            tinycolor({ h: (h + 270) % 360, s: hsl.s, l: hsl.l })
        ];
    }

    function splitcomplement(color) {
        var hsl = tinycolor(color).toHsl();
        var h = hsl.h;
        return [
            tinycolor(color),
            tinycolor({ h: (h + 72) % 360, s: hsl.s, l: hsl.l}),
            tinycolor({ h: (h + 216) % 360, s: hsl.s, l: hsl.l})
        ];
    }

    function analogous(color, results, slices) {
        results = results || 6;
        slices = slices || 30;

        var hsl = tinycolor(color).toHsl();
        var part = 360 / slices;
        var ret = [tinycolor(color)];

        for (hsl.h = ((hsl.h - (part * results >> 1)) + 720) % 360; --results; ) {
            hsl.h = (hsl.h + part) % 360;
            ret.push(tinycolor(hsl));
        }
        return ret;
    }

    function monochromatic(color, results) {
        results = results || 6;
        var hsv = tinycolor(color).toHsv();
        var h = hsv.h, s = hsv.s, v = hsv.v;
        var ret = [];
        var modification = 1 / results;

        while (results--) {
            ret.push(tinycolor({ h: h, s: s, v: v}));
            v = (v + modification) % 1;
        }

        return ret;
    }

    // Utility Functions
    // ---------------------

    tinycolor.mix = function(color1, color2, amount) {
        amount = (amount === 0) ? 0 : (amount || 50);

        var rgb1 = tinycolor(color1).toRgb();
        var rgb2 = tinycolor(color2).toRgb();

        var p = amount / 100;
        var w = p * 2 - 1;
        var a = rgb2.a - rgb1.a;

        var w1;

        if (w * a == -1) {
            w1 = w;
        } else {
            w1 = (w + a) / (1 + w * a);
        }

        w1 = (w1 + 1) / 2;

        var w2 = 1 - w1;

        var rgba = {
            r: rgb2.r * w1 + rgb1.r * w2,
            g: rgb2.g * w1 + rgb1.g * w2,
            b: rgb2.b * w1 + rgb1.b * w2,
            a: rgb2.a * p  + rgb1.a * (1 - p)
        };

        return tinycolor(rgba);
    };


    // Readability Functions
    // ---------------------
    // <http://www.w3.org/TR/AERT#color-contrast>

    // `readability`
    // Analyze the 2 colors and returns an object with the following properties:
    //    `brightness`: difference in brightness between the two colors
    //    `color`: difference in color/hue between the two colors
    tinycolor.readability = function(color1, color2) {
        var c1 = tinycolor(color1);
        var c2 = tinycolor(color2);
        var rgb1 = c1.toRgb();
        var rgb2 = c2.toRgb();
        var brightnessA = c1.getBrightness();
        var brightnessB = c2.getBrightness();
        var colorDiff = (
            Math.max(rgb1.r, rgb2.r) - Math.min(rgb1.r, rgb2.r) +
            Math.max(rgb1.g, rgb2.g) - Math.min(rgb1.g, rgb2.g) +
            Math.max(rgb1.b, rgb2.b) - Math.min(rgb1.b, rgb2.b)
        );

        return {
            brightness: Math.abs(brightnessA - brightnessB),
            color: colorDiff
        };
    };

    // `readable`
    // http://www.w3.org/TR/AERT#color-contrast
    // Ensure that foreground and background color combinations provide sufficient contrast.
    // *Example*
    //    tinycolor.isReadable("#000", "#111") => false
    tinycolor.isReadable = function(color1, color2) {
        var readability = tinycolor.readability(color1, color2);
        return readability.brightness > 125 && readability.color > 500;
    };

    // `mostReadable`
    // Given a base color and a list of possible foreground or background
    // colors for that base, returns the most readable color.
    // *Example*
    //    tinycolor.mostReadable("#123", ["#fff", "#000"]) => "#000"
    tinycolor.mostReadable = function(baseColor, colorList) {
        var bestColor = null;
        var bestScore = 0;
        var bestIsReadable = false;
        for (var i=0; i < colorList.length; i++) {

            // We normalize both around the "acceptable" breaking point,
            // but rank brightness constrast higher than hue.

            var readability = tinycolor.readability(baseColor, colorList[i]);
            var readable = readability.brightness > 125 && readability.color > 500;
            var score = 3 * (readability.brightness / 125) + (readability.color / 500);

            if ((readable && ! bestIsReadable) ||
                (readable && bestIsReadable && score > bestScore) ||
                ((! readable) && (! bestIsReadable) && score > bestScore)) {
                bestIsReadable = readable;
                bestScore = score;
                bestColor = tinycolor(colorList[i]);
            }
        }
        return bestColor;
    };


    // Big List of Colors
    // ------------------
    // <http://www.w3.org/TR/css3-color/#svg-color>
    var names = tinycolor.names = {
        aliceblue: "f0f8ff",
        antiquewhite: "faebd7",
        aqua: "0ff",
        aquamarine: "7fffd4",
        azure: "f0ffff",
        beige: "f5f5dc",
        bisque: "ffe4c4",
        black: "000",
        blanchedalmond: "ffebcd",
        blue: "00f",
        blueviolet: "8a2be2",
        brown: "a52a2a",
        burlywood: "deb887",
        burntsienna: "ea7e5d",
        cadetblue: "5f9ea0",
        chartreuse: "7fff00",
        chocolate: "d2691e",
        coral: "ff7f50",
        cornflowerblue: "6495ed",
        cornsilk: "fff8dc",
        crimson: "dc143c",
        cyan: "0ff",
        darkblue: "00008b",
        darkcyan: "008b8b",
        darkgoldenrod: "b8860b",
        darkgray: "a9a9a9",
        darkgreen: "006400",
        darkgrey: "a9a9a9",
        darkkhaki: "bdb76b",
        darkmagenta: "8b008b",
        darkolivegreen: "556b2f",
        darkorange: "ff8c00",
        darkorchid: "9932cc",
        darkred: "8b0000",
        darksalmon: "e9967a",
        darkseagreen: "8fbc8f",
        darkslateblue: "483d8b",
        darkslategray: "2f4f4f",
        darkslategrey: "2f4f4f",
        darkturquoise: "00ced1",
        darkviolet: "9400d3",
        deeppink: "ff1493",
        deepskyblue: "00bfff",
        dimgray: "696969",
        dimgrey: "696969",
        dodgerblue: "1e90ff",
        firebrick: "b22222",
        floralwhite: "fffaf0",
        forestgreen: "228b22",
        fuchsia: "f0f",
        gainsboro: "dcdcdc",
        ghostwhite: "f8f8ff",
        gold: "ffd700",
        goldenrod: "daa520",
        gray: "808080",
        green: "008000",
        greenyellow: "adff2f",
        grey: "808080",
        honeydew: "f0fff0",
        hotpink: "ff69b4",
        indianred: "cd5c5c",
        indigo: "4b0082",
        ivory: "fffff0",
        khaki: "f0e68c",
        lavender: "e6e6fa",
        lavenderblush: "fff0f5",
        lawngreen: "7cfc00",
        lemonchiffon: "fffacd",
        lightblue: "add8e6",
        lightcoral: "f08080",
        lightcyan: "e0ffff",
        lightgoldenrodyellow: "fafad2",
        lightgray: "d3d3d3",
        lightgreen: "90ee90",
        lightgrey: "d3d3d3",
        lightpink: "ffb6c1",
        lightsalmon: "ffa07a",
        lightseagreen: "20b2aa",
        lightskyblue: "87cefa",
        lightslategray: "789",
        lightslategrey: "789",
        lightsteelblue: "b0c4de",
        lightyellow: "ffffe0",
        lime: "0f0",
        limegreen: "32cd32",
        linen: "faf0e6",
        magenta: "f0f",
        maroon: "800000",
        mediumaquamarine: "66cdaa",
        mediumblue: "0000cd",
        mediumorchid: "ba55d3",
        mediumpurple: "9370db",
        mediumseagreen: "3cb371",
        mediumslateblue: "7b68ee",
        mediumspringgreen: "00fa9a",
        mediumturquoise: "48d1cc",
        mediumvioletred: "c71585",
        midnightblue: "191970",
        mintcream: "f5fffa",
        mistyrose: "ffe4e1",
        moccasin: "ffe4b5",
        navajowhite: "ffdead",
        navy: "000080",
        oldlace: "fdf5e6",
        olive: "808000",
        olivedrab: "6b8e23",
        orange: "ffa500",
        orangered: "ff4500",
        orchid: "da70d6",
        palegoldenrod: "eee8aa",
        palegreen: "98fb98",
        paleturquoise: "afeeee",
        palevioletred: "db7093",
        papayawhip: "ffefd5",
        peachpuff: "ffdab9",
        peru: "cd853f",
        pink: "ffc0cb",
        plum: "dda0dd",
        powderblue: "b0e0e6",
        purple: "800080",
        rebeccapurple: "663399",
        red: "f00",
        rosybrown: "bc8f8f",
        royalblue: "4169e1",
        saddlebrown: "8b4513",
        salmon: "fa8072",
        sandybrown: "f4a460",
        seagreen: "2e8b57",
        seashell: "fff5ee",
        sienna: "a0522d",
        silver: "c0c0c0",
        skyblue: "87ceeb",
        slateblue: "6a5acd",
        slategray: "708090",
        slategrey: "708090",
        snow: "fffafa",
        springgreen: "00ff7f",
        steelblue: "4682b4",
        tan: "d2b48c",
        teal: "008080",
        thistle: "d8bfd8",
        tomato: "ff6347",
        turquoise: "40e0d0",
        violet: "ee82ee",
        wheat: "f5deb3",
        white: "fff",
        whitesmoke: "f5f5f5",
        yellow: "ff0",
        yellowgreen: "9acd32"
    };

    // Make it easy to access colors via `hexNames[hex]`
    var hexNames = tinycolor.hexNames = flip(names);


    // Utilities
    // ---------

    // `{ 'name1': 'val1' }` becomes `{ 'val1': 'name1' }`
    function flip(o) {
        var flipped = { };
        for (var i in o) {
            if (o.hasOwnProperty(i)) {
                flipped[o[i]] = i;
            }
        }
        return flipped;
    }

    // Return a valid alpha value [0,1] with all invalid values being set to 1
    function boundAlpha(a) {
        a = parseFloat(a);

        if (isNaN(a) || a < 0 || a > 1) {
            a = 1;
        }

        return a;
    }

    // Take input from [0, n] and return it as [0, 1]
    function bound01(n, max) {
        if (isOnePointZero(n)) { n = "100%"; }

        var processPercent = isPercentage(n);
        n = mathMin(max, mathMax(0, parseFloat(n)));

        // Automatically convert percentage into number
        if (processPercent) {
            n = parseInt(n * max, 10) / 100;
        }

        // Handle floating point rounding errors
        if ((math.abs(n - max) < 0.000001)) {
            return 1;
        }

        // Convert into [0, 1] range if it isn't already
        return (n % max) / parseFloat(max);
    }

    // Force a number between 0 and 1
    function clamp01(val) {
        return mathMin(1, mathMax(0, val));
    }

    // Parse a base-16 hex value into a base-10 integer
    function parseIntFromHex(val) {
        return parseInt(val, 16);
    }

    // Need to handle 1.0 as 100%, since once it is a number, there is no difference between it and 1
    // <http://stackoverflow.com/questions/7422072/javascript-how-to-detect-number-as-a-decimal-including-1-0>
    function isOnePointZero(n) {
        return typeof n == "string" && n.indexOf('.') != -1 && parseFloat(n) === 1;
    }

    // Check to see if string passed in is a percentage
    function isPercentage(n) {
        return typeof n === "string" && n.indexOf('%') != -1;
    }

    // Force a hex value to have 2 characters
    function pad2(c) {
        return c.length == 1 ? '0' + c : '' + c;
    }

    // Replace a decimal with it's percentage value
    function convertToPercentage(n) {
        if (n <= 1) {
            n = (n * 100) + "%";
        }

        return n;
    }

    // Converts a decimal to a hex value
    function convertDecimalToHex(d) {
        return Math.round(parseFloat(d) * 255).toString(16);
    }
    // Converts a hex value to a decimal
    function convertHexToDecimal(h) {
        return (parseIntFromHex(h) / 255);
    }

    var matchers = (function() {

        // <http://www.w3.org/TR/css3-values/#integers>
        var CSS_INTEGER = "[-\\+]?\\d+%?";

        // <http://www.w3.org/TR/css3-values/#number-value>
        var CSS_NUMBER = "[-\\+]?\\d*\\.\\d+%?";

        // Allow positive/negative integer/number.  Don't capture the either/or, just the entire outcome.
        var CSS_UNIT = "(?:" + CSS_NUMBER + ")|(?:" + CSS_INTEGER + ")";

        // Actual matching.
        // Parentheses and commas are optional, but not required.
        // Whitespace can take the place of commas or opening paren
        var PERMISSIVE_MATCH3 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";
        var PERMISSIVE_MATCH4 = "[\\s|\\(]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")[,|\\s]+(" + CSS_UNIT + ")\\s*\\)?";

        return {
            rgb: new RegExp("rgb" + PERMISSIVE_MATCH3),
            rgba: new RegExp("rgba" + PERMISSIVE_MATCH4),
            hsl: new RegExp("hsl" + PERMISSIVE_MATCH3),
            hsla: new RegExp("hsla" + PERMISSIVE_MATCH4),
            hsv: new RegExp("hsv" + PERMISSIVE_MATCH3),
            hsva: new RegExp("hsva" + PERMISSIVE_MATCH4),
            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,
            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
            hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/
        };
    })();

    // `stringInputToObject`
    // Permissive string parsing.  Take in a number of formats, and output an object
    // based on detected format.  Returns `{ r, g, b }` or `{ h, s, l }` or `{ h, s, v}`
    function stringInputToObject(color) {

        color = color.replace(trimLeft,'').replace(trimRight, '').toLowerCase();
        var named = false;
        if (names[color]) {
            color = names[color];
            named = true;
        }
        else if (color == 'transparent') {
            return { r: 0, g: 0, b: 0, a: 0, format: "name" };
        }

        // Try to match string input using regular expressions.
        // Keep most of the number bounding out of this function - don't worry about [0,1] or [0,100] or [0,360]
        // Just return an object and let the conversion functions handle that.
        // This way the result will be the same whether the tinycolor is initialized with string or object.
        var match;
        if ((match = matchers.rgb.exec(color))) {
            return { r: match[1], g: match[2], b: match[3] };
        }
        if ((match = matchers.rgba.exec(color))) {
            return { r: match[1], g: match[2], b: match[3], a: match[4] };
        }
        if ((match = matchers.hsl.exec(color))) {
            return { h: match[1], s: match[2], l: match[3] };
        }
        if ((match = matchers.hsla.exec(color))) {
            return { h: match[1], s: match[2], l: match[3], a: match[4] };
        }
        if ((match = matchers.hsv.exec(color))) {
            return { h: match[1], s: match[2], v: match[3] };
        }
        if ((match = matchers.hsva.exec(color))) {
            return { h: match[1], s: match[2], v: match[3], a: match[4] };
        }
        if ((match = matchers.hex8.exec(color))) {
            return {
                a: convertHexToDecimal(match[1]),
                r: parseIntFromHex(match[2]),
                g: parseIntFromHex(match[3]),
                b: parseIntFromHex(match[4]),
                format: named ? "name" : "hex8"
            };
        }
        if ((match = matchers.hex6.exec(color))) {
            return {
                r: parseIntFromHex(match[1]),
                g: parseIntFromHex(match[2]),
                b: parseIntFromHex(match[3]),
                format: named ? "name" : "hex"
            };
        }
        if ((match = matchers.hex3.exec(color))) {
            return {
                r: parseIntFromHex(match[1] + '' + match[1]),
                g: parseIntFromHex(match[2] + '' + match[2]),
                b: parseIntFromHex(match[3] + '' + match[3]),
                format: named ? "name" : "hex"
            };
        }

        return false;
    }

    window.tinycolor = tinycolor;
    })();

    $(function () {
        if ($.fn.spectrum.load) {
            $.fn.spectrum.processNativeColorInputs();
        }
    });

});

/*
 * jQuery MiniColors: A tiny color picker built on jQuery
 *
 * Copyright: Cory LaViska for A Beautiful Site, LLC.
 *
 * Contributions and bug reports: https://github.com/claviska/jquery-minicolors
 *
 * Licensed under the MIT license: http://opensource.org/licenses/MIT
 *
 */
if(jQuery)(function($){$.minicolors={defaults:{animationSpeed:50,animationEasing:'swing',change:null,changeDelay:0,control:'hue',dataUris:true,defaultValue:'',hide:null,hideSpeed:100,inline:false,letterCase:'lowercase',opacity:false,position:'bottom left',show:null,showSpeed:100,theme:'default'}};$.extend($.fn,{minicolors:function(method,data){switch(method){case'destroy':$(this).each(function(){destroy($(this))});return $(this);case'hide':hide();return $(this);case'opacity':if(data===undefined){return $(this).attr('data-opacity')}else{$(this).each(function(){updateFromInput($(this).attr('data-opacity',data))})}return $(this);case'rgbObject':return rgbObject($(this),method==='rgbaObject');case'rgbString':case'rgbaString':return rgbString($(this),method==='rgbaString');case'settings':if(data===undefined){return $(this).data('minicolors-settings')}else{$(this).each(function(){var settings=$(this).data('minicolors-settings')||{};destroy($(this));$(this).minicolors($.extend(true,settings,data))})}return $(this);case'show':show($(this).eq(0));return $(this);case'value':if(data===undefined){return $(this).val()}else{$(this).each(function(){updateFromInput($(this).val(data))})}return $(this);default:if(method!=='create')data=method;$(this).each(function(){init($(this),data)});return $(this)}}});function init(input,settings){var minicolors=$('<div class="minicolors" />'),defaults=$.minicolors.defaults;if(input.data('minicolors-initialized'))return;settings=$.extend(true,{},defaults,settings);minicolors.addClass('minicolors-theme-'+settings.exam).toggleClass('minicolors-with-opacity',settings.opacity).toggleClass('minicolors-no-data-uris',settings.dataUris!==true);if(settings.position!==undefined){$.each(settings.position.split(' '),function(){minicolors.addClass('minicolors-position-'+this)})}input.addClass('minicolors-input').data('minicolors-initialized',false).data('minicolors-settings',settings).prop('size',7).wrap(minicolors).after('<div class="minicolors-panel minicolors-slider-'+settings.control+'">'+'<div class="minicolors-slider minicolors-sprite">'+'<div class="minicolors-picker"></div>'+'</div>'+'<div class="minicolors-opacity-slider minicolors-sprite">'+'<div class="minicolors-picker"></div>'+'</div>'+'<div class="minicolors-grid minicolors-sprite">'+'<div class="minicolors-grid-inner"></div>'+'<div class="minicolors-picker"><div></div></div>'+'</div>'+'</div>');if(!settings.inline){input.after('<span class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></span>');input.next('.minicolors-swatch').on('click',function(event){event.preventDefault();input.focus()})}input.parent().find('.minicolors-panel').on('selectstart',function(){return false}).end();if(settings.inline)input.parent().addClass('minicolors-inline');updateFromInput(input,false);input.data('minicolors-initialized',true)}function destroy(input){var minicolors=input.parent();input.removeData('minicolors-initialized').removeData('minicolors-settings').removeProp('size').removeClass('minicolors-input');minicolors.before(input).remove()}function show(input){var minicolors=input.parent(),panel=minicolors.find('.minicolors-panel'),settings=input.data('minicolors-settings');if(!input.data('minicolors-initialized')||input.prop('disabled')||minicolors.hasClass('minicolors-inline')||minicolors.hasClass('minicolors-focus'))return;hide();minicolors.addClass('minicolors-focus');panel.stop(true,true).fadeIn(settings.showSpeed,function(){if(settings.show)settings.show.call(input.get(0))})}function hide(){$('.minicolors-focus').each(function(){var minicolors=$(this),input=minicolors.find('.minicolors-input'),panel=minicolors.find('.minicolors-panel'),settings=input.data('minicolors-settings');panel.fadeOut(settings.hideSpeed,function(){if(settings.hide)settings.hide.call(input.get(0));minicolors.removeClass('minicolors-focus')})})}function move(target,event,animate){var input=target.parents('.minicolors').find('.minicolors-input'),settings=input.data('minicolors-settings'),picker=target.find('[class$=-picker]'),offsetX=target.offset().left,offsetY=target.offset().top,x=Math.round(event.pageX-offsetX),y=Math.round(event.pageY-offsetY),duration=animate?settings.animationSpeed:0,wx,wy,r,phi;if(event.originalEvent.changedTouches){x=event.originalEvent.changedTouches[0].pageX-offsetX;y=event.originalEvent.changedTouches[0].pageY-offsetY}if(x<0)x=0;if(y<0)y=0;if(x>target.width())x=target.width();if(y>target.height())y=target.height();if(target.parent().is('.minicolors-slider-wheel')&&picker.parent().is('.minicolors-grid')){wx=75-x;wy=75-y;r=Math.sqrt(wx*wx+wy*wy);phi=Math.atan2(wy,wx);if(phi<0)phi+=Math.PI*2;if(r>75){r=75;x=75-(75*Math.cos(phi));y=75-(75*Math.sin(phi))}x=Math.round(x);y=Math.round(y)}if(target.is('.minicolors-grid')){picker.stop(true).animate({top:y+'px',left:x+'px'},duration,settings.animationEasing,function(){updateFromControl(input,target)})}else{picker.stop(true).animate({top:y+'px'},duration,settings.animationEasing,function(){updateFromControl(input,target)})}}function updateFromControl(input,target){function getCoords(picker,container){var left,top;if(!picker.length||!container)return null;left=picker.offset().left;top=picker.offset().top;return{x:left-container.offset().left+(picker.outerWidth()/2),y:top-container.offset().top+(picker.outerHeight()/2)}}var hue,saturation,brightness,x,y,r,phi,hex=input.val(),opacity=input.attr('data-opacity'),minicolors=input.parent(),settings=input.data('minicolors-settings'),swatch=minicolors.find('.minicolors-swatch'),grid=minicolors.find('.minicolors-grid'),slider=minicolors.find('.minicolors-slider'),opacitySlider=minicolors.find('.minicolors-opacity-slider'),gridPicker=grid.find('[class$=-picker]'),sliderPicker=slider.find('[class$=-picker]'),opacityPicker=opacitySlider.find('[class$=-picker]'),gridPos=getCoords(gridPicker,grid),sliderPos=getCoords(sliderPicker,slider),opacityPos=getCoords(opacityPicker,opacitySlider);if(target.is('.minicolors-grid, .minicolors-slider')){switch(settings.control){case'wheel':x=(grid.width()/2)-gridPos.x;y=(grid.height()/2)-gridPos.y;r=Math.sqrt(x*x+y*y);phi=Math.atan2(y,x);if(phi<0)phi+=Math.PI*2;if(r>75){r=75;gridPos.x=69-(75*Math.cos(phi));gridPos.y=69-(75*Math.sin(phi))}saturation=keepWithin(r/0.75,0,100);hue=keepWithin(phi*180/Math.PI,0,360);brightness=keepWithin(100-Math.floor(sliderPos.y*(100/slider.height())),0,100);hex=hsb2hex({h:hue,s:saturation,b:brightness});slider.css('backgroundColor',hsb2hex({h:hue,s:saturation,b:100}));break;case'saturation':hue=keepWithin(parseInt(gridPos.x*(360/grid.width()),10),0,360);saturation=keepWithin(100-Math.floor(sliderPos.y*(100/slider.height())),0,100);brightness=keepWithin(100-Math.floor(gridPos.y*(100/grid.height())),0,100);hex=hsb2hex({h:hue,s:saturation,b:brightness});slider.css('backgroundColor',hsb2hex({h:hue,s:100,b:brightness}));minicolors.find('.minicolors-grid-inner').css('opacity',saturation/100);break;case'brightness':hue=keepWithin(parseInt(gridPos.x*(360/grid.width()),10),0,360);saturation=keepWithin(100-Math.floor(gridPos.y*(100/grid.height())),0,100);brightness=keepWithin(100-Math.floor(sliderPos.y*(100/slider.height())),0,100);hex=hsb2hex({h:hue,s:saturation,b:brightness});slider.css('backgroundColor',hsb2hex({h:hue,s:saturation,b:100}));minicolors.find('.minicolors-grid-inner').css('opacity',1-(brightness/100));break;default:hue=keepWithin(360-parseInt(sliderPos.y*(360/slider.height()),10),0,360);saturation=keepWithin(Math.floor(gridPos.x*(100/grid.width())),0,100);brightness=keepWithin(100-Math.floor(gridPos.y*(100/grid.height())),0,100);hex=hsb2hex({h:hue,s:saturation,b:brightness});grid.css('backgroundColor',hsb2hex({h:hue,s:100,b:100}));break}input.val(convertCase(hex,settings.letterCase))}if(target.is('.minicolors-opacity-slider')){if(settings.opacity){opacity=parseFloat(1-(opacityPos.y/opacitySlider.height())).toFixed(2)}else{opacity=1}if(settings.opacity)input.attr('data-opacity',opacity)}swatch.find('SPAN').css({backgroundColor:hex,opacity:opacity});doChange(input,hex,opacity)}function updateFromInput(input,preserveInputValue){var hex,hsb,opacity,x,y,r,phi,minicolors=input.parent(),settings=input.data('minicolors-settings'),swatch=minicolors.find('.minicolors-swatch'),grid=minicolors.find('.minicolors-grid'),slider=minicolors.find('.minicolors-slider'),opacitySlider=minicolors.find('.minicolors-opacity-slider'),gridPicker=grid.find('[class$=-picker]'),sliderPicker=slider.find('[class$=-picker]'),opacityPicker=opacitySlider.find('[class$=-picker]');hex=convertCase(parseHex(input.val(),true),settings.letterCase);if(!hex){hex=convertCase(parseHex(settings.defaultValue,true),settings.letterCase)}hsb=hex2hsb(hex);if(!preserveInputValue)input.val(hex);if(settings.opacity){opacity=input.attr('data-opacity')===''?1:keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2),0,1);if(isNaN(opacity))opacity=1;input.attr('data-opacity',opacity);swatch.find('SPAN').css('opacity',opacity);y=keepWithin(opacitySlider.height()-(opacitySlider.height()*opacity),0,opacitySlider.height());opacityPicker.css('top',y+'px')}swatch.find('SPAN').css('backgroundColor',hex);switch(settings.control){case'wheel':r=keepWithin(Math.ceil(hsb.s*0.75),0,grid.height()/2);phi=hsb.h*Math.PI/180;x=keepWithin(75-Math.cos(phi)*r,0,grid.width());y=keepWithin(75-Math.sin(phi)*r,0,grid.height());gridPicker.css({top:y+'px',left:x+'px'});y=150-(hsb.b/(100/grid.height()));if(hex==='')y=0;sliderPicker.css('top',y+'px');slider.css('backgroundColor',hsb2hex({h:hsb.h,s:hsb.s,b:100}));break;case'saturation':x=keepWithin((5*hsb.h)/12,0,150);y=keepWithin(grid.height()-Math.ceil(hsb.b/(100/grid.height())),0,grid.height());gridPicker.css({top:y+'px',left:x+'px'});y=keepWithin(slider.height()-(hsb.s*(slider.height()/100)),0,slider.height());sliderPicker.css('top',y+'px');slider.css('backgroundColor',hsb2hex({h:hsb.h,s:100,b:hsb.b}));minicolors.find('.minicolors-grid-inner').css('opacity',hsb.s/100);break;case'brightness':x=keepWithin((5*hsb.h)/12,0,150);y=keepWithin(grid.height()-Math.ceil(hsb.s/(100/grid.height())),0,grid.height());gridPicker.css({top:y+'px',left:x+'px'});y=keepWithin(slider.height()-(hsb.b*(slider.height()/100)),0,slider.height());sliderPicker.css('top',y+'px');slider.css('backgroundColor',hsb2hex({h:hsb.h,s:hsb.s,b:100}));minicolors.find('.minicolors-grid-inner').css('opacity',1-(hsb.b/100));break;default:x=keepWithin(Math.ceil(hsb.s/(100/grid.width())),0,grid.width());y=keepWithin(grid.height()-Math.ceil(hsb.b/(100/grid.height())),0,grid.height());gridPicker.css({top:y+'px',left:x+'px'});y=keepWithin(slider.height()-(hsb.h/(360/slider.height())),0,slider.height());sliderPicker.css('top',y+'px');grid.css('backgroundColor',hsb2hex({h:hsb.h,s:100,b:100}));break}if(input.data('minicolors-initialized')){doChange(input,hex,opacity)}}function doChange(input,hex,opacity){var settings=input.data('minicolors-settings'),lastChange=input.data('minicolors-lastChange');if(!lastChange||lastChange.hex!==hex||lastChange.opacity!==opacity){input.data('minicolors-lastChange',{hex:hex,opacity:opacity});if(settings.change){if(settings.changeDelay){clearTimeout(input.data('minicolors-changeTimeout'));input.data('minicolors-changeTimeout',setTimeout(function(){settings.change.call(input.get(0),hex,opacity)},settings.changeDelay))}else{settings.change.call(input.get(0),hex,opacity)}}input.trigger('change').trigger('input')}}function rgbObject(input){var hex=parseHex($(input).val(),true),rgb=hex2rgb(hex),opacity=$(input).attr('data-opacity');if(!rgb)return null;if(opacity!==undefined)$.extend(rgb,{a:parseFloat(opacity)});return rgb}function rgbString(input,alpha){var hex=parseHex($(input).val(),true),rgb=hex2rgb(hex),opacity=$(input).attr('data-opacity');if(!rgb)return null;if(opacity===undefined)opacity=1;if(alpha){return'rgba('+rgb.r+', '+rgb.g+', '+rgb.b+', '+parseFloat(opacity)+')'}else{return'rgb('+rgb.r+', '+rgb.g+', '+rgb.b+')'}}function convertCase(string,letterCase){return letterCase==='uppercase'?string.toUpperCase():string.toLowerCase()}function parseHex(string,expand){string=string.replace(/[^A-F0-9]/ig,'');if(string.length!==3&&string.length!==6)return'';if(string.length===3&&expand){string=string[0]+string[0]+string[1]+string[1]+string[2]+string[2]}return'#'+string}function keepWithin(value,min,max){if(value<min)value=min;if(value>max)value=max;return value}function hsb2rgb(hsb){var rgb={};var h=Math.round(hsb.h);var s=Math.round(hsb.s*255/100);var v=Math.round(hsb.b*255/100);if(s===0){rgb.r=rgb.g=rgb.b=v}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h===360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}else{rgb.r=0;rgb.g=0;rgb.b=0}}return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)}}function rgb2hex(rgb){var hex=[rgb.r.toString(16),rgb.g.toString(16),rgb.b.toString(16)];$.each(hex,function(nr,val){if(val.length===1)hex[nr]='0'+val});return'#'+hex.join('')}function hsb2hex(hsb){return rgb2hex(hsb2rgb(hsb))}function hex2hsb(hex){var hsb=rgb2hsb(hex2rgb(hex));if(hsb.s===0)hsb.h=360;return hsb}function rgb2hsb(rgb){var hsb={h:0,s:0,b:0};var min=Math.min(rgb.r,rgb.g,rgb.b);var max=Math.max(rgb.r,rgb.g,rgb.b);var delta=max-min;hsb.b=max;hsb.s=max!==0?255*delta/max:0;if(hsb.s!==0){if(rgb.r===max){hsb.h=(rgb.g-rgb.b)/delta}else if(rgb.g===max){hsb.h=2+(rgb.b-rgb.r)/delta}else{hsb.h=4+(rgb.r-rgb.g)/delta}}else{hsb.h=-1}hsb.h*=60;if(hsb.h<0){hsb.h+=360}hsb.s*=100/255;hsb.b*=100/255;return hsb}function hex2rgb(hex){hex=parseInt(((hex.indexOf('#')>-1)?hex.substring(1):hex),16);return{r:hex>>16,g:(hex&0x00FF00)>>8,b:(hex&0x0000FF)}}$(document).on('mousedown.minicolors touchstart.minicolors',function(event){if(!$(event.target).parents().add(event.target).hasClass('minicolors')){hide()}}).on('mousedown.minicolors touchstart.minicolors','.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider',function(event){var target=$(this);event.preventDefault();$(document).data('minicolors-target',target);move(target,event,true)}).on('mousemove.minicolors touchmove.minicolors',function(event){var target=$(document).data('minicolors-target');if(target)move(target,event)}).on('mouseup.minicolors touchend.minicolors',function(){$(this).removeData('minicolors-target')}).on('mousedown.minicolors touchstart.minicolors','.minicolors-swatch',function(event){var input=$(this).parent().find('.minicolors-input');event.preventDefault();show(input)}).on('focus.minicolors','.minicolors-input',function(){var input=$(this);if(!input.data('minicolors-initialized'))return;show(input)}).on('blur.minicolors','.minicolors-input',function(){var input=$(this),settings=input.data('minicolors-settings');if(!input.data('minicolors-initialized'))return;input.val(parseHex(input.val(),true));if(input.val()==='')input.val(parseHex(settings.defaultValue,true));input.val(convertCase(input.val(),settings.letterCase))}).on('keydown.minicolors','.minicolors-input',function(event){var input=$(this);if(!input.data('minicolors-initialized'))return;switch(event.keyCode){case 9:hide();break;case 13:case 27:hide();input.blur();break}}).on('keyup.minicolors','.minicolors-input',function(){var input=$(this);if(!input.data('minicolors-initialized'))return;updateFromInput(input,true)}).on('paste.minicolors','.minicolors-input',function(){var input=$(this);if(!input.data('minicolors-initialized'))return;setTimeout(function(){updateFromInput(input,true)},1)})})(jQuery);
/*
 * jQuery MiniColors: A tiny color picker built on jQuery
 *
 * Copyright: Cory LaViska for A Beautiful Site, LLC: http://www.abeautifulsite.net/
 *
 * Contribute: https://github.com/claviska/jquery-minicolors
 *
 * @license: http://opensource.org/licenses/MIT
 *
 */
(function (factory) {
    /* jshint ignore:start */
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], factory);
    } else if (typeof exports === 'object') {
        // Node/CommonJS
        module.exports = factory(require('jquery'));
    } else {
        // Browser globals
        factory(jQuery);
    }
    /* jshint ignore:end */
}(function ($) {

    // Defaults
    $.minicolors = {
        defaults: {
            animationSpeed: 50,
            animationEasing: 'swing',
            change: null,
            changeDelay: 0,
            control: 'hue',
            dataUris: true,
            defaultValue: '',
            hide: null,
            hideSpeed: 100,
            inline: false,
            letterCase: 'lowercase',
            opacity: false,
            position: 'bottom left',
            show: null,
            showSpeed: 100,
            theme: 'default'
        }
    };

    // Public methods
    $.extend($.fn, {
        minicolors: function (method, data) {

            switch (method) {

                // Destroy the control
                case 'destroy':
                    $(this).each(function () {
                        destroy($(this));
                    });
                    return $(this);

                    // Hide the color picker
                case 'hide':
                    hide();
                    return $(this);

                    // Get/set opacity
                case 'opacity':
                    // Getter
                    if (data === undefined) {
                        // Getter
                        return $(this).attr('data-opacity');
                    } else {
                        // Setter
                        $(this).each(function () {
                            updateFromInput($(this).attr('data-opacity', data));
                        });
                    }
                    return $(this);

                    // Get an RGB(A) object based on the current color/opacity
                case 'rgbObject':
                    return rgbObject($(this), method === 'rgbaObject');

                    // Get an RGB(A) string based on the current color/opacity
                case 'rgbString':
                case 'rgbaString':
                    return rgbString($(this), method === 'rgbaString');

                    // Get/set settings on the fly
                case 'settings':
                    if (data === undefined) {
                        return $(this).data('minicolors-settings');
                    } else {
                        // Setter
                        $(this).each(function () {
                            var settings = $(this).data('minicolors-settings') || {};
                            destroy($(this));
                            $(this).minicolors($.extend(true, settings, data));
                        });
                    }
                    return $(this);

                    // Show the color picker
                case 'show':
                    show($(this).eq(0));
                    return $(this);

                    // Get/set the hex color value
                case 'value':
                    if (data === undefined) {
                        // Getter
                        return $(this).val();
                    } else {
                        // Setter
                        $(this).each(function () {
                            updateFromInput($(this).val(data));
                        });
                    }
                    return $(this);

                    // Initializes the control
                default:
                    if (method !== 'create') data = method;
                    $(this).each(function () {
                        init($(this), data);
                    });
                    return $(this);

            }

        }
    });

    // Initialize input elements
    function init(input, settings) {

        var minicolors = $('<div class="minicolors" />'),
            defaults = $.minicolors.defaults;

        // Do nothing if already initialized
        if (input.data('minicolors-initialized')) return;

        // Handle settings
        settings = $.extend(true, {}, defaults, settings);

        // The wrapper
        minicolors
            .addClass('minicolors-theme-' + settings.exam)
            .toggleClass('minicolors-with-opacity', settings.opacity)
            .toggleClass('minicolors-no-data-uris', settings.dataUris !== true);

        // Custom positioning
        if (settings.position !== undefined) {
            $.each(settings.position.split(' '), function () {
                minicolors.addClass('minicolors-position-' + this);
            });
        }

        // The input
        input
            .addClass('minicolors-input')
            .data('minicolors-initialized', false)
            .data('minicolors-settings', settings)
            .prop('size', 7)
            .wrap(minicolors)
            .after(
                '<div class="minicolors-panel minicolors-slider-' + settings.control + '">' +
                    '<div class="minicolors-slider minicolors-sprite">' +
                        '<div class="minicolors-picker"></div>' +
                    '</div>' +
                    '<div class="minicolors-opacity-slider minicolors-sprite">' +
                        '<div class="minicolors-picker"></div>' +
                    '</div>' +
                    '<div class="minicolors-grid minicolors-sprite">' +
                        '<div class="minicolors-grid-inner"></div>' +
                        '<div class="minicolors-picker"><div></div></div>' +
                    '</div>' +
                '</div>'
            );

        // The swatch
        if (!settings.inline) {
            input.after('<span class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></span>');
            input.next('.minicolors-swatch').on('click', function (event) {
                event.preventDefault();
                input.focus();
            });
        }

        // Prevent text selection in IE
        input.parent().find('.minicolors-panel').on('selectstart', function () { return false; }).end();

        // Inline controls
        if (settings.inline) input.parent().addClass('minicolors-inline');

        updateFromInput(input, false);

        input.data('minicolors-initialized', true);

    }

    // Returns the input back to its original state
    function destroy(input) {

        var minicolors = input.parent();

        // Revert the input element
        input
            .removeData('minicolors-initialized')
            .removeData('minicolors-settings')
            .removeProp('size')
            .removeClass('minicolors-input');

        // Remove the wrap and destroy whatever remains
        minicolors.before(input).remove();

    }

    // Shows the specified dropdown panel
    function show(input) {

        var minicolors = input.parent(),
            panel = minicolors.find('.minicolors-panel'),
            settings = input.data('minicolors-settings');

        // Do nothing if uninitialized, disabled, inline, or already open
        if (!input.data('minicolors-initialized') ||
            input.prop('disabled') ||
            minicolors.hasClass('minicolors-inline') ||
            minicolors.hasClass('minicolors-focus')
        ) return;

        hide();

        minicolors.addClass('minicolors-focus');
        panel
            .stop(true, true)
            .fadeIn(settings.showSpeed, function () {
                if (settings.show) settings.show.call(input.get(0));
            });

    }

    // Hides all dropdown panels
    function hide() {
        //console.log("hide color");
        $('.minicolors-focus').each(function () {

            var minicolors = $(this),
                input = minicolors.find('.minicolors-input'),
                panel = minicolors.find('.minicolors-panel'),
                settings = input.data('minicolors-settings');
            //ThaoDTP
            var themeSettingId = $(input).attr('theme-setting-id');
            //console.log(themeSettingId);
            if (themeSettingId != null && themeSettingId != 'undefined') {
                var colorFinishInputHidden = $('.theme-setting-minicolor-' + themeSettingId);
                //console.log($(colorFinishInputHidden));
                if ($(colorFinishInputHidden).length > 0) {
                    $(colorFinishInputHidden).val(input.val());
                    $(colorFinishInputHidden).trigger('change');
                }
            }
            

            panel.fadeOut(settings.hideSpeed, function () {
                if (settings.hide) settings.hide.call(input.get(0));
                minicolors.removeClass('minicolors-focus');
            });

        });
    }

    // Moves the selected picker
    function move(target, event, animate) {

        var input = target.parents('.minicolors').find('.minicolors-input'),
            settings = input.data('minicolors-settings'),
            picker = target.find('[class$=-picker]'),
            offsetX = target.offset().left,
            offsetY = target.offset().top,
            x = Math.round(event.pageX - offsetX),
            y = Math.round(event.pageY - offsetY),
            duration = animate ? settings.animationSpeed : 0,
            wx, wy, r, phi;

        // Touch support
        if (event.originalEvent.changedTouches) {
            x = event.originalEvent.changedTouches[0].pageX - offsetX;
            y = event.originalEvent.changedTouches[0].pageY - offsetY;
        }

        // Constrain picker to its container
        if (x < 0) x = 0;
        if (y < 0) y = 0;
        if (x > target.width()) x = target.width();
        if (y > target.height()) y = target.height();

        // Constrain color wheel values to the wheel
        if (target.parent().is('.minicolors-slider-wheel') && picker.parent().is('.minicolors-grid')) {
            wx = 75 - x;
            wy = 75 - y;
            r = Math.sqrt(wx * wx + wy * wy);
            phi = Math.atan2(wy, wx);
            if (phi < 0) phi += Math.PI * 2;
            if (r > 75) {
                r = 75;
                x = 75 - (75 * Math.cos(phi));
                y = 75 - (75 * Math.sin(phi));
            }
            x = Math.round(x);
            y = Math.round(y);
        }

        // Move the picker
        if (target.is('.minicolors-grid')) {
            picker
                .stop(true)
                .animate({
                    top: y + 'px',
                    left: x + 'px'
                }, duration, settings.animationEasing, function () {
                    updateFromControl(input, target);
                });
        } else {
            picker
                .stop(true)
                .animate({
                    top: y + 'px'
                }, duration, settings.animationEasing, function () {
                    updateFromControl(input, target);
                });
        }

    }

    // Sets the input based on the color picker values
    function updateFromControl(input, target) {

        function getCoords(picker, container) {

            var left, top;
            if (!picker.length || !container) return null;
            left = picker.offset().left;
            top = picker.offset().top;

            return {
                x: left - container.offset().left + (picker.outerWidth() / 2),
                y: top - container.offset().top + (picker.outerHeight() / 2)
            };

        }

        var hue, saturation, brightness, x, y, r, phi,

            hex = input.val(),
            opacity = input.attr('data-opacity'),

            // Helpful references
            minicolors = input.parent(),
            settings = input.data('minicolors-settings'),
            swatch = minicolors.find('.minicolors-swatch'),

            // Panel objects
            grid = minicolors.find('.minicolors-grid'),
            slider = minicolors.find('.minicolors-slider'),
            opacitySlider = minicolors.find('.minicolors-opacity-slider'),

            // Picker objects
            gridPicker = grid.find('[class$=-picker]'),
            sliderPicker = slider.find('[class$=-picker]'),
            opacityPicker = opacitySlider.find('[class$=-picker]'),

            // Picker positions
            gridPos = getCoords(gridPicker, grid),
            sliderPos = getCoords(sliderPicker, slider),
            opacityPos = getCoords(opacityPicker, opacitySlider);

        // Handle colors
        if (target.is('.minicolors-grid, .minicolors-slider')) {

            // Determine HSB values
            switch (settings.control) {

                case 'wheel':
                    // Calculate hue, saturation, and brightness
                    x = (grid.width() / 2) - gridPos.x;
                    y = (grid.height() / 2) - gridPos.y;
                    r = Math.sqrt(x * x + y * y);
                    phi = Math.atan2(y, x);
                    if (phi < 0) phi += Math.PI * 2;
                    if (r > 75) {
                        r = 75;
                        gridPos.x = 69 - (75 * Math.cos(phi));
                        gridPos.y = 69 - (75 * Math.sin(phi));
                    }
                    saturation = keepWithin(r / 0.75, 0, 100);
                    hue = keepWithin(phi * 180 / Math.PI, 0, 360);
                    brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
                    break;

                case 'saturation':
                    // Calculate hue, saturation, and brightness
                    hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
                    saturation = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
                    brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: brightness }));
                    minicolors.find('.minicolors-grid-inner').css('opacity', saturation / 100);
                    break;

                case 'brightness':
                    // Calculate hue, saturation, and brightness
                    hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
                    saturation = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
                    brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
                    minicolors.find('.minicolors-grid-inner').css('opacity', 1 - (brightness / 100));
                    break;

                default:
                    // Calculate hue, saturation, and brightness
                    hue = keepWithin(360 - parseInt(sliderPos.y * (360 / slider.height()), 10), 0, 360);
                    saturation = keepWithin(Math.floor(gridPos.x * (100 / grid.width())), 0, 100);
                    brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
                    hex = hsb2hex({
                        h: hue,
                        s: saturation,
                        b: brightness
                    });

                    // Update UI
                    grid.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: 100 }));
                    break;

            }
            // Adjust case
            input.val(convertCase(hex, settings.letterCase));

        }

        // Handle opacity
        if (target.is('.minicolors-opacity-slider')) {
            if (settings.opacity) {
                opacity = parseFloat(1 - (opacityPos.y / opacitySlider.height())).toFixed(2);
            } else {
                opacity = 1;
            }
            if (settings.opacity) input.attr('data-opacity', opacity);
        }

        // Set swatch color
        swatch.find('SPAN').css({
            backgroundColor: hex,
            opacity: opacity
        });

        // Handle change event
        doChange(input, hex, opacity);

    }

    // Sets the color picker values from the input
    function updateFromInput(input, preserveInputValue) {

        var hex,
            hsb,
            opacity,
            x, y, r, phi,

            // Helpful references
            minicolors = input.parent(),
            settings = input.data('minicolors-settings'),
            swatch = minicolors.find('.minicolors-swatch'),

            // Panel objects
            grid = minicolors.find('.minicolors-grid'),
            slider = minicolors.find('.minicolors-slider'),
            opacitySlider = minicolors.find('.minicolors-opacity-slider'),

            // Picker objects
            gridPicker = grid.find('[class$=-picker]'),
            sliderPicker = slider.find('[class$=-picker]'),
            opacityPicker = opacitySlider.find('[class$=-picker]');

        // Determine hex/HSB values
        hex = convertCase(parseHex(input.val(), true), settings.letterCase);
        if (!hex) {
            hex = convertCase(parseHex(settings.defaultValue, true), settings.letterCase);
        }
        hsb = hex2hsb(hex);

        // Update input value
        if (!preserveInputValue) input.val(hex);

        // Determine opacity value
        if (settings.opacity) {
            // Get from data-opacity attribute and keep within 0-1 range
            opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
            if (isNaN(opacity)) opacity = 1;
            input.attr('data-opacity', opacity);
            swatch.find('SPAN').css('opacity', opacity);

            // Set opacity picker position
            y = keepWithin(opacitySlider.height() - (opacitySlider.height() * opacity), 0, opacitySlider.height());
            opacityPicker.css('top', y + 'px');
        }

        // Update swatch
        swatch.find('SPAN').css('backgroundColor', hex);

        // Determine picker locations
        switch (settings.control) {

            case 'wheel':
                // Set grid position
                r = keepWithin(Math.ceil(hsb.s * 0.75), 0, grid.height() / 2);
                phi = hsb.h * Math.PI / 180;
                x = keepWithin(75 - Math.cos(phi) * r, 0, grid.width());
                y = keepWithin(75 - Math.sin(phi) * r, 0, grid.height());
                gridPicker.css({
                    top: y + 'px',
                    left: x + 'px'
                });

                // Set slider position
                y = 150 - (hsb.b / (100 / grid.height()));
                if (hex === '') y = 0;
                sliderPicker.css('top', y + 'px');

                // Update panel color
                slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
                break;

            case 'saturation':
                // Set grid position
                x = keepWithin((5 * hsb.h) / 12, 0, 150);
                y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
                gridPicker.css({
                    top: y + 'px',
                    left: x + 'px'
                });

                // Set slider position
                y = keepWithin(slider.height() - (hsb.s * (slider.height() / 100)), 0, slider.height());
                sliderPicker.css('top', y + 'px');

                // Update UI
                slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: hsb.b }));
                minicolors.find('.minicolors-grid-inner').css('opacity', hsb.s / 100);
                break;

            case 'brightness':
                // Set grid position
                x = keepWithin((5 * hsb.h) / 12, 0, 150);
                y = keepWithin(grid.height() - Math.ceil(hsb.s / (100 / grid.height())), 0, grid.height());
                gridPicker.css({
                    top: y + 'px',
                    left: x + 'px'
                });

                // Set slider position
                y = keepWithin(slider.height() - (hsb.b * (slider.height() / 100)), 0, slider.height());
                sliderPicker.css('top', y + 'px');

                // Update UI
                slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
                minicolors.find('.minicolors-grid-inner').css('opacity', 1 - (hsb.b / 100));
                break;

            default:
                // Set grid position
                x = keepWithin(Math.ceil(hsb.s / (100 / grid.width())), 0, grid.width());
                y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
                gridPicker.css({
                    top: y + 'px',
                    left: x + 'px'
                });

                // Set slider position
                y = keepWithin(slider.height() - (hsb.h / (360 / slider.height())), 0, slider.height());
                sliderPicker.css('top', y + 'px');

                // Update panel color
                grid.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: 100 }));
                break;

        }

        // Fire change event, but only if minicolors is fully initialized
        if (input.data('minicolors-initialized')) {
            doChange(input, hex, opacity);
        }

    }

    // Runs the change and changeDelay callbacks
    function doChange(input, hex, opacity) {

        var settings = input.data('minicolors-settings'),
            lastChange = input.data('minicolors-lastChange');

        // Only run if it actually changed
        if (!lastChange || lastChange.hex !== hex || lastChange.opacity !== opacity) {

            // Remember last-changed value
            input.data('minicolors-lastChange', {
                hex: hex,
                opacity: opacity
            });

            // Fire change event
            if (settings.change) {
                if (settings.changeDelay) {
                    // Call after a delay
                    clearTimeout(input.data('minicolors-changeTimeout'));
                    input.data('minicolors-changeTimeout', setTimeout(function () {
                        settings.change.call(input.get(0), hex, opacity);
                    }, settings.changeDelay));
                } else {
                    // Call immediately
                    settings.change.call(input.get(0), hex, opacity);
                }
            }
            //input.trigger('change').trigger('input');
        }

    }

    // Generates an RGB(A) object based on the input's value
    function rgbObject(input) {
        var hex = parseHex($(input).val(), true),
            rgb = hex2rgb(hex),
            opacity = $(input).attr('data-opacity');
        if (!rgb) return null;
        if (opacity !== undefined) $.extend(rgb, { a: parseFloat(opacity) });
        return rgb;
    }

    // Genearates an RGB(A) string based on the input's value
    function rgbString(input, alpha) {
        var hex = parseHex($(input).val(), true),
            rgb = hex2rgb(hex),
            opacity = $(input).attr('data-opacity');
        if (!rgb) return null;
        if (opacity === undefined) opacity = 1;
        if (alpha) {
            return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
        } else {
            return 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
        }
    }

    // Converts to the letter case specified in settings
    function convertCase(string, letterCase) {
        return letterCase === 'uppercase' ? string.toUpperCase() : string.toLowerCase();
    }

    // Parses a string and returns a valid hex string when possible
    function parseHex(string, expand) {
        string = string.replace(/[^A-F0-9]/ig, '');
        if (string.length !== 3 && string.length !== 6) return '';
        if (string.length === 3 && expand) {
            string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
        }
        return '#' + string;
    }

    // Keeps value within min and max
    function keepWithin(value, min, max) {
        if (value < min) value = min;
        if (value > max) value = max;
        return value;
    }

    // Converts an HSB object to an RGB object
    function hsb2rgb(hsb) {
        var rgb = {};
        var h = Math.round(hsb.h);
        var s = Math.round(hsb.s * 255 / 100);
        var v = Math.round(hsb.b * 255 / 100);
        if (s === 0) {
            rgb.r = rgb.g = rgb.b = v;
        } else {
            var t1 = v;
            var t2 = (255 - s) * v / 255;
            var t3 = (t1 - t2) * (h % 60) / 60;
            if (h === 360) h = 0;
            if (h < 60) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3; }
            else if (h < 120) { rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3; }
            else if (h < 180) { rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3; }
            else if (h < 240) { rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3; }
            else if (h < 300) { rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3; }
            else if (h < 360) { rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3; }
            else { rgb.r = 0; rgb.g = 0; rgb.b = 0; }
        }
        return {
            r: Math.round(rgb.r),
            g: Math.round(rgb.g),
            b: Math.round(rgb.b)
        };
    }

    // Converts an RGB object to a hex string
    function rgb2hex(rgb) {
        var hex = [
            rgb.r.toString(16),
            rgb.g.toString(16),
            rgb.b.toString(16)
        ];
        $.each(hex, function (nr, val) {
            if (val.length === 1) hex[nr] = '0' + val;
        });
        return '#' + hex.join('');
    }

    // Converts an HSB object to a hex string
    function hsb2hex(hsb) {
        return rgb2hex(hsb2rgb(hsb));
    }

    // Converts a hex string to an HSB object
    function hex2hsb(hex) {
        var hsb = rgb2hsb(hex2rgb(hex));
        if (hsb.s === 0) hsb.h = 360;
        return hsb;
    }

    // Converts an RGB object to an HSB object
    function rgb2hsb(rgb) {
        var hsb = { h: 0, s: 0, b: 0 };
        var min = Math.min(rgb.r, rgb.g, rgb.b);
        var max = Math.max(rgb.r, rgb.g, rgb.b);
        var delta = max - min;
        hsb.b = max;
        hsb.s = max !== 0 ? 255 * delta / max : 0;
        if (hsb.s !== 0) {
            if (rgb.r === max) {
                hsb.h = (rgb.g - rgb.b) / delta;
            } else if (rgb.g === max) {
                hsb.h = 2 + (rgb.b - rgb.r) / delta;
            } else {
                hsb.h = 4 + (rgb.r - rgb.g) / delta;
            }
        } else {
            hsb.h = -1;
        }
        hsb.h *= 60;
        if (hsb.h < 0) {
            hsb.h += 360;
        }
        hsb.s *= 100 / 255;
        hsb.b *= 100 / 255;
        return hsb;
    }

    // Converts a hex string to an RGB object
    function hex2rgb(hex) {
        hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1) : hex), 16);
        return {
            /* jshint ignore:start */
            r: hex >> 16,
            g: (hex & 0x00FF00) >> 8,
            b: (hex & 0x0000FF)
            /* jshint ignore:end */
        };
    }

    // Handle events
    $(document)
        // Hide on clicks outside of the control
        .on('mousedown.minicolors touchstart.minicolors', function (event) {
            if (!$(event.target).parents().add(event.target).hasClass('minicolors')) {
                hide();
            }
        })
        // Start moving
        .on('mousedown.minicolors touchstart.minicolors', '.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider', function (event) {
            var target = $(this);
            event.preventDefault();
            $(document).data('minicolors-target', target);
            move(target, event, true);
        })
        // Move pickers
        .on('mousemove.minicolors touchmove.minicolors', function (event) {
            var target = $(document).data('minicolors-target');
            if (target) move(target, event);
        })
        // Stop moving
        .on('mouseup.minicolors touchend.minicolors', function () {
            $(this).removeData('minicolors-target');
        })
        // Show panel when swatch is clicked
        .on('mousedown.minicolors touchstart.minicolors', '.minicolors-swatch', function (event) {
            var input = $(this).parent().find('.minicolors-input');
            event.preventDefault();
            show(input);
        })
        // Show on focus
        .on('focus.minicolors', '.minicolors-input', function () {
            var input = $(this);
            if (!input.data('minicolors-initialized')) return;
            show(input);
        })
        // Fix hex on blur
        .on('blur.minicolors', '.minicolors-input', function () {
            var input = $(this),
                settings = input.data('minicolors-settings');
            if (!input.data('minicolors-initialized')) return;

            // Parse Hex
            input.val(parseHex(input.val(), true));

            // Is it blank?
            if (input.val() === '') input.val(parseHex(settings.defaultValue, true));

            // Adjust case
            input.val(convertCase(input.val(), settings.letterCase));

        })
        // Handle keypresses
        .on('keydown.minicolors', '.minicolors-input', function (event) {
            var input = $(this);
            if (!input.data('minicolors-initialized')) return;
            switch (event.keyCode) {
                case 9: // tab
                    hide();
                    break;
                case 13: // enter
                case 27: // esc
                    hide();
                    input.blur();
                    break;
            }
        })
        // Update on keyup
        .on('keyup.minicolors', '.minicolors-input', function () {
            var input = $(this);
            if (!input.data('minicolors-initialized')) return;
            updateFromInput(input, true);
        })
        // Update on paste
        .on('paste.minicolors', '.minicolors-input', function () {
            var input = $(this);
            if (!input.data('minicolors-initialized')) return;
            setTimeout(function () {
                updateFromInput(input, true);
            }, 1);
        });

}));
/* jstz.min.js Version: 1.0.6 Build date: 2015-11-04 */
!function(e){var a=function(){"use strict";var e="s",s={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},i=function(e){var a=-e.getTimezoneOffset();return null!==a?a:0},r=function(){var a=i(new Date(s.BASELINE_YEAR,0,2)),r=i(new Date(s.BASELINE_YEAR,5,2)),n=a-r;return 0>n?a+",1":n>0?r+",1,"+e:a+",0"},n=function(){var e,a;if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat&&(e=Intl.DateTimeFormat(),"undefined"!=typeof e&&"undefined"!=typeof e.resolvedOptions))return a=e.resolvedOptions().timeZone,a&&(a.indexOf("/")>-1||"UTC"===a)?a:void 0},o=function(e){for(var a=new Date(e,0,1,0,0,1,0).getTime(),s=new Date(e,12,31,23,59,59).getTime(),i=a,r=new Date(i).getTimezoneOffset(),n=null,o=null;s-864e5>i;){var t=new Date(i),A=t.getTimezoneOffset();A!==r&&(r>A&&(n=t),A>r&&(o=t),r=A),i+=864e5}return n&&o?{s:u(n).getTime(),e:u(o).getTime()}:!1},u=function l(e,a,i){"undefined"==typeof a&&(a=s.DAY,i=s.HOUR);for(var r=new Date(e.getTime()-a).getTime(),n=e.getTime()+a,o=new Date(r).getTimezoneOffset(),u=r,t=null;n-i>u;){var A=new Date(u),c=A.getTimezoneOffset();if(c!==o){t=A;break}u+=i}return a===s.DAY?l(t,s.HOUR,s.MINUTE):a===s.HOUR?l(t,s.MINUTE,s.SECOND):t},t=function(e,a,s,i){if("N/A"!==s)return s;if("Asia/Beirut"===a){if("Africa/Cairo"===i.name&&13983768e5===e[6].s&&14116788e5===e[6].e)return 0;if("Asia/Jerusalem"===i.name&&13959648e5===e[6].s&&14118588e5===e[6].e)return 0}else if("America/Santiago"===a){if("America/Asuncion"===i.name&&14124816e5===e[6].s&&1397358e6===e[6].e)return 0;if("America/Campo_Grande"===i.name&&14136912e5===e[6].s&&13925196e5===e[6].e)return 0}else if("America/Montevideo"===a){if("America/Sao_Paulo"===i.name&&14136876e5===e[6].s&&1392516e6===e[6].e)return 0}else if("Pacific/Auckland"===a&&"Pacific/Fiji"===i.name&&14142456e5===e[6].s&&13961016e5===e[6].e)return 0;return s},A=function(e,i){for(var r=function(a){for(var r=0,n=0;n<e.length;n++)if(a.rules[n]&&e[n]){if(!(e[n].s>=a.rules[n].s&&e[n].e<=a.rules[n].e)){r="N/A";break}if(r=0,r+=Math.abs(e[n].s-a.rules[n].s),r+=Math.abs(a.rules[n].e-e[n].e),r>s.MAX_SCORE){r="N/A";break}}return r=t(e,i,r,a)},n={},o=a.olson.dst_rules.zones,u=o.length,A=s.AMBIGUITIES[i],c=0;u>c;c++){var m=o[c],l=r(o[c]);"N/A"!==l&&(n[m.name]=l)}for(var f in n)if(n.hasOwnProperty(f))for(var d=0;d<A.length;d++)if(A[d]===f)return f;return i},c=function(e){var s=function(){for(var e=[],s=0;s<a.olson.dst_rules.years.length;s++){var i=o(a.olson.dst_rules.years[s]);e.push(i)}return e},i=function(e){for(var a=0;a<e.length;a++)if(e[a]!==!1)return!0;return!1},r=s(),n=i(r);return n?A(r,e):e},m=function(){var e=n();return e||(e=a.olson.timezones[r()],"undefined"!=typeof s.AMBIGUITIES[e]&&(e=c(e))),{name:function(){return e}}};return{determine:m}}();a.olson=a.olson||{},a.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},a.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"Africa/Casablanca",rules:[{e:12202236e5,s:12122784e5},{e:12508092e5,s:12438144e5},{e:1281222e6,s:12727584e5},{e:13120668e5,s:13017888e5},{e:13489704e5,s:1345428e6},{e:13828392e5,s:13761e8},{e:14142888e5,s:14069448e5}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Santiago",rules:[{e:1206846e6,s:1223784e6},{e:1237086e6,s:12552336e5},{e:127035e7,s:12866832e5},{e:13048236e5,s:13138992e5},{e:13356684e5,s:13465584e5},{e:1367118e6,s:13786128e5},{e:13985676e5,s:14100624e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:1414098e6,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]},{name:"Europe/London",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]}]},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return a}):"undefined"==typeof e?window.jstz=a:e.jstz=a}();
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,function(){"use strict";var e,t;function n(){return e.apply(null,arguments)}function s(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function i(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function r(e){return void 0===e}function a(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function o(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function u(e,t){var n,s=[];for(n=0;n<e.length;++n)s.push(t(e[n],n));return s}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){for(var n in t)l(t,n)&&(e[n]=t[n]);return l(t,"toString")&&(e.toString=t.toString),l(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t,n,s){return Ot(e,t,n,s,!0).utc()}function c(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function f(e){if(null==e._isValid){var n=c(e),s=t.call(n.parsedDateParts,function(e){return null!=e}),i=!isNaN(e._d.getTime())&&n.overflow<0&&!n.empty&&!n.invalidMonth&&!n.invalidWeekday&&!n.weekdayMismatch&&!n.nullInput&&!n.invalidFormat&&!n.userInvalidated&&(!n.meridiem||n.meridiem&&s);if(e._strict&&(i=i&&0===n.charsLeftOver&&0===n.unusedTokens.length&&void 0===n.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return i;e._isValid=i}return e._isValid}function m(e){var t=h(NaN);return null!=e?d(c(t),e):c(t).userInvalidated=!0,t}t=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1};var _=n.momentProperties=[];function y(e,t){var n,s,i;if(r(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),r(t._i)||(e._i=t._i),r(t._f)||(e._f=t._f),r(t._l)||(e._l=t._l),r(t._strict)||(e._strict=t._strict),r(t._tzm)||(e._tzm=t._tzm),r(t._isUTC)||(e._isUTC=t._isUTC),r(t._offset)||(e._offset=t._offset),r(t._pf)||(e._pf=c(t)),r(t._locale)||(e._locale=t._locale),_.length>0)for(n=0;n<_.length;n++)r(i=t[s=_[n]])||(e[s]=i);return e}var g=!1;function p(e){y(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===g&&(g=!0,n.updateOffset(this),g=!1)}function v(e){return e instanceof p||null!=e&&null!=e._isAMomentObject}function w(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function M(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=w(t)),n}function S(e,t,n){var s,i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(s=0;s<i;s++)(n&&e[s]!==t[s]||!n&&M(e[s])!==M(t[s]))&&a++;return a+r}function D(e){!1===n.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function k(e,t){var s=!0;return d(function(){if(null!=n.deprecationHandler&&n.deprecationHandler(null,e),s){for(var i,r=[],a=0;a<arguments.length;a++){if(i="","object"==typeof arguments[a]){for(var o in i+="\n["+a+"] ",arguments[0])i+=o+": "+arguments[0][o]+", ";i=i.slice(0,-2)}else i=arguments[a];r.push(i)}D(e+"\nArguments: "+Array.prototype.slice.call(r).join("")+"\n"+(new Error).stack),s=!1}return t.apply(this,arguments)},t)}var Y,O={};function T(e,t){null!=n.deprecationHandler&&n.deprecationHandler(e,t),O[e]||(D(t),O[e]=!0)}function x(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function b(e,t){var n,s=d({},e);for(n in t)l(t,n)&&(i(e[n])&&i(t[n])?(s[n]={},d(s[n],e[n]),d(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)l(e,n)&&!l(t,n)&&i(e[n])&&(s[n]=d({},s[n]));return s}function P(e){null!=e&&this.set(e)}n.suppressDeprecationWarnings=!1,n.deprecationHandler=null,Y=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)l(e,t)&&n.push(t);return n};var W={};function H(e,t){var n=e.toLowerCase();W[n]=W[n+"s"]=W[t]=e}function R(e){return"string"==typeof e?W[e]||W[e.toLowerCase()]:void 0}function C(e){var t,n,s={};for(n in e)l(e,n)&&(t=R(n))&&(s[t]=e[n]);return s}var F={};function L(e,t){F[e]=t}function U(e,t,n){var s=""+Math.abs(e),i=t-s.length;return(e>=0?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+s}var N=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,G=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,V={},E={};function I(e,t,n,s){var i=s;"string"==typeof s&&(i=function(){return this[s]()}),e&&(E[e]=i),t&&(E[t[0]]=function(){return U(i.apply(this,arguments),t[1],t[2])}),n&&(E[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function A(e,t){return e.isValid()?(t=j(t,e.localeData()),V[t]=V[t]||function(e){var t,n,s,i=e.match(N);for(t=0,n=i.length;t<n;t++)E[i[t]]?i[t]=E[i[t]]:i[t]=(s=i[t]).match(/\[[\s\S]/)?s.replace(/^\[|\]$/g,""):s.replace(/\\/g,"");return function(t){var s,r="";for(s=0;s<n;s++)r+=x(i[s])?i[s].call(t,e):i[s];return r}}(t),V[t](e)):e.localeData().invalidDate()}function j(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(G.lastIndex=0;n>=0&&G.test(e);)e=e.replace(G,s),G.lastIndex=0,n-=1;return e}var Z=/\d/,z=/\d\d/,$=/\d{3}/,q=/\d{4}/,J=/[+-]?\d{6}/,B=/\d\d?/,Q=/\d\d\d\d?/,X=/\d\d\d\d\d\d?/,K=/\d{1,3}/,ee=/\d{1,4}/,te=/[+-]?\d{1,6}/,ne=/\d+/,se=/[+-]?\d+/,ie=/Z|[+-]\d\d:?\d\d/gi,re=/Z|[+-]\d\d(?::?\d\d)?/gi,ae=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,oe={};function ue(e,t,n){oe[e]=x(t)?t:function(e,s){return e&&n?n:t}}function le(e,t){return l(oe,e)?oe[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var he={};function ce(e,t){var n,s=t;for("string"==typeof e&&(e=[e]),a(t)&&(s=function(e,n){n[t]=M(e)}),n=0;n<e.length;n++)he[e[n]]=s}function fe(e,t){ce(e,function(e,n,s,i){s._w=s._w||{},t(e,s._w,s,i)})}var me=0,_e=1,ye=2,ge=3,pe=4,ve=5,we=6,Me=7,Se=8;function De(e){return ke(e)?366:365}function ke(e){return e%4==0&&e%100!=0||e%400==0}I("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),I(0,["YY",2],0,function(){return this.year()%100}),I(0,["YYYY",4],0,"year"),I(0,["YYYYY",5],0,"year"),I(0,["YYYYYY",6,!0],0,"year"),H("year","y"),L("year",1),ue("Y",se),ue("YY",B,z),ue("YYYY",ee,q),ue("YYYYY",te,J),ue("YYYYYY",te,J),ce(["YYYYY","YYYYYY"],me),ce("YYYY",function(e,t){t[me]=2===e.length?n.parseTwoDigitYear(e):M(e)}),ce("YY",function(e,t){t[me]=n.parseTwoDigitYear(e)}),ce("Y",function(e,t){t[me]=parseInt(e,10)}),n.parseTwoDigitYear=function(e){return M(e)+(M(e)>68?1900:2e3)};var Ye,Oe=Te("FullYear",!0);function Te(e,t){return function(s){return null!=s?(be(this,e,s),n.updateOffset(this,t),this):xe(this,e)}}function xe(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function be(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&ke(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),Pe(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function Pe(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,s=(t%(n=12)+n)%n;return e+=(t-s)/12,1===s?ke(e)?29:28:31-s%7%2}Ye=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},I("M",["MM",2],"Mo",function(){return this.month()+1}),I("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),I("MMMM",0,0,function(e){return this.localeData().months(this,e)}),H("month","M"),L("month",8),ue("M",B),ue("MM",B,z),ue("MMM",function(e,t){return t.monthsShortRegex(e)}),ue("MMMM",function(e,t){return t.monthsRegex(e)}),ce(["M","MM"],function(e,t){t[_e]=M(e)-1}),ce(["MMM","MMMM"],function(e,t,n,s){var i=n._locale.monthsParse(e,s,n._strict);null!=i?t[_e]=i:c(n).invalidMonth=e});var We=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,He="January_February_March_April_May_June_July_August_September_October_November_December".split("_");var Re="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ce(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=M(t);else if(!a(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),Pe(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Fe(e){return null!=e?(Ce(this,e),n.updateOffset(this,!0),this):xe(this,"Month")}var Le=ae;var Ue=ae;function Ne(){function e(e,t){return t.length-e.length}var t,n,s=[],i=[],r=[];for(t=0;t<12;t++)n=h([2e3,t]),s.push(this.monthsShort(n,"")),i.push(this.months(n,"")),r.push(this.months(n,"")),r.push(this.monthsShort(n,""));for(s.sort(e),i.sort(e),r.sort(e),t=0;t<12;t++)s[t]=de(s[t]),i[t]=de(i[t]);for(t=0;t<24;t++)r[t]=de(r[t]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ge(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&e>=0&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function Ve(e,t,n){var s=7+t-n;return-((7+Ge(e,0,s).getUTCDay()-t)%7)+s-1}function Ee(e,t,n,s,i){var r,a,o=1+7*(t-1)+(7+n-s)%7+Ve(e,s,i);return o<=0?a=De(r=e-1)+o:o>De(e)?(r=e+1,a=o-De(e)):(r=e,a=o),{year:r,dayOfYear:a}}function Ie(e,t,n){var s,i,r=Ve(e.year(),t,n),a=Math.floor((e.dayOfYear()-r-1)/7)+1;return a<1?s=a+Ae(i=e.year()-1,t,n):a>Ae(e.year(),t,n)?(s=a-Ae(e.year(),t,n),i=e.year()+1):(i=e.year(),s=a),{week:s,year:i}}function Ae(e,t,n){var s=Ve(e,t,n),i=Ve(e+1,t,n);return(De(e)-s+i)/7}I("w",["ww",2],"wo","week"),I("W",["WW",2],"Wo","isoWeek"),H("week","w"),H("isoWeek","W"),L("week",5),L("isoWeek",5),ue("w",B),ue("ww",B,z),ue("W",B),ue("WW",B,z),fe(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=M(e)});I("d",0,"do","day"),I("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),I("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),I("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),I("e",0,0,"weekday"),I("E",0,0,"isoWeekday"),H("day","d"),H("weekday","e"),H("isoWeekday","E"),L("day",11),L("weekday",11),L("isoWeekday",11),ue("d",B),ue("e",B),ue("E",B),ue("dd",function(e,t){return t.weekdaysMinRegex(e)}),ue("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ue("dddd",function(e,t){return t.weekdaysRegex(e)}),fe(["dd","ddd","dddd"],function(e,t,n,s){var i=n._locale.weekdaysParse(e,s,n._strict);null!=i?t.d=i:c(n).invalidWeekday=e}),fe(["d","e","E"],function(e,t,n,s){t[s]=M(e)});var je="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");var Ze="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");var ze="Su_Mo_Tu_We_Th_Fr_Sa".split("_");var $e=ae;var qe=ae;var Je=ae;function Be(){function e(e,t){return t.length-e.length}var t,n,s,i,r,a=[],o=[],u=[],l=[];for(t=0;t<7;t++)n=h([2e3,1]).day(t),s=this.weekdaysMin(n,""),i=this.weekdaysShort(n,""),r=this.weekdays(n,""),a.push(s),o.push(i),u.push(r),l.push(s),l.push(i),l.push(r);for(a.sort(e),o.sort(e),u.sort(e),l.sort(e),t=0;t<7;t++)o[t]=de(o[t]),u[t]=de(u[t]),l[t]=de(l[t]);this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+a.join("|")+")","i")}function Qe(){return this.hours()%12||12}function Xe(e,t){I(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function Ke(e,t){return t._meridiemParse}I("H",["HH",2],0,"hour"),I("h",["hh",2],0,Qe),I("k",["kk",2],0,function(){return this.hours()||24}),I("hmm",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)}),I("hmmss",0,0,function(){return""+Qe.apply(this)+U(this.minutes(),2)+U(this.seconds(),2)}),I("Hmm",0,0,function(){return""+this.hours()+U(this.minutes(),2)}),I("Hmmss",0,0,function(){return""+this.hours()+U(this.minutes(),2)+U(this.seconds(),2)}),Xe("a",!0),Xe("A",!1),H("hour","h"),L("hour",13),ue("a",Ke),ue("A",Ke),ue("H",B),ue("h",B),ue("k",B),ue("HH",B,z),ue("hh",B,z),ue("kk",B,z),ue("hmm",Q),ue("hmmss",X),ue("Hmm",Q),ue("Hmmss",X),ce(["H","HH"],ge),ce(["k","kk"],function(e,t,n){var s=M(e);t[ge]=24===s?0:s}),ce(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),ce(["h","hh"],function(e,t,n){t[ge]=M(e),c(n).bigHour=!0}),ce("hmm",function(e,t,n){var s=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s)),c(n).bigHour=!0}),ce("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s,2)),t[ve]=M(e.substr(i)),c(n).bigHour=!0}),ce("Hmm",function(e,t,n){var s=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s))}),ce("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[ge]=M(e.substr(0,s)),t[pe]=M(e.substr(s,2)),t[ve]=M(e.substr(i))});var et,tt=Te("Hours",!0),nt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:He,monthsShort:Re,week:{dow:0,doy:6},weekdays:je,weekdaysMin:ze,weekdaysShort:Ze,meridiemParse:/[ap]\.?m?\.?/i},st={},it={};function rt(e){return e?e.toLowerCase().replace("_","-"):e}function at(e){var t=null;if(!st[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=et._abbr,require("./locale/"+e),ot(t)}catch(e){}return st[e]}function ot(e,t){var n;return e&&((n=r(t)?lt(e):ut(e,t))?et=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),et._abbr}function ut(e,t){if(null!==t){var n,s=nt;if(t.abbr=e,null!=st[e])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=st[e]._config;else if(null!=t.parentLocale)if(null!=st[t.parentLocale])s=st[t.parentLocale]._config;else{if(null==(n=at(t.parentLocale)))return it[t.parentLocale]||(it[t.parentLocale]=[]),it[t.parentLocale].push({name:e,config:t}),null;s=n._config}return st[e]=new P(b(s,t)),it[e]&&it[e].forEach(function(e){ut(e.name,e.config)}),ot(e),st[e]}return delete st[e],null}function lt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return et;if(!s(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=rt(e[r]).split("-")).length,n=(n=rt(e[r+1]))?n.split("-"):null;t>0;){if(s=at(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&S(i,n,!0)>=t-1)break;t--}r++}return et}(e)}function dt(e){var t,n=e._a;return n&&-2===c(e).overflow&&(t=n[_e]<0||n[_e]>11?_e:n[ye]<1||n[ye]>Pe(n[me],n[_e])?ye:n[ge]<0||n[ge]>24||24===n[ge]&&(0!==n[pe]||0!==n[ve]||0!==n[we])?ge:n[pe]<0||n[pe]>59?pe:n[ve]<0||n[ve]>59?ve:n[we]<0||n[we]>999?we:-1,c(e)._overflowDayOfYear&&(t<me||t>ye)&&(t=ye),c(e)._overflowWeeks&&-1===t&&(t=Me),c(e)._overflowWeekday&&-1===t&&(t=Se),c(e).overflow=t),e}function ht(e,t,n){return null!=e?e:null!=t?t:n}function ct(e){var t,s,i,r,a,o=[];if(!e._d){var u,l;for(u=e,l=new Date(n.now()),i=u._useUTC?[l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()]:[l.getFullYear(),l.getMonth(),l.getDate()],e._w&&null==e._a[ye]&&null==e._a[_e]&&function(e){var t,n,s,i,r,a,o,u;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)r=1,a=4,n=ht(t.GG,e._a[me],Ie(Tt(),1,4).year),s=ht(t.W,1),((i=ht(t.E,1))<1||i>7)&&(u=!0);else{r=e._locale._week.dow,a=e._locale._week.doy;var l=Ie(Tt(),r,a);n=ht(t.gg,e._a[me],l.year),s=ht(t.w,l.week),null!=t.d?((i=t.d)<0||i>6)&&(u=!0):null!=t.e?(i=t.e+r,(t.e<0||t.e>6)&&(u=!0)):i=r}s<1||s>Ae(n,r,a)?c(e)._overflowWeeks=!0:null!=u?c(e)._overflowWeekday=!0:(o=Ee(n,s,i,r,a),e._a[me]=o.year,e._dayOfYear=o.dayOfYear)}(e),null!=e._dayOfYear&&(a=ht(e._a[me],i[me]),(e._dayOfYear>De(a)||0===e._dayOfYear)&&(c(e)._overflowDayOfYear=!0),s=Ge(a,0,e._dayOfYear),e._a[_e]=s.getUTCMonth(),e._a[ye]=s.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=o[t]=i[t];for(;t<7;t++)e._a[t]=o[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ge]&&0===e._a[pe]&&0===e._a[ve]&&0===e._a[we]&&(e._nextDay=!0,e._a[ge]=0),e._d=(e._useUTC?Ge:function(e,t,n,s,i,r,a){var o=new Date(e,t,n,s,i,r,a);return e<100&&e>=0&&isFinite(o.getFullYear())&&o.setFullYear(e),o}).apply(null,o),r=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ge]=24),e._w&&void 0!==e._w.d&&e._w.d!==r&&(c(e).weekdayMismatch=!0)}}var ft=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,mt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,_t=/Z|[+-]\d\d(?::?\d\d)?/,yt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],gt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],pt=/^\/?Date\((\-?\d+)/i;function vt(e){var t,n,s,i,r,a,o=e._i,u=ft.exec(o)||mt.exec(o);if(u){for(c(e).iso=!0,t=0,n=yt.length;t<n;t++)if(yt[t][1].exec(u[1])){i=yt[t][0],s=!1!==yt[t][2];break}if(null==i)return void(e._isValid=!1);if(u[3]){for(t=0,n=gt.length;t<n;t++)if(gt[t][1].exec(u[3])){r=(u[2]||" ")+gt[t][0];break}if(null==r)return void(e._isValid=!1)}if(!s&&null!=r)return void(e._isValid=!1);if(u[4]){if(!_t.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),kt(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Mt(e,t,n,s,i,r){var a=[function(e){var t=parseInt(e,10);{if(t<=49)return 2e3+t;if(t<=999)return 1900+t}return t}(e),Re.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&a.push(parseInt(r,10)),a}var St={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Dt(e){var t,n,s,i=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim());if(i){var r=Mt(i[4],i[3],i[2],i[5],i[6],i[7]);if(t=i[1],n=r,s=e,t&&Ze.indexOf(t)!==new Date(n[0],n[1],n[2]).getDay()&&(c(s).weekdayMismatch=!0,s._isValid=!1,1))return;e._a=r,e._tzm=function(e,t,n){if(e)return St[e];if(t)return 0;var s=parseInt(n,10),i=s%100;return(s-i)/100*60+i}(i[8],i[9],i[10]),e._d=Ge.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),c(e).rfc2822=!0}else e._isValid=!1}function kt(e){if(e._f!==n.ISO_8601)if(e._f!==n.RFC_2822){e._a=[],c(e).empty=!0;var t,s,i,r,a,o,u,d,h=""+e._i,f=h.length,m=0;for(i=j(e._f,e._locale).match(N)||[],t=0;t<i.length;t++)r=i[t],(s=(h.match(le(r,e))||[])[0])&&((a=h.substr(0,h.indexOf(s))).length>0&&c(e).unusedInput.push(a),h=h.slice(h.indexOf(s)+s.length),m+=s.length),E[r]?(s?c(e).empty=!1:c(e).unusedTokens.push(r),o=r,d=e,null!=(u=s)&&l(he,o)&&he[o](u,d._a,d,o)):e._strict&&!s&&c(e).unusedTokens.push(r);c(e).charsLeftOver=f-m,h.length>0&&c(e).unusedInput.push(h),e._a[ge]<=12&&!0===c(e).bigHour&&e._a[ge]>0&&(c(e).bigHour=void 0),c(e).parsedDateParts=e._a.slice(0),c(e).meridiem=e._meridiem,e._a[ge]=function(e,t,n){var s;if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((s=e.isPM(n))&&t<12&&(t+=12),s||12!==t||(t=0),t):t}(e._locale,e._a[ge],e._meridiem),ct(e),dt(e)}else Dt(e);else vt(e)}function Yt(e){var t,l,h,_,g=e._i,w=e._f;return e._locale=e._locale||lt(e._l),null===g||void 0===w&&""===g?m({nullInput:!0}):("string"==typeof g&&(e._i=g=e._locale.preparse(g)),v(g)?new p(dt(g)):(o(g)?e._d=g:s(w)?function(e){var t,n,s,i,r;if(0===e._f.length)return c(e).invalidFormat=!0,void(e._d=new Date(NaN));for(i=0;i<e._f.length;i++)r=0,t=y({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],kt(t),f(t)&&(r+=c(t).charsLeftOver,r+=10*c(t).unusedTokens.length,c(t).score=r,(null==s||r<s)&&(s=r,n=t));d(e,n||t)}(e):w?kt(e):r(l=(t=e)._i)?t._d=new Date(n.now()):o(l)?t._d=new Date(l.valueOf()):"string"==typeof l?(h=t,null===(_=pt.exec(h._i))?(vt(h),!1===h._isValid&&(delete h._isValid,Dt(h),!1===h._isValid&&(delete h._isValid,n.createFromInputFallback(h)))):h._d=new Date(+_[1])):s(l)?(t._a=u(l.slice(0),function(e){return parseInt(e,10)}),ct(t)):i(l)?function(e){if(!e._d){var t=C(e._i);e._a=u([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ct(e)}}(t):a(l)?t._d=new Date(l):n.createFromInputFallback(t),f(e)||(e._d=null),e))}function Ot(e,t,n,r,a){var o,u={};return!0!==n&&!1!==n||(r=n,n=void 0),(i(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||s(e)&&0===e.length)&&(e=void 0),u._isAMomentObject=!0,u._useUTC=u._isUTC=a,u._l=n,u._i=e,u._f=t,u._strict=r,(o=new p(dt(Yt(u))))._nextDay&&(o.add(1,"d"),o._nextDay=void 0),o}function Tt(e,t,n,s){return Ot(e,t,n,s,!1)}n.createFromInputFallback=k("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),n.ISO_8601=function(){},n.RFC_2822=function(){};var xt=k("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:m()}),bt=k("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Tt.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:m()});function Pt(e,t){var n,i;if(1===t.length&&s(t[0])&&(t=t[0]),!t.length)return Tt();for(n=t[0],i=1;i<t.length;++i)t[i].isValid()&&!t[i][e](n)||(n=t[i]);return n}var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ht(e){var t=C(e),n=t.year||0,s=t.quarter||0,i=t.month||0,r=t.week||0,a=t.day||0,o=t.hour||0,u=t.minute||0,l=t.second||0,d=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ye.call(Wt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var n=!1,s=0;s<Wt.length;++s)if(e[Wt[s]]){if(n)return!1;parseFloat(e[Wt[s]])!==M(e[Wt[s]])&&(n=!0)}return!0}(t),this._milliseconds=+d+1e3*l+6e4*u+1e3*o*60*60,this._days=+a+7*r,this._months=+i+3*s+12*n,this._data={},this._locale=lt(),this._bubble()}function Rt(e){return e instanceof Ht}function Ct(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,t){I(e,0,0,function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+U(~~(e/60),2)+t+U(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),ue("Z",re),ue("ZZ",re),ce(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Ut(re,e)});var Lt=/([\+\-]|\d\d)/gi;function Ut(e,t){var n=(t||"").match(e);if(null===n)return null;var s=((n[n.length-1]||[])+"").match(Lt)||["-",0,0],i=60*s[1]+M(s[2]);return 0===i?0:"+"===s[0]?i:-i}function Nt(e,t){var s,i;return t._isUTC?(s=t.clone(),i=(v(e)||o(e)?e.valueOf():Tt(e).valueOf())-s.valueOf(),s._d.setTime(s._d.valueOf()+i),n.updateOffset(s,!1),s):Tt(e).local()}function Gt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Vt(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}n.updateOffset=function(){};var Et=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,It=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function At(e,t){var n,s,i,r=e,o=null;return Rt(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:a(e)?(r={},t?r[t]=e:r.milliseconds=e):(o=Et.exec(e))?(n="-"===o[1]?-1:1,r={y:0,d:M(o[ye])*n,h:M(o[ge])*n,m:M(o[pe])*n,s:M(o[ve])*n,ms:M(Ct(1e3*o[we]))*n}):(o=It.exec(e))?(n="-"===o[1]?-1:(o[1],1),r={y:jt(o[2],n),M:jt(o[3],n),w:jt(o[4],n),d:jt(o[5],n),h:jt(o[6],n),m:jt(o[7],n),s:jt(o[8],n)}):null==r?r={}:"object"==typeof r&&("from"in r||"to"in r)&&(i=function(e,t){var n;if(!e.isValid()||!t.isValid())return{milliseconds:0,months:0};t=Nt(t,e),e.isBefore(t)?n=Zt(e,t):((n=Zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(Tt(r.from),Tt(r.to)),(r={}).ms=i.milliseconds,r.M=i.months),s=new Ht(r),Rt(e)&&l(e,"_locale")&&(s._locale=e._locale),s}function jt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function Zt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function zt(e,t){return function(n,s){var i;return null===s||isNaN(+s)||(T(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),i=n,n=s,s=i),$t(this,At(n="string"==typeof n?+n:n,s),e),this}}function $t(e,t,s,i){var r=t._milliseconds,a=Ct(t._days),o=Ct(t._months);e.isValid()&&(i=null==i||i,o&&Ce(e,xe(e,"Month")+o*s),a&&be(e,"Date",xe(e,"Date")+a*s),r&&e._d.setTime(e._d.valueOf()+r*s),i&&n.updateOffset(e,a||o))}At.fn=Ht.prototype,At.invalid=function(){return At(NaN)};var qt=zt(1,"add"),Jt=zt(-1,"subtract");function Bt(e,t){var n=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months");return-(n+(t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(n+1,"months")-s)))||0}function Qt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=lt(e))&&(this._locale=t),this)}n.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",n.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Xt=k("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Kt(){return this._locale}function en(e,t){I(0,[e,e.length],0,t)}function tn(e,t,n,s,i){var r;return null==e?Ie(this,s,i).year:(t>(r=Ae(e,s,i))&&(t=r),function(e,t,n,s,i){var r=Ee(e,t,n,s,i),a=Ge(r.year,0,r.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}.call(this,e,t,n,s,i))}I(0,["gg",2],0,function(){return this.weekYear()%100}),I(0,["GG",2],0,function(){return this.isoWeekYear()%100}),en("gggg","weekYear"),en("ggggg","weekYear"),en("GGGG","isoWeekYear"),en("GGGGG","isoWeekYear"),H("weekYear","gg"),H("isoWeekYear","GG"),L("weekYear",1),L("isoWeekYear",1),ue("G",se),ue("g",se),ue("GG",B,z),ue("gg",B,z),ue("GGGG",ee,q),ue("gggg",ee,q),ue("GGGGG",te,J),ue("ggggg",te,J),fe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=M(e)}),fe(["gg","GG"],function(e,t,s,i){t[i]=n.parseTwoDigitYear(e)}),I("Q",0,"Qo","quarter"),H("quarter","Q"),L("quarter",7),ue("Q",Z),ce("Q",function(e,t){t[_e]=3*(M(e)-1)}),I("D",["DD",2],"Do","date"),H("date","D"),L("date",9),ue("D",B),ue("DD",B,z),ue("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),ce(["D","DD"],ye),ce("Do",function(e,t){t[ye]=M(e.match(B)[0])});var nn=Te("Date",!0);I("DDD",["DDDD",3],"DDDo","dayOfYear"),H("dayOfYear","DDD"),L("dayOfYear",4),ue("DDD",K),ue("DDDD",$),ce(["DDD","DDDD"],function(e,t,n){n._dayOfYear=M(e)}),I("m",["mm",2],0,"minute"),H("minute","m"),L("minute",14),ue("m",B),ue("mm",B,z),ce(["m","mm"],pe);var sn=Te("Minutes",!1);I("s",["ss",2],0,"second"),H("second","s"),L("second",15),ue("s",B),ue("ss",B,z),ce(["s","ss"],ve);var rn,an=Te("Seconds",!1);for(I("S",0,0,function(){return~~(this.millisecond()/100)}),I(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),I(0,["SSS",3],0,"millisecond"),I(0,["SSSS",4],0,function(){return 10*this.millisecond()}),I(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),I(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),I(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),I(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),I(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),H("millisecond","ms"),L("millisecond",16),ue("S",K,Z),ue("SS",K,z),ue("SSS",K,$),rn="SSSS";rn.length<=9;rn+="S")ue(rn,ne);function on(e,t){t[we]=M(1e3*("0."+e))}for(rn="S";rn.length<=9;rn+="S")ce(rn,on);var un=Te("Milliseconds",!1);I("z",0,0,"zoneAbbr"),I("zz",0,0,"zoneName");var ln=p.prototype;function dn(e){return e}ln.add=qt,ln.calendar=function(e,t){var s=e||Tt(),i=Nt(s,this).startOf("day"),r=n.calendarFormat(this,i)||"sameElse",a=t&&(x(t[r])?t[r].call(this,s):t[r]);return this.format(a||this.localeData().calendar(r,this,Tt(s)))},ln.clone=function(){return new p(this)},ln.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Nt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=R(t)){case"year":r=Bt(this,s)/12;break;case"month":r=Bt(this,s);break;case"quarter":r=Bt(this,s)/3;break;case"second":r=(this-s)/1e3;break;case"minute":r=(this-s)/6e4;break;case"hour":r=(this-s)/36e5;break;case"day":r=(this-s-i)/864e5;break;case"week":r=(this-s-i)/6048e5;break;default:r=this-s}return n?r:w(r)},ln.endOf=function(e){return void 0===(e=R(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},ln.format=function(e){e||(e=this.isUtc()?n.defaultFormatUtc:n.defaultFormat);var t=A(this,e);return this.localeData().postformat(t)},ln.from=function(e,t){return this.isValid()&&(v(e)&&e.isValid()||Tt(e).isValid())?At({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.fromNow=function(e){return this.from(Tt(),e)},ln.to=function(e,t){return this.isValid()&&(v(e)&&e.isValid()||Tt(e).isValid())?At({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ln.toNow=function(e){return this.to(Tt(),e)},ln.get=function(e){return x(this[e=R(e)])?this[e]():this},ln.invalidAt=function(){return c(this).overflow},ln.isAfter=function(e,t){var n=v(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(r(t)?"millisecond":t))?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},ln.isBefore=function(e,t){var n=v(e)?e:Tt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=R(r(t)?"millisecond":t))?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},ln.isBetween=function(e,t,n,s){return("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n))},ln.isSame=function(e,t){var n,s=v(e)?e:Tt(e);return!(!this.isValid()||!s.isValid())&&("millisecond"===(t=R(t||"millisecond"))?this.valueOf()===s.valueOf():(n=s.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},ln.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},ln.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},ln.isValid=function(){return f(this)},ln.lang=Xt,ln.locale=Qt,ln.localeData=Kt,ln.max=bt,ln.min=xt,ln.parsingFlags=function(){return d({},c(this))},ln.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t=[];for(var n in e)t.push({unit:n,priority:F[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=C(e)),s=0;s<n.length;s++)this[n[s].unit](e[n[s].unit]);else if(x(this[e=R(e)]))return this[e](t);return this},ln.startOf=function(e){switch(e=R(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},ln.subtract=Jt,ln.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},ln.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},ln.toDate=function(){return new Date(this.valueOf())},ln.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||n.year()>9999?A(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):x(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",A(n,"Z")):A(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},ln.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',s=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=t+'[")]';return this.format(n+s+"-MM-DD[T]HH:mm:ss.SSS"+i)},ln.toJSON=function(){return this.isValid()?this.toISOString():null},ln.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},ln.unix=function(){return Math.floor(this.valueOf()/1e3)},ln.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},ln.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},ln.year=Oe,ln.isLeapYear=function(){return ke(this.year())},ln.weekYear=function(e){return tn.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},ln.isoWeekYear=function(e){return tn.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},ln.quarter=ln.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},ln.month=Fe,ln.daysInMonth=function(){return Pe(this.year(),this.month())},ln.week=ln.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},ln.isoWeek=ln.isoWeeks=function(e){var t=Ie(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},ln.weeksInYear=function(){var e=this.localeData()._week;return Ae(this.year(),e.dow,e.doy)},ln.isoWeeksInYear=function(){return Ae(this.year(),1,4)},ln.date=nn,ln.day=ln.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},ln.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},ln.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=(n=e,s=this.localeData(),"string"==typeof n?s.weekdaysParse(n)%7||7:isNaN(n)?null:n);return this.day(this.day()%7?t:t-7)}return this.day()||7;var n,s},ln.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},ln.hour=ln.hours=tt,ln.minute=ln.minutes=sn,ln.second=ln.seconds=an,ln.millisecond=ln.milliseconds=un,ln.utcOffset=function(e,t,s){var i,r=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Ut(re,e)))return this}else Math.abs(e)<16&&!s&&(e*=60);return!this._isUTC&&t&&(i=Gt(this)),this._offset=e,this._isUTC=!0,null!=i&&this.add(i,"m"),r!==e&&(!t||this._changeInProgress?$t(this,At(e-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,n.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?r:Gt(this)},ln.utc=function(e){return this.utcOffset(0,e)},ln.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Gt(this),"m")),this},ln.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ut(ie,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},ln.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Tt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},ln.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},ln.isLocal=function(){return!!this.isValid()&&!this._isUTC},ln.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},ln.isUtc=Vt,ln.isUTC=Vt,ln.zoneAbbr=function(){return this._isUTC?"UTC":""},ln.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},ln.dates=k("dates accessor is deprecated. Use date instead.",nn),ln.months=k("months accessor is deprecated. Use month instead",Fe),ln.years=k("years accessor is deprecated. Use year instead",Oe),ln.zone=k("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),ln.isDSTShifted=k("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!r(this._isDSTShifted))return this._isDSTShifted;var e={};if(y(e,this),(e=Yt(e))._a){var t=e._isUTC?h(e._a):Tt(e._a);this._isDSTShifted=this.isValid()&&S(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted});var hn=P.prototype;function cn(e,t,n,s){var i=lt(),r=h().set(s,t);return i[n](r,e)}function fn(e,t,n){if(a(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");var s,i=[];for(s=0;s<12;s++)i[s]=cn(e,s,n,"month");return i}function mn(e,t,n,s){"boolean"==typeof e?(a(t)&&(n=t,t=void 0),t=t||""):(n=t=e,e=!1,a(t)&&(n=t,t=void 0),t=t||"");var i,r=lt(),o=e?r._week.dow:0;if(null!=n)return cn(t,(n+o)%7,s,"day");var u=[];for(i=0;i<7;i++)u[i]=cn(t,(i+o)%7,s,"day");return u}hn.calendar=function(e,t,n){var s=this._calendar[e]||this._calendar.sameElse;return x(s)?s.call(t,n):s},hn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},hn.invalidDate=function(){return this._invalidDate},hn.ordinal=function(e){return this._ordinal.replace("%d",e)},hn.preparse=dn,hn.postformat=dn,hn.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return x(i)?i(e,t,n,s):i.replace(/%d/i,e)},hn.pastFuture=function(e,t){var n=this._relativeTime[e>0?"future":"past"];return x(n)?n(t):n.replace(/%s/i,t)},hn.set=function(e){var t,n;for(n in e)x(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},hn.months=function(e,t){return e?s(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||We).test(t)?"format":"standalone"][e.month()]:s(this._months)?this._months:this._months.standalone},hn.monthsShort=function(e,t){return e?s(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[We.test(t)?"format":"standalone"][e.month()]:s(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},hn.monthsParse=function(e,t,n){var s,i,r;if(this._monthsParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=h([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:"MMM"===t?-1!==(i=Ye.call(this._shortMonthsParse,a))?i:-1!==(i=Ye.call(this._longMonthsParse,a))?i:null:-1!==(i=Ye.call(this._longMonthsParse,a))?i:-1!==(i=Ye.call(this._shortMonthsParse,a))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=h([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},hn.monthsRegex=function(e){return this._monthsParseExact?(l(this,"_monthsRegex")||Ne.call(this),e?this._monthsStrictRegex:this._monthsRegex):(l(this,"_monthsRegex")||(this._monthsRegex=Ue),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},hn.monthsShortRegex=function(e){return this._monthsParseExact?(l(this,"_monthsRegex")||Ne.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(l(this,"_monthsShortRegex")||(this._monthsShortRegex=Le),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},hn.week=function(e){return Ie(e,this._week.dow,this._week.doy).week},hn.firstDayOfYear=function(){return this._week.doy},hn.firstDayOfWeek=function(){return this._week.dow},hn.weekdays=function(e,t){return e?s(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:s(this._weekdays)?this._weekdays:this._weekdays.standalone},hn.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},hn.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},hn.weekdaysParse=function(e,t,n){var s,i,r;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,a=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=h([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"dddd"===t?-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:"ddd"===t?-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:null:-1!==(i=Ye.call(this._minWeekdaysParse,a))?i:-1!==(i=Ye.call(this._weekdaysParse,a))?i:-1!==(i=Ye.call(this._shortWeekdaysParse,a))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=h([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".",".?")+"$","i")),this._weekdaysParse[s]||(r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},hn.weekdaysRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(l(this,"_weekdaysRegex")||(this._weekdaysRegex=$e),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},hn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(l(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qe),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},hn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||Be.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(l(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Je),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},hn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},hn.meridiem=function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},ot("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===M(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),n.lang=k("moment.lang is deprecated. Use moment.locale instead.",ot),n.langData=k("moment.langData is deprecated. Use moment.localeData instead.",lt);var _n=Math.abs;function yn(e,t,n,s){var i=At(t,n);return e._milliseconds+=s*i._milliseconds,e._days+=s*i._days,e._months+=s*i._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function pn(e){return 4800*e/146097}function vn(e){return 146097*e/4800}function wn(e){return function(){return this.as(e)}}var Mn=wn("ms"),Sn=wn("s"),Dn=wn("m"),kn=wn("h"),Yn=wn("d"),On=wn("w"),Tn=wn("M"),xn=wn("y");function bn(e){return function(){return this.isValid()?this._data[e]:NaN}}var Pn=bn("milliseconds"),Wn=bn("seconds"),Hn=bn("minutes"),Rn=bn("hours"),Cn=bn("days"),Fn=bn("months"),Ln=bn("years");var Un=Math.round,Nn={ss:44,s:45,m:45,h:22,d:26,M:11};var Gn=Math.abs;function Vn(e){return(e>0)-(e<0)||+e}function En(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n=Gn(this._milliseconds)/1e3,s=Gn(this._days),i=Gn(this._months);t=w((e=w(n/60))/60),n%=60,e%=60;var r=w(i/12),a=i%=12,o=s,u=t,l=e,d=n?n.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";var c=h<0?"-":"",f=Vn(this._months)!==Vn(h)?"-":"",m=Vn(this._days)!==Vn(h)?"-":"",_=Vn(this._milliseconds)!==Vn(h)?"-":"";return c+"P"+(r?f+r+"Y":"")+(a?f+a+"M":"")+(o?m+o+"D":"")+(u||l||d?"T":"")+(u?_+u+"H":"")+(l?_+l+"M":"")+(d?_+d+"S":"")}var In=Ht.prototype;return In.isValid=function(){return this._isValid},In.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},In.add=function(e,t){return yn(this,e,t,1)},In.subtract=function(e,t){return yn(this,e,t,-1)},In.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=R(e))||"year"===e)return t=this._days+s/864e5,n=this._months+pn(t),"month"===e?n:n/12;switch(t=this._days+Math.round(vn(this._months)),e){case"week":return t/7+s/6048e5;case"day":return t+s/864e5;case"hour":return 24*t+s/36e5;case"minute":return 1440*t+s/6e4;case"second":return 86400*t+s/1e3;case"millisecond":return Math.floor(864e5*t)+s;default:throw new Error("Unknown unit "+e)}},In.asMilliseconds=Mn,In.asSeconds=Sn,In.asMinutes=Dn,In.asHours=kn,In.asDays=Yn,In.asWeeks=On,In.asMonths=Tn,In.asYears=xn,In.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*M(this._months/12):NaN},In._bubble=function(){var e,t,n,s,i,r=this._milliseconds,a=this._days,o=this._months,u=this._data;return r>=0&&a>=0&&o>=0||r<=0&&a<=0&&o<=0||(r+=864e5*gn(vn(o)+a),a=0,o=0),u.milliseconds=r%1e3,e=w(r/1e3),u.seconds=e%60,t=w(e/60),u.minutes=t%60,n=w(t/60),u.hours=n%24,o+=i=w(pn(a+=w(n/24))),a-=gn(vn(i)),s=w(o/12),o%=12,u.days=a,u.months=o,u.years=s,this},In.clone=function(){return At(this)},In.get=function(e){return e=R(e),this.isValid()?this[e+"s"]():NaN},In.milliseconds=Pn,In.seconds=Wn,In.minutes=Hn,In.hours=Rn,In.days=Cn,In.weeks=function(){return w(this.days()/7)},In.months=Fn,In.years=Ln,In.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,n,s,i,r,a,o,u,l,d,h,c=this.localeData(),f=(n=!e,s=c,i=At(t=this).abs(),r=Un(i.as("s")),a=Un(i.as("m")),o=Un(i.as("h")),u=Un(i.as("d")),l=Un(i.as("M")),d=Un(i.as("y")),(h=r<=Nn.ss&&["s",r]||r<Nn.s&&["ss",r]||a<=1&&["m"]||a<Nn.m&&["mm",a]||o<=1&&["h"]||o<Nn.h&&["hh",o]||u<=1&&["d"]||u<Nn.d&&["dd",u]||l<=1&&["M"]||l<Nn.M&&["MM",l]||d<=1&&["y"]||["yy",d])[2]=n,h[3]=+t>0,h[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,h));return e&&(f=c.pastFuture(+this,f)),c.postformat(f)},In.toISOString=En,In.toString=En,In.toJSON=En,In.locale=Qt,In.localeData=Kt,In.toIsoString=k("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",En),In.lang=Xt,I("X",0,0,"unix"),I("x",0,0,"valueOf"),ue("x",se),ue("X",/[+-]?\d+(\.\d{1,3})?/),ce("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),ce("x",function(e,t,n){n._d=new Date(M(e))}),n.version="2.21.0",e=Tt,n.fn=ln,n.min=function(){return Pt("isBefore",[].slice.call(arguments,0))},n.max=function(){return Pt("isAfter",[].slice.call(arguments,0))},n.now=function(){return Date.now?Date.now():+new Date},n.utc=h,n.unix=function(e){return Tt(1e3*e)},n.months=function(e,t){return fn(e,t,"months")},n.isDate=o,n.locale=ot,n.invalid=m,n.duration=At,n.isMoment=v,n.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},n.parseZone=function(){return Tt.apply(null,arguments).parseZone()},n.localeData=lt,n.isDuration=Rt,n.monthsShort=function(e,t){return fn(e,t,"monthsShort")},n.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},n.defineLocale=ut,n.updateLocale=function(e,t){if(null!=t){var n,s,i=nt;null!=(s=at(e))&&(i=s._config),(n=new P(t=b(i,t))).parentLocale=st[e],st[e]=n,ot(e)}else null!=st[e]&&(null!=st[e].parentLocale?st[e]=st[e].parentLocale:null!=st[e]&&delete st[e]);return st[e]},n.locales=function(){return Y(st)},n.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},n.normalizeUnits=R,n.relativeTimeRounding=function(e){return void 0===e?Un:"function"==typeof e&&(Un=e,!0)},n.relativeTimeThreshold=function(e,t){return void 0!==Nn[e]&&(void 0===t?Nn[e]:(Nn[e]=t,"s"===e&&(Nn.ss=t-1),!0))},n.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},n.prototype=ln,n.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},n});
{
    (function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js Api - Global Resources
        //
        // This is place for all Bizweb js api global resources like: functions, variables, configs,...
        // ---------------------------------------------------------------------------------
        var r;
        r = $("meta[name='bizweb-admin-context']").attr("content"); null != r ? window.Bizweb || (window.Bizweb = JSON.parse(r)) : window.Bizweb || (window.Bizweb = {});
        Bizweb.DEFAULT_OPTION_NAME = "Title";
        Bizweb.DEFAULT_OPTION_VALUE = "Default Title";
        Bizweb.DEFAULT_OPTION_NAMES = ["Kích thước", "Màu sắc", "Chất liệu", "Kiểu dáng"];
        Bizweb.LOADING = "<i class='fa fa-lg fa-spinner fa-pulse'></i>";
        Bizweb.config = {
            theme_extension: "bwt",
            aviary_api_key: "27f70770623f4ba7b0e9ab52ddfa3e3b"
        };
        Bizweb.funcRoutes = {};
        Bizweb.routes = {
            root: "/admin",
            dashboard: "/admin",
            themes: "/admin/topic",
            orders: "/admin/orders",
            products: "/admin/products",
            checkouts: "/admin/checkouts",
            draftorders: "/admin/draft_orders",
            update_product_image: "/admin/products/{0}/images/{1}",
            setting: {
                payments: "/admin/settings/payments",
                checkout: "/admin/settings/checkout",
                shipping: "/admin/settings/shipping",
                notifications: "/admin/settings/notifications",
                domain: "/admin/settings/domains"
            },
            ghn: "/admin/ghn",
            shipchung: "/admin/shipchung",
            boxme: "/admin/boxme",
            ghtk: "/admin/ghtk",
            vtp: "/admin/vtp",
            sgp: "/admin/sgp",
            dhl: "/admin/dhl",
            domain: {
                media: "//bizweb.dktcdn.net/",
                thumb: "//bizweb.dktcdn.net/thumb/"
            },
            apps: "/admin/apps",
            collections: "/admin/collections",
            channels: "/admin/channels",
            charges: "/admin/charges",
            customers: "/admin/customers",
            comments: "/admin/comments",
            blogs: "/admin/blogs",
            pages: "/admin/pages",
            discounts: "/admin/discounts",
            notifications: "/admin/notifications",
            users: "/admin/settings/account",
            plans: "/admin/settings/plans",
            bulk: "/admin/bulk",
            activityFeed: "/admin/activity/feed",
            vnp: "/admin/vnp"
        };

        var o = [].slice;
        var i = function () {
            var t, e, n, i, r, a, s, u, l;
            for (n = arguments[0], e = 2 <= arguments.length ? o.call(arguments, 1) : [], _.isObject(_.last(e)) && (s = e.pop()), u = n, i = r = 0, a = e.length; a > r; i = ++r) t = e[i], u = u.replace(":" + (i + 1), t);
            if (-1 !== u.indexOf(":")) throw "Path '" + u + "' is expecting more arguments";
            return l = s ? "?" + $.param(s) : "", {
                html: "" + u + l,
                json: u + ".json" + l
            }
        }
        for (key in Bizweb.routes) t = Bizweb.routes[key], Bizweb.funcRoutes[key] = i.bind(null, t)

        _urlMappings = {
            "collection": "/admin/collections/SingleDropdown",
            "product": "/admin/products/SingleDropdown",
            "page": "/admin/pages/SingleDropdown",
            "blog": "/admin/blogs/SingleDropdown",
            "customer": "/admin/customers/singledropdown",
            "article": "/admin/articles/SingleDropdown"
        };

        _urlSuggestMappings = {
            "collection": "/admin/collections/SingleSuggest",
            "product": "/admin/products/SingleSuggest",
            "page": "/admin/pages/SingleSuggest",
            "blog": "/admin/blogs/SingleSuggest",
            "customer": "/admin/customers/singlesuggest",
            "article": "/admin/articles/SingleSuggest"
        };

        _urlMultipleMappings = {
            "collection": "/admin/collections/Dropdown?type=custom&",
            "product": "/admin/products/Dropdown?"
        };

        _urlMultipleSuggestMappings = {
            "collection": "/admin/collections/Suggest?type=custom&",
            "product": "/admin/products/Suggest?"
        };

    }).call(this),

    // -----------------------
    // Lodash
    // -----------------------
    function () {
        function t(t, e) { return t.set(e[0], e[1]), t }
        function e(t, e) { return t.add(e), t }
        function n(t, e, n) {
            var i = n.length; switch (i) { case 0: return t.call(e); case 1: return t.call(e, n[0]); case 2: return t.call(e, n[0], n[1]); case 3: return t.call(e, n[0], n[1], n[2]) } return t.apply(e, n)
        }
        function i(t, e, n, i) {
            for (var r = -1, o = t.length; ++r < o;) { var a = t[r]; e(i, a, n(a), t) } return i
        }
        function r(t, e) {
            for (var n = -1, i = t.length, r = -1, o = e.length, a = Array(i + o) ; ++n < i;) a[n] = t[n]; for (; ++r < o;) a[n++] = e[r]; return a
        }
        function o(t, e) {
            for (var n = -1, i = t.length; ++n < i && e(t[n], n, t) !== !1;); return t
        }
        function a(t, e) {
            for (var n = t.length; n-- && e(t[n], n, t) !== !1;); return t
        }
        function s(t, e) {
            for (var n = -1, i = t.length; ++n < i;) if (!e(t[n], n, t)) return !1; return !0
        }
        function u(t, e) {
            for (var n = -1, i = t.length, r = 0, o = []; ++n < i;) { var a = t[n]; e(a, n, t) && (o[r++] = a) } return o
        }
        function l(t, e) {
            return !!t.length && v(t, e, 0) > -1
        }
        function c(t, e, n) {
            for (var i = -1, r = t.length; ++i < r;) if (n(e, t[i])) return !0; return !1
        }
        function h(t, e) {
            for (var n = -1, i = t.length, r = Array(i) ; ++n < i;) r[n] = e(t[n], n, t); return r
        }
        function d(t, e) {
            for (var n = -1, i = e.length, r = t.length; ++n < i;) t[r + n] = e[n]; return t
        } function p(t, e, n, i) { var r = -1, o = t.length; for (i && o && (n = t[++r]) ; ++r < o;) n = e(n, t[r], r, t); return n } function f(t, e, n, i) { var r = t.length; for (i && r && (n = t[--r]) ; r--;) n = e(n, t[r], r, t); return n } function m(t, e) { for (var n = -1, i = t.length; ++n < i;) if (e(t[n], n, t)) return !0; return !1 } function g(t, e, n) { for (var i = -1, r = t.length; ++i < r;) { var o = t[i], a = e(o); if (null != a && (s === K ? a === a : n(a, s))) var s = a, u = o } return u } function y(t, e, n, i) { var r; return n(t, function (t, n, o) { return e(t, n, o) ? (r = i ? n : t, !1) : void 0 }), r } function _(t, e, n) { for (var i = t.length, r = n ? i : -1; n ? r-- : ++r < i;) if (e(t[r], r, t)) return r; return -1 } function v(t, e, n) { if (e !== e) return F(t, n); for (var i = n - 1, r = t.length; ++i < r;) if (t[i] === e) return i; return -1 } function b(t, e, n, i) { for (var r = n - 1, o = t.length; ++r < o;) if (i(t[r], e)) return r; return -1 } function S(t, e, n, i, r) { return r(t, function (t, r, o) { n = i ? (i = !1, t) : e(n, t, r, o) }), n } function x(t, e) { var n = t.length; for (t.sort(e) ; n--;) t[n] = t[n].value; return t } function w(t, e) { for (var n, i = -1, r = t.length; ++i < r;) { var o = e(t[i]); o !== K && (n = n === K ? o : n + o) } return n }
        function T(t, e) { for (var n = -1, i = Array(t) ; ++n < t;) i[n] = e(n); return i } function A(t, e) { return h(e, function (e) { return [e, t[e]] }) } function C(t) { return function (e) { return t(e) } } function E(t, e) { return h(e, function (e) { return t[e] }) } function D(t, e) { for (var n = -1, i = t.length; ++n < i && v(e, t[n], 0) > -1;); return n } function k(t, e) { for (var n = t.length; n-- && v(e, t[n], 0) > -1;); return n } function R(t) { return t && t.Object === Object ? t : null } function M(t, e) { if (t !== e) { var n = null === t, i = t === K, r = t === t, o = null === e, a = e === K, s = e === e; if (t > e && !o || !r || n && !a && s || i && s) return 1; if (e > t && !n || !s || o && !i && r || a && r) return -1 } return 0 } function P(t, e, n) { for (var i = -1, r = t.criteria, o = e.criteria, a = r.length, s = n.length; ++i < a;) { var u = M(r[i], o[i]); if (u) { if (i >= s) return u; var l = n[i]; return u * ("desc" == l ? -1 : 1) } } return t.index - e.index } function N(t, e) { for (var n = t.length, i = 0; n--;) t[n] === e && i++; return i } function I(t) { return vn[t] } function L(t) { return bn[t] } function O(t) { return "\\" + wn[t] } function F(t, e, n) { for (var i = t.length, r = e + (n ? 0 : -1) ; n ? r-- : ++r < i;) { var o = t[r]; if (o !== o) return r } return -1 } function B(t) { var e = !1; if (null != t && "function" != typeof t.toString) try { e = !!(t + "") } catch (n) { } return e }
        function $(t, e) { return t = "number" == typeof t || Te.test(t) ? +t : -1, e = null == e ? bt : e, t > -1 && t % 1 == 0 && e > t } function H(t) { for (var e, n = []; !(e = t.next()).done;) n.push(e.value); return n } function z(t) { var e = -1, n = Array(t.size); return t.forEach(function (t, i) { n[++e] = [i, t] }), n } function V(t, e) { for (var n = -1, i = t.length, r = 0, o = []; ++n < i;) { var a = t[n]; (a === e || a === Z) && (t[n] = Z, o[r++] = n) } return o } function U(t) { var e = -1, n = Array(t.size); return t.forEach(function (t) { n[++e] = t }), n }
        function j(t) { if (!t || !hn.test(t)) return t.length; for (var e = cn.lastIndex = 0; cn.test(t) ;) e++; return e } function W(t) { return t.match(cn) } function q(t) { return Sn[t] }
        function G(R) {
            /**Compare 2 object **/
            //Compare 2 object
            //Returns the object's class, Array, Date, RegExp, Object are of interest to us
            var getClass = function (val) {
                return Object.prototype.toString.call(val)
                    .match(/^\[object\s(.*)\]$/)[1];
            };

            //Defines the type of the value, extended typeof
            var whatis = function (val) {

                if (val === undefined)
                    return 'undefined';
                if (val === null)
                    return 'null';

                var type = typeof val;

                if (type === 'object')
                    type = getClass(val).toLowerCase();

                if (type === 'number') {
                    if (val.toString().indexOf('.') > 0)
                        return 'float';
                    else
                        return 'integer';
                }

                return type;
            };

            var compareObjects = function (a, b) {
                if (a === b)
                    return true;
                for (var i in a) {
                    if (b.hasOwnProperty(i)) {
                        if (!equal(a[i], b[i])) return false;
                    } else {
                        return false;
                    }
                }

                for (var i in b) {
                    if (!a.hasOwnProperty(i)) {
                        return false;
                    }
                }
                return true;
            };

            var compareArrays = function (a, b) {
                if (a === b)
                    return true;
                if (a.length !== b.length)
                    return false;
                for (var i = 0; i < a.length; i++) {
                    if (!equal(a[i], b[i])) return false;
                };
                return true;
            };

            var _equal = {};
            _equal.array = compareArrays;
            _equal.object = compareObjects;
            _equal.date = function (a, b) {
                return a.getTime() === b.getTime();
            };
            _equal.regexp = function (a, b) {
                return a.toString() === b.toString();
            };
            //	uncoment to support function as string compare
            //	_equal.fucntion =  _equal.regexp;
            /*
             * Are two values equal, deep compare for objects and arrays.
             * @param a {any}
             * @param b {any}
             * @return {boolean} Are equal?
             */
            var equal = function (a, b) {
                if (a !== b) {
                    var atype = whatis(a), btype = whatis(b);

                    if (atype === btype)
                        return _equal.hasOwnProperty(atype) ? _equal[atype](a, b) : a == b;

                    return false;
                }

                return true;
            };
            /** End Compare 2 object**/
            /** prepareTransition **/
            var prepareTransition = function (ele) {
                return jQuery(ele).each(function () {
                    var t = jQuery(ele); t.one("TransitionEnd webkitTransitionEnd transitionend oTransitionEnd",
                        function () { t.removeClass("is-transitioning") }); var n = ["transition-duration", "-moz-transition-duration", "-webkit-transition-duration",
                            "-o-transition-duration"], i = 0; jQuery.each(n, function (e, n) { i || (i = parseFloat(t.css(n))) }),
                                0 != i && (t.addClass("is-transitioning"), t[0].offsetWidth)
                })
            }
            /** **/

            function Te(t) {
                if (za(t) && !Cc(t) && !(t instanceof Re)) { if (t instanceof ke) return t; if (Ku.call(t, "__wrapped__")) return Ir(t) } return new ke(t)
            }

            function De() { } function ke(t, e) { this.__wrapped__ = t, this.__actions__ = [], this.__chain__ = !!e, this.__index__ = 0, this.__values__ = K } function Re(t) { this.__wrapped__ = t, this.__actions__ = [], this.__dir__ = 1, this.__filtered__ = !1, this.__iteratees__ = [], this.__takeCount__ = wt, this.__views__ = [] } function Me() { var t = new Re(this.__wrapped__); return t.__actions__ = $i(this.__actions__), t.__dir__ = this.__dir__, t.__filtered__ = this.__filtered__, t.__iteratees__ = $i(this.__iteratees__), t.__takeCount__ = this.__takeCount__, t.__views__ = $i(this.__views__), t } function Pe() { if (this.__filtered__) { var t = new Re(this); t.__dir__ = -1, t.__filtered__ = !0 } else t = this.clone(), t.__dir__ *= -1; return t } function Ne() { var t = this.__wrapped__.value(), e = this.__dir__, n = Cc(t), i = 0 > e, r = n ? t.length : 0, o = yr(0, r, this.__views__), a = o.start, s = o.end, u = s - a, l = i ? s : a - 1, c = this.__iteratees__, h = c.length, d = 0, p = vl(u, this.__takeCount__); if (!n || X > r || r == u && p == u) return Ei(t, this.__actions__); var f = []; t: for (; u-- && p > d;) { l += e; for (var m = -1, g = t[l]; ++m < h;) { var y = c[m], _ = y.iteratee, v = y.type, b = _(g); if (v == yt) g = b; else if (!b) { if (v == gt) continue t; break t } } f[d++] = g } return f } function Ie() { } function Le(t, e) { return Fe(t, e) && delete t[e] } function Oe(t, e) { if (Cl) { var n = t[e]; return n === J ? K : n } return Ku.call(t, e) ? t[e] : K } function Fe(t, e) { return Cl ? t[e] !== K : Ku.call(t, e) } function Be(t, e, n) { t[e] = Cl && n === K ? J : n } function $e(t) { var e = -1, n = t ? t.length : 0; for (this.clear() ; ++e < n;) { var i = t[e]; this.set(i[0], i[1]) } } function He() { this.__data__ = { hash: new Ie, map: wl ? new wl : [], string: new Ie } } function ze(t) { var e = this.__data__; return Ar(t) ? Le("string" == typeof t ? e.string : e.hash, t) : wl ? e.map["delete"](t) : tn(e.map, t) } function Ve(t) { var e = this.__data__; return Ar(t) ? Oe("string" == typeof t ? e.string : e.hash, t) : wl ? e.map.get(t) : en(e.map, t) } function Ue(t) { var e = this.__data__; return Ar(t) ? Fe("string" == typeof t ? e.string : e.hash, t) : wl ? e.map.has(t) : nn(e.map, t) } function je(t, e) { var n = this.__data__; return Ar(t) ? Be("string" == typeof t ? n.string : n.hash, t, e) : wl ? n.map.set(t, e) : on(n.map, t, e), this } function We(t) { var e = -1, n = t ? t.length : 0; for (this.__data__ = new $e; ++e < n;) this.push(t[e]) } function qe(t, e) { var n = t.__data__; if (Ar(e)) { var i = n.__data__, r = "string" == typeof e ? i.string : i.hash; return r[e] === J } return n.has(e) } function Ge(t) { var e = this.__data__; if (Ar(t)) { var n = e.__data__, i = "string" == typeof t ? n.string : n.hash; i[t] = J } else e.set(t, J) } function Ke(t) { var e = -1, n = t ? t.length : 0; for (this.clear() ; ++e < n;) { var i = t[e]; this.set(i[0], i[1]) } } function Ye() { this.__data__ = { array: [], map: null } } function Xe(t) { var e = this.__data__, n = e.array; return n ? tn(n, t) : e.map["delete"](t) } function Qe(t) { var e = this.__data__, n = e.array; return n ? en(n, t) : e.map.get(t) } function Je(t) { var e = this.__data__, n = e.array; return n ? nn(n, t) : e.map.has(t) } function Ze(t, e) { var n = this.__data__, i = n.array; i && (i.length < X - 1 ? on(i, t, e) : (n.array = null, n.map = new $e(i))); var r = n.map; return r && r.set(t, e), this } function tn(t, e) { var n = rn(t, e); if (0 > n) return !1; var i = t.length - 1; return n == i ? t.pop() : dl.call(t, n, 1), !0 } function en(t, e) { var n = rn(t, e); return 0 > n ? K : t[n][1] } function nn(t, e) { return rn(t, e) > -1 } function rn(t, e) { for (var n = t.length; n--;) if (xa(t[n][0], e)) return n; return -1 } function on(t, e, n) { var i = rn(t, e); 0 > i ? t.push([e, n]) : t[i][1] = n } function an(t, e, n, i) { return t === K || xa(t, qu[n]) && !Ku.call(i, n) ? e : t } function sn(t, e, n) { (n !== K && !xa(t[e], n) || "number" == typeof e && n === K && !(e in t)) && (t[e] = n) } function un(t, e, n) { var i = t[e]; Ku.call(t, e) && xa(i, n) && (n !== K || e in t) || (t[e] = n) } function cn(t, e, n, i) { return Ol(t, function (t, r, o) { e(i, t, n(t), o) }), i } function vn(t, e) { return t && Hi(e, Es(e), t) } function bn(t, e) { for (var n = -1, i = null == t, r = e.length, o = Array(r) ; ++n < r;) o[n] = i ? K : Ts(t, e[n]); return o } function Sn(t) { return Da(t) ? t : [] } function xn(t) { return "function" == typeof t ? t : _u } function wn(t) { return Cc(t) ? t : Nr(t) } function Cn(t, e, n) { return t === t && (n !== K && (t = n >= t ? t : n), e !== K && (t = t >= e ? t : e)), t } function En(t, e, n, i, r, a, s) { var u; if (i && (u = a ? i(t, r, a, s) : i(t)), u !== K) return u; if (!Ha(t)) return t; var l = Cc(t); if (l) { if (u = vr(t), !e) return $i(t, u) } else { var c = gr(t), h = c == Mt || c == Pt; if (Ec(t)) return Ri(t, e); if (c == Lt || c == Ct || h && !a) { if (B(t)) return a ? t : {}; if (u = br(h ? {} : t), !e) return u = vn(u, t), n ? Vi(t, u) : u } else { if (!_n[c]) return a ? t : {}; u = Sr(t, c, e) } } s || (s = new Ke); var d = s.get(t); return d ? d : (s.set(t, u), (l ? o : Hn)(t, function (r, o) { un(u, o, En(r, e, n, i, o, t, s)) }), n && !l ? Vi(t, u) : u) } function kn(t) { var e = Es(t), n = e.length; return function (i) { if (null == i) return !n; for (var r = n; r--;) { var o = e[r], a = t[o], s = i[o]; if (s === K && !(o in Object(i)) || !a(s)) return !1 } return !0 } } function Rn(t) { return Ha(t) ? ll(t) : {} } function Mn(t, e, n) { if ("function" != typeof t) throw new ju(Q); return hl(function () { t.apply(K, n) }, e) } function Pn(t, e, n, i) { var r = -1, o = l, a = !0, s = t.length, u = [], d = e.length; if (!s) return u; n && (e = h(e, C(n))), i ? (o = c, a = !1) : e.length >= X && (o = qe, a = !1, e = new We(e)); t: for (; ++r < s;) { var p = t[r], f = n ? n(p) : p; if (a && f === f) { for (var m = d; m--;) if (e[m] === f) continue t; u.push(p) } else o(e, f, i) || u.push(p) } return u } function Ln(t, e) { var n = !0; return Ol(t, function (t, i, r) { return n = !!e(t, i, r) }), n } function On(t, e, n, i) { var r = t.length; for (n = ls(n), 0 > n && (n = -n > r ? 0 : r + n), i = i === K || i > r ? r : ls(i), 0 > i && (i += r), i = n > i ? 0 : cs(i) ; i > n;) t[n++] = e; return t } function Fn(t, e) { var n = []; return Ol(t, function (t, i, r) { e(t, i, r) && n.push(t) }), n } function Bn(t, e, n, i) { i || (i = []); for (var r = -1, o = t.length; ++r < o;) { var a = t[r]; e > 0 && Da(a) && (n || Cc(a) || Aa(a)) ? e > 1 ? Bn(a, e - 1, n, i) : d(i, a) : n || (i[i.length] = a) } return i } function $n(t, e) { return null == t ? t : Bl(t, e, Ds) } function Hn(t, e) { return t && Bl(t, e, Es) } function zn(t, e) { return t && $l(t, e, Es) } function Vn(t, e) { return u(e, function (e) { return Fa(t[e]) }) } function Un(t, e) { e = Tr(e, t) ? [e + ""] : wn(e); for (var n = 0, i = e.length; null != t && i > n;) t = t[e[n++]]; return n && n == i ? t : K }
            function jn(t, e) { return Ku.call(t, e) || "object" == typeof t && e in t && null === al(t) } function Wn(t, e) { return e in Object(t) } function qn(t, e, n) { return t >= vl(e, n) && t < _l(e, n) } function Gn(t, e, n) { for (var i = n ? c : l, r = t[0].length, o = t.length, a = o, s = Array(o), u = 1 / 0, d = []; a--;) { var p = t[a]; a && e && (p = h(p, C(e))), u = vl(p.length, u), s[a] = !n && (e || r >= 120 && p.length >= 120) ? new We(a && p) : K } p = t[0]; var f = -1, m = s[0]; t: for (; ++f < r && d.length < u;) { var g = p[f], y = e ? e(g) : g; if (!(m ? qe(m, y) : i(d, y, n))) { for (a = o; --a;) { var _ = s[a]; if (!(_ ? qe(_, y) : i(t[a], y, n))) continue t } m && m.push(y), d.push(g) } } return d } function Kn(t, e, n, i) { return Hn(t, function (t, r, o) { e(i, n(t), r, o) }), i } function Yn(t, e, i) { Tr(e, t) || (e = wn(e), t = Mr(t, e), e = Jr(e)); var r = null == t ? t : t[e]; return null == r ? K : n(r, t, i) } function Xn(t, e, n, i, r) { return t === e ? !0 : null == t || null == e || !Ha(t) && !za(e) ? t !== t && e !== e : Qn(t, e, Xn, n, i, r) } function Qn(t, e, n, i, r, o) { var a = Cc(t), s = Cc(e), u = Et, l = Et; a || (u = gr(t), u = u == Ct ? Lt : u), s || (l = gr(e), l = l == Ct ? Lt : l); var c = u == Lt && !B(t), h = l == Lt && !B(e), d = u == l; if (d && !c) return o || (o = new Ke), a || ns(t) ? ur(t, e, n, i, r, o) : lr(t, e, u, n, i, r, o); if (!(r & ht)) { var p = c && Ku.call(t, "__wrapped__"), f = h && Ku.call(e, "__wrapped__"); if (p || f) return o || (o = new Ke), n(p ? t.value() : t, f ? e.value() : e, i, r, o) } return d ? (o || (o = new Ke), cr(t, e, n, i, r, o)) : !1 } function Jn(t, e, n, i) { var r = n.length, o = r, a = !i; if (null == t) return !o; for (t = Object(t) ; r--;) { var s = n[r]; if (a && s[2] ? s[1] !== t[s[0]] : !(s[0] in t)) return !1 } for (; ++r < o;) { s = n[r]; var u = s[0], l = t[u], c = s[1]; if (a && s[2]) { if (l === K && !(u in t)) return !1 } else { var h = new Ke, d = i ? i(l, c, u, t, e, h) : K; if (!(d === K ? Xn(c, l, i, ct | ht, h) : d)) return !1 } } return !0 } function Zn(t) { var e = typeof t; return "function" == e ? t : null == t ? _u : "object" == e ? Cc(t) ? ri(t[0], t[1]) : ii(t) : Cu(t) }
            function ti(t) { return yl(Object(t)) } function ei(t) { t = null == t ? t : Object(t); var e = []; for (var n in t) e.push(n); return e } function ni(t, e) { var n = -1, i = Ea(t) ? Array(t.length) : []; return Ol(t, function (t, r, o) { i[++n] = e(t, r, o) }), i } function ii(t) { var e = pr(t); if (1 == e.length && e[0][2]) { var n = e[0][0], i = e[0][1]; return function (t) { return null == t ? !1 : t[n] === i && (i !== K || n in Object(t)) } } return function (n) { return n === t || Jn(n, t, e) } } function ri(t, e) { return function (n) { var i = Ts(n, t); return i === K && i === e ? Cs(n, t) : Xn(e, i, K, ct | ht) } } function oi(t, e, n, i, r) { if (t !== e) { var a = Cc(e) || ns(e) ? K : Ds(e); o(a || e, function (o, s) { if (a && (s = o, o = e[s]), Ha(o)) r || (r = new Ke), ai(t, e, s, n, oi, i, r); else { var u = i ? i(t[s], o, s + "", t, e, r) : K; u === K && (u = o), sn(t, s, u) } }) } } function ai(t, e, n, i, r, o, a) { var s = t[n], u = e[n], l = a.get(u); if (l) return void sn(t, n, l); var c = o ? o(s, u, n + "", t, e, a) : K, h = c === K; h && (c = u, Cc(u) || ns(u) ? Cc(s) ? c = s : Da(s) ? c = $i(s) : (h = !1, c = En(u, !o)) : Xa(u) || Aa(u) ? Aa(s) ? c = ds(s) : !Ha(s) || i && Fa(s) ? (h = !1, c = En(u, !o)) : c = s : h = !1), a.set(u, c), h && r(c, u, i, o, a), a["delete"](u), sn(t, n, c) } function si(t, e, n) { var i = -1; e = h(e.length ? e : Array(1), dr()); var r = ni(t, function (t, n, r) { var o = h(e, function (e) { return e(t) }); return { criteria: o, index: ++i, value: t } }); return x(r, function (t, e) { return P(t, e, n) }) } function ui(t, e) { return t = Object(t), p(e, function (e, n) { return n in t && (e[n] = t[n]), e }, {}) } function li(t, e) { var n = {}; return $n(t, function (t, i) { e(t, i) && (n[i] = t) }), n }
            function ci(t) { return function (e) { return null == e ? K : e[t] } } function hi(t) { return function (e) { return Un(e, t) } } function di(t, e, n, i) { var r = i ? b : v, o = -1, a = e.length, s = t; for (n && (s = h(t, C(n))) ; ++o < a;) for (var u = 0, l = e[o], c = n ? n(l) : l; (u = r(s, c, u, i)) > -1;) s !== t && dl.call(s, u, 1), dl.call(t, u, 1); return t } function pi(t, e) { for (var n = t ? e.length : 0, i = n - 1; n--;) { var r = e[n]; if (i == n || r != o) { var o = r; if ($(r)) dl.call(t, r, 1); else if (Tr(r, t)) delete t[r]; else { var a = wn(r), s = Mr(t, a); null != s && delete s[Jr(a)] } } } return t } function fi(t, e) { return t + fl(Sl() * (e - t + 1)) } function mi(t, e, n, i) { for (var r = -1, o = _l(pl((e - t) / (n || 1)), 0), a = Array(o) ; o--;) a[i ? o : ++r] = t, t += n; return a } function gi(t, e, n, i) { e = Tr(e, t) ? [e + ""] : wn(e); for (var r = -1, o = e.length, a = o - 1, s = t; null != s && ++r < o;) { var u = e[r]; if (Ha(s)) { var l = n; if (r != a) { var c = s[u]; l = i ? i(c, u, s) : K, l === K && (l = null == c ? $(e[r + 1]) ? [] : {} : c) } un(s, u, l) } s = s[u] } return t } function yi(t, e, n) { var i = -1, r = t.length; 0 > e && (e = -e > r ? 0 : r + e), n = n > r ? r : n, 0 > n && (n += r), r = e > n ? 0 : n - e >>> 0, e >>>= 0; for (var o = Array(r) ; ++i < r;) o[i] = t[i + e]; return o } function _i(t, e) { var n; return Ol(t, function (t, i, r) { return n = e(t, i, r), !n }), !!n } function vi(t, e, n) { var i = 0, r = t ? t.length : i; if ("number" == typeof e && e === e && At >= r) { for (; r > i;) { var o = i + r >>> 1, a = t[o]; (n ? e >= a : e > a) && null !== a ? i = o + 1 : r = o } return r } return bi(t, e, _u, n) } function bi(t, e, n, i) { e = n(e); for (var r = 0, o = t ? t.length : 0, a = e !== e, s = null === e, u = e === K; o > r;) { var l = fl((r + o) / 2), c = n(t[l]), h = c !== K, d = c === c; if (a) var p = d || i; else p = s ? d && h && (i || null != c) : u ? d && (i || h) : null == c ? !1 : i ? e >= c : e > c; p ? r = l + 1 : o = l } return vl(o, Tt) } function Si(t) { return xi(t) } function xi(t, e) { for (var n = 0, i = t.length, r = t[0], o = e ? e(r) : r, a = o, s = 1, u = [r]; ++n < i;) r = t[n], o = e ? e(r) : r, xa(o, a) || (a = o, u[s++] = r); return u } function wi(t, e, n) { var i = -1, r = l, o = t.length, a = !0, s = [], u = s; if (n) a = !1, r = c; else if (o >= X) { var h = e ? null : zl(t); if (h) return U(h); a = !1, r = qe, u = new We } else u = e ? [] : s; t: for (; ++i < o;) { var d = t[i], p = e ? e(d) : d; if (a && p === p) { for (var f = u.length; f--;) if (u[f] === p) continue t; e && u.push(p), s.push(d) } else r(u, p, n) || (u !== s && u.push(p), s.push(d)) } return s } function Ti(t, e) { e = Tr(e, t) ? [e + ""] : wn(e), t = Mr(t, e); var n = Jr(e); return null != t && As(t, n) ? delete t[n] : !0 } function Ai(t, e, n, i) { return gi(t, e, n(Un(t, e)), i) } function Ci(t, e, n, i) { for (var r = t.length, o = i ? r : -1; (i ? o-- : ++o < r) && e(t[o], o, t) ;); return n ? yi(t, i ? 0 : o, i ? o + 1 : r) : yi(t, i ? o + 1 : 0, i ? r : o) } function Ei(t, e) { var n = t; return n instanceof Re && (n = n.value()), p(e, function (t, e) { return e.func.apply(e.thisArg, d([t], e.args)) }, n) } function Di(t, e, n) { for (var i = -1, r = t.length; ++i < r;) var o = o ? d(Pn(o, t[i], e, n), Pn(t[i], o, e, n)) : t[i]; return o && o.length ? wi(o, e, n) : [] } function ki(t, e, n) { for (var i = -1, r = t.length, o = e.length, a = {}; ++i < r;) n(a, t[i], o > i ? e[i] : K); return a } function Ri(t, e) { if (e) return t.slice(); var n = new t.constructor(t.length); return t.copy(n), n } function Mi(t) { var e = new t.constructor(t.byteLength); return new il(e).set(new il(t)), e } function Pi(e) { return p(z(e), t, new e.constructor) } function Ni(t) { var e = new t.constructor(t.source, _e.exec(t)); return e.lastIndex = t.lastIndex, e } function Ii(t) { return p(U(t), e, new t.constructor) } function Li(t) { return Il ? Object(Il.call(t)) : {} } function Oi(t, e) { var n = e ? Mi(t.buffer) : t.buffer; return new t.constructor(n, t.byteOffset, t.length) } function Fi(t, e, n, i) { for (var r = -1, o = t.length, a = n.length, s = -1, u = e.length, l = _l(o - a, 0), c = Array(u + l), h = !i; ++s < u;) c[s] = e[s]; for (; ++r < a;) (h || o > r) && (c[n[r]] = t[r]); for (; l--;) c[s++] = t[r++]; return c } function Bi(t, e, n, i) { for (var r = -1, o = t.length, a = -1, s = n.length, u = -1, l = e.length, c = _l(o - s, 0), h = Array(c + l), d = !i; ++r < c;) h[r] = t[r]; for (var p = r; ++u < l;) h[p + u] = e[u]; for (; ++a < s;) (d || o > r) && (h[p + n[a]] = t[r++]); return h } function $i(t, e) { var n = -1, i = t.length; for (e || (e = Array(i)) ; ++n < i;) e[n] = t[n]; return e } function Hi(t, e, n) { return zi(t, e, n) } function zi(t, e, n, i) { n || (n = {}); for (var r = -1, o = e.length; ++r < o;) { var a = e[r], s = i ? i(n[a], t[a], a, n, t) : t[a]; un(n, a, s) } return n } function Vi(t, e) { return Hi(t, jl(t), e) } function Ui(t, e) { return function (n, r) { var o = Cc(n) ? i : cn, a = e ? e() : {}; return o(n, t, dr(r), a) } } function ji(t) { return da(function (e, n) { var i = -1, r = n.length, o = r > 1 ? n[r - 1] : K, a = r > 2 ? n[2] : K; for (o = "function" == typeof o ? (r--, o) : K, a && wr(n[0], n[1], a) && (o = 3 > r ? K : o, r = 1), e = Object(e) ; ++i < r;) { var s = n[i]; s && t(e, s, i, o) } return e }) } function Wi(t, e) { return function (n, i) { if (null == n) return n; if (!Ea(n)) return t(n, i); for (var r = n.length, o = e ? r : -1, a = Object(n) ; (e ? o-- : ++o < r) && i(a[o], o, a) !== !1;); return n } } function qi(t) { return function (e, n, i) { for (var r = -1, o = Object(e), a = i(e), s = a.length; s--;) { var u = a[t ? s : ++r]; if (n(o[u], u, o) === !1) break } return e } } function Gi(t, e, n) { function i() { var e = this && this !== Nn && this instanceof i ? o : t; return e.apply(r ? n : this, arguments) } var r = e & tt, o = Xi(t); return i } function Ki(t) { return function (e) { e = fs(e); var n = hn.test(e) ? W(e) : K, i = n ? n[0] : e.charAt(0), r = n ? n.slice(1).join("") : e.slice(1); return i[t]() + r } } function Yi(t) { return function (e) { return p(fu(Ks(e)), t, "") } } function Xi(t) { return function () { var e = arguments; switch (e.length) { case 0: return new t; case 1: return new t(e[0]); case 2: return new t(e[0], e[1]); case 3: return new t(e[0], e[1], e[2]); case 4: return new t(e[0], e[1], e[2], e[3]); case 5: return new t(e[0], e[1], e[2], e[3], e[4]); case 6: return new t(e[0], e[1], e[2], e[3], e[4], e[5]); case 7: return new t(e[0], e[1], e[2], e[3], e[4], e[5], e[6]) } var n = Rn(t.prototype), i = t.apply(n, e); return Ha(i) ? i : n } } function Qi(t, e, i) { function r() { for (var a = arguments.length, s = Array(a), u = a, l = mr(r) ; u--;) s[u] = arguments[u]; var c = 3 > a && s[0] !== l && s[a - 1] !== l ? [] : V(s, l); if (a -= c.length, i > a) return or(t, e, Zi, r.placeholder, K, s, c, K, K, i - a); var h = this && this !== Nn && this instanceof r ? o : t; return n(h, this, s) } var o = Xi(t); return r } function Ji(t) { return da(function (e) { e = Bn(e, 1); var n = e.length, i = n, r = ke.prototype.thru; for (t && e.reverse() ; i--;) { var o = e[i]; if ("function" != typeof o) throw new ju(Q); if (r && !a && "wrapper" == hr(o)) var a = new ke([], !0) } for (i = a ? i : n; ++i < n;) { o = e[i]; var s = hr(o), u = "wrapper" == s ? Vl(o) : K; a = u && Cr(u[0]) && u[1] == (st | it | ot | ut) && !u[4].length && 1 == u[9] ? a[hr(u[0])].apply(a, u[3]) : 1 == o.length && Cr(o) ? a[s]() : a.thru(o) } return function () { var t = arguments, i = t[0]; if (a && 1 == t.length && Cc(i) && i.length >= X) return a.plant(i).value(); for (var r = 0, o = n ? e[r].apply(this, t) : i; ++r < n;) o = e[r].call(this, o); return o } }) } function Zi(t, e, n, i, r, o, a, s, u, l) { function c() { for (var y = arguments.length, _ = y, v = Array(y) ; _--;) v[_] = arguments[_]; if (f) var b = mr(c), S = N(v, b); if (i && (v = Fi(v, i, r, f)), o && (v = Bi(v, o, a, f)), y -= S, f && l > y) { var x = V(v, b); return or(t, e, Zi, c.placeholder, n, v, x, s, u, l - y) } var w = d ? n : this, T = p ? w[t] : t; return y = v.length, s ? v = Pr(v, s) : m && y > 1 && v.reverse(), h && y > u && (v.length = u), this && this !== Nn && this instanceof c && (T = g || Xi(T)), T.apply(w, v) } var h = e & st, d = e & tt, p = e & et, f = e & (it | rt), m = e & lt, g = p ? K : Xi(t); return c } function tr(t, e) { return function (n, i) { return Kn(n, t, e(i), {}) } } function er(t) { return da(function (e) { return e = h(Bn(e, 1), dr()), da(function (i) { var r = this; return t(e, function (t) { return n(t, r, i) }) }) }) } function nr(t, e, n) { e = ls(e); var i = j(t); if (!e || i >= e) return ""; var r = e - i; n = n === K ? " " : n + ""; var o = nu(n, pl(r / j(n))); return hn.test(n) ? W(o).slice(0, r).join("") : o.slice(0, r) } function ir(t, e, i, r) { function o() { for (var e = -1, u = arguments.length, l = -1, c = r.length, h = Array(c + u), d = this && this !== Nn && this instanceof o ? s : t; ++l < c;) h[l] = r[l]; for (; u--;) h[l++] = arguments[++e]; return n(d, a ? i : this, h) } var a = e & tt, s = Xi(t); return o } function rr(t) { return function (e, n, i) { return i && "number" != typeof i && wr(e, n, i) && (n = i = K), e = hs(e), e = e === e ? e : 0, n === K ? (n = e, e = 0) : n = hs(n) || 0, i = i === K ? n > e ? 1 : -1 : hs(i) || 0, mi(e, n, i, t) } } function or(t, e, n, i, r, o, a, s, u, l) { var c = e & it, h = s ? $i(s) : K, d = c ? a : K, p = c ? K : a, f = c ? o : K, m = c ? K : o; e |= c ? ot : at, e &= ~(c ? at : ot), e & nt || (e &= ~(tt | et)); var g = [t, e, r, f, d, m, p, h, u, l], y = n.apply(K, g); return Cr(t) && Wl(y, g), y.placeholder = i, y } function ar(t) { var e = Vu[t]; return function (t, n) { if (t = hs(t), n = ls(n)) { var i = (fs(t) + "e").split("e"), r = e(i[0] + "e" + (+i[1] + n)); return i = (fs(r) + "e").split("e"), +(i[0] + "e" + (+i[1] - n)) } return e(t) } } function sr(t, e, n, i, r, o, a, s) { var u = e & et; if (!u && "function" != typeof t) throw new ju(Q); var l = i ? i.length : 0; if (l || (e &= ~(ot | at), i = r = K), a = a === K ? a : _l(ls(a), 0), s = s === K ? s : ls(s), l -= r ? r.length : 0, e & at) { var c = i, h = r; i = r = K } var d = u ? K : Vl(t), p = [t, e, n, i, r, c, h, o, a, s]; if (d && kr(p, d), t = p[0], e = p[1], n = p[2], i = p[3], r = p[4], s = p[9] = null == p[9] ? u ? 0 : t.length : _l(p[9] - l, 0), !s && e & (it | rt) && (e &= ~(it | rt)), e && e != tt) f = e == it || e == rt ? Qi(t, e, s) : e != ot && e != (tt | ot) || r.length ? Zi.apply(K, p) : ir(t, e, n, i); else var f = Gi(t, e, n); var m = d ? Hl : Wl; return m(f, p) } function ur(t, e, n, i, r, o) { var a = -1, s = r & ht, u = r & ct, l = t.length, c = e.length; if (l != c && !(s && c > l)) return !1; var h = o.get(t); if (h) return h == e; var d = !0; for (o.set(t, e) ; ++a < l;) { var p = t[a], f = e[a]; if (i) var g = s ? i(f, p, a, e, t, o) : i(p, f, a, t, e, o); if (g !== K) { if (g) continue; d = !1; break } if (u) { if (!m(e, function (t) { return p === t || n(p, t, i, r, o) })) { d = !1; break } } else if (p !== f && !n(p, f, i, r, o)) { d = !1; break } } return o["delete"](t), d } function lr(t, e, n, i, r, o, a) { switch (n) { case Vt: return t.byteLength == e.byteLength && i(new il(t), new il(e)) ? !0 : !1; case Dt: case kt: return +t == +e; case Rt: return t.name == e.name && t.message == e.message; case It: return t != +t ? e != +e : t == +e; case Ot: case Bt: return t == e + ""; case Nt: var s = z; case Ft: var u = o & ht; if (s || (s = U), t.size != e.size && !u) return !1; var l = a.get(t); return l ? l == e : ur(s(t), s(e), i, r, o | ct, a.set(t, e)); case $t: if (Il) return Il.call(t) == Il.call(e) } return !1 } function cr(t, e, n, i, r, o) { var a = r & ht, s = Es(t), u = s.length, l = Es(e), c = l.length; if (u != c && !a) return !1; for (var h = u; h--;) { var d = s[h]; if (!(a ? d in e : jn(e, d))) return !1 } var p = o.get(t); if (p) return p == e; var f = !0; o.set(t, e); for (var m = a; ++h < u;) { d = s[h]; var g = t[d], y = e[d]; if (i) var _ = a ? i(y, g, d, e, t, o) : i(g, y, d, t, e, o); if (!(_ === K ? g === y || n(g, y, i, r, o) : _)) { f = !1; break } m || (m = "constructor" == d) } if (f && !m) { var v = t.constructor, b = e.constructor; v != b && "constructor" in t && "constructor" in e && !("function" == typeof v && v instanceof v && "function" == typeof b && b instanceof b) && (f = !1) } return o["delete"](t), f } function hr(t) { for (var e = t.name + "", n = kl[e], i = Ku.call(kl, e) ? n.length : 0; i--;) { var r = n[i], o = r.func; if (null == o || o == t) return r.name } return e } function dr() { var t = Te.iteratee || vu; return t = t === vu ? Zn : t, arguments.length ? t(arguments[0], arguments[1]) : t } function pr(t) { for (var e = Os(t), n = e.length; n--;) e[n][2] = Dr(e[n][1]); return e } function fr(t, e) { var n = t[e]; return qa(n) ? n : K } function mr(t) { var e = Ku.call(Te, "placeholder") ? Te : t; return e.placeholder } function gr(t) { return Qu.call(t) } function yr(t, e, n) { for (var i = -1, r = n.length; ++i < r;) { var o = n[i], a = o.size; switch (o.type) { case "drop": t += a; break; case "dropRight": e -= a; break; case "take": e = vl(e, t + a); break; case "takeRight": t = _l(t, e - a) } } return { start: t, end: e } } function _r(t, e, n) { if (null == t) return !1; var i = n(t, e); i || Tr(e) || (e = wn(e), t = Mr(t, e), null != t && (e = Jr(e), i = n(t, e))); var r = t ? t.length : K; return i || !!r && $a(r) && $(e, r) && (Cc(t) || ts(t) || Aa(t)) } function vr(t) { var e = t.length, n = t.constructor(e); return e && "string" == typeof t[0] && Ku.call(t, "index") && (n.index = t.index, n.input = t.input), n } function br(t) { return "function" != typeof t.constructor || Er(t) ? {} : Rn(al(t)) } function Sr(t, e, n) { var i = t.constructor; switch (e) { case Vt: return Mi(t); case Dt: case kt: return new i(+t); case Ut: case jt: case Wt: case qt: case Gt: case Kt: case Yt: case Xt: case Qt: return Oi(t, n); case Nt: return Pi(t); case It: case Bt: return new i(t); case Ot: return Ni(t); case Ft: return Ii(t); case $t: return Li(t) } }
            function xr(t) { var e = t ? t.length : K; return $a(e) && (Cc(t) || ts(t) || Aa(t)) ? T(e, String) : null } function wr(t, e, n) { if (!Ha(n)) return !1; var i = typeof e; return ("number" == i ? Ea(n) && $(e, n.length) : "string" == i && e in n) ? xa(n[e], t) : !1 } function Tr(t, e) { return "number" == typeof t ? !0 : !Cc(t) && (le.test(t) || !ue.test(t) || null != e && t in Object(e)) } function Ar(t) { var e = typeof t; return "number" == e || "boolean" == e || "string" == e && "__proto__" != t || null == t } function Cr(t) { var e = hr(t), n = Te[e]; if ("function" != typeof n || !(e in Re.prototype)) return !1; if (t === n) return !0; var i = Vl(n); return !!i && t === i[0] }
            function Er(t) { var e = t && t.constructor, n = "function" == typeof e && e.prototype || qu; return t === n } function Dr(t) { return t === t && !Ha(t) } function kr(t, e) { var n = t[1], i = e[1], r = n | i, o = (tt | et | st) > r, a = i == st && n == it || i == st && n == ut && t[7].length <= e[8] || i == (st | ut) && e[7].length <= e[8] && n == it; if (!o && !a) return t; i & tt && (t[2] = e[2], r |= n & tt ? 0 : nt); var s = e[3]; if (s) { var u = t[3]; t[3] = u ? Fi(u, s, e[4]) : $i(s), t[4] = u ? V(t[3], Z) : $i(e[4]) } return s = e[5], s && (u = t[5], t[5] = u ? Bi(u, s, e[6]) : $i(s), t[6] = u ? V(t[5], Z) : $i(e[6])), s = e[7], s && (t[7] = $i(s)), i & st && (t[8] = null == t[8] ? e[8] : vl(t[8], e[8])), null == t[9] && (t[9] = e[9]), t[0] = e[0], t[1] = r, t } function Rr(t, e, n, i, r, o) { return Ha(t) && Ha(e) && oi(t, e, K, Rr, o.set(e, t)), t } function Mr(t, e) { return 1 == e.length ? t : Ts(t, yi(e, 0, -1)) } function Pr(t, e) { for (var n = t.length, i = vl(e.length, n), r = $i(t) ; i--;) { var o = e[i]; t[i] = $(o, n) ? r[o] : K } return t } function Nr(t) { var e = []; return fs(t).replace(ce, function (t, n, i, r) { e.push(i ? r.replace(ge, "$1") : n || t) }), e } function Ir(t) { if (t instanceof Re) return t.clone(); var e = new ke(t.__wrapped__, t.__chain__); return e.__actions__ = $i(t.__actions__), e.__index__ = t.__index__, e.__values__ = t.__values__, e } function Lr(t, e) { e = _l(ls(e), 0); var n = t ? t.length : 0; if (!n || 1 > e) return []; for (var i = 0, r = 0, o = Array(pl(n / e)) ; n > i;) o[r++] = yi(t, i, i += e); return o } function Or(t) { for (var e = -1, n = t ? t.length : 0, i = 0, r = []; ++e < n;) { var o = t[e]; o && (r[i++] = o) } return r } function Fr(t, e, n) { var i = t ? t.length : 0; return i ? (e = n || e === K ? 1 : ls(e), yi(t, 0 > e ? 0 : e, i)) : [] } function Br(t, e, n) { var i = t ? t.length : 0; return i ? (e = n || e === K ? 1 : ls(e), e = i - e, yi(t, 0, 0 > e ? 0 : e)) : [] } function $r(t, e) { return t && t.length ? Ci(t, dr(e, 3), !0, !0) : [] } function Hr(t, e) { return t && t.length ? Ci(t, dr(e, 3), !0) : [] } function zr(t, e, n, i) { var r = t ? t.length : 0; return r ? (n && "number" != typeof n && wr(t, e, n) && (n = 0, i = r), On(t, e, n, i)) : [] } function Vr(t, e) { return t && t.length ? _(t, dr(e, 3)) : -1 } function Ur(t, e) { return t && t.length ? _(t, dr(e, 3), !0) : -1 } function jr(t) { var e = t ? t.length : 0; return e ? Bn(t, 1) : [] } function Wr(t) { var e = t ? t.length : 0; return e ? Bn(t, vt) : [] } function qr(t, e) { var n = t ? t.length : 0; return n ? (e = e === K ? 1 : ls(e), Bn(t, e)) : [] } function Gr(t) { for (var e = -1, n = t ? t.length : 0, i = {}; ++e < n;) { var r = t[e]; i[r[0]] = r[1] } return i } function Kr(t) { return t ? t[0] : K } function Yr(t, e, n) { var i = t ? t.length : 0; return i ? (n = ls(n), 0 > n && (n = _l(i + n, 0)), v(t, e, n)) : -1 } function Xr(t) { return Br(t, 1) } function Qr(t, e) { return t ? gl.call(t, e) : "" } function Jr(t) { var e = t ? t.length : 0; return e ? t[e - 1] : K } function Zr(t, e, n) { var i = t ? t.length : 0; if (!i) return -1; var r = i; if (n !== K && (r = ls(n), r = (0 > r ? _l(i + r, 0) : vl(r, i - 1)) + 1), e !== e) return F(t, r, !0); for (; r--;) if (t[r] === e) return r; return -1 } function to(t, e) { return t && t.length && e && e.length ? di(t, e) : t } function eo(t, e, n) { return t && t.length && e && e.length ? di(t, e, dr(n)) : t } function no(t, e, n) { return t && t.length && e && e.length ? di(t, e, K, n) : t } function io(t, e) { var n = []; if (!t || !t.length) return n; var i = -1, r = [], o = t.length; for (e = dr(e, 3) ; ++i < o;) { var a = t[i]; e(a, i, t) && (n.push(a), r.push(i)) } return pi(t, r), n } function ro(t) { return t ? xl.call(t) : t } function oo(t, e, n) { var i = t ? t.length : 0; return i ? (n && "number" != typeof n && wr(t, e, n) ? (e = 0, n = i) : (e = null == e ? 0 : ls(e), n = n === K ? i : ls(n)), yi(t, e, n)) : [] } function ao(t, e) { return vi(t, e) } function so(t, e, n) { return bi(t, e, dr(n)) } function uo(t, e) { var n = t ? t.length : 0; if (n) { var i = vi(t, e); if (n > i && xa(t[i], e)) return i } return -1 } function lo(t, e) { return vi(t, e, !0) } function co(t, e, n) { return bi(t, e, dr(n), !0) } function ho(t, e) { var n = t ? t.length : 0; if (n) { var i = vi(t, e, !0) - 1; if (xa(t[i], e)) return i } return -1 } function po(t) { return t && t.length ? Si(t) : [] } function fo(t, e) { return t && t.length ? xi(t, dr(e)) : [] } function mo(t) { return Fr(t, 1) } function go(t, e, n) { return t && t.length ? (e = n || e === K ? 1 : ls(e), yi(t, 0, 0 > e ? 0 : e)) : [] } function yo(t, e, n) { var i = t ? t.length : 0; return i ? (e = n || e === K ? 1 : ls(e), e = i - e, yi(t, 0 > e ? 0 : e, i)) : [] } function _o(t, e) { return t && t.length ? Ci(t, dr(e, 3), !1, !0) : [] } function vo(t, e) { return t && t.length ? Ci(t, dr(e, 3)) : [] } function bo(t) { return t && t.length ? wi(t) : [] } function So(t, e) { return t && t.length ? wi(t, dr(e)) : [] } function xo(t, e) { return t && t.length ? wi(t, K, e) : [] } function wo(t) {
                if (!t || !t.length) return []; var e = 0; return t = u(t, function (t) {
                    return Da(t) ? (e = _l(t.length, e), !0) : void 0
                }), T(e, function (e) { return h(t, ci(e)) })
            } function To(t, e) { if (!t || !t.length) return []; var i = wo(t); return null == e ? i : h(i, function (t) { return n(e, K, t) }) } function Ao(t, e) { return ki(t || [], e || [], un) } function Co(t, e) { return ki(t || [], e || [], gi) } function Eo(t) { var e = Te(t); return e.__chain__ = !0, e } function Do(t, e) { return e(t), t } function ko(t, e) { return e(t) } function Ro() { return Eo(this) } function Mo() { return new ke(this.value(), this.__chain__) } function Po(t) { return this.map(t).flatten() } function No() { this.__values__ === K && (this.__values__ = us(this.value())); var t = this.__index__ >= this.__values__.length, e = t ? K : this.__values__[this.__index__++]; return { done: t, value: e } } function Io() { return this } function Lo(t) { for (var e, n = this; n instanceof De;) { var i = Ir(n); i.__index__ = 0, i.__values__ = K, e ? r.__wrapped__ = i : e = i; var r = i; n = n.__wrapped__ } return r.__wrapped__ = t, e } function Oo() { var t = this.__wrapped__; if (t instanceof Re) { var e = t; return this.__actions__.length && (e = new Re(this)), e = e.reverse(), e.__actions__.push({ func: ko, args: [ro], thisArg: K }), new ke(e, this.__chain__) } return this.thru(ro) } function Fo() { return Ei(this.__wrapped__, this.__actions__) } function Bo(t, e, n) { var i = Cc(t) ? s : Ln; return n && wr(t, e, n) && (e = K), i(t, dr(e, 3)) } function $o(t, e) { var n = Cc(t) ? u : Fn; return n(t, dr(e, 3)) } function Ho(t, e) { if (e = dr(e, 3), Cc(t)) { var n = _(t, e); return n > -1 ? t[n] : K } return y(t, e, Ol) } function zo(t, e) { if (e = dr(e, 3), Cc(t)) { var n = _(t, e, !0); return n > -1 ? t[n] : K } return y(t, e, Fl) } function Vo(t, e) { return Bn(qo(t, e), 1) } function Uo(t, e) { return "function" == typeof e && Cc(t) ? o(t, e) : Ol(t, xn(e)) } function jo(t, e) { return "function" == typeof e && Cc(t) ? a(t, e) : Fl(t, xn(e)) } function Wo(t, e, n, i) { t = Ea(t) ? t : Vs(t), n = n && !i ? ls(n) : 0; var r = t.length; return 0 > n && (n = _l(r + n, 0)), ts(t) ? r >= n && t.indexOf(e, n) > -1 : !!r && v(t, e, n) > -1 } function qo(t, e) { var n = Cc(t) ? h : ni; return n(t, dr(e, 3)) } function Go(t, e, n, i) { return null == t ? [] : (Cc(e) || (e = null == e ? [] : [e]), n = i ? K : n, Cc(n) || (n = null == n ? [] : [n]), si(t, e, n)) } function Ko(t, e, n) { var i = Cc(t) ? p : S, r = arguments.length < 3; return i(t, dr(e, 4), n, r, Ol) } function Yo(t, e, n) { var i = Cc(t) ? f : S, r = arguments.length < 3; return i(t, dr(e, 4), n, r, Fl) } function Xo(t, e) { var n = Cc(t) ? u : Fn; return e = dr(e, 3), n(t, function (t, n, i) { return !e(t, n, i) }) } function Qo(t) { var e = Ea(t) ? t : Vs(t), n = e.length; return n > 0 ? e[fi(0, n - 1)] : K } function Jo(t, e) { var n = -1, i = us(t), r = i.length, o = r - 1; for (e = Cn(ls(e), 0, r) ; ++n < e;) { var a = fi(n, o), s = i[a]; i[a] = i[n], i[n] = s } return i.length = e, i } function Zo(t) { return Jo(t, wt) }
            function ta(t) { if (null == t) return 0; if (Ea(t)) { var e = t.length; return e && ts(t) ? j(t) : e } return Es(t).length } function ea(t, e, n) { var i = Cc(t) ? m : _i; return n && wr(t, e, n) && (e = K), i(t, dr(e, 3)) } function na(t, e) { if ("function" != typeof e) throw new ju(Q); return t = ls(t), function () { return --t < 1 ? e.apply(this, arguments) : void 0 } } function ia(t, e, n) { return e = n ? K : e, e = t && null == e ? t.length : e, sr(t, st, K, K, K, K, e) } function ra(t, e) { var n; if ("function" != typeof e) throw new ju(Q); return t = ls(t), function () { return --t > 0 && (n = e.apply(this, arguments)), 1 >= t && (e = K), n } } function oa(t, e, n) { e = n ? K : e; var i = sr(t, it, K, K, K, K, K, e); return i.placeholder = oa.placeholder, i } function aa(t, e, n) { e = n ? K : e; var i = sr(t, rt, K, K, K, K, K, e); return i.placeholder = aa.placeholder, i } function sa(t, e, n) { function i() { f && rl(f), c && rl(c), g = 0, l = c = p = f = m = K } function r(e, n) { n && rl(n), c = f = m = K, e && (g = yc(), h = t.apply(p, l), f || c || (l = p = K)) } function o() { var t = e - (yc() - d); 0 >= t || t > e ? r(m, c) : f = hl(o, t) } function a() { return (f && m || c && v) && (h = t.apply(p, l)), i(), h } function s() { r(v, f) } function u() { if (l = arguments, d = yc(), p = this, m = v && (f || !y), _ === !1) var n = y && !f; else { g || c || y || (g = d); var i = _ - (d - g), r = (0 >= i || i > _) && (y || c); r ? (c && (c = rl(c)), g = d, h = t.apply(p, l)) : c || (c = hl(s, i)) } return r && f ? f = rl(f) : f || e === _ || (f = hl(o, e)), n && (r = !0, h = t.apply(p, l)), !r || f || c || (l = p = K), h } var l, c, h, d, p, f, m, g = 0, y = !1, _ = !1, v = !0; if ("function" != typeof t) throw new ju(Q); return e = hs(e) || 0, Ha(n) && (y = !!n.leading, _ = "maxWait" in n && _l(hs(n.maxWait) || 0, e), v = "trailing" in n ? !!n.trailing : v), u.cancel = i, u.flush = a, u } function ua(t) { return sr(t, lt) } function la(t, e) { if ("function" != typeof t || e && "function" != typeof e) throw new ju(Q); var n = function () { var i = arguments, r = e ? e.apply(this, i) : i[0], o = n.cache; if (o.has(r)) return o.get(r); var a = t.apply(this, i); return n.cache = o.set(r, a), a }; return n.cache = new la.Cache, n } function ca(t) { if ("function" != typeof t) throw new ju(Q); return function () { return !t.apply(this, arguments) } } function ha(t) { return ra(2, t) }
            function da(t, e) {
                if ("function" != typeof t) throw new ju(Q); return e = _l(e === K ? t.length - 1 : ls(e), 0),
                    function () {
                        for (var i = arguments, r = -1, o = _l(i.length - e, 0), a = Array(o) ; ++r < o;) a[r] = i[e + r]; switch (e)
                        { case 0: return t.call(this, a); case 1: return t.call(this, i[0], a); case 2: return t.call(this, i[0], i[1], a) }
                        var s = Array(e + 1); for (r = -1; ++r < e;) s[r] = i[r]; return s[e] = a, n(t, this, s)
                    }
            }
            function pa(t, e) { if ("function" != typeof t) throw new ju(Q); return e = e === K ? 0 : _l(ls(e), 0), da(function (i) { var r = i[e], o = i.slice(0, e); return r && d(o, r), n(t, this, o) }) } function fa(t, e, n) { var i = !0, r = !0; if ("function" != typeof t) throw new ju(Q); return Ha(n) && (i = "leading" in n ? !!n.leading : i, r = "trailing" in n ? !!n.trailing : r), sa(t, e, { leading: i, maxWait: e, trailing: r }) } function ma(t) { return ia(t, 1) } function ga(t, e) { return e = null == e ? _u : e, wc(e, t) } function ya() { if (!arguments.length) return []; var t = arguments[0]; return Cc(t) ? t : [t] } function _a(t) { return En(t, !1, !0) } function va(t, e) { return En(t, !1, !0, e) } function ba(t) { return En(t, !0, !0) } function Sa(t, e) { return En(t, !0, !0, e) } function xa(t, e) { return t === e || t !== t && e !== e } function wa(t, e) { return t > e } function Ta(t, e) { return t >= e }
            function Aa(t) { return Da(t) && Ku.call(t, "callee") && (!cl.call(t, "callee") || Qu.call(t) == Ct) } function Ca(t) { return za(t) && Qu.call(t) == Vt }
            function Ea(t) { return null != t && $a(Ul(t)) && !Fa(t) }
            function Da(t) { return za(t) && Ea(t) } function ka(t) { return t === !0 || t === !1 || za(t) && Qu.call(t) == Dt } function Ra(t) { return za(t) && Qu.call(t) == kt } function Ma(t) { return !!t && 1 === t.nodeType && za(t) && !Xa(t) } function Pa(t) { if (Ea(t) && (Cc(t) || ts(t) || Fa(t.splice) || Aa(t))) return !t.length; for (var e in t) if (Ku.call(t, e)) return !1; return !0 } function Na(t, e) { return Xn(t, e) } function Ia(t, e, n) { n = "function" == typeof n ? n : K; var i = n ? n(t, e) : K; return i === K ? Xn(t, e, n) : !!i } function La(t) { return za(t) ? Qu.call(t) == Rt || "string" == typeof t.message && "string" == typeof t.name : !1 } function Oa(t) { return "number" == typeof t && ml(t) }
            function Fa(t) { var e = Ha(t) ? Qu.call(t) : ""; return e == Mt || e == Pt } function Ba(t) { return "number" == typeof t && t == ls(t) }
            function $a(t) { return "number" == typeof t && t > -1 && t % 1 == 0 && bt >= t }
            function Ha(t) { var e = typeof t; return !!t && ("object" == e || "function" == e) } function za(t) { return !!t && "object" == typeof t } function Va(t) { return za(t) && gr(t) == Nt } function Ua(t, e) { return t === e || Jn(t, e, pr(e)) } function ja(t, e, n) { return n = "function" == typeof n ? n : K, Jn(t, e, pr(e), n) } function Wa(t) { return Ya(t) && t != +t } function qa(t) { return null == t ? !1 : Fa(t) ? Zu.test(Gu.call(t)) : za(t) && (B(t) ? Zu : xe).test(t) } function Ga(t) { return null === t } function Ka(t) { return null == t } function Ya(t) { return "number" == typeof t || za(t) && Qu.call(t) == It } function Xa(t) { if (!za(t) || Qu.call(t) != Lt || B(t)) return !1; var e = al(t); if (null === e) return !0; var n = e.constructor; return "function" == typeof n && n instanceof n && Gu.call(n) == Xu } function Qa(t) { return Ha(t) && Qu.call(t) == Ot } function Ja(t) { return Ba(t) && t >= -bt && bt >= t } function Za(t) { return za(t) && gr(t) == Ft }
            function ts(t) { return "string" == typeof t || !Cc(t) && za(t) && Qu.call(t) == Bt } function es(t) { return "symbol" == typeof t || za(t) && Qu.call(t) == $t } function ns(t) { return za(t) && $a(t.length) && !!yn[Qu.call(t)] } function is(t) { return t === K } function rs(t) { return za(t) && gr(t) == Ht } function os(t) { return za(t) && Qu.call(t) == zt } function as(t, e) { return e > t } function ss(t, e) { return e >= t } function us(t) { if (!t) return []; if (Ea(t)) return ts(t) ? W(t) : $i(t); if (ul && t[ul]) return H(t[ul]()); var e = gr(t), n = e == Nt ? z : e == Ft ? U : Vs; return n(t) } function ls(t) { if (!t) return 0 === t ? t : 0; if (t = hs(t), t === vt || t === -vt) { var e = 0 > t ? -1 : 1; return e * St } var n = t % 1; return t === t ? n ? t - n : t : 0 } function cs(t) { return t ? Cn(ls(t), 0, wt) : 0 } function hs(t) { if (Ha(t)) { var e = Fa(t.valueOf) ? t.valueOf() : t; t = Ha(e) ? e + "" : e } if ("string" != typeof t) return 0 === t ? t : +t; t = t.replace(pe, ""); var n = Se.test(t); return n || we.test(t) ? An(t.slice(2), n ? 2 : 8) : be.test(t) ? xt : +t } function ds(t) { return Hi(t, Ds(t)) } function ps(t) { return Cn(ls(t), -bt, bt) } function fs(t) { if ("string" == typeof t) return t; if (null == t) return ""; if (es(t)) return Ll ? Ll.call(t) : ""; var e = t + ""; return "0" == e && 1 / t == -vt ? "-0" : e } function ms(t, e) { var n = Rn(t); return e ? vn(n, e) : n } function gs(t, e) { return y(t, dr(e, 3), Hn, !0) } function ys(t, e) { return y(t, dr(e, 3), zn, !0) } function _s(t, e) { return null == t ? t : Bl(t, xn(e), Ds) } function vs(t, e) { return null == t ? t : $l(t, xn(e), Ds) } function bs(t, e) { return t && Hn(t, xn(e)) } function Ss(t, e) { return t && zn(t, xn(e)) } function xs(t) { return null == t ? [] : Vn(t, Es(t)) } function ws(t) { return null == t ? [] : Vn(t, Ds(t)) } function Ts(t, e, n) { var i = null == t ? K : Un(t, e); return i === K ? n : i } function As(t, e) { return _r(t, e, jn) } function Cs(t, e) { return _r(t, e, Wn) }
            function Es(t) {
                var e = Er(t); if (!e && !Ea(t))
                    return ti(t); var n = xr(t), i = !!n, r = n || [], o = r.length; for (var a in t) !jn(t, a) || i && ("length" == a || $(a, o)) || e && "constructor" == a || r.push(a); return r
            }
            function Ds(t) {
                for (var e = -1, n = Er(t), i = ei(t), r = i.length, o = xr(t), a = !!o, s = o || [], u = s.length; ++e < r;) { var l = i[e]; a && ("length" == l || $(l, u)) || "constructor" == l && (n || !Ku.call(t, l)) || s.push(l) } return s
            }
            function ks(t, e) {
                var n = {}; return e = dr(e, 3), Hn(t, function (t, i, r) { n[e(t, i, r)] = t }), n
            }
            function Rs(t, e) { var n = {}; return e = dr(e, 3), Hn(t, function (t, i, r) { n[i] = e(t, i, r) }), n }
            function Ms(t, e) { return e = dr(e), li(t, function (t, n) { return !e(t, n) }) }
            function Ps(t, e) { return null == t ? {} : li(t, dr(e)) }
            function Ns(t, e, n) {
                if (Tr(e, t)) i = null == t ? K : t[e]; else { e = wn(e); var i = Ts(t, e); t = Mr(t, e) } return i === K && (i = n), Fa(i) ? i.call(t) : i
            }
            function Is(t, e, n) { return null == t ? t : gi(t, e, n) }
            function Ls(t, e, n, i) { return i = "function" == typeof i ? i : K, null == t ? t : gi(t, e, n, i) }
            function Os(t) { return A(t, Es(t)) }
            function Fs(t) { return A(t, Ds(t)) }
            function Bs(t, e, n) {
                var i = Cc(t) || ns(t);
                if (e = dr(e, 4), null == n) if (i || Ha(t)) { var r = t.constructor; n = i ? Cc(t) ? new r : [] : Fa(r) ? Rn(al(t)) : {} } else n = {}; return (i ? o : Hn)(t, function (t, i, r) { return e(n, t, i, r) }), n
            }
            function $s(t, e) { return null == t ? !0 : Ti(t, e) }
            function Hs(t, e, n) { return null == t ? t : Ai(t, e, xn(n)) }
            function zs(t, e, n, i) { return i = "function" == typeof i ? i : K, null == t ? t : Ai(t, e, xn(n), i) }
            function Vs(t) { return t ? E(t, Es(t)) : [] } function Us(t) { return null == t ? [] : E(t, Ds(t)) } function js(t, e, n) { return n === K && (n = e, e = K), n !== K && (n = hs(n), n = n === n ? n : 0), e !== K && (e = hs(e), e = e === e ? e : 0), Cn(hs(t), e, n) } function Ws(t, e, n) { return e = hs(e) || 0, n === K ? (n = e, e = 0) : n = hs(n) || 0, t = hs(t), qn(t, e, n) } function qs(t, e, n) { if (n && "boolean" != typeof n && wr(t, e, n) && (e = n = K), n === K && ("boolean" == typeof e ? (n = e, e = K) : "boolean" == typeof t && (n = t, t = K)), t === K && e === K ? (t = 0, e = 1) : (t = hs(t) || 0, e === K ? (e = t, t = 0) : e = hs(e) || 0), t > e) { var i = t; t = e, e = i } if (n || t % 1 || e % 1) { var r = Sl(); return vl(t + r * (e - t + Tn("1e-" + ((r + "").length - 1))), e) } return fi(t, e) } function Gs(t) { return qc(fs(t).toLowerCase()) } function Ks(t) { return t = fs(t), t && t.replace(Ae, I).replace(ln, "") } function Ys(t, e, n) { t = fs(t), e = "string" == typeof e ? e : e + ""; var i = t.length; return n = n === K ? i : Cn(ls(n), 0, i), n -= e.length, n >= 0 && t.indexOf(e, n) == n } function Xs(t) { return t = fs(t), t && re.test(t) ? t.replace(ne, L) : t } function Qs(t) { return t = fs(t), t && de.test(t) ? t.replace(he, "\\$&") : t } function Js(t, e, n) { t = fs(t), e = ls(e); var i = j(t); if (!e || i >= e) return t; var r = (e - i) / 2, o = fl(r), a = pl(r); return nr("", o, n) + t + nr("", a, n) } function Zs(t, e, n) { return t = fs(t), t + nr(t, e, n) } function tu(t, e, n) { return t = fs(t), nr(t, e, n) + t } function eu(t, e, n) { return n || null == e ? e = 0 : e && (e = +e), t = fs(t).replace(pe, ""), bl(t, e || (ve.test(t) ? 16 : 10)) } function nu(t, e) { t = fs(t), e = ls(e); var n = ""; if (!t || 1 > e || e > bt) return n; do e % 2 && (n += t), e = fl(e / 2), t += t; while (e); return n } function iu() { var t = arguments, e = fs(t[0]); return t.length < 3 ? e : e.replace(t[1], t[2]) } function ru(t, e, n) { return fs(t).split(e, n) } function ou(t, e, n) { return t = fs(t), n = Cn(ls(n), 0, t.length), t.lastIndexOf(e, n) == n } function au(t, e, n) { var i = Te.templateSettings; n && wr(t, e, n) && (e = K), t = fs(t), e = Rc({}, e, i, an); var r, o, a = Rc({}, e.imports, i.imports, an), s = Es(a), u = E(a, s), l = 0, c = e.interpolate || Ce, h = "__p += '", d = Uu((e.escape || Ce).source + "|" + c.source + "|" + (c === se ? ye : Ce).source + "|" + (e.evaluate || Ce).source + "|$", "g"), p = "//# sourceURL=" + ("sourceURL" in e ? e.sourceURL : "lodash.templateSources[" + ++gn + "]") + "\n"; t.replace(d, function (e, n, i, a, s, u) { return i || (i = a), h += t.slice(l, u).replace(Ee, O), n && (r = !0, h += "' +\n__e(" + n + ") +\n'"), s && (o = !0, h += "';\n" + s + ";\n__p += '"), i && (h += "' +\n((__t = (" + i + ")) == null ? '' : __t) +\n'"), l = u + e.length, e }), h += "';\n"; var f = e.variable; f || (h = "with (obj) {\n" + h + "\n}\n"), h = (o ? h.replace(Jt, "") : h).replace(Zt, "$1").replace(te, "$1;"), h = "function(" + (f || "obj") + ") {\n" + (f ? "" : "obj || (obj = {});\n") + "var __t, __p = ''" + (r ? ", __e = _.escape" : "") + (o ? ", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n" : ";\n") + h + "return __p\n}"; var m = Xc(function () { return Function(s, p + "return " + h).apply(K, u) }); if (m.source = h, La(m)) throw m; return m } function su(t) { return fs(t).toLowerCase() } function uu(t) { return fs(t).toUpperCase() } function lu(t, e, n) { if (t = fs(t), !t) return t; if (n || e === K) return t.replace(pe, ""); if (e += "", !e) return t; var i = W(t), r = W(e); return i.slice(D(i, r), k(i, r) + 1).join("") } function cu(t, e, n) { if (t = fs(t), !t) return t; if (n || e === K) return t.replace(me, ""); if (e += "", !e) return t; var i = W(t); return i.slice(0, k(i, W(e)) + 1).join("") } function hu(t, e, n) { if (t = fs(t), !t) return t; if (n || e === K) return t.replace(fe, ""); if (e += "", !e) return t; var i = W(t); return i.slice(D(i, W(e))).join("") } function du(t, e) { var n = dt, i = pt; if (Ha(e)) { var r = "separator" in e ? e.separator : r; n = "length" in e ? ls(e.length) : n, i = "omission" in e ? fs(e.omission) : i } t = fs(t); var o = t.length; if (hn.test(t)) { var a = W(t); o = a.length } if (n >= o) return t; var s = n - j(i); if (1 > s) return i; var u = a ? a.slice(0, s).join("") : t.slice(0, s); if (r === K) return u + i; if (a && (s += u.length - s), Qa(r)) { if (t.slice(s).search(r)) { var l, c = u; for (r.global || (r = Uu(r.source, fs(_e.exec(r)) + "g")), r.lastIndex = 0; l = r.exec(c) ;) var h = l.index; u = u.slice(0, h === K ? s : h) } } else if (t.indexOf(r, s) != s) { var d = u.lastIndexOf(r); d > -1 && (u = u.slice(0, d)) } return u + i } function pu(t) { return t = fs(t), t && ie.test(t) ? t.replace(ee, q) : t } function fu(t, e, n) { return t = fs(t), e = n ? K : e, e === K && (e = fn.test(t) ? pn : dn), t.match(e) || [] } function mu(t) { var e = t ? t.length : 0, i = dr(); return t = e ? h(t, function (t) { if ("function" != typeof t[1]) throw new ju(Q); return [i(t[0]), t[1]] }) : [], da(function (i) { for (var r = -1; ++r < e;) { var o = t[r]; if (n(o[0], this, i)) return n(o[1], this, i) } }) } function gu(t) { return kn(En(t, !0)) } function yu(t) { return function () { return t } } function _u(t) { return t } function vu(t) { return Zn("function" == typeof t ? t : En(t, !0)) } function bu(t) { return ii(En(t, !0)) } function Su(t, e) { return ri(t, En(e, !0)) } function xu(t, e, n) { var i = Es(e), r = Vn(e, i); null != n || Ha(e) && (r.length || !i.length) || (n = e, e = t, t = this, r = Vn(e, Es(e))); var a = Ha(n) && "chain" in n ? n.chain : !0, s = Fa(t); return o(r, function (n) { var i = e[n]; t[n] = i, s && (t.prototype[n] = function () { var e = this.__chain__; if (a || e) { var n = t(this.__wrapped__), r = n.__actions__ = $i(this.__actions__); return r.push({ func: i, args: arguments, thisArg: t }), n.__chain__ = e, n } return i.apply(t, d([this.value()], arguments)) }) }), t } function wu() { return Nn._ === this && (Nn._ = Ju), this } function Tu() { } function Au(t) { return t = ls(t), function () { return arguments[t] } } function Cu(t) { return Tr(t) ? ci(t) : hi(t) } function Eu(t) { return function (e) { return null == t ? K : Un(t, e) } } function Du(t, e) { if (t = ls(t), 1 > t || t > bt) return []; var n = wt, i = vl(t, wt); e = xn(e), t -= wt; for (var r = T(i, e) ; ++n < t;) e(n); return r } function ku(t) { return Cc(t) ? h(t, String) : Nr(t) } function Ru(t) { var e = ++Yu; return fs(t) + e } function Mu(t, e) { var n; return t === K && e === K ? 0 : (t !== K && (n = t), e !== K && (n = n === K ? e : n + e), n) } function Pu(t) { return t && t.length ? g(t, _u, wa) : K } function Nu(t, e) { return t && t.length ? g(t, dr(e), wa) : K } function Iu(t) { return Bu(t) / (t ? t.length : 0) } function Lu(t) { return t && t.length ? g(t, _u, as) : K } function Ou(t, e) { return t && t.length ? g(t, dr(e), as) : K } function Fu(t, e) { var n; return t === K && e === K ? 0 : (t !== K && (n = t), e !== K && (n = n === K ? e : n - e), n) } function Bu(t) { return t && t.length ? w(t, _u) : 0 } function $u(t, e) { return t && t.length ? w(t, dr(e)) : 0 } R = R ? In.defaults({}, R, In.pick(Nn, mn)) : Nn; var Hu = R.Date, zu = R.Error, Vu = R.Math, Uu = R.RegExp, ju = R.TypeError, Wu = R.Array.prototype,
                qu = R.Object.prototype, Gu = R.Function.prototype.toString, Ku = qu.hasOwnProperty, Yu = 0, Xu = Gu.call(Object),
                Qu = qu.toString, Ju = Nn._, Zu = Uu("^" + Gu.call(Ku).replace(he, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"), tl = Dn ? R.Buffer : K, el = R.Reflect, nl = R.Symbol, il = R.Uint8Array, rl = R.clearTimeout, ol = el ? el.enumerate : K,
                al = Object.getPrototypeOf, sl = Object.getOwnPropertySymbols, ul = "symbol" == typeof (ul = nl && nl.iterator) ? ul : K, ll = Object.create,
                cl = qu.propertyIsEnumerable, hl = R.setTimeout, dl = Wu.splice, pl = Vu.ceil, fl = Vu.floor, ml = R.isFinite, gl = Wu.join,
                yl = Object.keys, _l = Vu.max, vl = Vu.min, bl = R.parseInt, Sl = Vu.random, xl = Wu.reverse, wl = fr(R, "Map"), Tl = fr(R, "Set"), Al = fr(R, "WeakMap"), Cl = fr(Object, "create"), El = Al && new Al, Dl = !cl.call({ valueOf: 1 }, "valueOf"), kl = {}, Rl = wl ? Gu.call(wl) : "", Ml = Tl ? Gu.call(Tl) : "", Pl = Al ? Gu.call(Al) : "", Nl = nl ? nl.prototype : K, Il = Nl ? Nl.valueOf : K, Ll = Nl ? Nl.toString : K;
            Te.templateSettings = {
                escape: oe,
                evaluate: ae,
                interpolate: se,
                variable: "", imports: { _: Te }
            }; var Ol = Wi(Hn), Fl = Wi(zn, !0), Bl = qi(), $l = qi(!0); ol && !cl.call({ valueOf: 1 }, "valueOf") && (ei = function (t) { return H(ol(t)) }); var Hl = El ? function (t, e) { return El.set(t, e), t } : _u, zl = Tl && 2 === new Tl([1, 2]).size ? function (t) { return new Tl(t) } : Tu, Vl = El ? function (t) { return El.get(t) } : Tu,
                Ul = ci("length"), jl = sl || function () { return [] }; (wl && gr(new wl) != Nt || Tl && gr(new Tl) != Ft || Al && gr(new Al) != Ht) && (gr = function (t) { var e = Qu.call(t), n = e == Lt ? t.constructor : null, i = "function" == typeof n ? Gu.call(n) : ""; if (i) switch (i) { case Rl: return Nt; case Ml: return Ft; case Pl: return Ht } return e }); var Wl = function () { var t = 0, e = 0; return function (n, i) { var r = yc(), o = mt - (r - e); if (e = r, o > 0) { if (++t >= ft) return n } else t = 0; return Hl(n, i) } }(), ql = da(function (t, e) { return Cc(t) || (t = null == t ? [] : [Object(t)]), e = Bn(e, 1), r(t, e) }), Gl = da(function (t, e) { return Da(t) ? Pn(t, Bn(e, 1, !0)) : [] }), Kl = da(function (t, e) { var n = Jr(e); return Da(n) && (n = K), Da(t) ? Pn(t, Bn(e, 1, !0), dr(n)) : [] }), Yl = da(function (t, e) { var n = Jr(e); return Da(n) && (n = K), Da(t) ? Pn(t, Bn(e, 1, !0), K, n) : [] }), Xl = da(function (t) { var e = h(t, Sn); return e.length && e[0] === t[0] ? Gn(e) : [] }), Ql = da(function (t) { var e = Jr(t), n = h(t, Sn); return e === Jr(n) ? e = K : n.pop(), n.length && n[0] === t[0] ? Gn(n, dr(e)) : [] }), Jl = da(function (t) { var e = Jr(t), n = h(t, Sn); return e === Jr(n) ? e = K : n.pop(), n.length && n[0] === t[0] ? Gn(n, K, e) : [] }), Zl = da(to), tc = da(function (t, e) { e = h(Bn(e, 1), String); var n = bn(t, e); return pi(t, e.sort(M)), n }), ec = da(function (t) { return wi(Bn(t, 1, !0)) }), nc = da(function (t) { var e = Jr(t); return Da(e) && (e = K), wi(Bn(t, 1, !0), dr(e)) }), ic = da(function (t) { var e = Jr(t); return Da(e) && (e = K), wi(Bn(t, 1, !0), K, e) }), rc = da(function (t, e) { return Da(t) ? Pn(t, e) : [] }), oc = da(function (t) { return Di(u(t, Da)) }), ac = da(function (t) { var e = Jr(t); return Da(e) && (e = K), Di(u(t, Da), dr(e)) }), sc = da(function (t) { var e = Jr(t); return Da(e) && (e = K), Di(u(t, Da), K, e) }), uc = da(wo), lc = da(function (t) { var e = t.length, n = e > 1 ? t[e - 1] : K; return n = "function" == typeof n ? (t.pop(), n) : K, To(t, n) }), cc = da(function (t) { t = Bn(t, 1); var e = t.length, n = e ? t[0] : 0, i = this.__wrapped__, r = function (e) { return bn(e, t) }; return !(e > 1 || this.__actions__.length) && i instanceof Re && $(n) ? (i = i.slice(n, +n + (e ? 1 : 0)), i.__actions__.push({ func: ko, args: [r], thisArg: K }), new ke(i, this.__chain__).thru(function (t) { return e && !t.length && t.push(K), t })) : this.thru(r) }), hc = Ui(function (t, e, n) { Ku.call(t, n) ? ++t[n] : t[n] = 1 }), dc = Ui(function (t, e, n) { Ku.call(t, n) ? t[n].push(e) : t[n] = [e] }), pc = da(function (t, e, i) { var r = -1, o = "function" == typeof e, a = Tr(e), s = Ea(t) ? Array(t.length) : []; return Ol(t, function (t) { var u = o ? e : a && null != t ? t[e] : K; s[++r] = u ? n(u, t, i) : Yn(t, e, i) }), s }), fc = Ui(function (t, e, n) { t[n] = e }), mc = Ui(function (t, e, n) { t[n ? 0 : 1].push(e) }, function () { return [[], []] }), gc = da(function (t, e) { if (null == t) return []; var n = e.length; return n > 1 && wr(t, e[0], e[1]) ? e = [] : n > 2 && wr(e[0], e[1], e[2]) && (e.length = 1), si(t, Bn(e, 1), []) }), yc = Hu.now, _c = da(function (t, e, n) { var i = tt; if (n.length) { var r = V(n, mr(_c)); i |= ot } return sr(t, i, e, n, r) }), vc = da(function (t, e, n) { var i = tt | et; if (n.length) { var r = V(n, mr(vc)); i |= ot } return sr(e, i, t, n, r) }), bc = da(function (t, e) { return Mn(t, 1, e) }), Sc = da(function (t, e, n) { return Mn(t, hs(e) || 0, n) }), xc = da(function (t, e) { e = h(Bn(e, 1), dr()); var i = e.length; return da(function (r) { for (var o = -1, a = vl(r.length, i) ; ++o < a;) r[o] = e[o].call(this, r[o]); return n(t, this, r) }) }), wc = da(function (t, e) { var n = V(e, mr(wc)); return sr(t, ot, K, e, n) }), Tc = da(function (t, e) { var n = V(e, mr(Tc)); return sr(t, at, K, e, n) }), Ac = da(function (t, e) { return sr(t, ut, K, K, K, Bn(e, 1)) }),
                    Cc = Array.isArray, Ec = tl ? function (t) { return t instanceof tl } : yu(!1), Dc = ji(function (t, e) { if (Dl || Er(e) || Ea(e)) return void Hi(e, Es(e), t); for (var n in e) Ku.call(e, n) && un(t, n, e[n]) }), kc = ji(function (t, e) { if (Dl || Er(e) || Ea(e)) return void Hi(e, Ds(e), t); for (var n in e) un(t, n, e[n]) }), Rc = ji(function (t, e, n, i) { zi(e, Ds(e), t, i) }), Mc = ji(function (t, e, n, i) { zi(e, Es(e), t, i) }), Pc = da(function (t, e) { return bn(t, Bn(e, 1)) }), Nc = da(function (t) { return t.push(K, an), n(Rc, K, t) }), Ic = da(function (t) { return t.push(K, Rr), n($c, K, t) }), Lc = tr(function (t, e, n) { t[e] = n }, yu(_u)), Oc = tr(function (t, e, n) { Ku.call(t, e) ? t[e].push(n) : t[e] = [n] }, dr), Fc = da(Yn), Bc = ji(function (t, e, n) { oi(t, e, n) }), $c = ji(function (t, e, n, i) { oi(t, e, n, i) }), Hc = da(function (t, e) { return null == t ? {} : (e = h(Bn(e, 1), String), ui(t, Pn(Ds(t), e))) }), zc = da(function (t, e) { return null == t ? {} : ui(t, Bn(e, 1)) }), Vc = Yi(function (t, e, n) { return e = e.toLowerCase(), t + (n ? Gs(e) : e) }), Uc = Yi(function (t, e, n) { return t + (n ? "-" : "") + e.toLowerCase() }), jc = Yi(function (t, e, n) { return t + (n ? " " : "") + e.toLowerCase() }), Wc = Ki("toLowerCase"), qc = Ki("toUpperCase"), Gc = Yi(function (t, e, n) { return t + (n ? "_" : "") + e.toLowerCase() }), Kc = Yi(function (t, e, n) { return t + (n ? " " : "") + Gs(e) }), Yc = Yi(function (t, e, n) { return t + (n ? " " : "") + e.toUpperCase() }), Xc = da(function (t, e) { try { return n(t, K, e) } catch (i) { return La(i) ? i : new zu(i) } }), Qc = da(function (t, e) { return o(Bn(e, 1), function (e) { t[e] = _c(t[e], t) }), t }), Jc = Ji(), Zc = Ji(!0), th = da(function (t, e) { return function (n) { return Yn(n, t, e) } }), eh = da(function (t, e) { return function (n) { return Yn(t, n, e) } }), nh = er(h), ih = er(s), rh = er(m), oh = rr(), ah = rr(!0), sh = ar("ceil"), uh = ar("floor"), lh = ar("round"); return Te.prototype = De.prototype, Te.prototype.constructor = Te, ke.prototype = Rn(De.prototype), ke.prototype.constructor = ke, Re.prototype = Rn(De.prototype), Re.prototype.constructor = Re, Ie.prototype = Cl ? Cl(null) : qu, $e.prototype.clear = He, $e.prototype["delete"] = ze, $e.prototype.get = Ve, $e.prototype.has = Ue, $e.prototype.set = je, We.prototype.push = Ge, Ke.prototype.clear = Ye, Ke.prototype["delete"] = Xe, Ke.prototype.get = Qe, Ke.prototype.has = Je, Ke.prototype.set = Ze, la.Cache = $e,
                        Te.equal = equal, Te.prepareTransition = prepareTransition,
                        Te.after = na, Te.ary = ia, Te.assign = Dc, Te.assignIn = kc, Te.assignInWith = Rc, Te.assignWith = Mc, Te.at = Pc, Te.before = ra, Te.bind = _c, Te.bindAll = Qc, Te.bindKey = vc, Te.castArray = ya, Te.chain = Eo, Te.chunk = Lr, Te.compact = Or, Te.concat = ql, Te.cond = mu, Te.conforms = gu, Te.constant = yu, Te.countBy = hc, Te.create = ms, Te.curry = oa, Te.curryRight = aa, Te.debounce = sa, Te.defaults = Nc, Te.defaultsDeep = Ic, Te.defer = bc, Te.delay = Sc, Te.difference = Gl, Te.differenceBy = Kl, Te.differenceWith = Yl, Te.drop = Fr, Te.dropRight = Br, Te.dropRightWhile = $r, Te.dropWhile = Hr, Te.fill = zr, Te.filter = $o, Te.flatMap = Vo, Te.flatten = jr, Te.flattenDeep = Wr, Te.flattenDepth = qr, Te.flip = ua, Te.flow = Jc, Te.flowRight = Zc, Te.fromPairs = Gr, Te.functions = xs, Te.functionsIn = ws, Te.groupBy = dc, Te.initial = Xr, Te.intersection = Xl, Te.intersectionBy = Ql, Te.intersectionWith = Jl, Te.invert = Lc, Te.invertBy = Oc, Te.invokeMap = pc, Te.iteratee = vu, Te.keyBy = fc, Te.keys = Es, Te.keysIn = Ds, Te.map = qo, Te.mapKeys = ks, Te.mapValues = Rs, Te.matches = bu, Te.matchesProperty = Su, Te.memoize = la, Te.merge = Bc, Te.mergeWith = $c, Te.method = th, Te.methodOf = eh, Te.mixin = xu, Te.negate = ca, Te.nthArg = Au, Te.omit = Hc, Te.omitBy = Ms, Te.once = ha, Te.orderBy = Go, Te.over = nh, Te.overArgs = xc, Te.overEvery = ih, Te.overSome = rh, Te.partial = wc, Te.partialRight = Tc, Te.partition = mc, Te.pick = zc, Te.pickBy = Ps, Te.property = Cu, Te.propertyOf = Eu, Te.pull = Zl, Te.pullAll = to, Te.pullAllBy = eo, Te.pullAllWith = no, Te.pullAt = tc, Te.range = oh, Te.rangeRight = ah, Te.rearg = Ac, Te.reject = Xo, Te.remove = io, Te.rest = da, Te.reverse = ro, Te.sampleSize = Jo, Te.set = Is, Te.setWith = Ls, Te.shuffle = Zo, Te.slice = oo, Te.sortBy = gc, Te.sortedUniq = po, Te.sortedUniqBy = fo, Te.split = ru, Te.spread = pa, Te.tail = mo, Te.take = go, Te.takeRight = yo, Te.takeRightWhile = _o, Te.takeWhile = vo, Te.tap = Do, Te.throttle = fa, Te.thru = ko, Te.toArray = us, Te.toPairs = Os, Te.toPairsIn = Fs, Te.toPath = ku, Te.toPlainObject = ds, Te.transform = Bs, Te.unary = ma, Te.union = ec, Te.unionBy = nc, Te.unionWith = ic, Te.uniq = bo, Te.uniqBy = So, Te.uniqWith = xo, Te.unset = $s, Te.unzip = wo, Te.unzipWith = To, Te.update = Hs, Te.updateWith = zs, Te.values = Vs, Te.valuesIn = Us, Te.without = rc, Te.words = fu, Te.wrap = ga, Te.xor = oc, Te.xorBy = ac, Te.xorWith = sc, Te.zip = uc, Te.zipObject = Ao, Te.zipObjectDeep = Co, Te.zipWith = lc, Te.extend = kc, Te.extendWith = Rc, xu(Te, Te), Te.add = Mu, Te.attempt = Xc, Te.camelCase = Vc, Te.capitalize = Gs, Te.ceil = sh, Te.clamp = js, Te.clone = _a, Te.cloneDeep = ba, Te.cloneDeepWith = Sa, Te.cloneWith = va, Te.deburr = Ks, Te.endsWith = Ys, Te.eq = xa, Te.escape = Xs, Te.escapeRegExp = Qs, Te.every = Bo, Te.find = Ho, Te.findIndex = Vr, Te.findKey = gs, Te.findLast = zo, Te.findLastIndex = Ur, Te.findLastKey = ys, Te.floor = uh, Te.forEach = Uo, Te.forEachRight = jo, Te.forIn = _s, Te.forInRight = vs, Te.forOwn = bs, Te.forOwnRight = Ss, Te.get = Ts, Te.gt = wa, Te.gte = Ta, Te.has = As, Te.hasIn = Cs, Te.head = Kr, Te.identity = _u, Te.includes = Wo, Te.indexOf = Yr, Te.inRange = Ws, Te.invoke = Fc, Te.isArguments = Aa, Te.isArray = Cc, Te.isArrayBuffer = Ca, Te.isArrayLike = Ea, Te.isArrayLikeObject = Da, Te.isBoolean = ka, Te.isBuffer = Ec, Te.isDate = Ra, Te.isElement = Ma, Te.isEmpty = Pa, Te.isEqual = Na, Te.isEqualWith = Ia, Te.isError = La, Te.isFinite = Oa, Te.isFunction = Fa, Te.isInteger = Ba, Te.isLength = $a, Te.isMap = Va, Te.isMatch = Ua, Te.isMatchWith = ja, Te.isNaN = Wa, Te.isNative = qa, Te.isNil = Ka, Te.isNull = Ga, Te.isNumber = Ya, Te.isObject = Ha, Te.isObjectLike = za, Te.isPlainObject = Xa, Te.isRegExp = Qa, Te.isSafeInteger = Ja, Te.isSet = Za, Te.isString = ts, Te.isSymbol = es, Te.isTypedArray = ns, Te.isUndefined = is, Te.isWeakMap = rs, Te.isWeakSet = os, Te.join = Qr, Te.kebabCase = Uc, Te.last = Jr, Te.lastIndexOf = Zr, Te.lowerCase = jc, Te.lowerFirst = Wc, Te.lt = as, Te.lte = ss, Te.max = Pu, Te.maxBy = Nu, Te.mean = Iu, Te.min = Lu, Te.minBy = Ou, Te.noConflict = wu, Te.noop = Tu, Te.now = yc, Te.pad = Js, Te.padEnd = Zs, Te.padStart = tu, Te.parseInt = eu, Te.random = qs, Te.reduce = Ko, Te.reduceRight = Yo, Te.repeat = nu, Te.replace = iu, Te.result = Ns, Te.round = lh, Te.runInContext = G, Te.sample = Qo, Te.size = ta, Te.snakeCase = Gc, Te.some = ea, Te.sortedIndex = ao, Te.sortedIndexBy = so, Te.sortedIndexOf = uo, Te.sortedLastIndex = lo, Te.sortedLastIndexBy = co, Te.sortedLastIndexOf = ho, Te.startCase = Kc, Te.startsWith = ou, Te.subtract = Fu, Te.sum = Bu, Te.sumBy = $u,
                        Te.template = au, Te.times = Du, Te.toInteger = ls, Te.toLength = cs, Te.toLower = su, Te.toNumber = hs, Te.toSafeInteger = ps, Te.toString = fs, Te.toUpper = uu, Te.trim = lu, Te.trimEnd = cu, Te.trimStart = hu, Te.truncate = du, Te.unescape = pu, Te.uniqueId = Ru, Te.upperCase = Yc, Te.upperFirst = qc, Te.each = Uo, Te.eachRight = jo, Te.first = Kr, xu(Te, function () { var t = {}; return Hn(Te, function (e, n) { Ku.call(Te.prototype, n) || (t[n] = e) }), t }(), { chain: !1 }), Te.VERSION = Y, o(["bind", "bindKey", "curry", "curryRight", "partial", "partialRight"], function (t) { Te[t].placeholder = Te }), o(["drop", "take"], function (t, e) { Re.prototype[t] = function (n) { var i = this.__filtered__; if (i && !e) return new Re(this); n = n === K ? 1 : _l(ls(n), 0); var r = this.clone(); return i ? r.__takeCount__ = vl(n, r.__takeCount__) : r.__views__.push({ size: vl(n, wt), type: t + (r.__dir__ < 0 ? "Right" : "") }), r }, Re.prototype[t + "Right"] = function (e) { return this.reverse()[t](e).reverse() } }), o(["filter", "map", "takeWhile"], function (t, e) { var n = e + 1, i = n == gt || n == _t; Re.prototype[t] = function (t) { var e = this.clone(); return e.__iteratees__.push({ iteratee: dr(t, 3), type: n }), e.__filtered__ = e.__filtered__ || i, e } }), o(["head", "last"], function (t, e) { var n = "take" + (e ? "Right" : ""); Re.prototype[t] = function () { return this[n](1).value()[0] } }), o(["initial", "tail"], function (t, e) { var n = "drop" + (e ? "" : "Right"); Re.prototype[t] = function () { return this.__filtered__ ? new Re(this) : this[n](1) } }), Re.prototype.compact = function () { return this.filter(_u) }, Re.prototype.find = function (t) { return this.filter(t).head() }, Re.prototype.findLast = function (t) { return this.reverse().find(t) }, Re.prototype.invokeMap = da(function (t, e) { return "function" == typeof t ? new Re(this) : this.map(function (n) { return Yn(n, t, e) }) }), Re.prototype.reject = function (t) { return t = dr(t, 3), this.filter(function (e) { return !t(e) }) }, Re.prototype.slice = function (t, e) { t = ls(t); var n = this; return n.__filtered__ && (t > 0 || 0 > e) ? new Re(n) : (0 > t ? n = n.takeRight(-t) : t && (n = n.drop(t)), e !== K && (e = ls(e), n = 0 > e ? n.dropRight(-e) : n.take(e - t)), n) }, Re.prototype.takeRightWhile = function (t) { return this.reverse().takeWhile(t).reverse() }, Re.prototype.toArray = function () { return this.take(wt) }, Hn(Re.prototype, function (t, e) { var n = /^(?:filter|find|map|reject)|While$/.test(e), i = /^(?:head|last)$/.test(e), r = Te[i ? "take" + ("last" == e ? "Right" : "") : e], o = i || /^find/.test(e); r && (Te.prototype[e] = function () { var e = this.__wrapped__, a = i ? [1] : arguments, s = e instanceof Re, u = a[0], l = s || Cc(e), c = function (t) { var e = r.apply(Te, d([t], a)); return i && h ? e[0] : e }; l && n && "function" == typeof u && 1 != u.length && (s = l = !1); var h = this.__chain__, p = !!this.__actions__.length, f = o && !h, m = s && !p; if (!o && l) { e = m ? e : new Re(this); var g = t.apply(e, a); return g.__actions__.push({ func: ko, args: [c], thisArg: K }), new ke(g, h) } return f && m ? t.apply(this, a) : (g = this.thru(c), f ? i ? g.value()[0] : g.value() : g) }) }), o(["pop", "push", "shift", "sort", "splice", "unshift"], function (t) { var e = Wu[t], n = /^(?:push|sort|unshift)$/.test(t) ? "tap" : "thru", i = /^(?:pop|shift)$/.test(t); Te.prototype[t] = function () { var t = arguments; return i && !this.__chain__ ? e.apply(this.value(), t) : this[n](function (n) { return e.apply(n, t) }) } }), Hn(Re.prototype, function (t, e) { var n = Te[e]; if (n) { var i = n.name + "", r = kl[i] || (kl[i] = []); r.push({ name: e, func: n }) } }), kl[Zi(K, et).name] = [{ name: "wrapper", func: K }], Re.prototype.clone = Me, Re.prototype.reverse = Pe, Re.prototype.value = Ne, Te.prototype.at = cc, Te.prototype.chain = Ro, Te.prototype.commit = Mo, Te.prototype.flatMap = Po, Te.prototype.next = No, Te.prototype.plant = Lo, Te.prototype.reverse = Oo, Te.prototype.toJSON = Te.prototype.valueOf = Te.prototype.value = Fo, ul && (Te.prototype[ul] = Io), Te
        } var K, Y = "4.6.1", X = 200, Q = "Expected a function", J = "__lodash_hash_undefined__", Z = "__lodash_placeholder__", tt = 1, et = 2, nt = 4, it = 8, rt = 16, ot = 32, at = 64, st = 128, ut = 256, lt = 512, ct = 1, ht = 2, dt = 30, pt = "...", ft = 150, mt = 16, gt = 1, yt = 2, _t = 3, vt = 1 / 0,
            bt = 9007199254740991, St = 1.7976931348623157e308, xt = NaN, wt = 4294967295, Tt = wt - 1, At = wt >>> 1, Ct = "[object Arguments]", Et = "[object Array]", Dt = "[object Boolean]", kt = "[object Date]", Rt = "[object Error]",
            Mt = "[object Function]", Pt = "[object GeneratorFunction]", Nt = "[object Map]", It = "[object Number]", Lt = "[object Object]", Ot = "[object RegExp]", Ft = "[object Set]",
            Bt = "[object String]", $t = "[object Symbol]", Ht = "[object WeakMap]", zt = "[object WeakSet]", Vt = "[object ArrayBuffer]", Ut = "[object Float32Array]", jt = "[object Float64Array]", Wt = "[object Int8Array]", qt = "[object Int16Array]", Gt = "[object Int32Array]", Kt = "[object Uint8Array]", Yt = "[object Uint8ClampedArray]", Xt = "[object Uint16Array]", Qt = "[object Uint32Array]", Jt = /\b__p \+= '';/g, Zt = /\b(__p \+=) '' \+/g, te = /(__e\(.*?\)|\b__t\)) \+\n'';/g, ee = /&(?:amp|lt|gt|quot|#39|#96);/g, ne = /[&<>"'`]/g, ie = RegExp(ee.source), re = RegExp(ne.source),
            oe = /(?:\[%|\{\{)=([\s\S]+?)(?:\}\}|%\])/g,
            ae = /(?:\[%|\{\{)([\s\S]+?)(?:\}\}|%\])/g,
            se = /(?:\[%|\{\{)!([\s\S]+?)(?:\}\}|%\])/g,
            ue = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/, le = /^\w*$/, ce = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g, he = /[\\^$.*+?()[\]{}|]/g, de = RegExp(he.source), pe = /^\s+|\s+$/g, fe = /^\s+/, me = /\s+$/, ge = /\\(\\)?/g, ye = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g, _e = /\w*$/, ve = /^0x/i, be = /^[-+]0x[0-9a-f]+$/i, Se = /^0b[01]+$/i, xe = /^\[object .+?Constructor\]$/, we = /^0o[0-7]+$/i, Te = /^(?:0|[1-9]\d*)$/, Ae = /[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g, Ce = /($^)/, Ee = /['\n\r\u2028\u2029\\]/g,
            De = "\\ud800-\\udfff", ke = "\\u0300-\\u036f\\ufe20-\\ufe23", Re = "\\u20d0-\\u20f0", Me = "\\u2700-\\u27bf", Pe = "a-z\\xdf-\\xf6\\xf8-\\xff", Ne = "\\xac\\xb1\\xd7\\xf7", Ie = "\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf", Le = "\\u2018\\u2019\\u201c\\u201d", Oe = " \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000", Fe = "A-Z\\xc0-\\xd6\\xd8-\\xde",
            Be = "\\ufe0e\\ufe0f", $e = Ne + Ie + Le + Oe, He = "[" + De + "]", ze = "[" + $e + "]", Ve = "[" + ke + Re + "]", Ue = "\\d+", je = "[" + Me + "]", We = "[" + Pe + "]", qe = "[^" + De + $e + Ue + Me + Pe + Fe + "]",
            Ge = "\\ud83c[\\udffb-\\udfff]", Ke = "(?:" + Ve + "|" + Ge + ")", Ye = "[^" + De + "]", Xe = "(?:\\ud83c[\\udde6-\\uddff]){2}", Qe = "[\\ud800-\\udbff][\\udc00-\\udfff]", Je = "[" + Fe + "]",
            Ze = "\\u200d", tn = "(?:" + We + "|" + qe + ")", en = "(?:" + Je + "|" + qe + ")", nn = Ke + "?", rn = "[" + Be + "]?", on = "(?:" + Ze + "(?:" + [Ye, Xe, Qe].join("|") + ")" + rn + nn + ")*",
            an = rn + nn + on, sn = "(?:" + [je, Xe, Qe].join("|") + ")" + an,
            un = "(?:" + [Ye + Ve + "?", Ve, Xe, Qe, He].join("|") + ")", ln = RegExp(Ve, "g"),
            cn = RegExp(Ge + "(?=" + Ge + ")|" + un + an, "g"),
            hn = RegExp("[" + Ze + De + ke + Re + Be + "]"), dn = /[a-zA-Z0-9]+/g, pn = RegExp([Je + "?" + We + "+(?=" + [ze, Je, "$"].join("|") + ")", en + "+(?=" + [ze, Je + tn, "$"].join("|") + ")", Je + "?" + tn + "+", Je + "+", Ue, sn].join("|"), "g"), fn = /[a-z][A-Z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/, mn = ["Array", "Buffer", "Date", "Error", "Float32Array", "Float64Array", "Function", "Int8Array", "Int16Array", "Int32Array", "Map", "Math", "Object", "Reflect", "RegExp", "Set", "String", "Symbol", "TypeError", "Uint8Array", "Uint8ClampedArray", "Uint16Array", "Uint32Array", "WeakMap", "_", "clearTimeout", "isFinite", "parseInt", "setTimeout"], gn = -1, yn = {};
        yn[Ut] = yn[jt] = yn[Wt] = yn[qt] = yn[Gt] = yn[Kt] = yn[Yt] = yn[Xt] = yn[Qt] = !0, yn[Ct] = yn[Et] = yn[Vt] = yn[Dt] = yn[kt] = yn[Rt] = yn[Mt] = yn[Nt] = yn[It] = yn[Lt] = yn[Ot] = yn[Ft] = yn[Bt] = yn[Ht] = !1; var _n = {}; _n[Ct] = _n[Et] = _n[Vt] = _n[Dt] = _n[kt] = _n[Ut] = _n[jt] = _n[Wt] = _n[qt] = _n[Gt] = _n[Nt] = _n[It] = _n[Lt] = _n[Ot] = _n[Ft] = _n[Bt] = _n[$t] = _n[Kt] = _n[Yt] = _n[Xt] = _n[Qt] = !0, _n[Rt] = _n[Mt] = _n[Ht] = !1; var vn = { "\xc0": "A", "\xc1": "A", "\xc2": "A", "\xc3": "A", "\xc4": "A", "\xc5": "A", "\xe0": "a", "\xe1": "a", "\xe2": "a", "\xe3": "a", "\xe4": "a", "\xe5": "a", "\xc7": "C", "\xe7": "c", "\xd0": "D", "\xf0": "d", "\xc8": "E", "\xc9": "E", "\xca": "E", "\xcb": "E", "\xe8": "e", "\xe9": "e", "\xea": "e", "\xeb": "e", "\xcc": "I", "\xcd": "I", "\xce": "I", "\xcf": "I", "\xec": "i", "\xed": "i", "\xee": "i", "\xef": "i", "\xd1": "N", "\xf1": "n", "\xd2": "O", "\xd3": "O", "\xd4": "O", "\xd5": "O", "\xd6": "O", "\xd8": "O", "\xf2": "o", "\xf3": "o", "\xf4": "o", "\xf5": "o", "\xf6": "o", "\xf8": "o", "\xd9": "U", "\xda": "U", "\xdb": "U", "\xdc": "U", "\xf9": "u", "\xfa": "u", "\xfb": "u", "\xfc": "u", "\xdd": "Y", "\xfd": "y", "\xff": "y", "\xc6": "Ae", "\xe6": "ae", "\xde": "Th", "\xfe": "th", "\xdf": "ss" }, bn = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;", "`": "&#96;" }, Sn = { "&amp;": "&", "&lt;": "<", "&gt;": ">", "&quot;": '"', "&#39;": "'", "&#96;": "`" }, xn = { "function": !0, object: !0 }, wn = { "\\": "\\", "'": "'", "\n": "n", "\r": "r", "\u2028": "u2028", "\u2029": "u2029" }, Tn = parseFloat, An = parseInt, Cn = xn[typeof exports] && exports && !exports.nodeType ? exports : K, En = xn[typeof module] && module && !module.nodeType ? module : K, Dn = En && En.exports === Cn ? Cn : K, kn = R(Cn && En && "object" == typeof global && global), Rn = R(xn[typeof self] && self), Mn = R(xn[typeof window] && window), Pn = R(xn[typeof this] && this), Nn = kn || Mn !== (Pn && Pn.window) && Mn || Rn || Pn || Function("return this")(), In = G(); (Mn || Rn || {})._ = In, "function" == typeof define && "object" == typeof define.amd && define.amd ? define(function () { return In }) : Cn && En ? (Dn && ((En.exports = In)._ = In), Cn._ = In) : Nn._ = In
    }.call(this),

    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - URI.js v1.15.1 http://medialize.github.io/URI.js/
        //
        // build contains: IPv6.js, punycode.js, SecondLevelDomains.js, URI.js, URITemplate.js
        // ---------------------------------------------------------------------------------
        (function (f, n) { "object" === typeof exports ? module.exports = n() : "function" === typeof define && define.amd ? define(n) : f.IPv6 = n(f) })(this, function (f) {
            var n = f && f.IPv6; return {
                best: function (g) {
                    g = g.toLowerCase().split(":"); var l = g.length, b = 8; "" === g[0] && "" === g[1] && "" === g[2] ? (g.shift(), g.shift()) : "" === g[0] && "" === g[1] ? g.shift() : "" === g[l - 1] && "" === g[l - 2] && g.pop(); l = g.length; -1 !== g[l - 1].indexOf(".") && (b = 7); var k; for (k = 0; k < l && "" !== g[k]; k++); if (k < b) for (g.splice(k, 1, "0000") ; g.length < b;) g.splice(k, 0, "0000"); for (k = 0; k < b; k++) {
                        for (var l =
                            g[k].split(""), f = 0; 3 > f; f++) if ("0" === l[0] && 1 < l.length) l.splice(0, 1); else break; g[k] = l.join("")
                    } var l = -1, n = f = 0, h = -1, u = !1; for (k = 0; k < b; k++) u ? "0" === g[k] ? n += 1 : (u = !1, n > f && (l = h, f = n)) : "0" === g[k] && (u = !0, h = k, n = 1); n > f && (l = h, f = n); 1 < f && g.splice(l, f, ""); l = g.length; b = ""; "" === g[0] && (b = ":"); for (k = 0; k < l; k++) { b += g[k]; if (k === l - 1) break; b += ":" } "" === g[l - 1] && (b += ":"); return b
                }, noConflict: function () { f.IPv6 === this && (f.IPv6 = n); return this }
            }
        });
        (function (f) {
            function n(b) { throw RangeError(v[b]); } function g(b, e) { for (var h = b.length; h--;) b[h] = e(b[h]); return b } function l(b, h) { return g(b.split(e), h).join(".") } function b(b) { for (var e = [], h = 0, g = b.length, a, c; h < g;) a = b.charCodeAt(h++), 55296 <= a && 56319 >= a && h < g ? (c = b.charCodeAt(h++), 56320 == (c & 64512) ? e.push(((a & 1023) << 10) + (c & 1023) + 65536) : (e.push(a), h--)) : e.push(a); return e } function k(b) { return g(b, function (b) { var e = ""; 65535 < b && (b -= 65536, e += x(b >>> 10 & 1023 | 55296), b = 56320 | b & 1023); return e += x(b) }).join("") } function A(b,
                e) { return b + 22 + 75 * (26 > b) - ((0 != e) << 5) } function w(b, e, h) { var g = 0; b = h ? q(b / 700) : b >> 1; for (b += q(b / e) ; 455 < b; g += 36) b = q(b / 35); return q(g + 36 * b / (b + 38)) } function h(b) {
                    var e = [], h = b.length, g, a = 0, c = 128, d = 72, m, z, y, f, l; m = b.lastIndexOf("-"); 0 > m && (m = 0); for (z = 0; z < m; ++z) 128 <= b.charCodeAt(z) && n("not-basic"), e.push(b.charCodeAt(z)); for (m = 0 < m ? m + 1 : 0; m < h;) {
                        z = a; g = 1; for (y = 36; ; y += 36) {
                            m >= h && n("invalid-input"); f = b.charCodeAt(m++); f = 10 > f - 48 ? f - 22 : 26 > f - 65 ? f - 65 : 26 > f - 97 ? f - 97 : 36; (36 <= f || f > q((2147483647 - a) / g)) && n("overflow"); a += f * g; l =
                                y <= d ? 1 : y >= d + 26 ? 26 : y - d; if (f < l) break; f = 36 - l; g > q(2147483647 / f) && n("overflow"); g *= f
                        } g = e.length + 1; d = w(a - z, g, 0 == z); q(a / g) > 2147483647 - c && n("overflow"); c += q(a / g); a %= g; e.splice(a++, 0, c)
                    } return k(e)
                } function u(e) {
                    var g, h, f, a, c, d, m, z, y, l = [], u, k, p; e = b(e); u = e.length; g = 128; h = 0; c = 72; for (d = 0; d < u; ++d) y = e[d], 128 > y && l.push(x(y)); for ((f = a = l.length) && l.push("-") ; f < u;) {
                        m = 2147483647; for (d = 0; d < u; ++d) y = e[d], y >= g && y < m && (m = y); k = f + 1; m - g > q((2147483647 - h) / k) && n("overflow"); h += (m - g) * k; g = m; for (d = 0; d < u; ++d) if (y = e[d], y < g && 2147483647 <
                            ++h && n("overflow"), y == g) { z = h; for (m = 36; ; m += 36) { y = m <= c ? 1 : m >= c + 26 ? 26 : m - c; if (z < y) break; p = z - y; z = 36 - y; l.push(x(A(y + p % z, 0))); z = q(p / z) } l.push(x(A(z, 0))); c = w(h, k, f == a); h = 0; ++f } ++h; ++g
                    } return l.join("")
                } var D = "object" == typeof exports && exports, E = "object" == typeof module && module && module.exports == D && module, B = "object" == typeof global && global; if (B.global === B || B.window === B) f = B; var t, r = /^xn--/, p = /[^ -~]/, e = /\x2E|\u3002|\uFF0E|\uFF61/g, v = {
                    overflow: "Overflow: input needs wider integers to process", "not-basic": "Illegal input >= 0x80 (not a basic code point)",
                    "invalid-input": "Invalid input"
                }, q = Math.floor, x = String.fromCharCode, C; t = { version: "1.2.3", ucs2: { decode: b, encode: k }, decode: h, encode: u, toASCII: function (b) { return l(b, function (b) { return p.test(b) ? "xn--" + u(b) : b }) }, toUnicode: function (b) { return l(b, function (b) { return r.test(b) ? h(b.slice(4).toLowerCase()) : b }) } }; if ("function" == typeof define && "object" == typeof define.amd && define.amd) define(function () { return t }); else if (D && !D.nodeType) if (E) E.exports = t; else for (C in t) t.hasOwnProperty(C) && (D[C] = t[C]); else f.punycode =
                    t
        })(this);
        (function (f, n) { "object" === typeof exports ? module.exports = n() : "function" === typeof define && define.amd ? define(n) : f.SecondLevelDomains = n(f) })(this, function (f) {
            var n = f && f.SecondLevelDomains, g = {
                list: {
                    ac: " com gov mil net org ", ae: " ac co gov mil name net org pro sch ", af: " com edu gov net org ", al: " com edu gov mil net org ", ao: " co ed gv it og pb ", ar: " com edu gob gov int mil net org tur ", at: " ac co gv or ", au: " asn com csiro edu gov id net org ", ba: " co com edu gov mil net org rs unbi unmo unsa untz unze ", bb: " biz co com edu gov info net org store tv ",
                    bh: " biz cc com edu gov info net org ", bn: " com edu gov net org ", bo: " com edu gob gov int mil net org tv ", br: " adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ", bs: " com edu gov net org ", bz: " du et om ov rg ", ca: " ab bc mb nb nf nl ns nt nu on pe qc sk yk ", ck: " biz co edu gen gov info net org ",
                    cn: " ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ", co: " com edu gov mil net nom org ", cr: " ac c co ed fi go or sa ", cy: " ac biz com ekloges gov ltd name net org parliament press pro tm ", "do": " art com edu gob gov mil net org sld web ", dz: " art asso com edu gov net org pol ", ec: " com edu fin gov info med mil net org pro ", eg: " com edu eun gov mil name net org sci ", er: " com edu gov ind mil net org rochest w ", es: " com edu gob nom org ",
                    et: " biz com edu gov info name net org ", fj: " ac biz com info mil name net org pro ", fk: " ac co gov net nom org ", fr: " asso com f gouv nom prd presse tm ", gg: " co net org ", gh: " com edu gov mil org ", gn: " ac com gov net org ", gr: " com edu gov mil net org ", gt: " com edu gob ind mil net org ", gu: " com edu gov net org ", hk: " com edu gov idv net org ", hu: " 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",
                    id: " ac co go mil net or sch web ", il: " ac co gov idf k12 muni net org ", "in": " ac co edu ernet firm gen gov i ind mil net nic org res ", iq: " com edu gov i mil net org ", ir: " ac co dnssec gov i id net org sch ", it: " edu gov ", je: " co net org ", jo: " com edu gov mil name net org sch ", jp: " ac ad co ed go gr lg ne or ", ke: " ac co go info me mobi ne or sc ", kh: " com edu gov mil net org per ", ki: " biz com de edu gov info mob net org tel ", km: " asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",
                    kn: " edu gov net org ", kr: " ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ", kw: " com edu gov net org ", ky: " com edu gov net org ", kz: " com edu gov mil net org ", lb: " com edu gov net org ", lk: " assn com edu gov grp hotel int ltd net ngo org sch soc web ", lr: " com edu gov net org ", lv: " asn com conf edu gov id mil net org ", ly: " com edu gov id med net org plc sch ", ma: " ac co gov m net org press ",
                    mc: " asso tm ", me: " ac co edu gov its net org priv ", mg: " com edu gov mil nom org prd tm ", mk: " com edu gov inf name net org pro ", ml: " com edu gov net org presse ", mn: " edu gov org ", mo: " com edu gov net org ", mt: " com edu gov net org ", mv: " aero biz com coop edu gov info int mil museum name net org pro ", mw: " ac co com coop edu gov int museum net org ", mx: " com edu gob net org ", my: " com edu gov mil name net org sch ", nf: " arts com firm info net other per rec store web ", ng: " biz com edu gov mil mobi name net org sch ",
                    ni: " ac co com edu gob mil net nom org ", np: " com edu gov mil net org ", nr: " biz com edu gov info net org ", om: " ac biz co com edu gov med mil museum net org pro sch ", pe: " com edu gob mil net nom org sld ", ph: " com edu gov i mil net ngo org ", pk: " biz com edu fam gob gok gon gop gos gov net org web ", pl: " art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ", pr: " ac biz com edu est gov info isla name net org pro prof ",
                    ps: " com edu gov net org plo sec ", pw: " belau co ed go ne or ", ro: " arts com firm info nom nt org rec store tm www ", rs: " ac co edu gov in org ", sb: " com edu gov net org ", sc: " com edu gov net org ", sh: " co com edu gov net nom org ", sl: " com edu gov net org ", st: " co com consulado edu embaixada gov mil net org principe saotome store ", sv: " com edu gob org red ", sz: " ac co org ", tr: " av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ", tt: " aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",
                    tw: " club com ebiz edu game gov idv mil net org ", mu: " ac co com gov net or org ", mz: " ac co edu gov org ", na: " co com ", nz: " ac co cri geek gen govt health iwi maori mil net org parliament school ", pa: " abo ac com edu gob ing med net nom org sld ", pt: " com edu gov int net nome org publ ", py: " com edu gov mil net org ", qa: " com edu gov mil net org ", re: " asso com nom ", ru: " ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",
                    rw: " ac co com edu gouv gov int mil net ", sa: " com edu gov med net org pub sch ", sd: " com edu gov info med net org tv ", se: " a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ", sg: " com edu gov idn net org per ", sn: " art com edu gouv org perso univ ", sy: " com edu gov mil net news org ", th: " ac co go in mi net or ", tj: " ac biz co com edu go gov info int mil name net nic org test web ", tn: " agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",
                    tz: " ac co go ne or ", ua: " biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ", ug: " ac co go ne or org sc ", uk: " ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",
                    us: " dni fed isa kids nsn ", uy: " com edu gub mil net org ", ve: " co com edu gob info mil net org web ", vi: " co com k12 net org ", vn: " ac biz com edu gov health info int name net org pro ", ye: " co com gov ltd me net org plc ", yu: " ac co edu gov org ", za: " ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ", zm: " ac co com edu gov net org sch "
                }, has: function (f) {
                    var b = f.lastIndexOf("."); if (0 >= b || b >= f.length - 1) return !1;
                    var k = f.lastIndexOf(".", b - 1); if (0 >= k || k >= b - 1) return !1; var n = g.list[f.slice(b + 1)]; return n ? 0 <= n.indexOf(" " + f.slice(k + 1, b) + " ") : !1
                }, is: function (f) { var b = f.lastIndexOf("."); if (0 >= b || b >= f.length - 1 || 0 <= f.lastIndexOf(".", b - 1)) return !1; var k = g.list[f.slice(b + 1)]; return k ? 0 <= k.indexOf(" " + f.slice(0, b) + " ") : !1 }, get: function (f) {
                    var b = f.lastIndexOf("."); if (0 >= b || b >= f.length - 1) return null; var k = f.lastIndexOf(".", b - 1); if (0 >= k || k >= b - 1) return null; var n = g.list[f.slice(b + 1)]; return !n || 0 > n.indexOf(" " + f.slice(k +
                        1, b) + " ") ? null : f.slice(k + 1)
                }, noConflict: function () { f.SecondLevelDomains === this && (f.SecondLevelDomains = n); return this }
            }; return g
        });
        (function (f, n) { "object" === typeof exports ? module.exports = n(require("./punycode"), require("./IPv6"), require("./SecondLevelDomains")) : "function" === typeof define && define.amd ? define(["./punycode", "./IPv6", "./SecondLevelDomains"], n) : f.URI = n(f.punycode, f.IPv6, f.SecondLevelDomains, f) })(this, function (f, n, g, l) {
            function b(a, c) {
                var d = 1 <= arguments.length, m = 2 <= arguments.length; if (!(this instanceof b)) return d ? m ? new b(a, c) : new b(a) : new b; if (void 0 === a) {
                    if (d) throw new TypeError("undefined is not a valid argument for URI");
                    a = "undefined" !== typeof location ? location.href + "" : ""
                } this.href(a); return void 0 !== c ? this.absoluteTo(c) : this
            } function k(a) { return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g, "\\$1") } function A(a) { return void 0 === a ? "Undefined" : String(Object.prototype.toString.call(a)).slice(8, -1) } function w(a) { return "Array" === A(a) } function h(a, c) {
                var d = {}, b, e; if ("RegExp" === A(c)) d = null; else if (w(c)) for (b = 0, e = c.length; b < e; b++) d[c[b]] = !0; else d[c] = !0; b = 0; for (e = a.length; b < e; b++) if (d && void 0 !== d[a[b]] || !d && c.test(a[b])) a.splice(b,
                    1), e--, b--; return a
            } function u(a, c) { var d, b; if (w(c)) { d = 0; for (b = c.length; d < b; d++) if (!u(a, c[d])) return !1; return !0 } var e = A(c); d = 0; for (b = a.length; d < b; d++) if ("RegExp" === e) { if ("string" === typeof a[d] && a[d].match(c)) return !0 } else if (a[d] === c) return !0; return !1 } function D(a, c) { if (!w(a) || !w(c) || a.length !== c.length) return !1; a.sort(); c.sort(); for (var d = 0, b = a.length; d < b; d++) if (a[d] !== c[d]) return !1; return !0 } function E(a) { return escape(a) } function B(a) {
                return encodeURIComponent(a).replace(/[!'()*]/g, E).replace(/\*/g,
                    "%2A")
            } function t(a) { return function (c, d) { if (void 0 === c) return this._parts[a] || ""; this._parts[a] = c || null; this.build(!d); return this } } function r(a, c) { return function (d, b) { if (void 0 === d) return this._parts[a] || ""; null !== d && (d += "", d.charAt(0) === c && (d = d.substring(1))); this._parts[a] = d; this.build(!b); return this } } var p = l && l.URI; b.version = "1.15.1"; var e = b.prototype, v = Object.prototype.hasOwnProperty; b._parts = function () {
                return {
                    protocol: null, username: null, password: null, hostname: null, urn: null, port: null, path: null,
                    query: null, fragment: null, duplicateQueryParameters: b.duplicateQueryParameters, escapeQuerySpace: b.escapeQuerySpace
                }
            }; b.duplicateQueryParameters = !1; b.escapeQuerySpace = !0; b.protocol_expression = /^[a-z][a-z0-9.+-]*$/i; b.idn_expression = /[^a-z0-9\.-]/i; b.punycode_expression = /(xn--)/i; b.ip4_expression = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/; b.ip6_expression = /^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;
            b.find_uri_expression = /\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig; b.findUri = { start: /\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi, end: /[\s\r\n]|$/, trim: /[`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u201e\u2018\u2019]+$/ }; b.defaultPorts = { http: "80", https: "443", ftp: "21", gopher: "70", ws: "80", wss: "443" }; b.invalid_hostname_characters =
                /[^a-zA-Z0-9\.-]/; b.domAttributes = { a: "href", blockquote: "cite", link: "href", base: "href", script: "src", form: "action", img: "src", area: "href", iframe: "src", embed: "src", source: "src", track: "src", input: "src", audio: "src", video: "src" }; b.getDomAttribute = function (a) { if (a && a.nodeName) { var c = a.nodeName.toLowerCase(); return "input" === c && "image" !== a.type ? void 0 : b.domAttributes[c] } }; b.encode = B; b.decode = decodeURIComponent; b.iso8859 = function () { b.encode = escape; b.decode = unescape }; b.unicode = function () {
                    b.encode = B; b.decode =
                        decodeURIComponent
                }; b.characters = {
                    pathname: { encode: { expression: /%(24|26|2B|2C|3B|3D|3A|40)/ig, map: { "%24": "$", "%26": "&", "%2B": "+", "%2C": ",", "%3B": ";", "%3D": "=", "%3A": ":", "%40": "@" } }, decode: { expression: /[\/\?#]/g, map: { "/": "%2F", "?": "%3F", "#": "%23" } } }, reserved: {
                        encode: {
                            expression: /%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig, map: {
                                "%3A": ":", "%2F": "/", "%3F": "?", "%23": "#", "%5B": "[", "%5D": "]", "%40": "@", "%21": "!", "%24": "$", "%26": "&", "%27": "'", "%28": "(", "%29": ")", "%2A": "*", "%2B": "+", "%2C": ",",
                                "%3B": ";", "%3D": "="
                            }
                        }
                    }, urnpath: { encode: { expression: /%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig, map: { "%21": "!", "%24": "$", "%27": "'", "%28": "(", "%29": ")", "%2A": "*", "%2B": "+", "%2C": ",", "%3B": ";", "%3D": "=", "%40": "@" } }, decode: { expression: /[\/\?#:]/g, map: { "/": "%2F", "?": "%3F", "#": "%23", ":": "%3A" } } }
                }; b.encodeQuery = function (a, c) { var d = b.encode(a + ""); void 0 === c && (c = b.escapeQuerySpace); return c ? d.replace(/%20/g, "+") : d }; b.decodeQuery = function (a, c) {
                    a += ""; void 0 === c && (c = b.escapeQuerySpace); try {
                        return b.decode(c ? a.replace(/\+/g,
                            "%20") : a)
                    } catch (d) { return a }
                }; var q = { encode: "encode", decode: "decode" }, x, C = function (a, c) { return function (d) { try { return b[c](d + "").replace(b.characters[a][c].expression, function (d) { return b.characters[a][c].map[d] }) } catch (m) { return d } } }; for (x in q) b[x + "PathSegment"] = C("pathname", q[x]), b[x + "UrnPathSegment"] = C("urnpath", q[x]); q = function (a, c, d) { return function (m) { var e; e = d ? function (a) { return b[c](b[d](a)) } : b[c]; m = (m + "").split(a); for (var f = 0, h = m.length; f < h; f++) m[f] = e(m[f]); return m.join(a) } }; b.decodePath =
                    q("/", "decodePathSegment"); b.decodeUrnPath = q(":", "decodeUrnPathSegment"); b.recodePath = q("/", "encodePathSegment", "decode"); b.recodeUrnPath = q(":", "encodeUrnPathSegment", "decode"); b.encodeReserved = C("reserved", "encode"); b.parse = function (a, c) {
                        var d; c || (c = {}); d = a.indexOf("#"); -1 < d && (c.fragment = a.substring(d + 1) || null, a = a.substring(0, d)); d = a.indexOf("?"); -1 < d && (c.query = a.substring(d + 1) || null, a = a.substring(0, d)); "//" === a.substring(0, 2) ? (c.protocol = null, a = a.substring(2), a = b.parseAuthority(a, c)) : (d = a.indexOf(":"),
                            -1 < d && (c.protocol = a.substring(0, d) || null, c.protocol && !c.protocol.match(b.protocol_expression) ? c.protocol = void 0 : "//" === a.substring(d + 1, d + 3) ? (a = a.substring(d + 3), a = b.parseAuthority(a, c)) : (a = a.substring(d + 1), c.urn = !0))); c.path = a; return c
                    }; b.parseHost = function (a, c) {
                        var d = a.indexOf("/"), b; -1 === d && (d = a.length); if ("[" === a.charAt(0)) b = a.indexOf("]"), c.hostname = a.substring(1, b) || null, c.port = a.substring(b + 2, d) || null, "/" === c.port && (c.port = null); else {
                            var e = a.indexOf(":"); b = a.indexOf("/"); e = a.indexOf(":", e + 1);
                            -1 !== e && (-1 === b || e < b) ? (c.hostname = a.substring(0, d) || null, c.port = null) : (b = a.substring(0, d).split(":"), c.hostname = b[0] || null, c.port = b[1] || null)
                        } c.hostname && "/" !== a.substring(d).charAt(0) && (d++, a = "/" + a); return a.substring(d) || "/"
                    }; b.parseAuthority = function (a, c) { a = b.parseUserinfo(a, c); return b.parseHost(a, c) }; b.parseUserinfo = function (a, c) {
                        var d = a.indexOf("/"), m = a.lastIndexOf("@", -1 < d ? d : a.length - 1); -1 < m && (-1 === d || m < d) ? (d = a.substring(0, m).split(":"), c.username = d[0] ? b.decode(d[0]) : null, d.shift(), c.password =
                            d[0] ? b.decode(d.join(":")) : null, a = a.substring(m + 1)) : (c.username = null, c.password = null); return a
                    }; b.parseQuery = function (a, c) { if (!a) return {}; a = a.replace(/&+/g, "&").replace(/^\?*&*|&+$/g, ""); if (!a) return {}; for (var d = {}, m = a.split("&"), e = m.length, f, h, g = 0; g < e; g++) f = m[g].split("="), h = b.decodeQuery(f.shift(), c), f = f.length ? b.decodeQuery(f.join("="), c) : null, v.call(d, h) ? ("string" === typeof d[h] && (d[h] = [d[h]]), d[h].push(f)) : d[h] = f; return d }; b.build = function (a) {
                        var c = ""; a.protocol && (c += a.protocol + ":"); a.urn || !c &&
                            !a.hostname || (c += "//"); c += b.buildAuthority(a) || ""; "string" === typeof a.path && ("/" !== a.path.charAt(0) && "string" === typeof a.hostname && (c += "/"), c += a.path); "string" === typeof a.query && a.query && (c += "?" + a.query); "string" === typeof a.fragment && a.fragment && (c += "#" + a.fragment); return c
                    }; b.buildHost = function (a) { var c = ""; if (a.hostname) c = b.ip6_expression.test(a.hostname) ? c + ("[" + a.hostname + "]") : c + a.hostname; else return ""; a.port && (c += ":" + a.port); return c }; b.buildAuthority = function (a) { return b.buildUserinfo(a) + b.buildHost(a) };
            b.buildUserinfo = function (a) { var c = ""; a.username && (c += b.encode(a.username), a.password && (c += ":" + b.encode(a.password)), c += "@"); return c }; b.buildQuery = function (a, c, d) { var m = "", e, f, h, g; for (f in a) if (v.call(a, f) && f) if (w(a[f])) for (e = {}, h = 0, g = a[f].length; h < g; h++) void 0 !== a[f][h] && void 0 === e[a[f][h] + ""] && (m += "&" + b.buildQueryParameter(f, a[f][h], d), !0 !== c && (e[a[f][h] + ""] = !0)); else void 0 !== a[f] && (m += "&" + b.buildQueryParameter(f, a[f], d)); return m.substring(1) }; b.buildQueryParameter = function (a, c, d) {
                return b.encodeQuery(a,
                    d) + (null !== c ? "=" + b.encodeQuery(c, d) : "")
            }; b.addQuery = function (a, c, d) { if ("object" === typeof c) for (var m in c) v.call(c, m) && b.addQuery(a, m, c[m]); else if ("string" === typeof c) void 0 === a[c] ? a[c] = d : ("string" === typeof a[c] && (a[c] = [a[c]]), w(d) || (d = [d]), a[c] = (a[c] || []).concat(d)); else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter"); }; b.removeQuery = function (a, c, d) {
                var m; if (w(c)) for (d = 0, m = c.length; d < m; d++) a[c[d]] = void 0; else if ("RegExp" === A(c)) for (m in a) c.test(m) && (a[m] = void 0);
                else if ("object" === typeof c) for (m in c) v.call(c, m) && b.removeQuery(a, m, c[m]); else if ("string" === typeof c) void 0 !== d ? "RegExp" === A(d) ? !w(a[c]) && d.test(a[c]) ? a[c] = void 0 : a[c] = h(a[c], d) : a[c] === d ? a[c] = void 0 : w(a[c]) && (a[c] = h(a[c], d)) : a[c] = void 0; else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");
            }; b.hasQuery = function (a, c, d, m) {
                if ("object" === typeof c) { for (var e in c) if (v.call(c, e) && !b.hasQuery(a, e, c[e])) return !1; return !0 } if ("string" !== typeof c) throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");
                switch (A(d)) { case "Undefined": return c in a; case "Boolean": return a = Boolean(w(a[c]) ? a[c].length : a[c]), d === a; case "Function": return !!d(a[c], c, a); case "Array": return w(a[c]) ? (m ? u : D)(a[c], d) : !1; case "RegExp": return w(a[c]) ? m ? u(a[c], d) : !1 : Boolean(a[c] && a[c].match(d)); case "Number": d = String(d); case "String": return w(a[c]) ? m ? u(a[c], d) : !1 : a[c] === d; default: throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter"); }
            }; b.commonPath = function (a, c) {
                var d =
                    Math.min(a.length, c.length), b; for (b = 0; b < d; b++) if (a.charAt(b) !== c.charAt(b)) { b--; break } if (1 > b) return a.charAt(0) === c.charAt(0) && "/" === a.charAt(0) ? "/" : ""; if ("/" !== a.charAt(b) || "/" !== c.charAt(b)) b = a.substring(0, b).lastIndexOf("/"); return a.substring(0, b + 1)
            }; b.withinString = function (a, c, d) {
                d || (d = {}); var m = d.start || b.findUri.start, e = d.end || b.findUri.end, f = d.trim || b.findUri.trim, h = /[a-z0-9-]=["']?$/i; for (m.lastIndex = 0; ;) {
                    var g = m.exec(a); if (!g) break; g = g.index; if (d.ignoreHtml) {
                        var u = a.slice(Math.max(g - 3, 0),
                            g); if (u && h.test(u)) continue
                    } var u = g + a.slice(g).search(e), k = a.slice(g, u).replace(f, ""); d.ignore && d.ignore.test(k) || (u = g + k.length, k = c(k, g, u, a), a = a.slice(0, g) + k + a.slice(u), m.lastIndex = g + k.length)
                } m.lastIndex = 0; return a
            }; b.ensureValidHostname = function (a) {
                if (a.match(b.invalid_hostname_characters)) {
                    if (!f) throw new TypeError('Hostname "' + a + '" contains characters other than [A-Z0-9.-] and Punycode.js is not available'); if (f.toASCII(a).match(b.invalid_hostname_characters)) throw new TypeError('Hostname "' +
                        a + '" contains characters other than [A-Z0-9.-]');
                }
            }; b.noConflict = function (a) { if (a) return a = { URI: this.noConflict() }, l.URITemplate && "function" === typeof l.URITemplate.noConflict && (a.URITemplate = l.URITemplate.noConflict()), l.IPv6 && "function" === typeof l.IPv6.noConflict && (a.IPv6 = l.IPv6.noConflict()), l.SecondLevelDomains && "function" === typeof l.SecondLevelDomains.noConflict && (a.SecondLevelDomains = l.SecondLevelDomains.noConflict()), a; l.URI === this && (l.URI = p); return this }; e.build = function (a) {
                if (!0 === a) this._deferred_build =
                    !0; else if (void 0 === a || this._deferred_build) this._string = b.build(this._parts), this._deferred_build = !1; return this
            }; e.clone = function () { return new b(this) }; e.valueOf = e.toString = function () { return this.build(!1)._string }; e.protocol = t("protocol"); e.username = t("username"); e.password = t("password"); e.hostname = t("hostname"); e.port = t("port"); e.query = r("query", "?"); e.fragment = r("fragment", "#"); e.search = function (a, c) { var b = this.query(a, c); return "string" === typeof b && b.length ? "?" + b : b }; e.hash = function (a, c) {
                var b =
                    this.fragment(a, c); return "string" === typeof b && b.length ? "#" + b : b
            }; e.pathname = function (a, c) { if (void 0 === a || !0 === a) { var d = this._parts.path || (this._parts.hostname ? "/" : ""); return a ? (this._parts.urn ? b.decodeUrnPath : b.decodePath)(d) : d } this._parts.path = this._parts.urn ? a ? b.recodeUrnPath(a) : "" : a ? b.recodePath(a) : "/"; this.build(!c); return this }; e.path = e.pathname; e.href = function (a, c) {
                var d; if (void 0 === a) return this.toString(); this._string = ""; this._parts = b._parts(); var e = a instanceof b, f = "object" === typeof a && (a.hostname ||
                    a.path || a.pathname); a.nodeName && (f = b.getDomAttribute(a), a = a[f] || "", f = !1); !e && f && void 0 !== a.pathname && (a = a.toString()); if ("string" === typeof a || a instanceof String) this._parts = b.parse(String(a), this._parts); else if (e || f) for (d in e = e ? a._parts : a, e) v.call(this._parts, d) && (this._parts[d] = e[d]); else throw new TypeError("invalid input"); this.build(!c); return this
            }; e.is = function (a) {
                var c = !1, d = !1, e = !1, f = !1, h = !1, u = !1, k = !1, l = !this._parts.urn; this._parts.hostname && (l = !1, d = b.ip4_expression.test(this._parts.hostname),
                    e = b.ip6_expression.test(this._parts.hostname), c = d || e, h = (f = !c) && g && g.has(this._parts.hostname), u = f && b.idn_expression.test(this._parts.hostname), k = f && b.punycode_expression.test(this._parts.hostname)); switch (a.toLowerCase()) {
                        case "relative": return l; case "absolute": return !l; case "domain": case "name": return f; case "sld": return h; case "ip": return c; case "ip4": case "ipv4": case "inet4": return d; case "ip6": case "ipv6": case "inet6": return e; case "idn": return u; case "url": return !this._parts.urn; case "urn": return !!this._parts.urn;
                        case "punycode": return k
                    } return null
            }; var F = e.protocol, G = e.port, H = e.hostname; e.protocol = function (a, c) { if (void 0 !== a && a && (a = a.replace(/:(\/\/)?$/, ""), !a.match(b.protocol_expression))) throw new TypeError('Protocol "' + a + "\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]"); return F.call(this, a, c) }; e.scheme = e.protocol; e.port = function (a, c) {
                if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 !== a && (0 === a && (a = null), a && (a += "", ":" === a.charAt(0) && (a = a.substring(1)), a.match(/[^0-9]/)))) throw new TypeError('Port "' +
                    a + '" contains characters other than [0-9]'); return G.call(this, a, c)
            }; e.hostname = function (a, c) { if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 !== a) { var d = {}; b.parseHost(a, d); a = d.hostname } return H.call(this, a, c) }; e.host = function (a, c) { if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 === a) return this._parts.hostname ? b.buildHost(this._parts) : ""; b.parseHost(a, this._parts); this.build(!c); return this }; e.authority = function (a, c) {
                if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 === a) return this._parts.hostname ?
                    b.buildAuthority(this._parts) : ""; b.parseAuthority(a, this._parts); this.build(!c); return this
            }; e.userinfo = function (a, c) { if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 === a) { if (!this._parts.username) return ""; var d = b.buildUserinfo(this._parts); return d.substring(0, d.length - 1) } "@" !== a[a.length - 1] && (a += "@"); b.parseUserinfo(a, this._parts); this.build(!c); return this }; e.resource = function (a, c) {
                var d; if (void 0 === a) return this.path() + this.search() + this.hash(); d = b.parse(a); this._parts.path = d.path; this._parts.query =
                    d.query; this._parts.fragment = d.fragment; this.build(!c); return this
            }; e.subdomain = function (a, c) {
                if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 === a) { if (!this._parts.hostname || this.is("IP")) return ""; var d = this._parts.hostname.length - this.domain().length - 1; return this._parts.hostname.substring(0, d) || "" } d = this._parts.hostname.length - this.domain().length; d = this._parts.hostname.substring(0, d); d = new RegExp("^" + k(d)); a && "." !== a.charAt(a.length - 1) && (a += "."); a && b.ensureValidHostname(a); this._parts.hostname =
                    this._parts.hostname.replace(d, a); this.build(!c); return this
            }; e.domain = function (a, c) {
                if (this._parts.urn) return void 0 === a ? "" : this; "boolean" === typeof a && (c = a, a = void 0); if (void 0 === a) { if (!this._parts.hostname || this.is("IP")) return ""; var d = this._parts.hostname.match(/\./g); if (d && 2 > d.length) return this._parts.hostname; d = this._parts.hostname.length - this.tld(c).length - 1; d = this._parts.hostname.lastIndexOf(".", d - 1) + 1; return this._parts.hostname.substring(d) || "" } if (!a) throw new TypeError("cannot set domain empty");
                b.ensureValidHostname(a); !this._parts.hostname || this.is("IP") ? this._parts.hostname = a : (d = new RegExp(k(this.domain()) + "$"), this._parts.hostname = this._parts.hostname.replace(d, a)); this.build(!c); return this
            }; e.tld = function (a, c) {
                if (this._parts.urn) return void 0 === a ? "" : this; "boolean" === typeof a && (c = a, a = void 0); if (void 0 === a) {
                    if (!this._parts.hostname || this.is("IP")) return ""; var b = this._parts.hostname.lastIndexOf("."), b = this._parts.hostname.substring(b + 1); return !0 !== c && g && g.list[b.toLowerCase()] ? g.get(this._parts.hostname) ||
                        b : b
                } if (a) if (a.match(/[^a-zA-Z0-9-]/)) if (g && g.is(a)) b = new RegExp(k(this.tld()) + "$"), this._parts.hostname = this._parts.hostname.replace(b, a); else throw new TypeError('TLD "' + a + '" contains characters other than [A-Z0-9]'); else { if (!this._parts.hostname || this.is("IP")) throw new ReferenceError("cannot set TLD on non-domain host"); b = new RegExp(k(this.tld()) + "$"); this._parts.hostname = this._parts.hostname.replace(b, a) } else throw new TypeError("cannot set TLD empty"); this.build(!c); return this
            }; e.directory =
                function (a, c) {
                    if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 === a || !0 === a) { if (!this._parts.path && !this._parts.hostname) return ""; if ("/" === this._parts.path) return "/"; var d = this._parts.path.length - this.filename().length - 1, d = this._parts.path.substring(0, d) || (this._parts.hostname ? "/" : ""); return a ? b.decodePath(d) : d } d = this._parts.path.length - this.filename().length; d = this._parts.path.substring(0, d); d = new RegExp("^" + k(d)); this.is("relative") || (a || (a = "/"), "/" !== a.charAt(0) && (a = "/" + a)); a && "/" !== a.charAt(a.length -
                        1) && (a += "/"); a = b.recodePath(a); this._parts.path = this._parts.path.replace(d, a); this.build(!c); return this
                }; e.filename = function (a, c) {
                    if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 === a || !0 === a) { if (!this._parts.path || "/" === this._parts.path) return ""; var d = this._parts.path.lastIndexOf("/"), d = this._parts.path.substring(d + 1); return a ? b.decodePathSegment(d) : d } d = !1; "/" === a.charAt(0) && (a = a.substring(1)); a.match(/\.?\//) && (d = !0); var e = new RegExp(k(this.filename()) + "$"); a = b.recodePath(a); this._parts.path =
                        this._parts.path.replace(e, a); d ? this.normalizePath(c) : this.build(!c); return this
                }; e.suffix = function (a, c) {
                    if (this._parts.urn) return void 0 === a ? "" : this; if (void 0 === a || !0 === a) { if (!this._parts.path || "/" === this._parts.path) return ""; var d = this.filename(), e = d.lastIndexOf("."); if (-1 === e) return ""; d = d.substring(e + 1); d = /^[a-z0-9%]+$/i.test(d) ? d : ""; return a ? b.decodePathSegment(d) : d } "." === a.charAt(0) && (a = a.substring(1)); if (d = this.suffix()) e = a ? new RegExp(k(d) + "$") : new RegExp(k("." + d) + "$"); else {
                        if (!a) return this;
                        this._parts.path += "." + b.recodePath(a)
                    } e && (a = b.recodePath(a), this._parts.path = this._parts.path.replace(e, a)); this.build(!c); return this
                }; e.segment = function (a, c, b) {
                    var e = this._parts.urn ? ":" : "/", f = this.path(), h = "/" === f.substring(0, 1), f = f.split(e); void 0 !== a && "number" !== typeof a && (b = c, c = a, a = void 0); if (void 0 !== a && "number" !== typeof a) throw Error('Bad segment "' + a + '", must be 0-based integer'); h && f.shift(); 0 > a && (a = Math.max(f.length + a, 0)); if (void 0 === c) return void 0 === a ? f : f[a]; if (null === a || void 0 === f[a]) if (w(c)) {
                        f =
                            []; a = 0; for (var g = c.length; a < g; a++) if (c[a].length || f.length && f[f.length - 1].length) f.length && !f[f.length - 1].length && f.pop(), f.push(c[a])
                    } else { if (c || "string" === typeof c) "" === f[f.length - 1] ? f[f.length - 1] = c : f.push(c) } else c ? f[a] = c : f.splice(a, 1); h && f.unshift(""); return this.path(f.join(e), b)
                }; e.segmentCoded = function (a, c, d) {
                    var e, f; "number" !== typeof a && (d = c, c = a, a = void 0); if (void 0 === c) { a = this.segment(a, c, d); if (w(a)) for (e = 0, f = a.length; e < f; e++) a[e] = b.decode(a[e]); else a = void 0 !== a ? b.decode(a) : void 0; return a } if (w(c)) for (e =
                        0, f = c.length; e < f; e++) c[e] = b.decode(c[e]); else c = "string" === typeof c || c instanceof String ? b.encode(c) : c; return this.segment(a, c, d)
                }; var I = e.query; e.query = function (a, c) {
                    if (!0 === a) return b.parseQuery(this._parts.query, this._parts.escapeQuerySpace); if ("function" === typeof a) { var d = b.parseQuery(this._parts.query, this._parts.escapeQuerySpace), e = a.call(this, d); this._parts.query = b.buildQuery(e || d, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace); this.build(!c); return this } return void 0 !==
                        a && "string" !== typeof a ? (this._parts.query = b.buildQuery(a, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace), this.build(!c), this) : I.call(this, a, c)
                }; e.setQuery = function (a, c, d) {
                    var e = b.parseQuery(this._parts.query, this._parts.escapeQuerySpace); if ("string" === typeof a || a instanceof String) e[a] = void 0 !== c ? c : null; else if ("object" === typeof a) for (var f in a) v.call(a, f) && (e[f] = a[f]); else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter"); this._parts.query =
                        b.buildQuery(e, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace); "string" !== typeof a && (d = c); this.build(!d); return this
                }; e.addQuery = function (a, c, d) { var e = b.parseQuery(this._parts.query, this._parts.escapeQuerySpace); b.addQuery(e, a, void 0 === c ? null : c); this._parts.query = b.buildQuery(e, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace); "string" !== typeof a && (d = c); this.build(!d); return this }; e.removeQuery = function (a, c, d) {
                    var e = b.parseQuery(this._parts.query, this._parts.escapeQuerySpace);
                    b.removeQuery(e, a, c); this._parts.query = b.buildQuery(e, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace); "string" !== typeof a && (d = c); this.build(!d); return this
                }; e.hasQuery = function (a, c, d) { var e = b.parseQuery(this._parts.query, this._parts.escapeQuerySpace); return b.hasQuery(e, a, c, d) }; e.setSearch = e.setQuery; e.addSearch = e.addQuery; e.removeSearch = e.removeQuery; e.hasSearch = e.hasQuery; e.normalize = function () {
                    return this._parts.urn ? this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build() :
                        this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()
                }; e.normalizeProtocol = function (a) { "string" === typeof this._parts.protocol && (this._parts.protocol = this._parts.protocol.toLowerCase(), this.build(!a)); return this }; e.normalizeHostname = function (a) {
                    this._parts.hostname && (this.is("IDN") && f ? this._parts.hostname = f.toASCII(this._parts.hostname) : this.is("IPv6") && n && (this._parts.hostname = n.best(this._parts.hostname)), this._parts.hostname =
                        this._parts.hostname.toLowerCase(), this.build(!a)); return this
                }; e.normalizePort = function (a) { "string" === typeof this._parts.protocol && this._parts.port === b.defaultPorts[this._parts.protocol] && (this._parts.port = null, this.build(!a)); return this }; e.normalizePath = function (a) {
                    var c = this._parts.path; if (!c) return this; if (this._parts.urn) return this._parts.path = b.recodeUrnPath(this._parts.path), this.build(!a), this; if ("/" === this._parts.path) return this; var d, e = "", f, h; "/" !== c.charAt(0) && (d = !0, c = "/" + c); c = c.replace(/(\/(\.\/)+)|(\/\.$)/g,
                        "/").replace(/\/{2,}/g, "/"); d && (e = c.substring(1).match(/^(\.\.\/)+/) || "") && (e = e[0]); for (; ;) { f = c.indexOf("/.."); if (-1 === f) break; else if (0 === f) { c = c.substring(3); continue } h = c.substring(0, f).lastIndexOf("/"); -1 === h && (h = f); c = c.substring(0, h) + c.substring(f + 3) } d && this.is("relative") && (c = e + c.substring(1)); c = b.recodePath(c); this._parts.path = c; this.build(!a); return this
                }; e.normalizePathname = e.normalizePath; e.normalizeQuery = function (a) {
                    "string" === typeof this._parts.query && (this._parts.query.length ? this.query(b.parseQuery(this._parts.query,
                        this._parts.escapeQuerySpace)) : this._parts.query = null, this.build(!a)); return this
                }; e.normalizeFragment = function (a) { this._parts.fragment || (this._parts.fragment = null, this.build(!a)); return this }; e.normalizeSearch = e.normalizeQuery; e.normalizeHash = e.normalizeFragment; e.iso8859 = function () { var a = b.encode, c = b.decode; b.encode = escape; b.decode = decodeURIComponent; try { this.normalize() } finally { b.encode = a, b.decode = c } return this }; e.unicode = function () {
                    var a = b.encode, c = b.decode; b.encode = B; b.decode = unescape; try { this.normalize() } finally {
                        b.encode =
                            a, b.decode = c
                    } return this
                }; e.readable = function () {
                    var a = this.clone(); a.username("").password("").normalize(); var c = ""; a._parts.protocol && (c += a._parts.protocol + "://"); a._parts.hostname && (a.is("punycode") && f ? (c += f.toUnicode(a._parts.hostname), a._parts.port && (c += ":" + a._parts.port)) : c += a.host()); a._parts.hostname && a._parts.path && "/" !== a._parts.path.charAt(0) && (c += "/"); c += a.path(!0); if (a._parts.query) {
                        for (var d = "", e = 0, h = a._parts.query.split("&"), g = h.length; e < g; e++) {
                            var u = (h[e] || "").split("="), d = d + ("&" + b.decodeQuery(u[0],
                                this._parts.escapeQuerySpace).replace(/&/g, "%26")); void 0 !== u[1] && (d += "=" + b.decodeQuery(u[1], this._parts.escapeQuerySpace).replace(/&/g, "%26"))
                        } c += "?" + d.substring(1)
                    } return c += b.decodeQuery(a.hash(), !0)
                }; e.absoluteTo = function (a) {
                    var c = this.clone(), d = ["protocol", "username", "password", "hostname", "port"], e, f; if (this._parts.urn) throw Error("URNs do not have any generally defined hierarchical components"); a instanceof b || (a = new b(a)); c._parts.protocol || (c._parts.protocol = a._parts.protocol); if (this._parts.hostname) return c;
                    for (e = 0; f = d[e]; e++) c._parts[f] = a._parts[f]; c._parts.path ? ".." === c._parts.path.substring(-2) && (c._parts.path += "/") : (c._parts.path = a._parts.path, c._parts.query || (c._parts.query = a._parts.query)); "/" !== c.path().charAt(0) && (d = (d = a.directory()) ? d : 0 === a.path().indexOf("/") ? "/" : "", c._parts.path = (d ? d + "/" : "") + c._parts.path, c.normalizePath()); c.build(); return c
                }; e.relativeTo = function (a) {
                    var c = this.clone().normalize(), d, e, f, h; if (c._parts.urn) throw Error("URNs do not have any generally defined hierarchical components");
                    a = (new b(a)).normalize(); d = c._parts; e = a._parts; f = c.path(); h = a.path(); if ("/" !== f.charAt(0)) throw Error("URI is already relative"); if ("/" !== h.charAt(0)) throw Error("Cannot calculate a URI relative to another relative URI"); d.protocol === e.protocol && (d.protocol = null); if (d.username === e.username && d.password === e.password && null === d.protocol && null === d.username && null === d.password && d.hostname === e.hostname && d.port === e.port) d.hostname = null, d.port = null; else return c.build(); if (f === h) return d.path = "", c.build();
                    a = b.commonPath(c.path(), a.path()); if (!a) return c.build(); e = e.path.substring(a.length).replace(/[^\/]*$/, "").replace(/.*?\//g, "../"); d.path = e + d.path.substring(a.length); return c.build()
                }; e.equals = function (a) {
                    var c = this.clone(); a = new b(a); var d = {}, e = {}, f = {}, h; c.normalize(); a.normalize(); if (c.toString() === a.toString()) return !0; d = c.query(); e = a.query(); c.query(""); a.query(""); if (c.toString() !== a.toString() || d.length !== e.length) return !1; d = b.parseQuery(d, this._parts.escapeQuerySpace); e = b.parseQuery(e, this._parts.escapeQuerySpace);
                    for (h in d) if (v.call(d, h)) { if (!w(d[h])) { if (d[h] !== e[h]) return !1 } else if (!D(d[h], e[h])) return !1; f[h] = !0 } for (h in e) if (v.call(e, h) && !f[h]) return !1; return !0
                }; e.duplicateQueryParameters = function (a) { this._parts.duplicateQueryParameters = !!a; return this }; e.escapeQuerySpace = function (a) { this._parts.escapeQuerySpace = !!a; return this }; return b
        });
        (function (f, n) { "object" === typeof exports ? module.exports = n(require("./URI")) : "function" === typeof define && define.amd ? define(["./URI"], n) : f.URITemplate = n(f.URI, f) })(this, function (f, n) {
            function g(b) { if (g._cache[b]) return g._cache[b]; if (!(this instanceof g)) return new g(b); this.expression = b; g._cache[b] = this; return this } function l(b) { this.data = b; this.cache = {} } var b = n && n.URITemplate, k = Object.prototype.hasOwnProperty, A = g.prototype, w = {
                "": { prefix: "", separator: ",", named: !1, empty_name_separator: !1, encode: "encode" },
                "+": { prefix: "", separator: ",", named: !1, empty_name_separator: !1, encode: "encodeReserved" }, "#": { prefix: "#", separator: ",", named: !1, empty_name_separator: !1, encode: "encodeReserved" }, ".": { prefix: ".", separator: ".", named: !1, empty_name_separator: !1, encode: "encode" }, "/": { prefix: "/", separator: "/", named: !1, empty_name_separator: !1, encode: "encode" }, ";": { prefix: ";", separator: ";", named: !0, empty_name_separator: !1, encode: "encode" }, "?": { prefix: "?", separator: "&", named: !0, empty_name_separator: !0, encode: "encode" }, "&": {
                    prefix: "&",
                    separator: "&", named: !0, empty_name_separator: !0, encode: "encode"
                }
            }; g._cache = {}; g.EXPRESSION_PATTERN = /\{([^a-zA-Z0-9%_]?)([^\}]+)(\}|$)/g; g.VARIABLE_PATTERN = /^([^*:]+)((\*)|:(\d+))?$/; g.VARIABLE_NAME_PATTERN = /[^a-zA-Z0-9%_]/; g.expand = function (b, f) {
                var k = w[b.operator], l = k.named ? "Named" : "Unnamed", n = b.variables, t = [], r, p, e; for (e = 0; p = n[e]; e++) r = f.get(p.name), r.val.length ? t.push(g["expand" + l](r, k, p.explode, p.explode && k.separator || ",", p.maxlength, p.name)) : r.type && t.push(""); return t.length ? k.prefix + t.join(k.separator) :
                    ""
            }; g.expandNamed = function (b, g, k, l, n, t) { var r = "", p = g.encode; g = g.empty_name_separator; var e = !b[p].length, v = 2 === b.type ? "" : f[p](t), q, x, w; x = 0; for (w = b.val.length; x < w; x++) n ? (q = f[p](b.val[x][1].substring(0, n)), 2 === b.type && (v = f[p](b.val[x][0].substring(0, n)))) : e ? (q = f[p](b.val[x][1]), 2 === b.type ? (v = f[p](b.val[x][0]), b[p].push([v, q])) : b[p].push([void 0, q])) : (q = b[p][x][1], 2 === b.type && (v = b[p][x][0])), r && (r += l), k ? r += v + (g || q ? "=" : "") + q : (x || (r += f[p](t) + (g || q ? "=" : "")), 2 === b.type && (r += v + ","), r += q); return r }; g.expandUnnamed =
                function (b, g, k, l, n) { var t = "", r = g.encode; g = g.empty_name_separator; var p = !b[r].length, e, v, q, w; q = 0; for (w = b.val.length; q < w; q++) n ? v = f[r](b.val[q][1].substring(0, n)) : p ? (v = f[r](b.val[q][1]), b[r].push([2 === b.type ? f[r](b.val[q][0]) : void 0, v])) : v = b[r][q][1], t && (t += l), 2 === b.type && (e = n ? f[r](b.val[q][0].substring(0, n)) : b[r][q][0], t += e, t = k ? t + (g || v ? "=" : "") : t + ","), t += v; return t }; g.noConflict = function () { n.URITemplate === g && (n.URITemplate = b); return g }; A.expand = function (b) {
                    var f = ""; this.parts && this.parts.length || this.parse();
                    b instanceof l || (b = new l(b)); for (var k = 0, n = this.parts.length; k < n; k++) f += "string" === typeof this.parts[k] ? this.parts[k] : g.expand(this.parts[k], b); return f
                }; A.parse = function () {
                    var b = this.expression, f = g.EXPRESSION_PATTERN, k = g.VARIABLE_PATTERN, n = g.VARIABLE_NAME_PATTERN, l = [], t = 0, r, p, e; for (f.lastIndex = 0; ;) {
                        p = f.exec(b); if (null === p) { l.push(b.substring(t)); break } else l.push(b.substring(t, p.index)), t = p.index + p[0].length; if (!w[p[1]]) throw Error('Unknown Operator "' + p[1] + '" in "' + p[0] + '"'); if (!p[3]) throw Error('Unclosed Expression "' +
                            p[0] + '"'); r = p[2].split(","); for (var v = 0, q = r.length; v < q; v++) { e = r[v].match(k); if (null === e) throw Error('Invalid Variable "' + r[v] + '" in "' + p[0] + '"'); if (e[1].match(n)) throw Error('Invalid Variable Name "' + e[1] + '" in "' + p[0] + '"'); r[v] = { name: e[1], explode: !!e[3], maxlength: e[4] && parseInt(e[4], 10) } } if (!r.length) throw Error('Expression Missing Variable(s) "' + p[0] + '"'); l.push({ expression: p[0], operator: p[1], variables: r })
                    } l.length || l.push(b); this.parts = l; return this
                }; l.prototype.get = function (b) {
                    var f = this.data,
                        g = { type: 0, val: [], encode: [], encodeReserved: [] }, l; if (void 0 !== this.cache[b]) return this.cache[b]; this.cache[b] = g; f = "[object Function]" === String(Object.prototype.toString.call(f)) ? f(b) : "[object Function]" === String(Object.prototype.toString.call(f[b])) ? f[b](b) : f[b]; if (void 0 !== f && null !== f) if ("[object Array]" === String(Object.prototype.toString.call(f))) { l = 0; for (b = f.length; l < b; l++) void 0 !== f[l] && null !== f[l] && g.val.push([void 0, String(f[l])]); g.val.length && (g.type = 3) } else if ("[object Object]" === String(Object.prototype.toString.call(f))) {
                            for (l in f) k.call(f,
                                l) && void 0 !== f[l] && null !== f[l] && g.val.push([l, String(f[l])]); g.val.length && (g.type = 2)
                        } else g.type = 1, g.val.push([void 0, String(f)]); return g
                }; f.expand = function (b, k) { var l = (new g(b)).expand(k); return new f(l) }; return g
        });
    }.call(this),

    function () {
        // ---------------------------------------------------------------------------------
        // Js Libs - Bizweb Twine
        // ---------------------------------------------------------------------------------
        (function () { var slice = [].slice; (function (root, factory) { if (typeof root.define === "function" && root.define.amd) { return root.define([], factory) } else if (typeof module === "object" && module.exports) { return module.exports = factory() } else { return root.Twine = factory() } })(this, function () { var Twine, arrayPointersForNode, attribute, bind, bindingOrder, currentBindingCallbacks, defineArray, elements, eventName, findOrCreateElementForNode, fireCustomChangeEvent, getContext, getIndexesForElement, getValue, isDataAttribute, isKeypath, j, k, keyWithArrayIndex, keypathForKey, keypathRegex, len, len1, nodeArrayIndexes, nodeCount, preventDefaultForEvent, ref, ref1, refreshCallbacks, refreshElement, refreshQueued, registry, requiresRegistry, rootContext, rootNode, setValue, setupEventBinding, setupPropertyBinding, stringifyNodeAttributes, valuePropertyForNode, wrapFunctionString; Twine = {}; Twine.shouldDiscardEvent = {}; elements = {}; registry = {}; nodeCount = 0; rootContext = null; keypathRegex = /^[a-z]\w*(\.[a-z]\w*|\[\d+\])*$/i; refreshQueued = false; refreshCallbacks = []; rootNode = null; currentBindingCallbacks = null; Twine.getAttribute = function (node, attr) { return node.getAttribute("data-" + attr) || node.getAttribute(attr) }; Twine.reset = function (newContext, node) { var bindings, j, key, len, obj, ref; if (node == null) { node = document.documentElement } for (key in elements) { if (bindings = (ref = elements[key]) != null ? ref.bindings : void 0) { for (j = 0, len = bindings.length; j < len; j++) { obj = bindings[j]; if (obj.teardown) { obj.teardown() } } } } elements = {}; rootContext = newContext; rootNode = node; rootNode.bindingId = nodeCount = 1; return this }; Twine.bind = function (node, context) { if (node == null) { node = rootNode } if (context == null) { context = Twine.context(node) } return bind(context, node, getIndexesForElement(node), true) }; Twine.afterBound = function (callback) { if (currentBindingCallbacks) { return currentBindingCallbacks.push(callback) } else { return callback() } }; bind = function (context, node, indexes, forceSaveContext) { var _, attribute, binding, bindingConstructors, callback, callbacks, childNode, constructor, defineArrayAttr, definition, element, j, k, key, keypath, l, len, len1, len2, len3, m, newContextKey, newIndexes, ref, ref1, ref2, ref3, ref4, type, value; currentBindingCallbacks = []; element = null; if (node.bindingId) { Twine.unbind(node) } if (defineArrayAttr = Twine.getAttribute(node, "define-array")) { newIndexes = defineArray(node, context, defineArrayAttr); if (indexes == null) { indexes = {} } for (key in indexes) { value = indexes[key]; if (!newIndexes.hasOwnProperty(key)) { newIndexes[key] = value } } indexes = newIndexes; element = findOrCreateElementForNode(node); element.indexes = indexes } bindingConstructors = null; ref = node.attributes; for (j = 0, len = ref.length; j < len; j++) { attribute = ref[j]; type = attribute.name; if (isDataAttribute(type)) { type = type.slice(5) } constructor = Twine.bindingTypes[type]; if (!constructor) { continue } if (bindingConstructors == null) { bindingConstructors = [] } definition = attribute.value; bindingConstructors.push([type, constructor, definition]) } if (bindingConstructors) { if (element == null) { element = findOrCreateElementForNode(node) } if (element.bindings == null) { element.bindings = [] } if (element.indexes == null) { element.indexes = indexes } ref1 = bindingConstructors.sort(bindingOrder); for (k = 0, len1 = ref1.length; k < len1; k++) { ref2 = ref1[k], _ = ref2[0], constructor = ref2[1], definition = ref2[2]; binding = constructor(node, context, definition, element); if (binding) { element.bindings.push(binding) } } } if (newContextKey = Twine.getAttribute(node, "context")) { keypath = keypathForKey(node, newContextKey); if (keypath[0] === "$root") { context = rootContext; keypath = keypath.slice(1) } context = getValue(context, keypath) || setValue(context, keypath, {}) } if (element || newContextKey || forceSaveContext) { if (element == null) { element = findOrCreateElementForNode(node) } element.childContext = context; if (indexes != null) { if (element.indexes == null) { element.indexes = indexes } } } callbacks = currentBindingCallbacks; ref3 = node.children || []; for (l = 0, len2 = ref3.length; l < len2; l++) { childNode = ref3[l]; bind(context, childNode, newContextKey != null ? null : indexes) } Twine.count = nodeCount; ref4 = callbacks || []; for (m = 0, len3 = ref4.length; m < len3; m++) { callback = ref4[m]; callback() } currentBindingCallbacks = null; return Twine }; findOrCreateElementForNode = function (node) { var name1; if (node.bindingId == null) { node.bindingId = ++nodeCount } return elements[name1 = node.bindingId] != null ? elements[name1] : elements[name1] = {} }; Twine.refresh = function (callback) { if (callback) { refreshCallbacks.push(callback) } if (refreshQueued) { return } refreshQueued = true; return setTimeout(Twine.refreshImmediately, 0) }; refreshElement = function (element) { var j, len, obj, ref; if (element.bindings) { ref = element.bindings; for (j = 0, len = ref.length; j < len; j++) { obj = ref[j]; if (obj.refresh != null) { obj.refresh() } } } }; Twine.refreshImmediately = function () { var callbacks, cb, element, j, key, len; refreshQueued = false; for (key in elements) { element = elements[key]; refreshElement(element) } callbacks = refreshCallbacks; refreshCallbacks = []; for (j = 0, len = callbacks.length; j < len; j++) { cb = callbacks[j]; cb() } }; Twine.register = function (name, component) { if (registry[name]) { throw new Error("Twine error: '" + name + "' is already registered with Twine") } else { return registry[name] = component } }; Twine.change = function (node, bubble) { var event; if (bubble == null) { bubble = false } event = document.createEvent("HTMLEvents"); event.initEvent("change", bubble, true); return node.dispatchEvent(event) }; Twine.unbind = function (node) { var bindings, childNode, id, j, k, len, len1, obj, ref, ref1; if (id = node.bindingId) { if (bindings = (ref = elements[id]) != null ? ref.bindings : void 0) { for (j = 0, len = bindings.length; j < len; j++) { obj = bindings[j]; if (obj.teardown) { obj.teardown() } } } delete elements[id]; delete node.bindingId } ref1 = node.children || []; for (k = 0, len1 = ref1.length; k < len1; k++) { childNode = ref1[k]; Twine.unbind(childNode) } return this }; Twine.context = function (node) { return getContext(node, false) }; Twine.childContext = function (node) { return getContext(node, true) }; getContext = function (node, child) { var context, id, ref; while (node) { if (node === rootNode) { return rootContext } if (!child) { node = node.parentNode } if (!node) { console.warn("Unable to find context; please check that the node is attached to the DOM that Twine has bound, or that bindings have been initiated on this node's DOM"); return null } if ((id = node.bindingId) && (context = (ref = elements[id]) != null ? ref.childContext : void 0)) { return context } if (child) { node = node.parentNode } } }; getIndexesForElement = function (node) { var firstContext, id, ref; firstContext = null; while (node) { if (id = node.bindingId) { return (ref = elements[id]) != null ? ref.indexes : void 0 } node = node.parentNode } }; Twine.contextKey = function (node, lastContext) { var addKey, context, id, keys, ref; keys = []; addKey = function (context) { var key, val; for (key in context) { val = context[key]; if (!(lastContext === val)) { continue } keys.unshift(key); break } return lastContext = context }; while (node && node !== rootNode && (node = node.parentNode)) { if ((id = node.bindingId) && (context = (ref = elements[id]) != null ? ref.childContext : void 0)) { addKey(context) } } if (node === rootNode) { addKey(rootContext) } return keys.join(".") }; valuePropertyForNode = function (node) { var name, ref; name = node.nodeName.toLowerCase(); if (name === "input" || name === "textarea" || name === "select") { if ((ref = node.getAttribute("type")) === "checkbox" || ref === "radio") { return "checked" } else { return "value" } } else { return "textContent" } }; keypathForKey = function (node, key) { var end, i, j, keypath, len, ref, start; keypath = []; ref = key.split("."); for (i = j = 0, len = ref.length; j < len; i = ++j) { key = ref[i]; if ((start = key.indexOf("[")) !== -1) { if (i === 0) { keypath.push.apply(keypath, keyWithArrayIndex(key.substr(0, start), node)) } else { keypath.push(key.substr(0, start)) } key = key.substr(start); while ((end = key.indexOf("]")) !== -1) { keypath.push(parseInt(key.substr(1, end), 10)); key = key.substr(end + 1) } } else { if (i === 0) { keypath.push.apply(keypath, keyWithArrayIndex(key, node)) } else { keypath.push(key) } } } return keypath }; keyWithArrayIndex = function (key, node) { var index, ref, ref1; index = (ref = elements[node.bindingId]) != null ? (ref1 = ref.indexes) != null ? ref1[key] : void 0 : void 0; if (index != null) { return [key, index] } else { return [key] } }; getValue = function (object, keypath) { var j, key, len; for (j = 0, len = keypath.length; j < len; j++) { key = keypath[j]; if (object != null) { object = object[key] } } return object }; setValue = function (object, keypath, value) { var j, k, key, lastKey, len, ref; ref = keypath, keypath = 2 <= ref.length ? slice.call(ref, 0, j = ref.length - 1) : (j = 0, []), lastKey = ref[j++]; for (k = 0, len = keypath.length; k < len; k++) { key = keypath[k]; object = object[key] != null ? object[key] : object[key] = {} } return object[lastKey] = value }; stringifyNodeAttributes = function (node) { return [].map.call(node.attributes, function (attr) { return attr.name + "=" + JSON.stringify(attr.value) }).join(" ") }; wrapFunctionString = function (code, args, node) { var e, error, keypath; if (isKeypath(code) && (keypath = keypathForKey(node, code))) { if (keypath[0] === "$root") { return function ($context, $root) { return getValue($root, keypath) } } else { return function ($context, $root) { return getValue($context, keypath) } } } else { code = "return " + code; if (nodeArrayIndexes(node)) { code = "with($arrayPointers) { " + code + " }" } if (requiresRegistry(args)) { code = "with($registry) { " + code + " }" } try { return new Function(args, "with($context) { " + code + " }") } catch (error) { e = error; throw "Twine error: Unable to create function on " + node.nodeName + " node with attributes " + stringifyNodeAttributes(node) } } }; requiresRegistry = function (args) { return /\$registry/.test(args) }; nodeArrayIndexes = function (node) { var ref; return node.bindingId != null && ((ref = elements[node.bindingId]) != null ? ref.indexes : void 0) }; arrayPointersForNode = function (node, context) { var index, indexes, key, result; indexes = nodeArrayIndexes(node); if (!indexes) { return {} } result = {}; for (key in indexes) { index = indexes[key]; result[key] = context[key][index] } return result }; isKeypath = function (value) { return value !== "true" && value !== "false" && value !== "null" && value !== "undefined" && keypathRegex.test(value) }; isDataAttribute = function (value) { return value[0] === "d" && value[1] === "a" && value[2] === "t" && value[3] === "a" && value[4] === "-" }; fireCustomChangeEvent = function (node) { var event; event = document.createEvent("CustomEvent"); event.initCustomEvent("bindings:change", true, false, {}); return node.dispatchEvent(event) }; bindingOrder = function (arg, arg1) { var ORDERED_BINDINGS, firstType, secondType; firstType = arg[0]; secondType = arg1[0]; ORDERED_BINDINGS = { define: 1, bind: 2, eval: 3 }; if (!ORDERED_BINDINGS[firstType]) { return 1 } if (!ORDERED_BINDINGS[secondType]) { return -1 } return ORDERED_BINDINGS[firstType] - ORDERED_BINDINGS[secondType] }; Twine.bindingTypes = { bind: function (node, context, definition) { var changeHandler, checkedValueType, fn, keypath, lastValue, oldValue, refresh, refreshContext, teardown, twoWayBinding, value, valueProp; valueProp = valuePropertyForNode(node); value = node[valueProp]; lastValue = void 0; teardown = void 0; checkedValueType = node.getAttribute("type") === "radio"; fn = wrapFunctionString(definition, "$context,$root,$arrayPointers", node); refresh = function () { var newValue; newValue = fn.call(node, context, rootContext, arrayPointersForNode(node, context)); if (newValue === lastValue) { return } lastValue = newValue; if (newValue === node[valueProp]) { return } node[valueProp] = checkedValueType ? newValue === node.value : newValue; return fireCustomChangeEvent(node) }; if (!isKeypath(definition)) { return { refresh: refresh } } refreshContext = function () { if (checkedValueType) { if (!node.checked) { return } return setValue(context, keypath, node.value) } else { return setValue(context, keypath, node[valueProp]) } }; keypath = keypathForKey(node, definition); twoWayBinding = valueProp !== "textContent" && node.type !== "hidden"; if (keypath[0] === "$root") { context = rootContext; keypath = keypath.slice(1) } if (value != null && (twoWayBinding || value !== "") && (oldValue = getValue(context, keypath)) == null) { refreshContext() } if (twoWayBinding) { changeHandler = function () { if (getValue(context, keypath) === this[valueProp]) { return } refreshContext(); return Twine.refreshImmediately() }; jQuery(node).on("input keyup change", changeHandler); teardown = function () { return jQuery(node).off("input keyup change", changeHandler) } } return { refresh: refresh, teardown: teardown } }, "bind-show": function (node, context, definition) { var fn, lastValue; fn = wrapFunctionString(definition, "$context,$root,$arrayPointers", node); lastValue = void 0; return { refresh: function () { var newValue; newValue = !fn.call(node, context, rootContext, arrayPointersForNode(node, context)); if (newValue === lastValue) { return } return jQuery(node).toggleClass("hide", lastValue = newValue) } } }, "bind-class": function (node, context, definition) { var $node, fn, lastValues; fn = wrapFunctionString(definition, "$context,$root,$arrayPointers", node); lastValues = {}; $node = jQuery(node); return { refresh: function () { var additions, currValue, key, newValue, newValues, ref, removals, value; newValues = fn.call(node, context, rootContext, arrayPointersForNode(node, context)); additions = []; removals = []; for (key in newValues) { value = newValues[key]; newValue = newValues[key] = !!newValues[key]; currValue = (ref = lastValues[key]) != null ? ref : $node.hasClass(key); if (currValue !== newValue) { if (newValue) { additions.push(key) } else { removals.push(key) } } } if (removals.length) { $node.removeClass(removals.join(" ")) } if (additions.length) { $node.addClass(additions.join(" ")) } return lastValues = newValues } } }, "bind-attribute": function (node, context, definition) { var fn, lastValue; fn = wrapFunctionString(definition, "$context,$root,$arrayPointers", node); lastValue = {}; return { refresh: function () { var key, newValue, value; newValue = fn.call(node, context, rootContext, arrayPointersForNode(node, context)); for (key in newValue) { value = newValue[key]; if (lastValue[key] !== value) { jQuery(node).attr(key, value || null) } } return lastValue = newValue } } }, define: function (node, context, definition) { var fn, key, object, value; fn = wrapFunctionString(definition, "$context,$root,$registry,$arrayPointers", node); object = fn.call(node, context, rootContext, registry, arrayPointersForNode(node, context)); for (key in object) { value = object[key]; context[key] = value } }, eval: function (node, context, definition) { var fn; fn = wrapFunctionString(definition, "$context,$root,$registry,$arrayPointers", node); fn.call(node, context, rootContext, registry, arrayPointersForNode(node, context)) } }; defineArray = function (node, context, definition) { var fn, indexes, key, object, value; fn = wrapFunctionString(definition, "$context,$root", node); object = fn.call(node, context, rootContext); indexes = {}; for (key in object) { value = object[key]; if (context[key] == null) { context[key] = [] } if (!(context[key] instanceof Array)) { throw "Twine error: expected '" + key + "' to be an array" } indexes[key] = context[key].length; context[key].push(value) } return indexes }; setupPropertyBinding = function (attributeName, bindingName) { var booleanProp; booleanProp = attributeName === "checked" || attributeName === "indeterminate" || attributeName === "disabled" || attributeName === "readOnly" || attributeName === "draggable"; return Twine.bindingTypes["bind-" + bindingName.toLowerCase()] = function (node, context, definition) { var fn, lastValue; fn = wrapFunctionString(definition, "$context,$root,$arrayPointers", node); lastValue = void 0; return { refresh: function () { var newValue; newValue = fn.call(node, context, rootContext, arrayPointersForNode(node, context)); if (booleanProp) { newValue = !!newValue } if (newValue === lastValue) { return } node[attributeName] = lastValue = newValue; if (attributeName === "checked") { return fireCustomChangeEvent(node) } } } } }; ref = ["placeholder", "checked", "indeterminate", "disabled", "href", "title", "readOnly", "src", "draggable"]; for (j = 0, len = ref.length; j < len; j++) { attribute = ref[j]; setupPropertyBinding(attribute, attribute) } setupPropertyBinding("innerHTML", "unsafe-html"); preventDefaultForEvent = function (event) { var ref1; return (event.type === "submit" || event.currentTarget.nodeName.toLowerCase() === "a") && ((ref1 = Twine.getAttribute(event.currentTarget, "allow-default")) === "false" || ref1 === false || ref1 === 0 || ref1 === void 0 || ref1 === null) }; setupEventBinding = function (eventName) { return Twine.bindingTypes["bind-event-" + eventName] = function (node, context, definition) { var onEventHandler; onEventHandler = function (event, data) { var base, discardEvent; discardEvent = typeof (base = Twine.shouldDiscardEvent)[eventName] === "function" ? base[eventName](event) : void 0; if (discardEvent || preventDefaultForEvent(event)) { event.preventDefault() } if (discardEvent) { return } wrapFunctionString(definition, "$context,$root,$arrayPointers,event,data", node).call(node, context, rootContext, arrayPointersForNode(node, context), event, data); return Twine.refreshImmediately() }; jQuery(node).on(eventName, onEventHandler); return { teardown: function () { return jQuery(node).off(eventName, onEventHandler) } } } }; ref1 = ["click", "dblclick", "mouseenter", "mouseleave", "mouseover", "mouseout", "mousedown", "mouseup", "submit", "dragenter", "dragleave", "dragover", "drop", "drag", "change", "keypress", "keydown", "keyup", "input", "error", "done", "success", "fail", "blur", "focus", "load", "paste"]; for (k = 0, len1 = ref1.length; k < len1; k++) { eventName = ref1[k]; setupEventBinding(eventName) } return Twine }) }).call(this);
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bindings (Using Bizweb Twine)
        //
        // Js binding for Html document(ex: bind, binding event, bind-shown, bind-class,...)
        // ---------------------------------------------------------------------------------
        window.Bindings = window.Twine;
    }.call(this);

    // -----------------------
    // Page
    // -----------------------
    !function () {
        var t = function (t) {
            var e = {
                exports: {}
            };
            return t.call(e.exports, e, e.exports), e.exports
        },
        e = function () {
            function t(t, e) {
                var r = [],
                    n = !0,
                    o = !1,
                    i = undefined;
                try {
                    for (var u, a = t[Symbol.iterator]() ; !(n = (u = a.next()).done) && (r.push(u.value), !e || r.length !== e) ; n = !0);
                } catch (t) {
                    o = !0, i = t
                } finally {
                    try {
                        !n && a["return"] && a["return"]()
                    } finally {
                        if (o) throw i
                    }
                }
                return r
            }
            return function (e, r) {
                if (Array.isArray(e)) return e;
                if (Symbol.iterator in Object(e)) return t(e, r);
                throw new TypeError("Invalid attempt to destructure non-iterable instance")
            }
        }();
        t(function (t, n) {
            "use strict";

            function o() {
                var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {
                    return {}
                };
                h = t
            }

            function i(t) {
                location.href !== l && (c = {});
                var r = void 0;
                if (null != h && (r = h() || {}, Bindings.reset(r), t || Bindings.bind(), h = null), t) {
                    var n = !0,
                        o = !1,
                        i = undefined;
                    try {
                        //Twine.reset(context).bind().refresh()
                        for (var u, a = t[Symbol.iterator]() ; !(n = (u = a.next()).done) ; n = !0) {
                            var d = u.value;
                            Bindings.bind(d)
                        }
                    } catch (t) {
                        o = !0, i = t
                    } finally {
                        try {
                            !n && a["return"] && a["return"]()
                        } finally {
                            if (o) throw i
                        }
                    }
                }
                var p = !0,
                    v = !1,
                    g = undefined;
                try {
                    for (var b, m = f[Symbol.iterator]() ; !(p = (b = m.next()).done) ; p = !0) {
                        var y = e(b.value, 2),
                            w = y[0];
                        (0, y[1])(w)
                    }
                } catch (t) {
                    v = !0, g = t
                } finally {
                    try {
                        !p && m["return"] && m["return"]()
                    } finally {
                        if (v) throw g
                    }
                }
                f.length = 0, Bindings.refreshImmediately(), r && "function" == typeof r.pageLoaded && r.pageLoaded()
            }
            Object.defineProperty(n, "__esModule", {
                value: !0
            }), n["default"] = o;
            var l = location.href,
                c = {},
                f = [],
                h = void 0;
            o.getLastUrl = function () {
                return l
            }, o.onRefresh = function (t) {
                for (var e = arguments.length, r = Array(e > 1 ? e - 1 : 0), n = 1; n < e; n++) r[n - 1] = arguments[n];
                var o = void 0,
                    i = void 0;
                r[1] ? (o = r[0], i = r[1]) : i = r[0], o && Bindings.afterBound(function () {
                    var e = Bindings.contextKey(o, t),
                        r = c[e];
                    r && f.push([r, i]), c[e] = t
                })
            }, o.pushState = function (t) {
                window.history.pushState({
                    turbolinks: !0,
                    url: t
                }, null, t)
            }, o.replaceState = function (t) {
                window.history.replaceState({
                    turbolinks: !0,
                    url: t
                }, null, t)
            }, o.openPopup = function (t, e, r) {
                var n = {
                    width: 500,
                    height: 500,
                    directories: "no",
                    location: "no",
                    menubar: "no",
                    resizeable: "yes",
                    scrollbars: "yes",
                    toolbar: "no",
                    status: "no"
                },
                    i = _.defaults(r, n),
                    u = _.map(i, function (t, e) {
                        return e + "=" + t
                    }).toString();
                o.open(t, e, u)
            }, document.addEventListener("DOMContentLoaded", function () {
                return i()
            }), document.addEventListener("page:load", function (t) {
                i(t.data),
                l = location.href
            }),
                document.addEventListener("page:before-partial-replace",
                function (t) {
                    var e = t.data,
                        r = !0,
                        n = !1,
                        o = undefined;
                    try {
                        for (var i, u = e[Symbol.iterator]() ; !(r = (i = u.next()).done) ; r = !0) {
                            var a = i.value;
                            Bindings.unbind(a)
                        }
                    } catch (t) {
                        n = !0, o = t
                    } finally {
                        try {
                            !r && u["return"] && u["return"]()
                        } finally {
                            if (n) throw o
                        }
                    }
                }),
                document.addEventListener("page:after-node-removed", function (t) {
                    return (0, $)(t.data).remove()
                }), (0, $)(document).ajaxComplete(function () {
                    return Bindings.refresh()
                }), window.Page = null != n["default"] ? n["default"] : n
        });
    }("undefined" != typeof global ? global : "undefined" != typeof window ? window : this);

    // -------------------------
    // Turbograft
    // -------------------------
    (function () {
        null == window.TurboGraft && (window.TurboGraft = {
            handlers: {}
        }), TurboGraft.tgAttribute = function (t) {
            return "tg-" === t.slice(0, 3) ? "data-" + t : "data-tg-" + t
        }, TurboGraft.getTGAttribute = function (t, e) {
            var r;
            return r = TurboGraft.tgAttribute(e), t.getAttribute(r) || t.getAttribute(e)
        }, TurboGraft.removeTGAttribute = function (t, e) {
            var r;
            return r = TurboGraft.tgAttribute(e), t.removeAttribute(r), t.removeAttribute(e)
        }, TurboGraft.hasTGAttribute = function (t, e) {
            var r;
            return r = TurboGraft.tgAttribute(e), t.hasAttribute(r) || t.hasAttribute(e)
        }, TurboGraft.querySelectorAllTGAttribute = function (t, e, r) {
            var n;
            return null == r && (r = null), n = TurboGraft.tgAttribute(e), r ? t.querySelectorAll("[" + n + "=" + r + "], [" + e + "=" + r + "]") : t.querySelectorAll("[" + n + "], [" + e + "]")
        }
    }).call(this),
    function () {
        window.Click = function () {
            function t(t) {
                this.event = t, this.event.defaultPrevented || (this._extractLink(), this._validForTurbolinks() && (Turbolinks.visit(this.link.href), this.event.preventDefault()))
            }
            return t.installHandlerLast = function (e) {
                if (!e.defaultPrevented) return document.removeEventListener("click", t.handle, !1), document.addEventListener("click", t.handle, !1)
            }, t.handle = function (e) {
                return new t(e)
            }, t.prototype._extractLink = function () {
                var t;
                for (t = this.event.target; t.parentNode && "A" !== t.nodeName;) t = t.parentNode;
                if ("A" === t.nodeName && 0 !== t.href.length) return this.link = new Link(t)
            }, t.prototype._validForTurbolinks = function () {
                return null != this.link && !(this.link.shouldIgnore() || this._nonStandardClick())
            }, t.prototype._nonStandardClick = function () {
                return this.event.which > 1 || this.event.metaKey || this.event.ctrlKey || this.event.shiftKey || this.event.altKey
            }, t
        }()
    }.call(this),
    function () {
        window.ComponentUrl = function () {
            function t(e) {
                if (this.original = null != e ? e : document.location.href, this.original.constructor === t) return this.original;
                this._parse()
            }
            return t.prototype.withoutHash = function () {
                return this.href.replace(this.hash, "")
            }, t.prototype.withoutHashForIE10compatibility = function () {
                return this.withoutHash()
            }, t.prototype.hasNoHash = function () {
                return 0 === this.hash.length
            }, t.prototype._parse = function () {
                var t;
                return (null != this.link ? this.link : this.link = document.createElement("a")).href = this.original, t = this.link, this.href = t.href, this.protocol = t.protocol, this.host = t.host, this.hostname = t.hostname, this.port = t.port, this.pathname = t.pathname, this.search = t.search, this.hash = t.hash, this.origin = [this.protocol, "//", this.hostname].join(""), 0 !== this.port.length && (this.origin += ":" + this.port), this.relative = [this.pathname, this.search, this.hash].join(""), this.absolute = this.href
            }, t
        }()
    }.call(this),
    function () {
        window.CSRFToken = function () {
            function t() { }
            return t.get = function (t) {
                var e;
                return null == t && (t = document), {
                    node: e = t.querySelector('meta[name="csrf-token"]'),
                    token: null != e && "function" == typeof e.getAttribute ? e.getAttribute("content") : void 0
                }
            }, t.update = function (t) {
                var e;
                if (e = this.get(), null != e.token && null != t && e.token !== t) return e.node.setAttribute("content", t)
            }, t
        }()
    }.call(this),
    function () {
        TurboGraft.Document = {
            create: function (t) {
                var e;
                return /<(html|body)/i.test(t) ? (e = document.documentElement.cloneNode(), e.innerHTML = t) : (e = document.documentElement.cloneNode(!0), e.querySelector("body").innerHTML = t), e.head = e.querySelector("head"), e.body = e.querySelector("body"), e
            }
        }
    }.call(this),
    function () {
        var t, e, r, n;
        e = function (t, e) {
            return t.classList.contains(e)
        }, r = function (t) {
            return t.getAttribute("disabled") || e(t, "disabled")
        }, n = function (t, e, r) {
            var n, o;
            if (null == r && (r = null), !(n = t.getAttribute("href") || t.getAttribute("action"))) throw new Error("Turbograft developer error: You did not provide a URL ('" + urlAttribute + "' attribute) for data-tg-remote");
            return TurboGraft.getTGAttribute(t, "remote-once") && (TurboGraft.removeTGAttribute(t, "remote-once"), TurboGraft.removeTGAttribute(t, "tg-remote")), o = {
                httpRequestType: e,
                httpUrl: n,
                fullRefresh: null != TurboGraft.getTGAttribute(t, "full-refresh"),
                refreshOnSuccess: TurboGraft.getTGAttribute(t, "refresh-on-success"),
                refreshOnSuccessExcept: TurboGraft.getTGAttribute(t, "full-refresh-on-success-except"),
                refreshOnError: TurboGraft.getTGAttribute(t, "refresh-on-error"),
                refreshOnErrorExcept: TurboGraft.getTGAttribute(t, "full-refresh-on-error-except")
            }, new TurboGraft.Remote(o, r, t)
        }, TurboGraft.handlers.remoteMethodHandler = function (t) {
            var e, r, o;
            o = t.clickTarget, (e = TurboGraft.getTGAttribute(o, "tg-remote")) && (t.preventDefault(), r = n(o, e), r.submit())
        }, TurboGraft.handlers.remoteFormHandler = function (t) {
            var e, r, o;
            o = t.target, e = o.getAttribute("method"), TurboGraft.hasTGAttribute(o, "tg-remote") && (t.preventDefault(), r = n(o, e, o), r.submit())
        }, t = function (t, e, n) {
            return null == n && (n = !1), document.addEventListener(t, function (t) {
                var n, o;
                for (o = t.target; o !== document && null != o;) {
                    if (("A" === o.nodeName || "BUTTON" === o.nodeName) && (n = r(o), n && t.preventDefault(), !n)) return t.clickTarget = o, void e(t);
                    o = o.parentNode
                }
            })
        }, t("click", TurboGraft.handlers.remoteMethodHandler, !0), document.addEventListener("submit", function (t) {
            return TurboGraft.handlers.remoteFormHandler(t)
        })
    }.call(this),
    function () {
        var t = function (t, r) {
            function n() {
                this.constructor = t
            }
            for (var o in r) e.call(r, o) && (t[o] = r[o]);
            return n.prototype = r.prototype, t.prototype = new n, t.__super__ = r.prototype, t
        },
            e = {}.hasOwnProperty,
            r = [].slice;
        window.Link = function (e) {
            function n(t) {
                if (this.link = t, this.link.constructor === n) return this.link;
                this.original = this.link.href, n.__super__.constructor.apply(this, arguments)
            }
            return t(n, e), n.HTML_EXTENSIONS = ["html"], n.allowExtensions = function () {
                var t, e, o, i;
                for (e = 1 <= arguments.length ? r.call(arguments, 0) : [], o = 0, i = e.length; o < i; o++) t = e[o], n.HTML_EXTENSIONS.push(t);
                return n.HTML_EXTENSIONS
            }, n.prototype.shouldIgnore = function () {
                return this._crossOrigin() || this._anchored() || this._nonHtml() || this._optOut() || this._target()
            }, n.prototype._crossOrigin = function () {
                return this.origin !== (new ComponentUrl).origin
            }, n.prototype._anchored = function () {
                var t;
                return (this.hash && this.withoutHash()) === (t = new ComponentUrl).withoutHash() || this.href === t.href + "#"
            }, n.prototype._nonHtml = function () {
                return this.pathname.match(/\.[a-z]+$/g) && !this.pathname.match(new RegExp("\\.(?:" + n.HTML_EXTENSIONS.join("|") + ")?$", "g"))
            }, n.prototype._optOut = function () {
                var t, e;
                for (e = this.link; !t && e !== document && null !== e;) t = null != e.getAttribute("data-no-turbolink"), e = e.parentNode;
                return t
            }, n.prototype._target = function () {
                return 0 !== this.link.target.length
            }, n
        }(ComponentUrl)
    }.call(this),
    function () {
        var t, e, r;
        window.Page || (window.Page = {}), Page.visit = function (t, e) {
            return null == e && (e = {}), e.reload ? window.location = t : Turbolinks.visit(t)
        }, Page.refresh = function (t, e) {
            var r, n, o, i;
            return null == t && (t = {}), r = t.url ? t.url : t.queryParams ? (n = $.param(t.queryParams), n && (n = "?" + n), location.pathname + n) : location.href, o = {
                partialReplace: !0,
                exceptKeys: t.exceptKeys,
                onlyKeys: t.onlyKeys,
                updatePushState: t.updatePushState,
                callback: e
            }, (i = t.response) ? Turbolinks.loadPage(null, i, o) : Turbolinks.visit(r, o)
        }, Page.open = function () {
            return window.open.apply(window, arguments)
        }, r = [], Page.onReplace = function (t, n) {
            if (!t || !n) throw new Error("Page.onReplace: Node and callback must both be specified");
            if (!e(n)) throw new Error("Page.onReplace: Callback must be a function");
            return r.push({
                node: t,
                callback: n
            })
        }, e = function (t) {
            return !!(t && t.constructor && t.call && t.apply)
        }, t = function (t, e) {
            return t.contains ? t.contains(e) : !!(t === e || t.compareDocumentPosition(e) & Node.DOCUMENT_POSITION_CONTAINED_BY)
        }, document.addEventListener("page:before-partial-replace", function (e) {
            var n, o, i, u, a, s, l, c, f;
            for (c = e.data, f = [], i = 0, a = r.length; i < a; i++) {
                for (n = r[i], o = !1, u = 0, s = c.length; u < s; u++)
                    if (l = c[u], t(l, n.node)) {
                        n.callback(), o = !0;
                        break
                    }
                o || f.push(n)
            }
            return r = f
        }), document.addEventListener("page:before-replace", function () {
            var t, e, n;
            for (e = 0, n = r.length; e < n; e++) t = r[e], t.callback();
            return r = []
        })
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };
        TurboGraft.Remote = function () {
            function e(e, r, n) {
                var o, i, u, a;
                this.opts = e, this.onError = t(this.onError, this), this.onSuccess = t(this.onSuccess, this), this.initiator = r || n, this.actualRequestType = "get" === (null != (i = this.opts.httpRequestType) ? i.toLowerCase() : void 0) ? "GET" : "POST", this.useNativeEncoding = this.opts.useNativeEncoding, this.formData = this.createPayload(r), this.opts.refreshOnSuccess && (this.refreshOnSuccess = this.opts.refreshOnSuccess.split(" ")), this.opts.refreshOnSuccessExcept && (this.refreshOnSuccessExcept = this.opts.refreshOnSuccessExcept.split(" ")), this.opts.refreshOnError && (this.refreshOnError = this.opts.refreshOnError.split(" ")), this.opts.refreshOnErrorExcept && (this.refreshOnErrorExcept = this.opts.refreshOnErrorExcept.split(" ")), a = new XMLHttpRequest, "GET" === this.actualRequestType ? (u = this.formData ? this.opts.httpUrl + "?" + this.formData : this.opts.httpUrl, a.open(this.actualRequestType, u, !0)) : a.open(this.actualRequestType, this.opts.httpUrl, !0), a.setRequestHeader("X-Requested-With", "XMLHttpRequest"), a.setRequestHeader("Accept", "text/html, application/xhtml+xml, application/xml"), this.contentType && a.setRequestHeader("Content-Type", this.contentType), a.setRequestHeader("X-XHR-Referer", document.location.href), o = CSRFToken.get().token, o && a.setRequestHeader("X-CSRF-Token", o), triggerEventFor("turbograft:remote:init", this.initiator, {
                    xhr: a,
                    initiator: this.initiator
                }), a.addEventListener("loadstart", function (t) {
                    return function () {
                        return triggerEventFor("turbograft:remote:start", t.initiator, {
                            xhr: a
                        })
                    }
                }(this)), a.addEventListener("error", this.onError), a.addEventListener("load", function (t) {
                    return function (e) {
                        return a.status < 400 ? t.onSuccess(e) : t.onError(e)
                    }
                }(this)), a.addEventListener("loadend", function (t) {
                    return function () {
                        var e;
                        return "function" == typeof (e = t.opts).done && e.done(), triggerEventFor("turbograft:remote:always", t.initiator, {
                            initiator: t.initiator,
                            xhr: a
                        })
                    }
                }(this)), this.xhr = a
            }
            return e.prototype.submit = function () {
                return this.xhr.send(this.formData)
            }, e.prototype.createPayload = function (t) {
                var e;
                return e = t ? this.useNativeEncoding || t.querySelectorAll("[type='file'][name]").length > 0 ? this.nativeEncodeForm(t) : this.uriEncodeForm(t) : "", e instanceof FormData || (this.contentType = "application/x-www-form-urlencoded; charset=UTF-8", -1 === e.indexOf("_method") && this.opts.httpRequestType && "GET" !== this.actualRequestType && (e = this.formAppend(e, "_method", this.opts.httpRequestType))), e
            }, e.prototype.formAppend = function (t, e, r) {
                return t.length && (t += "&"), t += encodeURIComponent(e) + "=" + encodeURIComponent(r)
            }, e.prototype.uriEncodeForm = function (t) {
                var e;
                return e = "", this._iterateOverFormInputs(t, function (t) {
                    return function (r) {
                        return e = t.formAppend(e, r.name, r.value)
                    }
                }(this)), e
            }, e.prototype.formDataAppend = function (t, e) {
                var r, n, o, i;
                if ("file" === e.type)
                    for (i = e.files, n = 0, o = i.length; n < o; n++) r = i[n], t.append(e.name, r);
                else t.append(e.name, e.value);
                return t
            }, e.prototype.nativeEncodeForm = function (t) {
                var e;
                return e = new FormData, this._iterateOverFormInputs(t, function (t) {
                    return function (r) {
                        return e = t.formDataAppend(e, r)
                    }
                }(this)), e
            }, e.prototype._iterateOverFormInputs = function (t, e) {
                var r, n, o, i, u, a, s;
                for (i = this._enabledInputs(t), s = [], r = 0, u = i.length; r < u; r++) n = i[r], o = !n.disabled, a = "checkbox" === n.type || "radio" === n.type, o && n.name && (a && n.checked || !a) ? s.push(e(n)) : s.push(void 0);
                return s
            }, e.prototype._enabledInputs = function (t) {
                var e, r, n, o, i, u, a, s, l, c, f;
                if (f = "input:not([type='reset']):not([type='button']):not([type='submit']):not([type='image']), select, textarea", u = Array.prototype.slice.call(t.querySelectorAll(f)), r = Array.prototype.slice.call(TurboGraft.querySelectorAllTGAttribute(t, "tg-remote-noserialize")), !r.length) return u;
                for (e = r, o = 0, s = r.length; o < s; o++) c = r[o], e = e.concat(Array.prototype.slice.call(c.querySelectorAll(f)));
                for (n = [], a = 0, l = u.length; a < l; a++) i = u[a], e.indexOf(i) < 0 && n.push(i);
                return n
            }, e.prototype.onSuccess = function (t) {
                var e, r, n;
                return "function" == typeof (e = this.opts).success && e.success(), n = t.target, triggerEventFor("turbograft:remote:success", this.initiator, {
                    initiator: this.initiator,
                    xhr: n
                }), (r = n.getResponseHeader("X-Next-Redirect")) ? void Page.visit(r, {
                    reload: !0
                }) : TurboGraft.hasTGAttribute(this.initiator, "tg-remote-norefresh") ? void 0 : this.opts.fullRefresh && this.refreshOnSuccess ? Page.refresh({
                    onlyKeys: this.refreshOnSuccess
                }) : this.opts.fullRefresh ? Page.refresh() : this.refreshOnSuccess ? Page.refresh({
                    response: n,
                    onlyKeys: this.refreshOnSuccess
                }) : this.refreshOnSuccessExcept ? Page.refresh({
                    response: n,
                    exceptKeys: this.refreshOnSuccessExcept
                }) : Page.refresh({
                    response: n
                })
            }, e.prototype.onError = function (t) {
                var e, r;
                return "function" == typeof (e = this.opts).fail && e.fail(), r = t.target, triggerEventFor("turbograft:remote:fail", this.initiator, {
                    initiator: this.initiator,
                    xhr: r
                }), TurboGraft.hasTGAttribute(this.initiator, "tg-remote-norefresh") ? triggerEventFor("turbograft:remote:fail:unhandled", this.initiator, {
                    xhr: r
                }) : this.opts.fullRefresh && this.refreshOnError ? Page.refresh({
                    onlyKeys: this.refreshOnError
                }) : this.opts.fullRefresh ? Page.refresh() : this.refreshOnError ? Page.refresh({
                    response: r,
                    onlyKeys: this.refreshOnError
                }) : this.refreshOnErrorExcept ? Page.refresh({
                    response: r,
                    exceptKeys: this.refreshOnErrorExcept
                }) : triggerEventFor("turbograft:remote:fail:unhandled", this.initiator, {
                    xhr: r
                })
            }, e
        }()
    }.call(this),
    function () {
        TurboGraft.Response = function () {
            function t(t, e) {
                var r;
                this.xhr = t;
                r = e && e.withoutHash() !== this.xhr.responseURL ? this.xhr.responseURL : this.xhr.getResponseHeader("X-XHR-Redirected-To");
                this.finalURL = r || e;
            }
            return t.prototype.valid = function () {
                return this.hasRenderableHttpStatus() && this.hasValidContent()
            }, t.prototype.document = function () {
                if (this.valid()) return TurboGraft.Document.create(this.xhr.responseText)
            }, t.prototype.hasRenderableHttpStatus = function () {
                var t;
                return 422 === this.xhr.status || !(400 <= (t = this.xhr.status) && t < 600)
            }, t.prototype.hasValidContent = function () {
                var t;
                if (t = this.xhr.getResponseHeader("Content-Type")) return t.match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/);
                throw new Error("Error encountered for XHR Response: " + this)
            }, t.prototype.toString = function () {
                return "URL: " + this.xhr.responseURL + ", ReadyState: " + this.xhr.readyState + ", Headers: " + this.xhr.getAllResponseHeaders()
            }, t
        }(), TurboGraft.location = function () {
            return location.href
        }
    }.call(this),
    function () {
        var t, e, r, n, o, i, u, a, s, l, c, f, h, d, p, v = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };
        e = "[data-turbolinks-track]", r = "turbolinksTrack", t = "true", f = {}, c = null, p = function () {
            var t;
            return t = Object.keys(f).map(function (t) {
                return f[t]
            }), Promise.all(t)
        }, TurboGraft.TurboHead = function () {
            function e(t, e) {
                this.activeDocument = t, this.upstreamDocument = e, this._insertNewAssets = v(this._insertNewAssets, this), this.activeAssets = u(this.activeDocument), this.upstreamAssets = u(this.upstreamDocument), this.newScripts = this.upstreamAssets.filter(n("nodeName", "SCRIPT")).filter(s("src", this.activeAssets)), this.newLinks = this.upstreamAssets.filter(n("nodeName", "LINK")).filter(s("href", this.activeAssets))
            }
            return e._testAPI = {
                reset: function () {
                    return f = {}, c = null
                }
            }, e.prototype.hasChangedAnonymousAssets = function () {
                var e, n, i, u;
                return n = this.upstreamAssets.filter(o(r, t)), e = this.activeAssets.filter(o(r, t)), e.length !== n.length || (u = s("src", n), i = s("href", n), e.some(function (t) {
                    return u(t) || i(t)
                }))
            }, e.prototype.movingFromTrackedToUntracked = function () {
                return 0 === this.upstreamAssets.length && this.activeAssets.length > 0
            }, e.prototype.hasNamedAssetConflicts = function () {
                return this.newScripts.concat(this.newLinks).filter(l(r, t)).some(i(r, this.activeAssets))
            }, e.prototype.hasAssetConflicts = function () {
                return this.movingFromTrackedToUntracked() || this.hasNamedAssetConflicts() || this.hasChangedAnonymousAssets()
            }, e.prototype.waitForAssets = function () {
                return "function" == typeof c && c({
                    isCanceled: !0
                }), new Promise(function (t) {
                    return function (e) {
                        return c = e, p().then(t._insertNewAssets).then(p).then(e)
                    }
                }(this))
            }, e.prototype._insertNewAssets = function () {
                return h(this.activeDocument, this.newLinks), d(this.activeDocument, this.newScripts)
            }, e
        }(), u = function (t) {
            return [].slice.call(t.querySelectorAll(e))
        }, n = function (t, e) {
            return function (r) {
                return r[t] === e
            }
        }, s = function (t, e) {
            return function (r) {
                return !e.some(function (e) {
                    return r[t] === e[t]
                })
            }
        }, o = function (t, e) {
            return function (r) {
                return r.dataset[t] === e
            }
        }, l = function (t, e) {
            return function (r) {
                return r.dataset[t] !== e
            }
        }, i = function (t, e) {
            return function (r) {
                var n;
                return n = r.dataset[t], e.some(o(t, n))
            }
        }, h = function (t, e) {
            return e.forEach(function (e) {
                var r;
                return r = e.cloneNode(), t.head.appendChild(r), triggerEvent("page:after-link-inserted", r)
            })
        }, d = function (t, e) {
            var r;
            return r = Promise.resolve(), e.forEach(function (e) {
                return r = r.then(function () {
                    return a(t, e)
                })
            }), r
        }, a = function (t, e) {
            var r, n, o, i, u, a;
            if (a = e.src, f[a]) return f[a];
            for (i = t.createElement("SCRIPT"), u = e.attributes, n = 0, o = u.length; n < o; n++) r = u[n], i.setAttribute(r.name, r.value);
            return i.appendChild(t.createTextNode(e.innerHTML)), f[a] = new Promise(function (e) {
                var r;
                return r = function (t) {
                    return "error" === t.type && triggerEvent("page:#script-error", t), i.removeEventListener("load", r), i.removeEventListener("error", r), e()
                }, i.addEventListener("load", r), i.addEventListener("error", r), t.head.appendChild(i), triggerEvent("page:after-script-inserted", i)
            })
        }
    }.call(this),
    function () {
        var t, e, r, n, o, i, u, a, s, l, c, f, h, d, p, v;
        t = TurboGraft.Response, e = TurboGraft.TurboHead, l = window.jQuery, v = null, r = document, a = function () {
            return r.addEventListener("DOMContentLoaded", function () {
                return triggerEvent("page:change"), triggerEvent("page:update")
            }, !0)
        }, s = function () {
            if (void 0 !== l) return l(r).on("ajaxSuccess", function (t, e) {
                if (l.trim(e.responseText)) return triggerEvent("page:update")
            })
        }, u = void 0 !== window.history.state || navigator.userAgent.match(/Firefox\/2[6|7]/), o = window.history && window.history.pushState && window.history.replaceState && u, window.triggerEvent = function (t, e) {
            var n;
            return n = r.createEvent("Events"), e && (n.data = e), n.initEvent(t, !0, !0), r.dispatchEvent(n)
        }, window.triggerEventFor = function (t, e, n) {
            var o;
            return o = r.createEvent("Events"), n && (o.data = n), o.initEvent(t, !0, !0), e.dispatchEvent(o)
        }, c = function (t) {
            var e, n;
            return n = (null != (e = r.cookie.match(new RegExp(t + "=(\\w+)"))) ? e[1].toUpperCase() : void 0) || "", r.cookie = t + "=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/", n
        }, p = "GET" === (f = c("request_method")) || "" === f, i = o && p, n = r.addEventListener && r.createEvent, n && (a(), s()), d = function (t, e) {
            var r;
            return r = e.parentNode.replaceChild(t, e), triggerEvent("page:after-node-removed", r)
        }, h = function (t) {
            var e;
            return e = t.parentNode.removeChild(t), triggerEvent("page:after-node-removed", e)
        },
        window.Turbolinks = function () {
            function n() { }
            var o, u, a, s, l, c, f, p, g, b, m, y, w, T, E, x, A, S, k, R, G, C, L, P;
            return s = null, A = null,
            p = function (t, e) {
                if (null == e && (e = {}), !E(t)) return t = new ComponentUrl(t), G(), g(t, e)
            },
            w = function (t, e) {
                var r, n;
                return Boolean(e.partialReplace || (null != (r = e.onlyKeys) ? r.length : void 0) || (null != (n = e.exceptKeys) ? n.length : void 0))
            }, n.fullPageNavigate = function (t) {
                null != t && (t = new ComponentUrl(t).absolute, triggerEvent("page:before-full-refresh", {
                    url: t
                }), r.location.href = t)
            }, n.pushState = function (t, e, r) {
                return window.history.pushState(t, e, r)
            }, n.replaceState = function (t, e, r) {
                return window.history.replaceState(t, e, r)
            }, n.document = function (t) {
                return t && (r = t), r
            }, g = function (t, e) {
                var r, o, i;
                triggerEvent("page:fetch", {
                    url: t.absolute
                }), null != v && (v.readyState = 0, v.statusText = "abort", v.abort()), v = new XMLHttpRequest, v.open("GET", t.withoutHashForIE10compatibility(), !0), v.setRequestHeader("Accept", "text/html, application/xhtml+xml, application/xml"), v.setRequestHeader("X-XHR-Referer", A), null == e.headers && (e.headers = {}), o = e.headers;
                for (r in o) i = o[r], v.setRequestHeader(r, i);
                v.onload = function () {
                    return v.status >= 500 ? n.fullPageNavigate(t) : n.loadPage(t, v, e), v = null
                }, v.onerror = function () {
                    return "abort" === v.statusText ? void (v = null) : n.fullPageNavigate(t)
                }, v.send()
            }, n.loadPage = function (o, i, u) {
                var a, s, l;
                return null == u && (u = {}),
                    triggerEvent("page:receive"),
                    a = new t(i, o),
                    G(),
                    null == u.updatePushState && (u.updatePushState = !0),
                    u.partialReplace = w(a, u), (l = a.document()) ? u.partialReplace ? void P(l, a, u) : (s = new e(r, l),
                    s.hasAssetConflicts() ? n.fullPageNavigate(a.finalURL) : s.waitForAssets().then(function (t) {
                        if (!(null != t ? t.isCanceled : void 0)) return P(l, a, u)
                    })) : (triggerEvent("page:error", i), void n.fullPageNavigate(a.finalURL))
            }, P = function (t, e, r) {
                var o, i;
                return o = a(null != (i = t.querySelector("title")) ? i.textContent : void 0, C(t.querySelector("body")),
                    CSRFToken.get(t).token, "runScripts", r),
                    r.updatePushState && S(e.finalURL),
                    r.partialReplace || n.resetScrollPosition(),
                    "function" == typeof r.callback && r.callback(),
                    triggerEvent("page:load", o)
            }, a = function (t, e, n, i, u) {
                var a, c, h, p;
                if (null == u && (u = {}), t && (r.title = t), null != (h = u.onlyKeys) ? h.length : void 0) return c = [].concat(m(), b(u.onlyKeys)), a = R(c, e), o(a) && L(), a;
                R(m(), e), x(e), (null != (p = u.exceptKeys) ? p.length : void 0) ? k(u.exceptKeys, e) : l(e), triggerEvent("page:before-replace"), d(e, r.body), null != n && CSRFToken.update(n), L(), i && f(), s = window.history.state, triggerEvent("page:change"), triggerEvent("page:update")
            }, b = function (t) {
                var e, n, o, i, u, a, s, l;
                for (a = [], e = 0, i = t.length; e < i; e++)
                    for (o = t[e], l = TurboGraft.querySelectorAllTGAttribute(r, "refresh", o), n = 0, u = l.length; n < u; n++) s = l[n], a.push(s);
                return a
            }, m = function () {
                var t, e, n, o, i;
                for (n = [], i = TurboGraft.querySelectorAllTGAttribute(r, "refresh-always"), t = 0, e = i.length; t < e; t++) o = i[t], n.push(o);
                return n
            }, o = function (t) {
                var e, r, n;
                for (e = 0, r = t.length; e < r; e++)
                    if (n = t[e], n.querySelectorAll("input[autofocus], textarea[autofocus]").length > 0) return !0;
                return !1
            }, L = function () {
                var t, e;
                if ((t = (e = r.querySelectorAll("input[autofocus], textarea[autofocus]"))[e.length - 1]) && r.activeElement !== t) return t.focus()
            }, l = function (t) {
                var e, r, n, o;
                for (o = TurboGraft.querySelectorAllTGAttribute(t, "refresh-never"), e = 0, r = o.length; e < r; e++) n = o[e], h(n)
            }, R = function (t, e) {
                var r, n, o, i, u, a, s;
                for (triggerEvent("page:before-partial-replace", t), a = function (e) {
                        var r, n, o;
                        for (r = 0, n = t.length; r < n; r++)
                            if (o = t[r], e !== o && o.contains(e)) return !0;
                        return !1
                }, s = [], n = 0, o = t.length; n < o; n++)
                    if (r = t[n], !a(r)) {
                        if (!(u = r.getAttribute("id"))) throw new Error("Turbolinks refresh: Refresh key elements must have an id.");
                        (i = e.querySelector("#" + u)) ? (i = i.cloneNode(!0), d(i, r), "SCRIPT" === i.nodeName && "false" !== i.dataset.turbolinksEval ? c(i) : s.push(i)) : TurboGraft.hasTGAttribute(r, "refresh-always") || h(r)
                    }
                return s
            }, T = function (t, e) {
                var r, n, o, i, u, a;
                for (a = [], n = 0, o = e.length; n < o; n++) {
                    if (r = e[n], !(i = r.getAttribute("id"))) throw new Error("TurboGraft refresh: Kept nodes must have an id.");
                    (u = t.querySelector("#" + i)) ? a.push(d(r, u)) : a.push(void 0)
                }
                return a
            }, x = function (t) {
                var e, n, o, i, u;
                for (e = [], u = TurboGraft.querySelectorAllTGAttribute(r, "tg-static"), n = 0, o = u.length; n < o; n++) i = u[n], e.push(i);
                T(t, e)
            }, k = function (t, e) {
                var n, o, i, u, a, s, l, c;
                for (n = [], o = 0, a = t.length; o < a; o++)
                    for (u = t[o], c = TurboGraft.querySelectorAllTGAttribute(r, "refresh", u), i = 0, s = c.length; i < s; i++) l = c[i], n.push(l);
                T(e, n)
            }, f = function () {
                var t, e, n, o, i;
                for (i = Array.prototype.slice.call(r.body.querySelectorAll('script:not([data-turbolinks-eval="false"])')), t = 0, e = i.length; t < e; t++) o = i[t], "" !== (n = o.type) && "text/javascript" !== n || c(o)
            }, c = function (t) {
                var e, n, o, i, u, a, s;
                for (n = r.createElement("script"), s = t.attributes, o = 0, i = s.length; o < i; o++) e = s[o], n.setAttribute(e.name, e.value);
                n.appendChild(r.createTextNode(t.innerHTML)), a = t.parentNode, u = t.nextSibling, a.removeChild(t), a.insertBefore(n, u)
            }, C = function (t) {
                return t.innerHTML = t.innerHTML.replace(/<noscript[\S\s]*?<\/noscript>/gi, ""), t
            }, S = function (t) {
                (t = new ComponentUrl(t)).absolute !== A && n.pushState({
                    turbolinks: !0,
                    url: t.absolute
                }, "", t.absolute)
            }, G = function () {
                return A = r.location.href
            }, n.rememberCurrentUrl = function () {
                return n.replaceState({
                    turbolinks: !0,
                    url: r.location.href
                }, "", r.location.href)
            }, n.rememberCurrentState = function () {
                return s = window.history.state
            },
                function (t) {
                    return window.scrollTo(t.positionX, t.positionY)
                }, n.resetScrollPosition = function () {
                    return r.location.hash ? r.location.href = r.location.href : window.scrollTo(0, 0)
                }, E = function (t) {
                    return !triggerEvent("page:before-change", t)
                }, y = function (t) {
                    var e;
                    if (null != (e = t.state) ? e.turbolinks : void 0) return n.visit(t.target.location.href)
                }, u = function (t) {
                    return setTimeout(t, 500)
                }, i ? (n.visit = p, n.rememberCurrentUrl(), n.rememberCurrentState(), r.addEventListener("click", Click.installHandlerLast, !0), u(function () {
                    return window.addEventListener("popstate", y, !1)
                })) : n.visit = function (t) {
                    return r.location.href = t
                }, n
        }()
    }.call(this);

    // -------------------------
    // Common Util
    // -------------------------
    (function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Common
        //
        // Contains all common functions.
        // ---------------------------------------------------------------------------------
        window.Common = {
            include: function (array, obj) {
                if (!array)
                    return false;

                for (var i = 0; i < array.length; i++) {
                    if (array[i] == obj)
                        return true;
                }

                return false;
            },
            difference: function (array, obj) {
                var differents = [];

                for (var i = 0; i < array.length; i++) {
                    if (array[i] != obj)
                        differents.push(array[i]);
                }

                return differents;
            }
        };
    }).call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.Utility
        //
        // All Utility of Bizweb API.
        // ---------------------------------------------------------------------------------

        Bizweb.Utility = {
            loadAjax: function (url, ele, callback, options) {
                if (options == null) {
                    options = { hide: true };
                }

                if (Bizweb.Utility.ajax && options.abort)
                    Bizweb.Utility.ajax.abort();

                Bizweb.Utility.ajax = $.ajax({
                    url: url,
                    data: options.data,
                    beforeSend: function (xhr, request) {
                        if (options.pushState)
                            Page.pushState(request.url);
                    },
                    success: function (data) {
                        if (options.hide) {
                            Bizweb.Modal.hide();
                            $(".modal-backdrop.fade.in").remove();
                        }

                        if ($(ele).get(0)) {
                            Bindings.unbind($(ele).get(0));
                            var html = "";
                            var $data = $(data);
                            var $ele = $data.find(ele);
                            var title = null;

                            var match = data.match("<title>(.*?)</title>");
                            if (match != null && match.length > 0) {
                                title = match[1];
                            }
                            if ($ele.length > 0) {
                                html = $ele.html();
                            }
                            else {
                                html = data;
                            }
                            $(ele).html(html);
                            if (title != null && title != "") {
                                $("head title").html(title);
                            }
                            var javascript = $(data).find(".section-footer").html();
                            $(".section-footer").html(javascript);

                            Bindings.bind($(ele).get(0));

                            if (options.pageLoad)
                                $(document).trigger("page:load");

                            if (callback)
                                callback(data);
                        }
                    }
                });
            },
            getThumb: function (srcFile, type) {
                if (srcFile == "") {
                    return "";
                }
                if (srcFile.startsWith("//")) {
                    srcFile = "http:" + srcFile;
                }
                if (type.toLowerCase() == "original") {
                    srcFile = srcFile.replace("http://", "//").replace("https://", "//");
                    return srcFile;
                }
                var url = new URL(srcFile);
                var pathname = url.pathname + url.search;
                return Bizweb.routes.domain.thumb + type.toLowerCase() + pathname;
            },
            isNumeric: function (n) {
                return !isNaN(parseFloat(n)) && isFinite(n);
            },
            getParameter: function (name) {
                name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
                var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
                return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
            },
            isMobile: function () {
                return $(window).width() < 855;
            },
            toggleSidebar: function () {
                var navDrawer = Bindings.context(document.body).navDrawer;
                if (Bizweb.Utility.isMobile()) {
                    if (navDrawer) {
                        if (navDrawer.isOpen) {
                            navDrawer.close();
                        }
                        else {
                            navDrawer.open();
                        }
                    }
                }
                else {
                    $(".page-wrapper").toggleClass("page-hide-sidebar");
                    if (navDrawer && navDrawer.isOpen) {
                        navDrawer.close();
                    }
                }
            },
            hideSidebar: function () {
                var navDrawer = Bindings.context(document.body).navDrawer;
                if (Bizweb.Utility.isMobile()) {
                    if (navDrawer && navDrawer.isOpen) {
                        navDrawer.close();
                    }
                }
                else {
                    $(".page-wrapper").addClass("page-hide-sidebar");
                    if (navDrawer && navDrawer.isOpen) {
                        navDrawer.close();
                    }
                }
            },
            showSidebar: function () {
                var navDrawer = Bindings.context(document.body).navDrawer;
                if (Bizweb.Utility.isMobile()) {
                    if (navDrawer && !navDrawer.isOpen) {
                        navDrawer.open();
                    }
                }
                else {
                    $(".page-wrapper").removeClass("page-hide-sidebar");
                }
            },
            toggleMenu: function () {
                $(".page-wrapper").toggleClass("page-hide-menu");
            },
            showMenu: function () {
                $(".page-wrapper").removeClass("page-hide-menu");
            },
            hideMenu: function () {
                $(".page-wrapper").addClass("page-hide-menu");
            },
            getCookie: function (cname) {
                var name = cname + "=";
                var ca = document.cookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') c = c.substring(1);
                    if (c.indexOf(name) != -1) return c.substring(name.length, c.length);
                }
                return "";
            },
            setCookie: function (cname, cvalue, exdays) {
                var d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                var expires = "expires=" + d.toGMTString();
                document.cookie = cname + "=" + cvalue + "; " + expires;
            },
            decodeHtml: function (text) {
                return $('<textarea />').html(text).text();
            },
            changeUrl: function (url) {
                window.history.pushState(null, null, url);
            },
            scrollTo: function (e, speed) {
                if (!speed)
                    speed = 'fast';

                $('html, body').animate({ scrollTop: $(e).offset().top }, speed);
            },
            setParameter: function (key, value) {
                key = encodeURI(key); value = encodeURI(value);

                var kvp = document.location.search.substr(1).split('&');

                var i = kvp.length; var x; while (i--) {
                    x = kvp[i].split('=');

                    if (x[0] == key) {
                        x[1] = value;
                        kvp[i] = x.join('=');
                        break;
                    }
                }

                if (i < 0) { kvp[kvp.length] = [key, value].join('='); }

                window.history.pushState(null, null, document.location.pathname + "?" + kvp.filter(Boolean).join('&'));
            },
            money: function (amount, format) {
                return money(amount, format)
            },
            textMoneyWithSymbol: function (value, cultureCode) {
                Globalize.culture = Globalize.cultures[cultureCode];
                if (!Bizweb.Utility.isNumeric(value)) {
                    value = 0;
                }

                var formatedValue = Globalize.format(parseFloat(value), "c", Globalize.culture.name);
                if (Globalize.culture.numberFormat["."] == ",") {
                    formatedValue = formatedValue.replace(/\./g, '..');
                    formatedValue = formatedValue.replace(/,/g, ".");
                    formatedValue = formatedValue.replace(/\.\./g, ",");
                }
                formatedValue = formatedValue.replace("(", "-");
                formatedValue = formatedValue.replace(")", "");

                return formatedValue;
            }
        }
    }.call(this),

    // -------------------------
    // Bizweb Confirm
    // -------------------------
    function () {
        var e, t;
        t = [], e = function (e, t) {
            var n, i, r;
            return e.preventDefault(), i = e.originalEvent.data, n = new Bizweb.Confirm({
                link: i
            }), r = n.show(), r.done(function () {
                var e, i;
                for (e = 0, i = t.length; e < i; e++) (0, t[e])();
                return Turbolinks.visit(n.link())
            }), r.fail(function () {
                return n.hide()
            })
        },
            Page.onChange = function (e, n) {
                if (!_.isFunction(e) || !_.isFunction(n)) throw new Error("shouldTriggerCallback and doneCallback must both be functions");
                return t.push({
                    shouldTriggerCallback: e,
                    doneCallback: n
                })
            }, $(document).on("page:before-change", function (n) {
                var i, r;
                if (r = function () {
                    var e, n, r;
                    for (r = [],
                    e = 0,
                    n = t.length; e < n; e++)
                        i = t[e],
                        i.shouldTriggerCallback() && r.push(i.doneCallback);
                    return r
                }(),
                !_.isEmpty(r))
                    return e(n, r)
            }), $(window).on("beforeunload", function () {
                var e, n, i;
                for (n = 0, i = t.length; n < i; n++)
                    if (e = t[n], e.shouldTriggerCallback()) return "Bạn có chỉnh sửa chưa được lưu trên trang này. Nếu rời khỏi trang này, tất cả chỉnh sửa sẽ không được lưu."
            })
    }.call(this);
}

!function (e) {
    var t = function (e) {
        var t = {
            exports: {}
        };
        return e.call(t.exports, t, t.exports), t.exports
    },
        n = function (e) {
            return e && e.__esModule ? e : {
                "default": e
            }
        },
        i = function () {
            function e(e, t) {
                var n = [],
                    i = !0,
                    r = !1,
                    o = undefined;
                try {
                    for (var a, s = e[Symbol.iterator]() ; !(i = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t) ; i = !0);
                } catch (e) {
                    r = !0, o = e
                } finally {
                    try {
                        !i && s["return"] && s["return"]()
                    } finally {
                        if (r) throw o
                    }
                }
                return n
            }
            return function (t, n) {
                if (Array.isArray(t)) return t;
                if (Symbol.iterator in Object(t)) return e(t, n);
                throw new TypeError("Invalid attempt to destructure non-iterable instance")
            }
        }(),
        r = function () {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var i = t[n];
                    i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                }
            }
            return function (t, n, i) {
                return n && e(t.prototype, n), i && e(t, i), t
            }
        }(),
        o = function (e, t) {
            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
        },
        a = function (e) {
            if (e && e.__esModule) return e;
            var t = {};
            if (null != e)
                for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
            return t["default"] = e, t
        },
        s = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) {
            return typeof e
        } : function (e) {
            return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
        },
        u = function (e, t) {
            if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function, not " + typeof t);
            e.prototype = Object.create(t && t.prototype, {
                constructor: {
                    value: e,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), t && (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : e.__proto__ = t)
        },
        l = function (e, t) {
            if (!e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !t || "object" != typeof t && "function" != typeof t ? e : t
        },
        c = Object.assign || function (e) {
            for (var t = 1; t < arguments.length; t++) {
                var n = arguments[t];
                for (var i in n) Object.prototype.hasOwnProperty.call(n, i) && (e[i] = n[i])
            }
            return e
        },
        p = t(function (e, t) {
            "use strict";

            function n(e) {
                return i.find(function (t) {
                    return t.code === e
                })
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.getCurrency = n;
            var i = t.CURRENCIES = [{
                code: "USD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "EUR",
                money_format: "\u20ac{{amount_with_comma_separator}}",
                money_in_emails_format: "\u20ac{{amount_with_comma_separator}}",
                symbol: "\u20ac",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "GBP",
                money_format: "\xa3{{amount}}",
                money_in_emails_format: "\xa3{{amount}}",
                symbol: "\xa3",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "CAD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "AFN",
                money_format: "{{amount}}\u060b",
                money_in_emails_format: "{{amount}}\u060b",
                symbol: "\u060b",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "ALL",
                money_format: "Lek {{amount}}",
                money_in_emails_format: "Lek {{amount}}",
                symbol: "L",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "DZD",
                money_format: "DA {{amount}}",
                money_in_emails_format: "DA {{amount}}",
                symbol: "\u062f.\u062c",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "AOA",
                money_format: "Kz{{amount}}",
                money_in_emails_format: "Kz{{amount}}",
                symbol: "Kz",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "ARS",
                money_format: "${{amount_with_comma_separator}}",
                money_in_emails_format: "${{amount_with_comma_separator}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "AMD",
                money_format: "{{amount}} AMD",
                money_in_emails_format: "{{amount}} AMD",
                symbol: "\u0564\u0580.",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "AWG",
                money_format: "Afl{{amount}}",
                money_in_emails_format: "Afl{{amount}}",
                symbol: "\u0192",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "AUD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BBD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "AZN",
                money_format: "m.{{amount}}",
                money_in_emails_format: "m.{{amount}}",
                symbol: "\u20bc",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BDT",
                money_format: "Tk {{amount}}",
                money_in_emails_format: "Tk {{amount}}",
                symbol: "\u09f3",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BSD",
                money_format: "BS${{amount}}",
                money_in_emails_format: "BS${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BHD",
                money_format: "{{amount}}0 BD",
                money_in_emails_format: "{{amount}}0 BD",
                symbol: "\u0628.\u062f",
                subunit_to_unit: 1e3,
                decimal_mark: "."
            }, {
                code: "BYR",
                money_format: "Br {{amount}}",
                money_in_emails_format: "Br {{amount}}",
                symbol: "Br",
                subunit_to_unit: 1,
                decimal_mark: ","
            }, {
                code: "BZD",
                money_format: "BZ${{amount}}",
                money_in_emails_format: "BZ${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BTN",
                money_format: "Nu {{amount}}",
                money_in_emails_format: "Nu {{amount}}",
                symbol: "Nu.",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BAM",
                money_format: "KM {{amount_with_comma_separator}}",
                money_in_emails_format: "KM {{amount_with_comma_separator}}",
                symbol: "\u041a\u041c",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BRL",
                money_format: "R$ {{amount_with_comma_separator}}",
                money_in_emails_format: "R$ {{amount_with_comma_separator}}",
                symbol: "R$",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "BOB",
                money_format: "Bs{{amount_with_comma_separator}}",
                money_in_emails_format: "Bs{{amount_with_comma_separator}}",
                symbol: "Bs.",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BWP",
                money_format: "P{{amount}}",
                money_in_emails_format: "P{{amount}}",
                symbol: "P",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BND",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "BGN",
                money_format: "{{amount}} \u043b\u0432",
                money_in_emails_format: "{{amount}} \u043b\u0432",
                symbol: "\u043b\u0432.",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MMK",
                money_format: "K{{amount}}",
                money_in_emails_format: "K{{amount}}",
                symbol: "K",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "KHR",
                money_format: "KHR{{amount}}",
                money_in_emails_format: "KHR{{amount}}",
                symbol: "\u17db",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "CVE",
                money_format: "{{amount_with_space_separator}}$",
                money_in_emails_format: "{{amount_with_space_separator}}$",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "KYD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "XAF",
                money_format: "FCFA{{amount}}",
                money_in_emails_format: "FCFA{{amount}}",
                symbol: "Fr",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "CLP",
                money_format: "${{amount_no_decimals}}",
                money_in_emails_format: "${{amount_no_decimals}}",
                symbol: "$",
                subunit_to_unit: 1,
                decimal_mark: ","
            }, {
                code: "CNY",
                money_format: "\xa5{{amount}}",
                money_in_emails_format: "\xa5{{amount}}",
                symbol: "\xa5",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "COP",
                money_format: "${{amount_with_comma_separator}}",
                money_in_emails_format: "${{amount_with_comma_separator}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "KMF",
                money_format: "{{amount_with_comma_separator}} CF",
                money_in_emails_format: "{{amount_with_comma_separator}} CF",
                symbol: "Fr",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "CDF",
                money_format: "FC{{amount}}",
                money_in_emails_format: "FC{{amount}}",
                symbol: "Fr",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "CRC",
                money_format: "\u20a1 {{amount_with_comma_separator}}",
                money_in_emails_format: "\u20a1 {{amount_with_comma_separator}}",
                symbol: "\u20a1",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "HRK",
                money_format: "{{amount_with_comma_separator}} kn",
                money_in_emails_format: "{{amount_with_comma_separator}} kn",
                symbol: "kn",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "CZK",
                money_format: "{{amount_with_comma_separator}} K\u010d",
                money_in_emails_format: "{{amount_with_comma_separator}} K\u010d",
                symbol: "K\u010d",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "DKK",
                money_format: "{{amount_with_comma_separator}} kr",
                money_in_emails_format: "{{amount_with_comma_separator}} kr",
                symbol: "kr.",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "DOP",
                money_format: "RD$ {{amount}}",
                money_in_emails_format: "RD$ {{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "XCD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "EGP",
                money_format: "LE {{amount}}",
                money_in_emails_format: "LE {{amount}}",
                symbol: "\u062c.\u0645",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "ETB",
                money_format: "Br{{amount}}",
                money_in_emails_format: "Br{{amount}}",
                symbol: "Br",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "XPF",
                money_format: "{{amount_no_decimals_with_space_separator}} XPF",
                money_in_emails_format: "{{amount_no_decimals_with_space_separator}} XPF",
                symbol: "Fr",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "FJD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "GMD",
                money_format: "D {{amount}}",
                money_in_emails_format: "D {{amount}}",
                symbol: "D",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "GHS",
                money_format: "GH\u20b5{{amount}}",
                money_in_emails_format: "GH\u20b5{{amount}}",
                symbol: "\u20b5",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "GTQ",
                money_format: "Q{{amount}}",
                money_in_emails_format: "Q{{amount}}",
                symbol: "Q",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "GYD",
                money_format: "G${{amount}}",
                money_in_emails_format: "G${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "GEL",
                money_format: "{{amount}} GEL",
                money_in_emails_format: "{{amount}} GEL",
                symbol: "\u10da",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "HTG",
                money_format: "G {{amount}}",
                money_in_emails_format: "G {{amount}}",
                symbol: "G",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "HNL",
                money_format: "L {{amount}}",
                money_in_emails_format: "L {{amount}}",
                symbol: "L",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "HKD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "HUF",
                money_format: "{{amount_no_decimals_with_comma_separator}}",
                money_in_emails_format: "{{amount_no_decimals_with_comma_separator}}",
                symbol: "Ft",
                subunit_to_unit: 1,
                decimal_mark: ","
            }, {
                code: "ISK",
                money_format: "{{amount_no_decimals}} kr",
                money_in_emails_format: "{{amount_no_decimals}} kr",
                symbol: "kr",
                subunit_to_unit: 1,
                decimal_mark: ","
            }, {
                code: "INR",
                money_format: "Rs. {{amount}}",
                money_in_emails_format: "Rs. {{amount}}",
                symbol: "\u20b9",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "IDR",
                money_format: "{{amount_with_comma_separator}}",
                money_in_emails_format: "{{amount_with_comma_separator}}",
                symbol: "Rp",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "ILS",
                money_format: "{{amount}} NIS",
                money_in_emails_format: "{{amount}} NIS",
                symbol: "\u20aa",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "JMD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "JPY",
                money_format: "\xa5{{amount_no_decimals}}",
                money_in_emails_format: "\xa5{{amount_no_decimals}}",
                symbol: "\xa5",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "JEP",
                money_format: "\xa3{{amount}}",
                money_in_emails_format: "\xa3{{amount}}",
                symbol: "\xa3",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "JOD",
                money_format: "{{amount}}0 JD",
                money_in_emails_format: "{{amount}}0 JD",
                symbol: "\u062f.\u0627",
                subunit_to_unit: 1e3,
                decimal_mark: "."
            }, {
                code: "KZT",
                money_format: "{{amount}} KZT",
                money_in_emails_format: "{{amount}} KZT",
                symbol: "\u3012",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "KES",
                money_format: "KSh{{amount}}",
                money_in_emails_format: "KSh{{amount}}",
                symbol: "KSh",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "KWD",
                money_format: "{{amount}}0 KD",
                money_in_emails_format: "{{amount}}0 KD",
                symbol: "\u062f.\u0643",
                subunit_to_unit: 1e3,
                decimal_mark: "."
            }, {
                code: "KGS",
                money_format: "\u043b\u0432{{amount}}",
                money_in_emails_format: "\u043b\u0432{{amount}}",
                symbol: "som",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "LAK",
                money_format: "\u20ad{{amount}}",
                money_in_emails_format: "\u20ad{{amount}}",
                symbol: "\u20ad",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "LVL",
                money_format: "Ls {{amount}}",
                money_in_emails_format: "Ls {{amount}}",
                symbol: "Ls",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "LBP",
                money_format: "L\xa3{{amount}}",
                money_in_emails_format: "L\xa3{{amount}}",
                symbol: "\u0644.\u0644",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "LSL",
                money_format: "M{{amount}}",
                money_in_emails_format: "M{{amount}}",
                symbol: "L",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "LRD",
                money_format: "L${{amount}}",
                money_in_emails_format: "L${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "LTL",
                money_format: "{{amount}} Lt",
                money_in_emails_format: "{{amount}} Lt",
                symbol: "Lt",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MGA",
                money_format: "Ar {{amount}}",
                money_in_emails_format: "Ar {{amount}}",
                symbol: "Ar",
                subunit_to_unit: 5,
                decimal_mark: "."
            }, {
                code: "MKD",
                money_format: "\u0434\u0435\u043d {{amount}}",
                money_in_emails_format: "\u0434\u0435\u043d {{amount}}",
                symbol: "\u0434\u0435\u043d",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MOP",
                money_format: "MOP${{amount}}",
                money_in_emails_format: "MOP${{amount}}",
                symbol: "P",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MWK",
                money_format: "Mk{{amount}}",
                money_in_emails_format: "Mk{{amount}}",
                symbol: "MK",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MVR",
                money_format: "Rf{{amount}}",
                money_in_emails_format: "Rf{{amount}}",
                symbol: "MVR",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MXN",
                money_format: "$ {{amount}}",
                money_in_emails_format: "$ {{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MYR",
                money_format: "RM{{amount}} MYR",
                money_in_emails_format: "RM{{amount}} MYR",
                symbol: "RM",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MUR",
                money_format: "Rs {{amount}}",
                money_in_emails_format: "Rs {{amount}}",
                symbol: "\u20a8",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MDL",
                money_format: "{{amount}} MDL",
                money_in_emails_format: "{{amount}} MDL",
                symbol: "L",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MAD",
                money_format: "{{amount}} dh",
                money_in_emails_format: "{{amount}} dh",
                symbol: "\u062f.\u0645.",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MNT",
                money_format: "{{amount_no_decimals}} \u20ae",
                money_in_emails_format: "{{amount_no_decimals}} \u20ae",
                symbol: "\u20ae",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "MZN",
                money_format: "{{amount}} Mt",
                money_in_emails_format: "{{amount}} Mt",
                symbol: "MTn",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "NAD",
                money_format: "N${{amount}}",
                money_in_emails_format: "N${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "NPR",
                money_format: "Rs{{amount}}",
                money_in_emails_format: "Rs{{amount}}",
                symbol: "\u20a8",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "ANG",
                money_format: "\u0192;{{amount}}",
                money_in_emails_format: "\u0192{{amount}}",
                symbol: "\u0192",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "NZD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "NIO",
                money_format: "C${{amount}}",
                money_in_emails_format: "C${{amount}}",
                symbol: "C$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "NGN",
                money_format: "\u20a6{{amount}}",
                money_in_emails_format: "\u20a6{{amount}}",
                symbol: "\u20a6",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "NOK",
                money_format: "{{amount_with_comma_separator}} kr",
                money_in_emails_format: "{{amount_with_comma_separator}} kr",
                symbol: "kr",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "OMR",
                money_format: "{{amount_with_comma_separator}}0 OMR",
                money_in_emails_format: "{{amount_with_comma_separator}}0 OMR",
                symbol: "\u0631.\u0639.",
                subunit_to_unit: 1e3,
                decimal_mark: "."
            }, {
                code: "PKR",
                money_format: "Rs.{{amount}}",
                money_in_emails_format: "Rs.{{amount}}",
                symbol: "\u20a8",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "PGK",
                money_format: "K {{amount}}",
                money_in_emails_format: "K {{amount}}",
                symbol: "K",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "PYG",
                money_format: "Gs. {{amount_no_decimals_with_comma_separator}}",
                money_in_emails_format: "Gs. {{amount_no_decimals_with_comma_separator}}",
                symbol: "\u20b2",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "PEN",
                money_format: "S/. {{amount}}",
                money_in_emails_format: "S/. {{amount}}",
                symbol: "S/.",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "PHP",
                money_format: "\u20b1{{amount}}",
                money_in_emails_format: "\u20b1{{amount}}",
                symbol: "\u20b1",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "PLN",
                money_format: "{{amount_with_comma_separator}} zl",
                money_in_emails_format: "{{amount_with_comma_separator}} zl",
                symbol: "z\u0142",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "QAR",
                money_format: "QAR {{amount_with_comma_separator}}",
                money_in_emails_format: "QAR {{amount_with_comma_separator}}",
                symbol: "\u0631.\u0642",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "RON",
                money_format: "{{amount_with_comma_separator}} lei",
                money_in_emails_format: "{{amount_with_comma_separator}} lei",
                symbol: "Lei",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "RUB",
                money_format: "\u0440\u0443\u0431{{amount_with_comma_separator}}",
                money_in_emails_format: "\u0440\u0443\u0431{{amount_with_comma_separator}}",
                symbol: "\u20bd",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "RWF",
                money_format: "{{amount_no_decimals}} RF",
                money_in_emails_format: "{{amount_no_decimals}} RF",
                symbol: "FRw",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "WST",
                money_format: "WS$ {{amount}}",
                money_in_emails_format: "WS$ {{amount}}",
                symbol: "T",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SAR",
                money_format: "{{amount}} SR",
                money_in_emails_format: "{{amount}} SR",
                symbol: "\u0631.\u0633",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "STD",
                money_format: "Db {{amount}}",
                money_in_emails_format: "Db {{amount}}",
                symbol: "Db",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "RSD",
                money_format: "{{amount}} RSD",
                money_in_emails_format: "{{amount}} RSD",
                symbol: "\u0420\u0421\u0414",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SCR",
                money_format: "Rs {{amount}}",
                money_in_emails_format: "Rs {{amount}}",
                symbol: "\u20a8",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SGD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SDG",
                money_format: "{{amount}} SD",
                money_in_emails_format: "{{amount}} SD",
                symbol: "\xa3",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SYP",
                money_format: "S\xa3{{amount}}",
                money_in_emails_format: "S\xa3{{amount}}",
                symbol: "\xa3S",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "ZAR",
                money_format: "R {{amount}}",
                money_in_emails_format: "R {{amount}}",
                symbol: "R",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "KRW",
                money_format: "\u20a9{{amount_no_decimals}}",
                money_in_emails_format: "\u20a9{{amount_no_decimals}}",
                symbol: "\u20a9",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "SSP",
                money_format: "{{amount}} SSP",
                money_in_emails_format: "{{amount}} SSP",
                symbol: "\xa3",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SBD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "LKR",
                money_format: "Rs {{amount}}",
                money_in_emails_format: "Rs {{amount}}",
                symbol: "\u20a8",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SRD",
                money_format: "SRD {{amount_with_comma_separator}}",
                money_in_emails_format: "SRD {{amount_with_comma_separator}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SZL",
                money_format: "L {{amount}}",
                money_in_emails_format: "L {{amount}}",
                symbol: "E",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "SEK",
                money_format: "{{amount_no_decimals}} kr",
                money_in_emails_format: "{{amount_no_decimals}} kr",
                symbol: "kr",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "CHF",
                money_format: "SFr. {{amount}}",
                money_in_emails_format: "SFr. {{amount}}",
                symbol: "CHF",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "TWD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "THB",
                money_format: "{{amount}} \u0e3f",
                money_in_emails_format: "{{amount}} \u0e3f",
                symbol: "\u0e3f",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "TZS",
                money_format: "{{amount}} TZS",
                money_in_emails_format: "{{amount}} TZS",
                symbol: "Sh",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "TTD",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "TND",
                money_format: "{{amount}}0",
                money_in_emails_format: "{{amount}}0",
                symbol: "\u062f.\u062a",
                subunit_to_unit: 1e3,
                decimal_mark: "."
            }, {
                code: "TRY",
                money_format: "{{amount}}TL",
                money_in_emails_format: "{{amount}}TL",
                symbol: "\u20ba",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "TMT",
                money_format: "{{amount}}T",
                money_in_emails_format: "{{amount}}T",
                symbol: "T",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "UGX",
                money_format: "Ush {{amount_no_decimals}}",
                money_in_emails_format: "Ush {{amount_no_decimals}}",
                symbol: "USh",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "UAH",
                money_format: "\u20b4{{amount}}",
                money_in_emails_format: "\u20b4{{amount}}",
                symbol: "\u20b4",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "AED",
                money_format: "Dhs. {{amount}}",
                money_in_emails_format: "Dhs. {{amount}}",
                symbol: "\u062f.\u0625",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "UYU",
                money_format: "${{amount_with_comma_separator}}",
                money_in_emails_format: "${{amount_with_comma_separator}}",
                symbol: "$",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "UZS",
                money_format: "{{amount_no_decimals_with_space_separator}} som",
                money_in_emails_format: "{{amount_no_decimals_with_space_separator}} som",
                symbol: "",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "VUV",
                money_format: "${{amount}}",
                money_in_emails_format: "${{amount}}",
                symbol: "Vt",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "VEF",
                money_format: "Bs. {{amount_with_comma_separator}}",
                money_in_emails_format: "Bs. {{amount_with_comma_separator}}",
                symbol: "Bs.F.",
                subunit_to_unit: 100,
                decimal_mark: ","
            }, {
                code: "VND",
                money_format: "{{amount_no_decimals}}\u20ab",
                money_in_emails_format: "{{amount_no_decimals}}\u20ab",
                symbol: "\u20ab",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "XOF",
                money_format: "CFA{{amount}}",
                money_in_emails_format: "CFA{{amount}}",
                symbol: "Fr",
                subunit_to_unit: 1,
                decimal_mark: "."
            }, {
                code: "YER",
                money_format: "{{amount_with_comma_separator}} YER",
                money_in_emails_format: "{{amount_with_comma_separator}} YER",
                symbol: "\ufdfc",
                subunit_to_unit: 100,
                decimal_mark: "."
            }, {
                code: "ZMW",
                money_format: "K{{amount_no_decimals_with_comma_separator}}",
                money_in_emails_format: "K{{amount_no_decimals_with_comma_separator}}",
                symbol: "ZK",
                subunit_to_unit: 100,
                decimal_mark: "."
            }];
            Bizweb.CurrencyDB = null != t["default"] ? t["default"] : t
        }),
        d = window.Page;
    // missing new Bizweb.routes function

    var y = (t(function () {
        "use strict";

        function e(e) {
            return e && e.__esModule ? e : {
                "default": e
            }
        }

        function t(e) {
            return {
                $label: (0, i["default"])("label[for='" + e.attr("id") + "']"),
                $parent: e.parent("." + r.STYLIZED)
            }
        }

        function n(e) {
            var n = (0, i["default"])(e);
            t(n).$parent.toggleClass(o.INPUT.CONTENT, Boolean(n.val()))
        }
        var i = e($),
            r = {
                STYLIZED: "next-input--stylized",
                INPUT: "next-input",
                LABEL: "next-label",
                TEXT_AREA: "ui-text-area"
            },
            o = {
                LABEL: {
                    FOCUSED: r.LABEL + "--is-focused"
                },
                INPUT: {
                    FOCUSED: r.INPUT + "--is-focused",
                    CONTENT: r.INPUT + "--has-content"
                }
            },
            a = (0, i["default"])(document);
        a.on("focus blur", "." + r.INPUT, function (e) {
            var n = t((0, i["default"])(e.target)),
                r = n.$label,
                a = n.$parent,
                s = "focusin" === e.type;
            r.toggleClass(o.LABEL.FOCUSED, s), a.toggleClass(o.INPUT.FOCUSED, s)
        }), a.on("input", "." + r.INPUT, function (e) {
            return n(e.target)
        }), a.on("ready page:load", function () {
            return function () {
                (0, i["default"])("." + r.INPUT).toArray().forEach(function (e) {
                    n(e)
                })
            }()
        }),
            function () {
                var e = ["text", "tel", "search", "url", "password", "textarea"];
                a.on("click", "." + r.STYLIZED, function (t) {
                    if (![r.INPUT, r.TEXT_AREA].some(function (e) {
                            return null != t.target.classList && t.target.classList.contains(e)
                    })) {
                        var n = (0, i["default"])(t.target).closest("." + r.STYLIZED).find("." + r.INPUT + ", ." + r.TEXT_AREA)[0];
                        n.focus(), e.includes(n.type) && (n.selectionStart = n.value.length)
                    }
                })
            }(), a.on("focus", ".tagit-new .ui-widget-content", function (e) {
                return (0, i["default"])(e.target).closest("." + r.LABEL).addClass(o.LABEL.FOCUSED)
            }), a.on("blur", ".tagit-new .ui-widget-content", function (e) {
                return (0, i["default"])(e.target).closest("." + r.LABEL).removeClass(o.LABEL.FOCUSED)
            })
    }), t(function () {
        "use strict";

        function e(e) {
            return e && e.__esModule ? e : {
                "default": e
            }
        }

        function t(e) {
            if (Array.isArray(e)) {
                for (var t = 0, n = Array(e.length) ; t < e.length; t++) n[t] = e[t];
                return n
            }
            return Array.from(e)
        }

        function n(e) {
            var t = r(e.target),
                n = o(e.target),
                i = "focusin" === e.type;
            (0, a["default"])(t).toggleClass("next-label--is-focused", i), (0, a["default"])(n).toggleClass("next-input--is-focused", i)
        }

        function i(e) {
            var t = o(e);
            (0, a["default"])(t).toggleClass("next-input--has-content", Boolean(e.value))
        }

        function r(e) {
            return document.querySelector("label[for='" + e.id + "']")
        }

        function o(e) {
            return e.parentNode.classList.contains("ui-select__wrapper") ? e.parentNode : null
        }
        var a = e($),
            s = ".ui-select",
            u = (0, a["default"])(document);
        u.on("focus blur", s, n), u.on("input", s, function (e) {
            i(e.target)
        }), u.on("ready page:load", function () {
            var e = document.querySelectorAll(s);
            [].concat(t(e)).forEach(function (e) {
                i(e)
            })
        })
    }), t(function (e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        t.ALT = 18, t.BACKSPACE = 8, t.COMMA = 188, t.COMMAND = 91, t.CONTROL = 17, t.DELETE = 46, t.DOWN = 40, t.D_LOWER_CASE = 68, t.END = 35, t.ENTER = 13, t.ESCAPE = 27, t.HOME = 36, t.LEFT = 37, t.NUMPAD_ADD = 107, t.NUMPAD_DECIMAL = 110, t.NUMPAD_DIVIDE = 111, t.NUMPAD_ENTER = 108, t.NUMPAD_MULTIPLY = 106, t.NUMPAD_SUBTRACT = 109, t.PAGE_DOWN = 34, t.PAGE_UP = 33, t.PERIOD = 190, t.RIGHT = 39, t.SHIFT = 16, t.SPACE = 32, t.TAB = 9, t.UP = 38, t.S = 83, t.Y = 89, t.Z = 90;
        Bizweb.Keycodes = null != t["default"] ? t["default"] : t
    })),
        v = (t(function () {
            "use strict";

            function e(e) {
                var n = t(e.target),
                    r = "focusin" === e.type;
                (0, i["default"])(n).toggleClass("next-label--is-focused", r)
            }

            function t(e) {
                return document.querySelector("label[for='" + e.id + "']")
            }
            var i = n($);
            (0, i["default"])(document).on("focus blur", ".ui-text-area", e)
        }), t(function (e, t) {
            "use strict";

            function n(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function i(e) {
                return Array.isArray(e) ? e : [e]
            }

            function r(e, t) {
                var n = void 0;
                return "object" === (void 0 === e ? "undefined" : o(e)) ? n = e : (n = {}, n[e] = t), n
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var o = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) {
                return typeof e
            } : function (e) {
                return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
            },
                a = function () {
                    function e(e, t) {
                        for (var n = 0; n < t.length; n++) {
                            var i = t[n];
                            i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                        }
                    }
                    return function (t, n, i) {
                        return n && e(t.prototype, n), i && e(t, i), t
                    }
                }(),
                s = "page:before-replace",
                u = "page:before-partial-replace",
                l = function () {
                    function e(t, i) {
                        n(this, e), this.remove = this.remove.bind(this), this.dispatcher = t, this.callbackObject = i
                    }
                    return a(e, [{
                        key: "remove",
                        value: function () {
                            this.dispatcher.remove(this.callbackObject)
                        }
                    }, {
                        key: "bindToNode",
                        value: function (e) {
                            var t = this;
                            document.addEventListener(u, function (n) {
                                i(n.data).forEach(function (n) {
                                    n.contains(e) && t.remove()
                                })
                            }),document.addEventListener(s, this.remove)
                        }
                    }]), e
                }(),
                c = function () {
                    function e() {
                        n(this, e), this.listeners = {}, this.register = this.register.bind(this)
                    }
                    return a(e, [{
                        key: "register",
                        value: function (e, t) {
                            var n = this,
                                o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                                a = r(e, t);
                            return Object.keys(a).forEach(function (e) {
                                return null == n.listeners[e] && (n.listeners[e] = []), i(a[e]).forEach(function (t) {
                                    t.scope = o.scope, n.listeners[e].push(t)
                                })
                            }), new l(this, a)
                        }
                    }, {
                        key: "dispatch",
                        value: function (e) {
                            null != this.listeners[e.type] && this.listeners[e.type].forEach(function (t) {
                                e.scope === t.scope && t(e)
                            })
                        }
                    }, {
                        key: "remove",
                        value: function (e, t) {
                            var n = this,
                                o = r(e, t);
                            Object.keys(o).forEach(function (e) {
                                var t = i(o[e]);
                                n.listeners[e] = n.listeners[e].filter(function (e) {
                                    return !t.includes(e)
                                })
                            })
                        }
                    }]), e
                }();
            t["default"] = c, Bizweb.Dispatcher = null != t["default"] ? t["default"] : t
        })),
        g = t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var i = n(v),
                r = window.Bizweb && window.Bizweb.rootDispatcher,
                o = r ? window.Bizweb.rootDispatcher : new i["default"];
            t["default"] = o, Bizweb.rootDispatcher = null != t["default"] ? t["default"] : t
        }),
        b = t(function (e, t) {
            "use strict";

            function n() {
                if (r) return r;
                var e = document.createElement("div"),
                    t = !0,
                    n = !1,
                    o = undefined;
                try {
                    for (var a, s = Object.keys(i)[Symbol.iterator]() ; !(t = (a = s.next()).done) ; t = !0) {
                        var u = a.value;
                        if ("undefined" != typeof e.style[u]) {
                            r = i[u];
                            break
                        }
                    }
                } catch (e) {
                    n = !0, o = e
                } finally {
                    try {
                        !t && s["return"] && s["return"]()
                    } finally {
                        if (n) throw o
                    }
                }
                return r
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.transitionEnd = n;
            var i = {
                transition: "transitionend",
                OTransition: "oTransitionEnd",
                MozTransition: "transitionend",
                WebkitTransition: "webkitTransitionEnd"
            },
                r = void 0;
            Bizweb.Events = null != t["default"] ? t["default"] : t
        }),
        E = t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function i(e, t) {
                if ("function" != typeof t) throw new TypeError("Expected callback to be a function");
                if (null == e || e === document.body) return null;
                var n = e.correspondingUseElement || e.correspondingElement || e;
                return t(n) ? n : i(n.parentElement, t)
            }

            function r(e) {
                if ("function" != typeof e) throw new TypeError("Expected a function");
                var t = ["DOMContentLoaded", "page:load"],
                    n = ["ui-modal:show-remote"];
                t.forEach(function (t) {
                    return document.addEventListener(t, e)
                }), n.forEach(function (t) {
                    return h["default"].register(t, e)
                })
            }

            function o(e, t) {
                var n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                    i = n.bubbles,
                    r = i !== undefined && i,
                    o = n.cancelable,
                    a = o !== undefined && o,
                    s = document.createEvent("HTMLEvents");
                s.initEvent(t, r, a), s.data = n.data, e.dispatchEvent(s)
            }

            function a() {
                for (var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {}; e.firstChild;) e.removeChild(e.firstChild)
            }

            function s() {
                var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                    t = document.createElement("option");
                return t.label = e.label || "", t.text = e.label || "", t.value = e.value || "", t.defaultSelected = Boolean(e.defaultSelected), t.disabled = Boolean(e.disabled), t
            }

            function u() {
                var e = document.body,
                    t = document.createElement("div");
                t.style.position = "absolute", t.style.top = t.style.left = "-9999px", t.style.width = t.style.height = "100px", t.style.overflow = "scroll", e.appendChild(t);
                var n = t.offsetWidth - t.clientWidth;
                return e.removeChild(t), n
            }

            function l(e, t) {
                document.body.contains(e) || t()
            }

            function c(e, t, n) {
                var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},
                    r = i.once,
                    o = r !== undefined && r;
                (Array.isArray(t) ? t : t.split(/[ ,]+/)).forEach(function (t) {
                    function i(r) {
                        n.call(r.currentTarget, r), e.removeEventListener(t, i)
                    }
                    e.addEventListener(t, o ? i : n)
                })
            }

            function d() {
                return window.matchMedia("(prefers-reduced-motion: reduce)").matches
            }

            function f(e) {
                e.offsetHeight, e.offsetWidth
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.findClosestParent = i, t.ready = r, t.dispatchEvent = o, t.removeChildren = a, t.createOption = s, t.getScrollbarWidth = u, t.handleDetachedNode = l, t.addEventListener = c, t.prefersReducedMotion = d, t.forceReflow = f;
            var h = n(g);
            document.addEventListener("touchstart", function () { })
        }),
        A = t(function (e, t) {
            "use strict";

            function n(e) {
                if (e && e.__esModule) return e;
                var t = {};
                if (null != e)
                    for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                return t["default"] = e, t
            }

            function i(e, t) {
                function n(e) {
                    var i = e.target;
                    i.classList.remove(t), i.removeEventListener(r.transitionEnd(), n)
                }
                e.addEventListener(r.transitionEnd(), n), e.classList.add(t), (0, E.forceReflow)(e)
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t["default"] = i;
            var r = n(b)
        }),
        S = t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            t.DESKTOP = window.matchMedia("screen and (min-width: 769px)"), t.MOBILE = window.matchMedia("screen and (max-width: 665px)"), t.SMALL = window.matchMedia("screen and (max-width: 568px)"), t.UI_LAYOUT_SINGLE_COLUMN = window.matchMedia("(max-width: 700px), (min-width: 768px) and (max-width: 940px)"), t.PAGE_CONDENSED = window.matchMedia("(max-width: 550px), (min-width: 768px) and (max-width: 790px)");
            Bizweb.Breakpoints = null != t["default"] ? t["default"] : t
        }),
        T = t(function (e, t) {
            "use strict";

            function n(e) {
                e !== o && (null != o && i(), o = e, o.setAttribute("tabindex", "-1"), o.focus(), document.addEventListener("focusin", r))
            }

            function i() {
                null != o && (o.removeAttribute("tabindex"), document.removeEventListener("focusin", r), o = null)
            }

            function r(e) {
                o === e.target || o.contains(e.target) || o.focus()
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.activate = n, t.deactivate = i;
            var o = void 0
        }),
        C = t(function (e, t) {
            "use strict";

            function n(e, t) {
                var n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                    i = n.leading,
                    r = i !== undefined && i,
                    o = n.trailing,
                    a = o === undefined || o,
                    s = n.maxWait,
                    u = s === undefined ? 0 : s,
                    l = u > 0,
                    c = 0,
                    d = !1,
                    f = null,
                    h = null;
                if ("function" != typeof e) throw new TypeError("Expected a function");
                return function () {
                    function n() {
                        r && !h && g()
                    }

                    function i() {
                        a && (c > 1 || !r) && g(), o(), m()
                    }

                    function o() {
                        h = null, c = 0
                    }

                    function s() {
                        f || (m(), f = setTimeout(function () {
                            d = !1
                        }, u))
                    }

                    function m() {
                        d = !0, f = null
                    }
                    for (var _ = this, p = arguments.length, y = Array(p), v = 0; v < p; v++) y[v] = arguments[v];
                    var g = function () {
                        e.apply(_, y)
                    };
                    l && (s(), d || (g(), m())), c++, n(), clearTimeout(h), h = setTimeout(i, t)
                }
            }

            function i(e, t) {
                var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                    r = i.leading,
                    o = r === undefined || r,
                    a = i.trailing,
                    s = a === undefined || a;
                if ("function" != typeof e) throw new TypeError("Expected a function");
                return n(e, t, {
                    leading: o,
                    trailing: s,
                    maxWait: t
                })
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.debounce = n, t.throttle = i, Bizweb.Utilities = null != t["default"] ? t["default"] : t
        }),
        N = t(function (e, t) {
            "use strict";

            function n(e) {
                if (e && e.__esModule) return e;
                var t = {};
                if (null != e)
                    for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                return t["default"] = e, t
            }

            function i(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function r() {
                var e = document.querySelector("." + I.BASE);
                P = window.pageYOffset, document.body.classList.add(I.SCROLL_LOCK), e.scrollTop = P
            }

            function o() {
                document.body.classList.remove(I.SCROLL_LOCK), window.scroll(0, P)
            }

            function a() {
                return null != document.querySelector("." + I.STATES.WITH_TURBO_BAR) ? B : 0
            }

            function s() {
                M.close(), (0, E.dispatchEvent)(M.node, O.transitionEnd())
            }

            function u() {
                M.backdrop.addEventListener("touchstart", d), M.backdrop.addEventListener("click", M.close), M.closer.addEventListener("click", M.close), /*p["default"].register(w.Events.NAVIGATING, M.close),*/ window.addEventListener("resize", x)
            }

            function l() {
                M.backdrop.removeEventListener("touchstart", d), M.backdrop.removeEventListener("click", M.close), M.closer.removeEventListener("click", M.close), /*p["default"].remove(w.Events.NAVIGATING, M.close),*/ window.removeEventListener("resize", x)
            }

            function c(e) {
                null != (0, E.findClosestParent)(e.target, function (e) {
                    return null != e.classList && e.classList.contains(I.OPENER)
                }) && M.open()
            }

            function d(e) {
                e.preventDefault(), M.close()
            }

            function f(e) {
                e.keyCode === k.ESCAPE && M.isOpen && M.close()
            }

            function h(e) {
                if (e.keyCode === k.ENTER) {
                    if (null != (0, E.findClosestParent)(e.target, function (e) {
                            return null != e.classList && e.classList.contains(I.SKIP_TO_CONTENT)
                    })) {
                        var t = document.querySelector("." + I.MAIN);
                        t.addEventListener("blur", m), t.setAttribute("tabindex", -1)
                    }
                }
            }

            function m(e) {
                var t = e.target;
                t.removeAttribute("tabindex"), t.removeEventListener("blur", m)
            }

            function _() {
                document.addEventListener("click", c), document.addEventListener("keyup", f), document.addEventListener("keydown", h)
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.Header = t.Aside = t.Events = t.Classes = undefined, t.lockScroll = r, t.unlockScroll = o, t.turboBarOffset = a, t.addEvents = _;
            var p = i(g),
                v = i(A),
                k = n(y),
                N = n(S),
                L = n(T),
                O = n(b),
                I = t.Classes = {
                    BASE: "ui-app-frame",
                    ASIDE: "ui-app-frame__aside",
                    CLOSER: "ui-app-frame__aside-closer",
                    OPENER: "ui-app-frame__aside-opener",
                    BACKDROP: "ui-app-frame__backdrop",
                    MAIN: "ui-app-frame__main",
                    SCROLL_LOCK: "ui-app-frame--scroll-lock",
                    SKIP_TO_CONTENT: "ui-app-frame__skip-to-content",
                    HEADER: "ui-app-frame__header",
                    STATES: {
                        OPEN: "ui-app-frame__aside--is-open",
                        TRANSITIONING: "ui-app-frame__aside--is-transitioning",
                        BACKDROP: {
                            VISIBLE: "ui-app-frame__backdrop--is-visible"
                        },
                        WITH_TURBO_BAR: "ui-app-frame--with-turbo-bar"
                    }
                },
                R = t.Events = {
                    BEFORE_OPEN: "app-frame-aside:open:before",
                    OPEN: "app-frame-aside:open",
                    BEFORE_CLOSE: "app-frame-aside:close:before",
                    CLOSE: "app-frame-aside:close"
                },
                D = {
                    isOpen: !1
                },
                B = 32,
                P = 0,
                M = t.Aside = {
                    init: function (e) {
                        this.node = e, this.closer = this.node.querySelector("." + I.CLOSER), this.opener = document.querySelector("." + I.OPENER), this.backdrop = document.querySelector("." + I.BACKDROP), this.open = this.open.bind(this), this.close = this.close.bind(this), s()
                    },
                    get isOpen() {
                        return D.isOpen
                    },
                    set isOpen(e) {
                        if ("boolean" != typeof e) throw new TypeError("Expected a boolean");
                        e !== D.isOpen && (e ? this.open() : this.close())
                    },
                    open: function () {
                        this.isOpen || N.DESKTOP.matches || (p["default"].dispatch({
                            type: R.BEFORE_OPEN,
                            data: this
                        }), u(), r(), this.backdrop.classList.add(I.STATES.BACKDROP.VISIBLE), (0, v["default"])(this.node, I.STATES.TRANSITIONING), this.node.classList.add(I.STATES.OPEN), D.isOpen = !0, L.activate(this.node), p["default"].dispatch({
                            type: R.OPEN,
                            data: this
                        }))
                    },
                    close: function () {
                        this.isOpen && (p["default"].dispatch({
                            type: R.BEFORE_CLOSE,
                            data: this
                        }), l(), o(), this.backdrop.classList.remove(I.STATES.BACKDROP.VISIBLE), (0, v["default"])(this.node, I.STATES.TRANSITIONING), this.node.classList.remove(I.STATES.OPEN), D.isOpen = !1, L.deactivate(), this.opener.firstElementChild.focus(), p["default"].dispatch({
                            type: R.CLOSE,
                            data: this
                        }))
                    },
                    toggle: function () {
                        this.isOpen ? this.close() : this.open()
                    }
                },
                F = t.Header = {
                    init: function (e) {
                        this.node = e
                    },
                    get height() {
                        return null == this.node ? 0 : this.node.getBoundingClientRect().height
                    }
                },
                x = (0, C.debounce)(function () {
                    N.DESKTOP.matches && s()
                }, 50);
            (0, E.ready)(function () {
                var e = document.querySelector("." + I.ASIDE),
                    t = document.querySelector("." + I.HEADER);
                null != e && M.init(e), null != t && F.init(t)
            }), _(), Bizweb.AppFrame = null != t["default"] ? t["default"] : t
        }),
        L = t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function i(e) {
                if (Array.isArray(e)) {
                    for (var t = 0, n = Array(e.length) ; t < e.length; t++) n[t] = e[t];
                    return n
                }
                return Array.from(e)
            }

            function r(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function o(e) {
                return p[e.id]
            }

            function a(e) {
                return y[e.getAttribute(c.Button.TARGET)]
            }

            function s() {
                S.initialize();
                var e = document.querySelectorAll("[" + c.TYPE + "]");
                [].concat(i(e)).forEach(function (e) {
                    var t = e.id;
                    t && (p[t] = new b(e))
                })
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.CollapsibleWrapper = undefined;
            var u = function () {
                function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n];
                        i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                    }
                }
                return function (t, n, i) {
                    return n && e(t.prototype, n), i && e(t, i), t
                }
            }(),
                l = n(g),
                c = {
                    TYPE: "data-collapsible",
                    STATE: "data-collapsible-state",
                    MAX_WIDTH: "data-collapsible-maxwidth",
                    HIDDEN: "aria-hidden",
                    CONTAINER: "data-collapsible-text-container-selector",
                    Button: {
                        TARGET: "data-collapsible-target",
                        EXPANDED: "aria-expanded",
                        CONTROLS: "aria-controls",
                        Text: {
                            EXPANDED: "data-collapsible-text--expanded",
                            COLLAPSED: "data-collapsible-text--collapsed"
                        }
                    }
                },
                d = {
                    BASE: "ui-collapsible",
                    ACTIVATOR: "ui-collapsible__activator",
                    PANEL: "ui-collapsible__panel",
                    TRANSITION: "ui-collapsible--has-transition",
                    HIDE_ACTIVATOR: "ui-collapsible__activator--hide",
                    Button: {
                        TEXT: "btn__text",
                        ICON: "icon"
                    }
                },
                f = "collapsible:collapsed",
                h = "collapsible:expanded",
                m = "collapsible:collapsed:after",
                _ = "collapsible:expanded:after",
                p = {},
                y = {},
                v = function () {
                    function e(t, n) {
                        r(this, e), this._clickToToggle = this._clickToToggle.bind(this), this.node = t, this.collapsible = n, this.target = this.collapsible.node, this.collapsed = "false" === this.node.getAttribute(c.Button.EXPANDED), this.ready = !0;
                        var i = this.node.querySelector("[" + c.Button.Text.EXPANDED + "][" + c.Button.Text.COLLAPSED + "]");
                        null != i && (this.text = {
                            node: i,
                            expanded: i ? i.getAttribute(c.Button.Text.EXPANDED) : null,
                            collapsed: i ? i.getAttribute(c.Button.Text.COLLAPSED) : null
                        }), this.node.addEventListener("click", this._clickToToggle)
                    }
                    return u(e, [{
                        key: "toggle",
                        value: function () {
                            return this.collapsed ? this.expand() : this.collapse()
                        }
                    }, {
                        key: "expand",
                        value: function () {
                            return this.collapsed ? (this.ready = !1, this.collapsed = !1, this.node.setAttribute(c.Button.EXPANDED, "true"), this._toggleText(), this) : this
                        }
                    }, {
                        key: "collapse",
                        value: function () {
                            return this.collapsed ? this : (this.ready = !1, this.collapsed = !0, this.node.setAttribute(c.Button.EXPANDED, "false"), this._toggleText(), this)
                        }
                    }, {
                        key: "remove",
                        value: function () {
                            this.node.removeEventListener("click", this._clickToToggle), y[this.node.getAttribute(c.Button.TARGET)] = null, this.node.parentNode.removeChild(this.node)
                        }
                    }, {
                        key: "hide",
                        value: function () {
                            this.node.classList.add(d.HIDE_ACTIVATOR)
                        }
                    }, {
                        key: "show",
                        value: function () {
                            this.node.classList.remove(d.HIDE_ACTIVATOR)
                        }
                    }, {
                        key: "_toggleText",
                        value: function () {
                            return null != this.text && (this.text.node.innerHTML = this.collapsed ? this.text.collapsed : this.text.expanded), this
                        }
                    }, {
                        key: "_clickToToggle",
                        value: function (e) {
                            this.ready && (e.preventDefault(), document.body.contains(this.target) && this.collapsible.toggle())
                        }
                    }]), e
                }();
            v.getCollapsibleRefForNode = o, v.getActivatorForNode = a, v._collapsibleRefs = p, v._activatorRefs = y;
            var b = function () {
                function e(t) {
                    if (r(this, e), this._getHeight = this._getHeight.bind(this), this._finishTransition = this._finishTransition.bind(this), this.node = t, this.id = this.node.id, this.id) {
                        this.collapsed = "collapsed" === this.node.getAttribute(c.STATE);
                        var n = this.node.getAttribute(c.MAX_WIDTH);
                        n && (this.maxwidth = parseInt(n, 10)), this.activator = null, this._pairActivator(), this._toggleAtWidth(), this._trackWidthResize()
                    }
                }
                return u(e, [{
                    key: "toggle",
                    value: function () {
                        var e = !(arguments.length > 0 && arguments[0] !== undefined) || arguments[0];
                        return this.collapsed ? this.expand(e) : this.collapse(e)
                    }
                }, {
                    key: "expand",
                    value: function () {
                        var e = this,
                            t = !(arguments.length > 0 && arguments[0] !== undefined) || arguments[0];
                        return this.collapsed ? (this.activator && this.activator.expand(), t && !(0, E.prefersReducedMotion)() ? (this.node.addEventListener("transitionend", this._finishTransition), this.node.classList.add(d.TRANSITION), this.node.style.height = this._getHeight(), (0, E.forceReflow)(this.node), window.requestAnimationFrame(function () {
                            e.collapsed = !1, e.node.setAttribute(c.STATE, "expanded"), e.node.setAttribute(c.HIDDEN, "false"), l["default"].dispatch(e._generateTransitionEvent(h))
                        })) : (this.collapsed = !1, this.node.setAttribute(c.STATE, "expanded"), this.node.setAttribute(c.HIDDEN, "false"), this.activator.ready = !0, l["default"].dispatch(this._generateTransitionEvent(h))), this) : this
                    }
                }, {
                    key: "collapse",
                    value: function () {
                        var e = this,
                            t = !(arguments.length > 0 && arguments[0] !== undefined) || arguments[0];
                        return this.collapsed ? this : (this.activator && this.activator.collapse(), t && !(0, E.prefersReducedMotion)() ? (this.node.addEventListener("transitionend", this._finishTransition), this.node.classList.add(d.TRANSITION), this.node.style.height = this._getHeight(), (0, E.forceReflow)(this.node), window.requestAnimationFrame(function () {
                            e.collapsed = !0, e.node.setAttribute(c.STATE, "collapsed"), e.node.setAttribute(c.HIDDEN, "true"), l["default"].dispatch(e._generateTransitionEvent(f))
                        })) : (this.collapsed = !0, this.node.setAttribute(c.STATE, "collapsed"), this.node.setAttribute(c.HIDDEN, "true"), this.activator.ready = !0, l["default"].dispatch(this._generateTransitionEvent(f))), this)
                    }
                }, {
                    key: "remove",
                    value: function () {
                        this.activator && this.activator.remove(), p[this.id] = null, this.node.parentNode.removeChild(this.node)
                    }
                }, {
                    key: "_getHeight",
                    value: function () {
                        var e = this.node.scrollHeight;
                        return e += parseInt(window.getComputedStyle(this.node).getPropertyValue("margin-bottom"), 10), (e += parseInt(window.getComputedStyle(this.node).getPropertyValue("margin-top"), 10)) + "px"
                    }
                }, {
                    key: "_finishTransition",
                    value: function (e) {
                        e.target === this.node && "height" === e.propertyName && (this.node.removeEventListener("transitionend", this._finishTransition), this.node.classList.remove(d.TRANSITION), this.node.style.height = null, (0, E.forceReflow)(this.node), this.activator.ready = !0, l["default"].dispatch(this._generateTransitionEvent(this.collapsed ? m : _)))
                    }
                }, {
                    key: "_generateTransitionEvent",
                    value: function (e) {
                        return {
                            type: e,
                            data: {
                                collapsibleInstance: this
                            }
                        }
                    }
                }, {
                    key: "_pairActivator",
                    value: function () {
                        var e = document.querySelector("[" + c.Button.TARGET + "='" + this.id + "']");
                        e && (y[this.id] = new v(e, this), this.activator = y[this.id])
                    }
                }, {
                    key: "_toggleAtWidth",
                    value: function () {
                        var e = arguments.length > 0 && arguments[0] !== undefined && arguments[0];
                        return this.maxwidth && (this.node.offsetWidth >= this.maxwidth ? (this.collapsed && this.expand(e), this.activator && this.activator.hide()) : this.activator && this.activator.show()), this
                    }
                }, {
                    key: "_trackWidthResize",
                    value: function () {
                        var e = this;
                        this.maxwidth && window.addEventListener("resize", (0, C.debounce)(function () {
                            window.requestAnimationFrame(function () {
                                e._toggleAtWidth()
                            })
                        }, 50))
                    }
                }]), e
            }();
            b.DISPATCHER_COLLAPSED_ACTION = f, b.DISPATCHER_EXPANDED_ACTION = h, b.DISPATCHER_COLLAPSED_ACTION_AFTER = m, b.DISPATCHER_EXPANDED_ACTION_AFTER = _, b.getCollapsibleRefForNode = o, b.getActivatorForNode = a, b._collapsibleRefs = p, b._activatorRefs = y, t["default"] = b;
            var A = 1,
                S = t.CollapsibleWrapper = function () {
                    function e(t) {
                        r(this, e), t.__collapsibleInstance = this;
                        var n = t.querySelector("." + d.ACTIVATOR).firstElementChild,
                            i = t.querySelector("." + d.PANEL),
                            o = i.getAttribute(c.STATE),
                            a = t.getAttribute(c.CONTAINER),
                            s = t.getAttribute(c.Button.Text.EXPANDED),
                            u = t.getAttribute(c.Button.Text.COLLAPSED);
                        if (i.id = i.id || "Collapsible" + A++, i.setAttribute(c.HIDDEN, "collapsed" === o), s && u && a) {
                            var l = t.querySelector(a);
                            l.setAttribute(c.Button.Text.EXPANDED, s), l.setAttribute(c.Button.Text.COLLAPSED, u)
                        }
                        n.setAttribute(c.Button.TARGET, i.id), n.setAttribute(c.Button.CONTROLS, i.id), n.setAttribute(c.Button.EXPANDED, "expanded" === o)
                    }
                    return u(e, null, [{
                        key: "forElement",
                        value: function (t) {
                            return t.__collapsibleInstance || new e(t)
                        }
                    }, {
                        key: "initialize",
                        value: function () {
                            var t = document.querySelectorAll("." + d.BASE);
                            return [].concat(i(t)).map(e.forElement)
                        }
                    }]), e
                }();
            (0, E.ready)(s)
        }),
        O = t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function i() {
                r(), o(), p.CONTEXT_BAR && (p.CANCEL && p.CANCEL.addEventListener("click", a), p.PRIMARY && p.PRIMARY.addEventListener("click", s))
            }

            function r() {
                p.CONTEXT_BAR = document.querySelector("." + h.CONTEXT_BAR), p.MESSAGES = document.querySelector("." + h.CONTEXT_BAR_MESSAGE), p.PRIMARY = document.querySelector("." + h.CONTEXT_BAR_PRIMARY_ACTION), p.CANCEL = document.querySelector("." + h.CONTEXT_BAR_CANCEL_ACTION)
            }

            function o() {
                var e = document.querySelector("form[" + m.CONTEXT_CREATE_NAME + "]");
                if (y = {
                    create: !1,
                    name: "Chỉnh sửa",
                    cancelPath: "/"
                }, e) {
                    var t = e.getAttribute(m.CONTEXT_CREATE_NAME),
                        n = e.getAttribute(m.CONTEXT_CANCEL_PATH),
                        i = {},
                        r = {},
                        o = {
                            form: e.id
                        };
                    try {
                        i = JSON.parse(e.getAttribute(m.CONTEXT_PRIMARY_ATTRIBUTES)), r = JSON.parse(e.getAttribute(m.CONTEXT_CANCEL_ATTRIBUTES))
                    } finally {
                        i = i ? Object.assign(o, i) : o
                    }
                    y.name = t || y.name, y.cancelPath = n || y.cancelPath, l({
                        data: {
                            message: y.name + " chưa được lưu",
                            cancelLabel: "Hủy",
                            primaryAttr: i,
                            cancelAttr: r
                        }
                    }), y.create = !0
                }
            }

            function a() {
                var e = y.create ? {
                    url: y.cancelPath
                } : {};
                f["default"].dispatch({
                    type: "DIRTY_STATE_REVERT",
                    data: e
                })
            }

            function s() {
                var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                    t = e.target;
                if ("true" !== t.getAttribute(m.CONTEXT_PRIMARY_DISABLED)) {
                    var n = t ? t.getAttribute("form") : null,
                        i = n ? "#" + n : "form",
                        r = document.querySelector(i);
                    r && u(r)
                }
            }

            function u(e) {
                var t = document.createElement("input");
                t.style.display = "none", t.type = "submit", e.appendChild(t).click(), e.removeChild(t)
            }

            function l() {
                var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
                if (!y.create && p.CONTEXT_BAR) {
                    if (p.CONTEXT_BAR.classList.add(h.IS_DIRTY), e.data && e.data.message && (p.MESSAGES.innerHTML = e.data.message), p.PRIMARY && e.data && e.data.primaryAttr) {
                        var t = !0,
                            n = !1,
                            i = undefined;
                        try {
                            for (var r, o = Object.keys(e.data.primaryAttr)[Symbol.iterator]() ; !(t = (r = o.next()).done) ; t = !0) {
                                var a = r.value;
                                p.PRIMARY.setAttribute(a, e.data.primaryAttr[a])
                            }
                        } catch (e) {
                            n = !0, i = e
                        } finally {
                            try {
                                !t && o["return"] && o["return"]()
                            } finally {
                                if (n) throw i
                            }
                        }
                    }
                    if (p.PRIMARY && e.data && e.data.primaryLabel && (p.PRIMARY.innerHTML = e.data.primaryLabel), p.CANCEL && e.data && e.data.cancelLabel && (p.CANCEL.innerHTML = e.data.cancelLabel), p.CANCEL && e.data && e.data.cancelAttr) {
                        var s = !0,
                            u = !1,
                            l = undefined;
                        try {
                            for (var c, d = Object.keys(e.data.cancelAttr)[Symbol.iterator]() ; !(s = (c = d.next()).done) ; s = !0) {
                                var m = c.value;
                                p.CANCEL.setAttribute(m, e.data.cancelAttr[m])
                            }
                        } catch (e) {
                            u = !0, l = e
                        } finally {
                            try {
                                !s && d["return"] && d["return"]()
                            } finally {
                                if (u) throw l
                            }
                        }
                    }
                    f["default"].dispatch({
                        type: _.CONTEXT_BAR_SHOWN
                    })
                }
            }

            function c() {
                !y.create && p.CONTEXT_BAR && p.CONTEXT_BAR.classList.remove(h.IS_DIRTY)
            }

            function d() {
                return p.CONTEXT_BAR && p.CONTEXT_BAR.classList.contains(h.IS_DIRTY)
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.Nodes = t.Events = t.Attrs = t.Classes = undefined;
            var f = n(g),
                h = t.Classes = {
                    CONTEXT_BAR: "ui-context-bar",
                    CONTEXT_BAR_MESSAGE: "ui-context-bar__message",
                    CONTEXT_BAR_PRIMARY_ACTION: "ui-context-bar__actions-primary",
                    CONTEXT_BAR_CANCEL_ACTION: "ui-context-bar__actions-cancel",
                    IS_DIRTY: "ui-context-bar--is-dirty"
                },
                m = t.Attrs = {
                    CONTEXT_CREATE_NAME: "data-context-create-name",
                    CONTEXT_CANCEL_PATH: "data-context-cancel-path",
                    CONTEXT_CANCEL_ATTRIBUTES: "data-context-cancel-attributes",
                    CONTEXT_PRIMARY_ATTRIBUTES: "data-context-primary-attributes",
                    CONTEXT_PRIMARY_DISABLED: "data-disable-submit"
                },
                _ = t.Events = {
                    CONTEXT_BAR_ON: "CONTEXT_BAR_ON_EVENT",
                    CONTEXT_BAR_SHOWN: "CONTEXT_BAR_SHOWN_EVENT",
                    CONTEXT_BAR_OFF: "CONTEXT_BAR_OFF_EVENT"
                },
                p = t.Nodes = {
                    CONTEXT_BAR: null,
                    MESSAGES: null,
                    PRIMARY: null,
                    CANCEL: null
                },
                y = {};
            f["default"].register(_.CONTEXT_BAR_ON, l), f["default"].register(_.CONTEXT_BAR_OFF, c), t["default"] = {
                initialize: i,
                show: l,
                hide: c,
                isDirty: d
            }, (0, E.ready)(i), Bizweb.ContextBar = null != t["default"] ? t["default"] : t
        }),
        x = t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function i(e) {
                d(!0), a(e, !0)
            }

            function r(e) {
                var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3e3;
                d(!1), a(e, !1), l(t)
            }

            function o() {
                y.$wrapper = (0, m["default"])("#" + v.WRAPPER), y.$flash = (0, m["default"])("#" + v.BASE), y.$message = y.$flash.find("." + g.MESSAGE)
            }

            function a(e, t) {
                y.lastFocused = document.activeElement || document.body, o(), u(), _ = !1, e && y.$message.text(e), y.$message.attr(b.ROLE, t ? E.ROLE_ALERT : E.ROLE_STATUS), y.$flash.attr(b.HAS_MESSAGE, "true"), y.$wrapper.addClass(g.WRAPPER_VISIBLE), y.$flash.addClass(g.ANIMATE_IN).one("animationend", function () {
                    y.$flash.removeClass(g.ANIMATE_IN), y.$message.trigger("focus")
                })
            }

            function s() {
                u(), _ = !0, y.$flash.addClass(g.ANIMATE_OUT).one("animationend", function () {
                    y.$flash.removeClass(g.ANIMATE_OUT), y.$wrapper.removeClass(g.WRAPPER_VISIBLE), y.$message.text(""), y.$flash.attr(b.HAS_MESSAGE, null), _ = !1, y.lastFocused instanceof HTMLElement && y.lastFocused.focus()
                }), y.$flash.trigger("animationend")
            }

            function u() {
                p && clearTimeout(p), y.$flash.trigger("animationend").off("mouseleave").off("animationend"), y.$message.removeAttr(b.ROLE)
            }

            function l(e) {
                p && clearTimeout(p), p = setTimeout(s, e)
            }

            function c() {
                y.$flash.removeClass(g.ANIMATE_OUT).off("animationend"), _ = !1
            }

            function d(e) {
                y.$flash.toggleClass(g.ERROR, e)
            }

            function f() {
                y.$flash.on("mouseenter", function () {
                    p && clearTimeout(p), _ && c(), y.$flash.one("mouseleave", function () {
                        y.$flash.hasClass(g.ERROR) || l(1e3)
                    })
                }), y.$flash.on("click", function () {
                    _ || (y.$flash.off("mouseleave"), s())
                })
            }

            function h() {
                o(), f(), "true" === y.$flash.attr(b.HAS_MESSAGE) && (y.$flash.hasClass(g.ERROR) ? i("") : r(""))
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.error = i, t.notice = r;
            var m = n($),
                _ = void 0,
                p = void 0,
                div = document.createElement("div"),
                $div = v = (0, m["default"])(div),
                y = {
                    $wrapper: $div,
                    $flash: $div,
                    $message: $div,
                    lastFocused: div
                },
                v = {
                    WRAPPER: "UIFlashWrapper",
                    BASE: "UIFlashMessage"
                },
                g = {
                    WRAPPER_VISIBLE: "ui-flash-wrapper--is-visible",
                    ERROR: "ui-flash--error",
                    ANIMATE_IN: "ui-flash--is-animating-in",
                    ANIMATE_OUT: "ui-flash--is-animating-out",
                    MESSAGE: "ui-flash__message"
                },
                b = {
                    HAS_MESSAGE: "data-flash-has-message",
                    ROLE: "role"
                },
                E = {
                    ROLE_ALERT: "alert",
                    ROLE_STATUS: "status"
                };
            (0, m["default"])(document).on("ready page:load flash:init", function () {
                h()
            }), Bizweb.Flashs = null != t["default"] ? t["default"] : t
        }),
        H = t(function (e, t) {
            "use strict";

            function n(e) {
                var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
                    n = t.scrollingElement,
                    r = n === undefined ? e : n,
                    o = r.scrollTop,
                    a = !(o + r.clientHeight >= r.scrollHeight),
                    s = o > 0,
                    u = s && a;
                e.classList[a ? "add" : "remove"](i.BOTTOM_SHADOW), e.classList[s ? "add" : "remove"](i.TOP_SHADOW), e.classList[u ? "add" : "remove"](i.TOP_AND_BOTTOM_SHADOW)
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.update = n;
            var i = {
                TOP_AND_BOTTOM_SHADOW: "scroll-shadow--top-and-bottom",
                BOTTOM_SHADOW: "scroll-shadow--bottom",
                TOP_SHADOW: "scroll-shadow--top"
            };
            Bizweb.ScrollShadow = null != t["default"] ? t["default"] : t
        }),
        q = t(function (e, t) {
            "use strict";

            function n(e) {
                if (e && e.__esModule) return e;
                var t = {};
                if (null != e)
                    for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                return t["default"] = e, t
            }

            function i(e) {
                var t = !(arguments.length > 1 && arguments[1] !== undefined) || arguments[1],
                    n = t ? "addEventListener" : "removeEventListener";
                l.forEach(function (t) {
                    e[n](t, r)
                })
            }

            function r(e) {
                e.preventDefault()
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t["default"] = function (e) {
                function t() {
                    var n = e.scrollTop / u;
                    e.scrollTop = n < s ? 0 : e.scrollTop - n, e.scrollTop > 0 ? window.requestAnimationFrame(t) : (i(e, !1), l && o.update(e))
                }
                var n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                if (e.scrollTop > 0 || e.scrollHeight <= e.clientHeight || (0, E.prefersReducedMotion)()) return -1;
                var r = n.scrollShadow,
                    l = r !== undefined && r;
                return e.scrollTop = a, i(e), l && o.update(e), window.requestAnimationFrame(t), e.scrollTop
            };
            var o = n(H),
                a = 100,
                s = .2,
                u = 5,
                l = ["scroll", "touchmove", "wheel"]
        }),
        j = t(function (e, t) {
            "use strict";

            function n(e) {
                if (e && e.__esModule) return e;
                var t = {};
                if (null != e)
                    for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                return t["default"] = e, t
            }

            function i(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function r(e) {
                if (Array.isArray(e)) {
                    for (var t = 0, n = Array(e.length) ; t < e.length; t++) n[t] = e[t];
                    return n
                }
                return Array.from(e)
            }

            function o(e) {
                var t = (0, F["default"])(e).siblings(":not(" + G.BASE + ")")[0];
                s(e), a(e, t);
                var n = {
                    activate: function () {
                        d(e)
                    },
                    deactivate: function () {
                        p(e)
                    },
                    toggle: function () {
                        m(e)
                    },
                    reposition: function () {
                        E()
                    },
                    isActive: function () {
                        return e === (null == ee.popover ? null : ee.popover.base)
                    }
                };
                return (0, F["default"])(e).data(G.BASE, n), n
            }

            function a(e, t) {
                var n = ae++,
                    i = e.id || G.BASE + "--" + n,
                    r = c(t),
                    o = r.id || G.BASE + "-activator--" + n;
                return (0, F["default"])(e).attr({
                    id: i,
                    "aria-labelledby": o,
                    "aria-expanded": "false",
                    role: "dialog"
                }), (0, F["default"])(r).attr({
                    id: o,
                    "aria-expanded": "false",
                    "aria-haspopup": "true",
                    "aria-owns": i,
                    "aria-controls": i
                })
            }

            function s(e) {
                var t = window.getComputedStyle(e);
                e.setAttribute(X.CSS_CACHE.VERTICAL_MARGIN, u(t.marginTop, e) || 0), e.setAttribute(X.CSS_CACHE.HORIZONTAL_MARGIN, u(t.marginLeft, e) || 0);
                var n = (0, F["default"])(e).children("." + G.CONTENT_WRAPPER)[0],
                    i = window.getComputedStyle(n);
                return e.setAttribute(X.CSS_CACHE.MAX_HEIGHT, u(i.maxHeight, n) || 1e4), e.setAttribute(X.CSS_CACHE.MAX_WIDTH, u(i.maxWidth, n) || 1e4), e.classList.contains(z.BASE.FULL_WIDTH) || (e.style.maxWidth = "none"), e.style.marginLeft = e.style.marginRight = "0px", e.style.marginLeft
            }

            function u(e, t) {
                if ("none" === e) return !1;
                var n = parseFloat(e);
                return e.indexOf("rem") >= 0 ? n * te() : e.indexOf("em") >= 0 ? n * parseFloat(window.getComputedStyle(t).fontSize) : e.indexOf("%") >= 0 ? n / 100 : n
            }

            function l(e) {
                var t = void 0;
                return [].concat(r(e.parentNode.children)).forEach(function (n) {
                    n !== e && n.offsetWidth > 0 && (t = n)
                }), t || e.previousElementSibling || e.nextElementSibling
            }

            function c(e) {
                var t = (0, F["default"])(e);
                return t.is(":input") ? e : t.find(":input")[0] || e
            }

            function d(e) {
                if (e === (null == ee.popover ? null : ee.popover.base)) return null;
                ee.popover && p();
                var t = (0, F["default"])(e);
                t.data(G.BASE) || o(e);
                var n = e.querySelector("." + G.TOOLTIP),
                    i = l(e),
                    r = document.getElementById("wrapper") || document.body,
                    a = t.closest(e.getAttribute(X.RELATIVE_TO)).get(0) || t.closest(e.getAttribute(X.HORIZONTALLY_RELATIVE_TO)).get(0) || r,
                    s = t.closest(e.getAttribute(X.RELATIVE_TO)).get(0) || t.closest(e.getAttribute(X.VERTICALLY_RELATIVE_TO)).get(0) || r,
                    u = e.getAttribute(X.ACTIVATE_FROM),
                    d = t.closest(e.getAttribute(X.SCROLL_CONTAINER)).get(0);
                ee = {
                    container: e.parentNode,
                    activator: i,
                    activatorInput: c(i),
                    source: u ? i.querySelector(u) : i,
                    horizontallyRelativeTo: a,
                    verticallyRelativeTo: s,
                    preferredPosition: e.getAttribute(X.PREFERRED_POSITION) || Q.BOTTOM,
                    horizontallyPosition: !e.classList.contains(z.BASE.FULL_WIDTH),
                    positionAgainstEdge: e.classList.contains(z.BASE.ALIGN_TO_EDGE),
                    scrollContainer: d,
                    popover: {
                        base: e,
                        container: e.parentNode,
                        content: e.querySelector("." + G.CONTENT),
                        contentWrapper: e.querySelector("." + G.CONTENT_WRAPPER),
                        tooltip: n,
                        panes: Array.prototype.slice.call(e.querySelectorAll("." + G.PANE))
                    },
                    styles: {
                        horizontalMargin: parseInt(e.getAttribute(X.CSS_CACHE.HORIZONTAL_MARGIN), 10),
                        verticalMargin: parseInt(e.getAttribute(X.CSS_CACHE.VERTICAL_MARGIN), 10),
                        maxHeight: parseInt(e.getAttribute(X.CSS_CACHE.MAX_HEIGHT), 10),
                        maxWidth: parseFloat(e.getAttribute(X.CSS_CACHE.MAX_WIDTH))
                    }
                };
                var m = !1;
                return t.off(x.transitionEnd()), t.one(x.transitionEnd(), function () {
                    return m ? null : (m = !0, O(), t.trigger(Y.ACTIVATED))
                }), h(e), f(), E()
            }

            function f() {
                var e = ee.popover.base;
                e.setAttribute("aria-expanded", "true"), ee.activatorInput.setAttribute("aria-expanded", "true"), (0, F["default"])(e).one(x.transitionEnd(), function () {
                    return (0, F["default"])(e).removeClass(K.BASE.TRANSITIONING)
                }), (0, F["default"])(e).addClass(K.BASE.TRANSITIONING), window.requestAnimationFrame(function () {
                    ee.popover && (I(), (0, F["default"])(e).addClass(K.BASE.ACTIVE), ee.popover.container.classList.add(K.CONTAINER.ACTIVE), (0, F["default"])(e).trigger(Y.ACTIVATING))
                })
            }

            function h(e) {
                return (0, F["default"])(e).on("wheel", "." + G.PANE, P), ee.scrollContainer ? (0, F["default"])(ee.scrollContainer).on("scroll." + Z, se) : null
            }

            function m(e) {
                return (null == ee.popover ? null : ee.popover.base) === e ? p() : d(e)
            }

            function _() {
                return ee.popover ? (0, F["default"])(ee.popover.base).closest(document).length ? null : p() : null
            }

            function p(e) {
                if (!ee.popover) return null;
                if (e && e !== ee.popover.base) return null;
                var t = ee.popover.base,
                    n = ee.popover.content,
                    i = ee.popover.container,
                    r = (0, F["default"])(t),
                    o = Boolean(r.closest(document).length);
                r.off(x.transitionEnd()), r.trigger(Y.DEACTIVATING);
                var a = function () {
                    var e = !1;
                    return function () {
                        return e ? null : (e = !0, i.classList.remove(K.CONTAINER.DEACTIVATING), n.style.width = "", (0, F["default"])(t).trigger(Y.DEACTIVATED))
                    }
                }();
                o && (r.one(x.transitionEnd(), function () {
                    r.removeClass(K.BASE.TRANSITIONING), a()
                }), r.addClass(K.BASE.TRANSITIONING)), v(), o || a(), g(t);
                var s = !0,
                    u = !1,
                    l = undefined;
                try {
                    for (var c, d = Object.keys(ee || {})[Symbol.iterator]() ; !(s = (c = d.next()).done) ; s = !0) {
                        var f = c.value;
                        delete ee[f]
                    }
                } catch (e) {
                    u = !0, l = e
                } finally {
                    try {
                        !s && d["return"] && d["return"]()
                    } finally {
                        if (u) throw l
                    }
                }
                return null
            }

            function v() {
                var e = ee.popover;
                return e.container.classList.add(K.CONTAINER.DEACTIVATING), e.container.classList.remove(K.CONTAINER.ACTIVE), e.base.classList.remove(K.BASE.ACTIVE), e.base.setAttribute("aria-expanded", "false"), ee.activatorInput.setAttribute("aria-expanded", "false")
            }

            function g(e) {
                return (0, F["default"])(e).off("wheel", "." + G.PANE, P), ee.scrollContainer ? (0, F["default"])(ee.scrollContainer).off("." + Z) : null
            }

            function E(e) {
                var t = void 0,
                    n = void 0,
                    i = void 0,
                    r = void 0,
                    o = void 0,
                    a = void 0;
                if (!ee.popover) return null;
                var s = null == e || !e.type || "resize" === e.type,
                    u = {
                        base: {},
                        wrapper: {},
                        content: {},
                        tooltip: {}
                    },
                    l = k();
                return N({
                    rect: l
                }, u), s && ee.horizontallyPosition && (a = T(), o = l.left / l.horizontallyRelativeTo.width <= .5, r = w(l.horizontallyRelativeTo.width), u.content.width = r, i = {
                    offsets: a,
                    width: r,
                    left: o,
                    rect: l
                }, ee.positionAgainstEdge ? A(i, u) : S(i, u), n = l.width / 2 + a.leftFromContainerToActivator + a.leftFromActivatorToSource - u.base.left, u.tooltip.left = Math.round(n), t = u.base.transformOrigin.split(" ").slice(1).join(" "), ee.styles.transformOriginX = Math.round(n) + "px", u.base.transformOrigin = ee.styles.transformOriginX + " " + t), requestAnimationFrame(function () {
                    var e = ee.popover;
                    return null == e ? null : ((0, F["default"])(e.base).css(u.base), (0, F["default"])(e.content).css(u.content), (0, F["default"])(e.contentWrapper).css(u.wrapper), (0, F["default"])(e.tooltip).css(u.tooltip), s && (e.content.style.height = re() + 2), e.base.style.transformOrigin = u.base.transformOrigin, e.base.style.transformOrigin)
                })
            }

            function A(e, t) {
                var n = e.offsets,
                    i = e.width,
                    r = e.rect,
                    o = e.left,
                    a = r[o ? "right" : "left"] + r.width / 2 - ee.styles.horizontalMargin,
                    s = o ? 0 : r.width - i;
                return s += n.leftFromContainerToActivator, t.base.left = function () {
                    return i > a ? o ? s - (i - a) - n.leftFromActivatorToSource : s + (i - a) : o ? s - n.leftFromActivatorToSource : s - n.rightFromActivatorToSource
                }(), t.base.left = Math.round(t.base.left + n.leftFromActivatorToSource), t.base.left
            }

            function S(e, t) {
                var n = e.offsets,
                    i = e.width,
                    r = e.rect,
                    o = e.left,
                    a = .5 * i + ee.styles.horizontalMargin;
                return t.base.left = function () {
                    return o && r.left < a ? r.width / 2 + ee.styles.horizontalMargin - r.left : !o && r.right < a ? r.width / 2 - i + r.right - ee.styles.horizontalMargin : r.width / 2 - i / 2
                }(), t.base.left = Math.round(t.base.left + n.leftFromContainerToActivator + n.leftFromActivatorToSource), t.base.left
            }

            function T() {
                var e = ee.activator.getBoundingClientRect(),
                    t = ee.source === ee.activator,
                    n = t ? e : ee.source.getBoundingClientRect();
                return {
                    leftFromContainerToActivator: e.left - ee.container.getBoundingClientRect().left,
                    leftFromActivatorToSource: n.left - e.left,
                    rightFromActivatorToSource: n.right - e.right
                }
            }

            function k() {
                var e = ee.source.getBoundingClientRect(),
                    t = ee.horizontallyRelativeTo.getBoundingClientRect(),
                    n = ee.verticallyRelativeTo.getBoundingClientRect(),
                    i = e.top + .5 * e.height,
                    r = e.left + .5 * e.width;
                return r -= t.left, {
                    height: e.height,
                    width: e.width,
                    top: i - ne(),
                    bottom: window.innerHeight - i,
                    left: r,
                    right: t.width - r,
                    horizontallyRelativeTo: t,
                    verticallyRelativeTo: n
                }
            }

            function w(e) {
                var t = void 0;
                ee.styles.contentWidth || (t = ee.popover.content, t.classList.add(K.CONTENT.CALCULATING), ee.styles.contentWidth = t.offsetWidth + 2, t.classList.remove(K.CONTENT.CALCULATING));
                var n = e - 2 * ee.styles.horizontalMargin;
                return Math.min(n, ee.styles.maxWidth, ee.styles.contentWidth)
            }

            function N(e, t) {
                var n = void 0,
                    i = ee.popover.base.offsetHeight + 2 * ee.styles.verticalMargin,
                    r = e.rect,
                    o = r.verticallyRelativeTo.top + r.verticallyRelativeTo.height - (r.top + r.height),
                    a = window.scrollY + r.top - r.verticallyRelativeTo.top;
                return n = ee.preferredPosition === Q.MOST_SPACE ? o < a ? Q.TOP : Q.BOTTOM : ee.preferredPosition === Q.BOTTOM ? r.bottom < i && r.top > r.bottom || o < i && a > i ? Q.TOP : Q.BOTTOM : r.top < i && r.bottom > r.top || a < i && o > i ? Q.BOTTOM : Q.TOP, L(n, r, t)
            }

            function L(e, t, n) {
                var i = e === Q.TOP,
                    r = ee.horizontallyPosition ? 0 : "50%";
                n.base.transformOrigin = i ? (ee.styles.transformOriginX || r) + " calc(100% + " + J + "px)" : (ee.styles.transformOriginX || r) + " -" + J + "px", e !== ee.position && (ee.position = e, ee.popover.base.classList[i ? "remove" : "add"](K.BASE.POSITIONED_BELOW), ee.popover.base.classList[i ? "add" : "remove"](K.BASE.POSITIONED_ABOVE));
                var o = t[e] - t.height / 2 - 2 * ee.styles.verticalMargin;
                return n.content.maxHeight = Math.min(o, ee.styles.maxHeight), n.content.maxHeight
            }

            function O() {
                ee.popover.panes.forEach(function (e) {
                    return e.classList.contains(z.PANE.FIXED) ? null : j.update(e)
                })
            }

            function I() {
                ee.popover.panes.forEach(function (e) {
                    e.classList.contains(z.PANE.FIXED) || (0, V["default"])(e, {
                        scrollShadow: !0
                    })
                })
            }

            function R(e) {
                var t = void 0,
                    n = (0, F["default"])(e.target).closest("." + G.BASE).length;
                if (n && e.which === U.ESCAPE) ee.activator.focus(), p(), e.preventDefault();
                else {
                    if (t = (0, F["default"])(e.currentTarget).children("." + G.BASE)[0], n || t.classList.contains(z.BASE.JS_ACTIVATED)) return;
                    [U.ENTER, U.SPACE].includes(e.which) && null != e.target && null != e.target.tagName && "input" !== e.target.tagName.toLowerCase() ? (m(t), e.preventDefault()) : e.which === U.ESCAPE && (p(), e.preventDefault())
                }
            }

            function D(e) {
                var t = (0, F["default"])(e.target).closest("." + G.BASE).length,
                    n = (0, F["default"])(e.currentTarget).children("." + G.BASE)[0];
                t || n.classList.contains(z.BASE.JS_ACTIVATED) || d(n)
            }

            function B(e) {
                var t = (0, F["default"])(e.target).closest("." + G.BASE).length,
                    n = (0, F["default"])(e.currentTarget).children("." + G.BASE)[0];
                t || n.classList.contains(z.BASE.JS_ACTIVATED) || p()
            }

            function P(e) {
                function t() {
                    e.stopPropagation(), e.preventDefault()
                }
                var n = e.currentTarget,
                    i = e.originalEvent.deltaY,
                    r = i < 0,
                    o = [n.offsetHeight, n.scrollHeight, n.scrollTop],
                    a = o[0],
                    s = o[1],
                    u = o[2],
                    l = !r && i > s - a - u,
                    c = r && -i > u;
                l && (n.scrollTop = s, t()), c && (n.scrollTop = 0, t()), j.update(n)
            }

            function M() {
                return (0, F["default"])(document).on("page:load", _).on("click focusin", ie).on("keydown", "." + G.CONTAINER, R).on("mouseenter", "." + z.CONTAINER.HOVER_ACTIVATED, D).on("mouseleave", "." + z.CONTAINER.HOVER_ACTIVATED, B), se = (0, C.debounce)(E, 50, {
                    leading: !0
                }), (0, F["default"])(window).on("resize scroll", se)
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var F = i($),
                x = n(b),
                U = n(y),
                j = n(H),
                V = i(q),
                W = "ui-popover",
                G = {
                    BASE: W,
                    CONTAINER: "ui-popover__container",
                    CONTENT_WRAPPER: "ui-popover__content-wrapper",
                    CONTENT: "ui-popover__content",
                    TOOLTIP: "ui-popover__tooltip",
                    PANE: "ui-popover__pane"
                },
                K = {
                    BASE: {
                        ACTIVE: "ui-popover--is-active",
                        TRANSITIONING: "ui-popover--is-transitioning",
                        POSITIONED_BELOW: "ui-popover--is-positioned-beneath",
                        POSITIONED_ABOVE: "ui-popover--is-positioned-above"
                    },
                    CONTAINER: {
                        ACTIVE: "ui-popover__container--contains-active-popover",
                        DEACTIVATING: "ui-popover__container--is-deactivating"
                    },
                    CONTENT: {
                        CALCULATING: "ui-popover__content--is-calculating"
                    }
                },
                z = {
                    BASE: {
                        ALIGN_TO_EDGE: "ui-popover--align-edge",
                        FULL_WIDTH: "ui-popover--full-width",
                        NO_FOCUS: "ui-popover--no-focus",
                        HOVER_ACTIVATED: "ui-popover--hover-activated",
                        JS_ACTIVATED: "ui-popover--js-activated"
                    },
                    CONTAINER: {
                        HOVER_ACTIVATED: "ui-popover__container--hover-activated"
                    },
                    PANE: {
                        FIXED: "ui-popover__pane--fixed"
                    }
                },
                Y = {
                    ACTIVATING: "ui-popover:activating",
                    ACTIVATED: "ui-popover:activated",
                    DEACTIVATED: "ui-popover:deactivated",
                    DEACTIVATING: "ui-popover:deactivating"
                },
                X = {
                    PREFERRED_POSITION: "data-popover-preferred-position",
                    HORIZONTALLY_RELATIVE_TO: "data-popover-horizontally-relative-to-closest",
                    VERTICALLY_RELATIVE_TO: "data-popover-vertically-relative-to-closest",
                    RELATIVE_TO: "data-popover-relative-to-closest",
                    ACTIVATE_FROM: "data-popover-activate-from",
                    SCROLL_CONTAINER: "data-popover-scroll-container",
                    CSS_CACHE: {
                        MAX_HEIGHT: "data-popover-css-max-height",
                        MAX_WIDTH: "data-popover-css-max-width",
                        VERTICAL_MARGIN: "data-popover-css-vertical-margin",
                        HORIZONTAL_MARGIN: "data-popover-css-horizontal-margin"
                    }
                },
                Q = {
                    TOP: "top",
                    BOTTOM: "bottom",
                    MOST_SPACE: "most_space"
                },
                Z = "ui-popover",
                J = 5,
                ee = {},
                te = function () {
                    var e = null;
                    return function () {
                        if (null != e) return e;
                        var t = (0, F["default"])("<div>M</div>").appendTo("body");
                        return t.css({
                            display: "inline-block",
                            padding: "0",
                            lineHeight: "1",
                            position: "absolute",
                            visibility: "hidden",
                            fontSize: "1em"
                        }), t.remove(), e
                    }
                }(),
                ne = function () {
                    var e = void 0,
                        t = void 0,
                        n = e = 0;
                    return (0, F["default"])(document).on("ready page:load", function () {
                        return t = document.querySelector(".page .header-row") || document.querySelector(".ui-title-bar"), n = (null == t ? 0 : t.offsetHeight) || 0, setTimeout(function () {
                            var t = void 0;
                            return e = (null == (t = document.querySelector("#turbo")) ? 0 : t.offsetHeight) || 0
                        }, 1)
                    }),
                        function () {
                            return e + n
                        }
                }(),
                ie = function () {
                    var e = 0,
                        t = null;
                    return function (n) {
                        var i = void 0,
                            r = void 0,
                            o = void 0,
                            a = void 0,
                            s = !1,
                            u = function () {
                                var e = "function" == typeof n.target.getAttribute ? n.target.getAttribute("for") : null;
                                return e ? (s = !0, (0, F["default"])("#" + e)) : (0, F["default"])(n.target)
                            }();
                        if (u.closest("[disabled]").length) return null;
                        if (u.closest("." + G.BASE).length) return null;
                        if (u.closest("[data-disable-popover-automatic-deactivation=true]").length) return null;
                        var f = u.closest("." + G.CONTAINER),
                            h = f.children("." + G.BASE)[0];
                        return h && (a = c(l(h)),
                        a.disabled) ? null : f.length ? s ? null : (o = f[0],
                        r = Date.now(),
                        t === o && r - e < 500 ? null : (e = r,
                        t = o,
                        n.preventDefault(),
                        i = f.children("." + G.BASE)[0],
                        i == null ? null : i.classList.contains(z.BASE.JS_ACTIVATED) ? null : i.classList.contains(z.BASE.NO_FOCUS) ? p() : "focusin" === n.type ? d(i) : m(i))) : null != ee.popover && ee.popover.base.classList.contains(z.BASE.JS_ACTIVATED) ? null : p()
                    }
                }(),
                re = function () {
                    function e(e, t) {
                        return e + t.scrollHeight
                    }
                    return function () {
                        return ee.popover.panes.reduce(e, 0)
                    }
                }(),
                oe = {
                    activeCache: ee,
                    a11yPopovers: a,
                    cachePopoverCSSProperties: s,
                    baseFontSize: te,
                    calculatePixelDimension: u,
                    activate: d,
                    applyActivationMarkup: f,
                    attachActiveEventListeners: h,
                    toggle: m,
                    deactivate: p,
                    applyDeactivationMarkup: v,
                    detachActiveEventListeners: g,
                    positionPopover: E,
                    horizontallyPositionWithCenterAlignment: S,
                    horizontallyPositionWithEdgeAlignment: A,
                    calculateHorizontalOffsets: T,
                    spaceDetailsForActivePopover: k,
                    calculateMaxWidth: w,
                    determineVerticalPositioning: N,
                    topSpaceReservedForHeader: ne,
                    popoverFocus: ie,
                    popoverKeydown: R,
                    popoverPaneScroll: P,
                    _init: M
                };
            o["for"] = function (e) {
                var t = (0, F["default"])(e).closest("." + G.BASE);
                return t.length ? t.data(G.BASE) || o(t[0]) : null
            }, o.send = function (e) {
                for (var t = arguments.length, n = Array(t > 1 ? t - 1 : 0), i = 1; i < t; i++) n[i - 1] = arguments[i];
                return n.length ? null == oe[e] ? null : oe[e].apply(null, n) : oe[e]
            }, o.deactivate = function () {
                return p()
            }, o.CLASSES = G, o.EVENTS = Y, o.STATES = K, o.VARIANTS = z, o.ATTRS = X, o.POSITIONS = Q, o.ZINDEX = 21, t["default"] = o;
            var ae = 1,
                se = null;
            M(), Bizweb.UIPopover = null != t["default"] ? t["default"] : t
        }),
        te = t(function (e, t) {
            var i = O["default"],
                d = g["default"];
            t.ContextBar = i, t.rootDispatcher = d, Bizweb.Components = null != t["default"] ? t["default"] : t
        }),
        ne = t(function (e) {
            ! function (t, n) {
                "function" == typeof define && define.amd ? define(n) : e.exports = n()
            }(0, function () {
                function e(e, t, n) {
                    return e < t ? t : e > n ? n : e
                }

                function t(e) {
                    return 100 * (-1 + e)
                }

                function n(e, n, i) {
                    var r;
                    return r = "translate3d" === l.positionUsing ? {
                        transform: "translate3d(" + t(e) + "%,0,0)"
                    } : "translate" === l.positionUsing ? {
                        transform: "translate(" + t(e) + "%,0)"
                    } : {
                        "margin-left": t(e) + "%"
                    }, r.transition = "all " + n + "ms " + i, r
                }

                function i(e, t) {
                    return ("string" == typeof e ? e : a(e)).indexOf(" " + t + " ") >= 0
                }

                function r(e, t) {
                    var n = a(e),
                        r = n + t;
                    i(n, t) || (e.className = r.substring(1))
                }

                function o(e, t) {
                    var n, r = a(e);
                    i(e, t) && (n = r.replace(" " + t + " ", " "), e.className = n.substring(1, n.length - 1))
                }

                function a(e) {
                    return (" " + (e.className || "") + " ").replace(/\s+/gi, " ")
                }

                function s(e) {
                    e && e.parentNode && e.parentNode.removeChild(e)
                }
                var u = {};
                u.version = "0.1.6";
                var l = u.settings = {
                    minimum: .08,
                    easing: "ease",
                    positionUsing: "",
                    speed: 200,
                    trickle: !0,
                    trickleRate: .02,
                    trickleSpeed: 800,
                    showSpinner: !0,
                    barSelector: '[role="bar"]',
                    spinnerSelector: '[role="spinner"]',
                    parent: "body",
                    template: '<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'
                };
                u.configure = function (e) {
                    var t, n;
                    for (t in e) (n = e[t]) !== undefined && e.hasOwnProperty(t) && (l[t] = n);
                    return this
                }, u.status = null, u.set = function (t) {
                    var i = u.isStarted();
                    t = e(t, l.minimum, 1), u.status = 1 === t ? null : t;
                    var r = u.render(!i),
                        o = r.querySelector(l.barSelector),
                        a = l.speed,
                        s = l.easing;
                    return r.offsetWidth, c(function (e) {
                        "" === l.positionUsing && (l.positionUsing = u.getPositioningCSS()), d(o, n(t, a, s)), 1 === t ? (d(r, {
                            transition: "none",
                            opacity: 1
                        }), r.offsetWidth, setTimeout(function () {
                            d(r, {
                                transition: "all " + a + "ms linear",
                                opacity: 0
                            }), setTimeout(function () {
                                u.remove(), e()
                            }, a)
                        }, a)) : setTimeout(e, a)
                    }), this
                }, u.isStarted = function () {
                    return "number" == typeof u.status
                }, u.start = function () {
                    u.status || u.set(0);
                    var e = function () {
                        setTimeout(function () {
                            u.status && (u.trickle(), e())
                        }, l.trickleSpeed)
                    };
                    return l.trickle && e(), this
                }, u.done = function (e) {
                    return e || u.status ? u.inc(.3 + .5 * Math.random()).set(1) : this
                }, u.inc = function (t) {
                    var n = u.status;
                    return n ? ("number" != typeof t && (t = (1 - n) * e(Math.random() * n, .1, .95)), n = e(n + t, 0, .994), u.set(n)) : u.start()
                }, u.trickle = function () {
                    return u.inc(Math.random() * l.trickleRate)
                },
                    function () {
                        var e = 0,
                            t = 0;
                        u.promise = function (n) {
                            return n && "resolved" != n.state() ? (0 == t && u.start(), e++, t++, n.always(function () {
                                t--, 0 == t ? (e = 0, u.done()) : u.set((e - t) / e)
                            }), this) : this
                        }
                    }(), u.render = function (e) {
                        if (u.isRendered()) return document.getElementById("nprogress");
                        r(document.documentElement, "nprogress-busy");
                        var n = document.createElement("div");
                        n.id = "nprogress", n.innerHTML = l.template;
                        var i, o = n.querySelector(l.barSelector),
                            a = e ? "-100" : t(u.status || 0),
                            c = document.querySelector(l.parent);
                        return d(o, {
                            transition: "all 0 linear",
                            transform: "translate3d(" + a + "%,0,0)"
                        }), l.showSpinner || (i = n.querySelector(l.spinnerSelector)) && s(i), c != document.body && r(c, "nprogress-custom-parent"), c.appendChild(n), n
                    }, u.remove = function () {
                        o(document.documentElement, "nprogress-busy"), o(document.querySelector(l.parent), "nprogress-custom-parent");
                        var e = document.getElementById("nprogress");
                        e && s(e)
                    }, u.isRendered = function () {
                        return !!document.getElementById("nprogress")
                    }, u.getPositioningCSS = function () {
                        var e = document.body.style,
                            t = "WebkitTransform" in e ? "Webkit" : "MozTransform" in e ? "Moz" : "msTransform" in e ? "ms" : "OTransform" in e ? "O" : "";
                        return t + "Perspective" in e ? "translate3d" : t + "Transform" in e ? "translate" : "margin"
                    };
                var c = function () {
                    function e() {
                        var n = t.shift();
                        n && n(e)
                    }
                    var t = [];
                    return function (n) {
                        t.push(n), 1 == t.length && e()
                    }
                }(),
                    d = function () {
                        function e(e) {
                            return e.replace(/^-ms-/, "ms-").replace(/-([\da-z])/gi, function (e, t) {
                                return t.toUpperCase()
                            })
                        }

                        function t(e) {
                            var t = document.body.style;
                            if (e in t) return e;
                            for (var n, i = r.length, o = e.charAt(0).toUpperCase() + e.slice(1) ; i--;)
                                if ((n = r[i] + o) in t) return n;
                            return e
                        }

                        function n(n) {
                            return n = e(n), o[n] || (o[n] = t(n))
                        }

                        function i(e, t, i) {
                            t = n(t), e.style[t] = i
                        }
                        var r = ["Webkit", "O", "Moz", "ms"],
                            o = {};
                        return function (e, t) {
                            var n, r, o = arguments;
                            if (2 == o.length)
                                for (n in t) (r = t[n]) !== undefined && t.hasOwnProperty(n) && i(e, n, r);
                            else i(e, o[1], o[2])
                        }
                    }();
                return u
            })
        }),
        ie = t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var i = n($),
                r = n(ne),
                o = '\n<div class="loading-bar__container">\n  <div class="loading-bar"></div>\n</div>\n',
                a = {
                    continueAfterRefresh: function (e) {
                        var t = this._continueLoading;
                        this._continueLoading = !0;
                        try {
                            return e()
                        } finally {
                            this._continueLoading = t
                        }
                    },
                    withoutLoadingBar: function (e) {
                        var t = this._noLoading;
                        this._noLoading = !0;
                        try {
                            return e()
                        } finally {
                            this._noLoading = t
                        }
                    },
                    start: function () {
                        this.loading || (this.loading = !0, r["default"].configure({
                            parent: "body",
                            barSelector: ".loading-bar",
                            template: o
                        }), r["default"].start(), (0, i["default"])("body").addClass("is-loading"))
                    },
                    stop: function () {
                        this.loading = !1, r["default"].done(), (0, i["default"])("body").removeClass("is-loading")
                    },
                    increment: function (e) {
                        return r["default"].inc(e)
                    },
                    _continue: function () {
                        this.loading && (r["default"].set(r["default"].status), (0, i["default"])("body").addClass("is-loading"))
                    }
                };
            (0, i["default"])(document).on("page:fetch turbograft:remote:init", function () {
                a._noLoading || a.start()
            }), (0, i["default"])(document).on("page:load turbograft:remote:always", function () {
                a._continueLoading ? a._continue() : a.stop()
            }), t["default"] = a, Bizweb.Loading = null != t["default"] ? t["default"] : t
        }),
        re = t(function(e, t) {
            "use strict";

            function s() {
                window.Bizweb.Forms._dirtyForm = !0
            }

            function u(e, t) {
                return p["default"].size(e) === p["default"].size(t) && p["default"].chain(e).zip(t).every(function(e) {
                    var t = i(e, 2),
                        n = t[0],
                        r = t[1];
                    return n.disabled || n.value === r.value
                }).value()
            }

            function l(e) {
                var t = e.currentTarget,
                    n = t.value;
                n && (t.value = new window.Bizweb.Money(n).toDelimiteredString(),
                    v["default"].change(t))
            }

            function c(e) {
                var t = e.currentTarget,
                    n = window.Bizweb.Number.parseFloatWithCommas(t.value);
                t.value = n || 0, v["default"].change(t)
            }

            function f(e) {
                var t = e.currentTarget,
                    n = window.Bizweb.Number.parseInteger(t.value);
                t.value = n || 0, v["default"].change(t)
            }

            function h(e) {
                if (e.data.url) E["default"].refresh({
                    url: e.data.url
                });
                else {
                    //var t = window.Twine.context(document.body).CancelContextModal;

                    Twine.refresh();
                    var content = $("#CancelContextModal").html();
                    var t = new Bizweb.Modal(this);
                    t && t.show({ content: content });
                }
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.RTE_INITIALIZED_EVENT = undefined, t.alertIfFormDirty = s, t.matchEnabledValues = u, t.cleanMoneyField = l, t.cleanDecimalField = c, t.cleanIntegerField = f;
            var m = a(y),
                p = n(_),
                v = n(Twine),
                g = n($),
                b = n(ie),
                E = n(d),
                A = t.RTE_INITIALIZED_EVENT = "rte:initialized",
                S = "a.js-btn-primary, input.js-btn-primary, button.js-btn-primary",
                T = "a.js-btn-loadable, input.js-btn-loadable, button.js-btn-loadable, select.js-btn-loadable",
                C = (0, g["default"])(document);
            C.on("keypress", "form[no-submit-on-enter] input", function(e) {
                13 === e.which && e.preventDefault()
            }), C.on("keydown", "form[submit-on-cmd-enter] input", function(e) {
                e.which === m.ENTER && (e.metaKey || e.ctrlKey ? this.form.submit(e) : e.preventDefault())
            }), C.on("keypress", ".click-on-enter", function(e) {
                13 === e.which && (0, g["default"])(e.target).click()
            }), E["default"].onChange(function() {
                return window.Bizweb.Forms._dirtyForm
            }, function() {
                window.Bizweb.Forms._dirtyForm = !1
            }), C.on("submit", "form[ajax]", function(e) {
                e.preventDefault();
                var t = (0, g["default"])(e.target),
                    n = t.serialize(),
                    i = {
                        type: t.attr("method"),
                        url: t.attr("action"),
                        data: n,
                        dataType: "html",
                        fail: function() {
                            for (var e = arguments.length, n = Array(e), i = 0; i < e; i++) n[i] = arguments[i];
                            t.trigger("fail", n)
                        },
                        done: function () {
                            for (var e = arguments.length, n = Array(e), i = 0; i < e; i++) n[i] = arguments[i];
                            t.trigger("done", n)
                        }
                    };
                new window.Bizweb.Remote(i, t.attr("refresh-on-success"), t.attr("refresh-on-error")).submit()
            });
            var k = function() {
                function e(t) {
                    var n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                    o(this, e), this.opts = n, this.bindingsFinished = this.bindingsFinished.bind(this), this.updateRTEInitialValue = this.updateRTEInitialValue.bind(this), this._updateDirty = this._updateDirty.bind(this), this._updateDirtyState = this._updateDirtyState.bind(this), this._initializeButtons = this._initializeButtons.bind(this), this.submit = this.submit.bind(this), this.startLoading = this.startLoading.bind(this), this.stopLoading = this.stopLoading.bind(this), this.$form = (0, g["default"])(t), this.$primaryButtons = this.$form.find(S), this.$primaryButtons.addClass("btn-primary"), this.primaryAttr = this.$form.data("context-bar-primary-attributes"), this.contextBarNode = document.querySelector(".ui-context-bar"), te.rootDispatcher.register("DIRTY_STATE_REVERT", h).bindToNode(t), te.rootDispatcher.register("CONTEXT_BAR_SHOWN_EVENT", this._initializeButtons).bindToNode(t), t && t.id && (this.$primaryButtons = this.$primaryButtons.add(".js-btn-primary[form='" + t.id + "']")), this.$loadableButtons = this.$form.find(T), t && t.id && (this.$loadableButtons = this.$loadableButtons.add(".js-btn-loadable[form='" + t.id + "']")), this.$loadableButtons.addClass("has-loading"), this.$form.on("input change paste bindings:change", this._updateDirty), this.$form.on("submit", this.submit), this.$form.on("fail done", this.stopLoading),
                    //this.$form.on("change", "input.js-money-field", l),
                    this.$form.on("change", "input.js-decimal-field", c),
                    this.$form.on("change", "input.js-integer-field", f),
                    this.$form.on(A, this.updateRTEInitialValue),
                    this.opts.disabledUntilDirty &&
                    this.$primaryButtons.attr("disabled", "disabled"),
                    this.opts.observer && 
                    this.opts.observer.register(this, this.$form), v["default"].afterBound(this.bindingsFinished)

                    var that = this;
                    if (typeof CKEDITOR !== "undefined") {
                        for (var i in CKEDITOR.instances) {
                            CKEDITOR.instances[i].on('change', function (e) {
                                var id = this.element.$.id;
                                document.getElementById(id).value = this.getData();
                                that._updateDirtyState();
                            });
                        }
                    }
                }
                return r(e, null, [{
                    key: "withIgnoreUnsavedChanges",
                    value: function(e) {
                        var t = this._dirtyForm;
                        return this._dirtyForm = !1, e.call(), this._dirtyForm = t, this._dirtyForm
                    }
                }, {
                    key: "makeClean",
                    value: function() {
                        return this._dirtyForm = !1, this._dirtyForm
                    }
                }, {
                    key: "resetChanges",
                    value: function() {
                        e.makeClean(), te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_OFF_EVENT"
                        }), E["default"].refresh()
                    }
                }]), r(e, [{
                    key: "bindingsFinished",
                    value: function() {
                        this.resetDirtyTracking(), this.opts.startDirty && this.makeDirty()
                    }
                }, {
                    key: "updateRTEInitialValue",
                    value: function(e) {
                        var t = e.target,
                            n = t.id,
                            i = this.initialValues.find(function(e) {
                                var t = e.id;
                                return n === t
                            });
                        null != i && (i.value = t.value), this._updateDirtyState()
                    }
                }, {
                    key: "makeClean",
                    value: function() {
                        this.isDirty = !1, this.opts.keepGlobalDirtyState || (e._dirtyForm = !1), this.$primaryButtons.removeAttr("data-form-dirty"), te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_UPDATE_PRIMARY_ACTION",
                            data: {
                                disabled: !0,
                                loading: !1
                            }
                        }), this.opts.disableContextBar || te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_OFF_EVENT"
                        }), this.opts.disabledUntilDirty && this.$primaryButtons.attr("disabled", "disabled")
                    }
                }, {
                    key: "makeDirty",
                    value: function() {
                        this.isDirty = !0, this.opts.alertUnsavedChanges && s(), this.enablePrimaryButtons(), this.opts.disabledUntilDirty && !this.opts.disableContextBar && this.showContextBar()
                    }
                }, {
                    key: "showContextBar",
                    value: function() {
                        var e = {
                            form: this.$form.attr("id")
                        },
                            t = Object.assign(e, this.primaryAttr);
                        te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_ON_EVENT",
                            data: {
                                primaryAttr: t
                            }
                        })
                    }
                }, {
                    key: "enablePrimaryButtons",
                    value: function() {
                        this.disabled || (this.$primaryButtons.attr("data-form-dirty", !0), this.opts.disabledUntilDirty && this.$primaryButtons.removeAttr("disabled"), te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_UPDATE_PRIMARY_ACTION",
                            data: {
                                disabled: !1,
                                loading: !1
                            }
                        }))
                    }
                }, {
                    key: "resetDirtyTracking",
                    value: function() {
                        return this.makeClean(), this.initialValues = this._getInputValues(), this.initialValues
                    }
                }, {
                    key: "isClean",
                    value: function() {
                        return !this.isDirty
                    }
                }, {
                    key: "enable",
                    value: function() {
                        return this.disabled = !1, this.isDirty ? this.makeDirty() : null
                    }
                }, {
                    key: "disable",
                    value: function() {
                        return this.disabled = !0, this.$primaryButtons.attr("disabled", "disabled")
                    }
                }, {
                    key: "submit",
                    value: function(t) {
                        var n = void 0;
                        if (this.opts.keepGlobalDirtyState || (e._dirtyForm = !1), "function" == typeof this.opts.submit) {
                            for (var i = arguments.length, r = Array(i > 1 ? i - 1 : 0), o = 1; o < i; o++) r[o - 1] = arguments[o];
                            n = this.opts.submit.apply(this, [t].concat(r))
                        }
                        return null != t && t.isImmediatePropagationStopped() || this.startLoading(), n
                    }
                }, {
                    key: "startLoading",
                    value: function(e) {
                        var t = this.$loadableButtons;
                        null != e && e.$loadingElements && (t = e.$loadingElements), b["default"].start(), t.attr("disabled", "disabled").addClass("is-loading"), te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_UPDATE_PRIMARY_ACTION",
                            data: {
                                disabled: !0,
                                loading: !0
                            }
                        })
                    }
                }, {
                    key: "stopLoading",
                    value: function(e) {
                        var t = this.$loadableButtons;
                        null != e && e.$loadingElements && (t = e.$loadingElements), b["default"].stop(), t.removeAttr("disabled").removeClass("is-loading"), te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_UPDATE_PRIMARY_ACTION",
                            data: {
                                disabled: !1,
                                loading: !1
                            }
                        })
                    }
                }, {
                    key: "disableHiddenInputs",
                    value: function() {
                        this.$form.find(".disable-inputs-when-hidden:visible :input").prop("disabled", !1), this.$form.find(".disable-inputs-when-hidden:not(:visible) :input").prop("disabled", "disabled")
                    }
                }, {
                    key: "_initializeButtons",
                    value: function() {
                        this.$form && this.$form.attr("id") && (this.$primaryButtons = this.$primaryButtons.add('.js-btn-primary[form="' + this.$form.attr("id") + '"]'), this.$loadableButtons = this.$loadableButtons.add('.js-btn-loadable[form="' + this.$form.attr("id") + '"]')), this.opts.disabledUntilDirty && !this.isDirty && (this.$primaryButtons.attr("disabled", "disabled"), te.rootDispatcher.dispatch({
                            type: "CONTEXT_BAR_UPDATE_PRIMARY_ACTION",
                            data: {
                                disabled: !0,
                                loading: !1
                            }
                        })), v["default"].bind(this.contextBarNode)
                    }
                }, {
                    key: "_updateDirty",
                    value: function(e) {
                        var t = e.target;
                        t.classList.contains("js-no-dirty") || ["form", "input", "textarea", "select"].includes(t.nodeName.toLowerCase()) && ("hidden" === t.type && null === (0, g["default"])(t).data("dirty-trigger") || (null == this.debounceValidate && (this.debounceValidate = p["default"].debounce(this._updateDirtyState, 10, {
                            leading: !0,
                            trailing: !0
                        })), this.debounceValidate()))
                    }
                }, {
                    key: "_updateDirtyState",
                    value: function() {
                        return u(this._getInputValues(), this.initialValues) ? this.makeClean() : this.makeDirty(), v["default"].refresh()
                    }
                }, {
                    key: "_getInputValues",
                    value: function() {
                        var e = this.$form.find("input, select, textarea").not(".js-no-dirty");
                        return p["default"].map(e, function(e) {
                            var t = e.id,
                                n = e.disabled,
                                i = e.type,
                                r = e.checked,
                                o = e.value;
                            return o = ["checkbox", "radio"].includes(i) ? r : o, {
                                id: t,
                                value: o,
                                disabled: n
                            }
                        })
                    }
                }]), e
            }();
            k.RTE_INITIALIZED_EVENT = A, k._dirtyForm = !1, t["default"] = k, Bizweb.Forms = null != t["default"] ? t["default"] : t
        });

    var se = t(function (e, t) {
        "use strict";

        function n(e) {
            function t(e) {
                var t = o(e, n, {
                    noRound: !0
                });
                return u || 1 !== n || (t = Number(t)), t
            }
            var n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1,
                r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                a = r.forceZeroDecimal,
                u = a !== undefined && a;
            if (null != e) {
                var l = e < 0,
                    c = Math.abs(e),
                    d = void 0;
                switch (i(c)) {
                    case "b":
                        d = t(c / 1e9) + "b";
                        break;
                    case "m":
                        d = t(c / 1e6) + "m";
                        break;
                    case "k":
                        d = t(c / 1e3) + "k";
                        break;
                    default:
                        d = s(t(c))
                }
                return l ? "\u2212" + d : d
            }
        }

        function i(e) {
            return e > 999999999 ? "b" : e > 999999 ? "m" : e > 999 ? "k" : null
        }

        function r() {
            var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0,
                t = arguments[1],
                n = Math.abs(e),
                i = t;
            return null == i && (i = n < 1 && 0 !== n ? 1 : 0), s(o(n, i), ",") + "%"
        }

        function o(e) {
            var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null,
                n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                i = n.noRound,
                r = i !== undefined && i;
            if (null === t) return e;
            if (r) {
                var o = void 0;
                o = 0 === t ? new RegExp("\\d+") : new RegExp("\\d+\\.(\\d{0," + t + "})");
                var a = e.toString().match(o);
                if (a) {
                    var s = a[0],
                        u = a[1];
                    if (u && u.length < t)
                        for (var l = t - u.length, c = 0; c < l; c++) s += "0";
                    return s
                }
            }
            return Number(e).toFixed(t)
        }

        function a(e) {
            var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0,
                n = Math.pow(10, t);
            return Math.round(Number(e) * n) / n
        }

        function s(e) {
            var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ",";
            if (null == e) return "";
            var n = e.toString().split(".");
            return n[0] = n[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1" + t), n.join(".")
        }

        function u(e) {
            var t = parseInt(e, 10);
            return isFinite(t) || (t = 0), t
        }

        function l(e) {
            var t = (null == e ? null : e.toString()) || "";
            return t ? Number(t.replace(/,/g, "")) : 0
        }

        function c(e) {
            return !isNaN(e) && parseInt(Number(e), 10) === e
        }

        function isFractionFunc(e) {
            return Math.floor(e) !== e
        }

        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.condensed = n, t.getRangeGroup = i, t.percentage = r, t.withPrecision = o, t.roundToPrecision = a, t.withDelimiter = s, t.parseInteger = u, t.parseFloatWithCommas = l, t.isInteger = c, t.isFraction = isFractionFunc,
        Bizweb.Number = null != t["default"] ? t["default"] : t
    });
    t(function (e, t) {
        "use strict";

        function n() {
            return v.getCurrency(Bizweb.store.settings.currency)
        }

        function s(e) {
            return e.map(function (e) {
                return e instanceof E ? e : new E(e)
            })
        }

        function u(e) {
            return isNaN(parseInt(e, 10)) ? "0" : e
        }

        function l(e) {
            return e.toString().length - 1
        }

        function c(e, t) {
            return Number("0." + u(e)).toFixed(l(t)) * t
        }

        function d(e) {
            return e.replace(/[^0-9]/g, "")
        }

        function h(e, t) {
            var n = t.decimal_mark,
                r = t.subunit_to_unit,
                o = e.split(A).map(d),
                a = e.match(A) || [],
                s = a.length,
                l = a[s - 1],
                f = o[o.length - 1],
                h = 0,
                m = 0;
            if (l === n) {
                var _ = new RegExp("[^0-9-" + n + "]", "g"),
                    p = e.replace(_, ""),
                    y = p.split(n),
                    v = i(y, 2);
                h = v[0], m = v[1]
            } else !s || !a.includes(n) && 2 !== f.length ? h = e.replace(/[^0-9]/g, "") : (h = o.slice(0, s).join(""), m = o.slice(s, s + 1).join(""));
            return h = parseInt(u(h), 10), m = c(m, r), h * r + m
        }

        function m(e, t) {
            if (e instanceof E) return e.cents;
            var n = e.toString().trim(),
                i = 1;
            return "-" === n.charAt(0) && (i = -1, n = n.substring(1)), i * h(n, t)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var y = a(se),
            v = a(p),
            g = /(\{\{\s*(\w+)\s*\}\})/,
            b = "\u2212",
            E = function () {
                function e(t) {
                    var i = !(arguments.length > 1 && arguments[1] !== undefined) || arguments[1];
                    o(this, e), this.cents = i ? m(t, n()) : t
                }
                return r(e, [{
                    key: "add",
                    value: function () {
                        for (var t = arguments.length, n = Array(t), i = 0; i < t; i++) n[i] = arguments[i];
                        return new e(s(n).reduce(function (e, t) {
                            return e + t.cents
                        }, this.cents), !1)
                    }
                }, {
                    key: "sub",
                    value: function () {
                        for (var t = arguments.length, n = Array(t), i = 0; i < t; i++) n[i] = arguments[i];
                        return new e(s(n).reduce(function (e, t) {
                            return e - t.cents
                        }, this.cents), !1)
                    }
                }, {
                    key: "mul",
                    value: function (t) {
                        return new e(this.cents * t, !1)
                    }
                }, {
                    key: "div",
                    value: function (t) {
                        return new e(this.cents / t, !1)
                    }
                }, {
                    key: "toFloat",
                    value: function () {
                        return this.cents / n().subunit_to_unit
                    }
                }, {
                    key: "toFixed",
                    value: function (e) {
                        return this.toFloat().toFixed(e)
                    }
                }, {
                    key: "toString",
                    value: function () {
                        return e.format(this.toFloat(), e.moneyFormat())
                    }
                }, {
                    key: "toUnencodedString",
                    value: function () {
                        return e.format(this.toFloat(), e.moneyUnencodedFormat())
                    }
                }, {
                    key: "toDelimiteredString",
                    value: function () {
                        return e.formatWithDelimiters(this.cents / n().subunit_to_unit)
                    }
                }, {
                    key: "valueOf",
                    value: function () {
                        return this.toFloat()
                    }
                }, {
                    key: "isEqual",
                    value: function (e) {
                        return m(e, n()) === this.cents
                    }
                }, {
                    key: "isZero",
                    value: function () {
                        return 0 === this.cents
                    }
                }], [{
                    key: "moneyFormat",
                    value: function () {
                        return n().money_format
                    }
                }, {
                    key: "moneyUnencodedFormat",
                    value: function () {
                        return n().money_in_emails_format
                    }
                }, {
                    key: "format",
                    value: function (t) {
                        var n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : e.moneyUnencodedFormat(),
                            r = void 0,
                            o = void 0;
                        if (null != t) {
                            var a = t < 0,
                                s = Math.abs(Number(t)),
                                u = n.match(g);
                            if (u) {
                                var l = i(u, 3),
                                    c = l[1];
                                switch (l[2]) {
                                    case "amount_no_decimals":
                                        o = this.formatWithDelimiters(s, 0);
                                        break;
                                    case "amount_with_comma_separator":
                                        o = this.formatWithDelimiters(s, 2, ".", ",");
                                        break;
                                    case "amount_with_space_separator":
                                        o = this.formatWithDelimiters(s, 2, " ", ",");
                                        break;
                                    case "amount_with_period_and_space_separator":
                                        o = this.formatWithDelimiters(s, 2, " ", ".");
                                        break;
                                    case "amount_no_decimals_with_comma_separator":
                                        o = this.formatWithDelimiters(s, 0, ".", ",");
                                        break;
                                    case "amount_no_decimals_with_space_separator":
                                        o = this.formatWithDelimiters(s, 0, " ");
                                        break;
                                    case "amount_with_apostrophe_separator":
                                        o = this.formatWithDelimiters(s, 2, "'", ".");
                                        break;
                                    default:
                                        o = this.formatWithDelimiters(s, 2)
                                }
                                return r = n.replace(c, o), a ? "" + b + r : r
                            }
                        }
                    }
                }, {
                    key: "formatWithCurrency",
                    value: function (e) {
                        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Bizweb.store.settings.currency,
                            n = v.getCurrency(t).money_format;
                        return this.format(e, n)
                    }
                }, {
                    key: "formatWithDelimiters",
                    value: function (e) {
                        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : l(n().subunit_to_unit),
                            i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ",",
                            r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : ".",
                            o = e.toFixed(t).split(".");
                        return o[0] = o[0].replace(/(\d)(?=(\d{3})+\b)/g, "$1" + i), o.join(r)
                    }
                }, {
                    key: "condensed",
                    value: function (e) {
                        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.moneyFormat(),
                            n = void 0,
                            r = y.isInteger(e) ? 1 : 2,
                            o = y.condensed(e, r);
                        ["B", "M", "K"].includes(n = o.charAt(o.length - 1)) ? o = o.slice(0, -1) : n = "";
                        var a = t.match(/(\{\{\s*(\w+)\s*\}\})/),
                            s = i(a, 1),
                            u = s[0];
                        return t.replace(u, o + n + " ")
                    }
                }, {
                    key: "invoicingFormat",
                    value: function (e, t) {
                        var n = v.getCurrency(t).money_format;
                        return 0 === e ? "Free" : "USD" !== t || t !== Bizweb.store.settings.currency ? this.format(e, n) + " " + t : this.format(e, n)
                    }
                }]), e
            }();
        t["default"] = E;
        var A = /[',.]/g;
        Bizweb.Money = null != t["default"] ? t["default"] : t
    });

    var ue = (t(function (e, t) {
        "use strict";

        function n(e) {
            var t = e.from,
                n = t === undefined ? 1 : t,
                i = e.to,
                r = e.inclusive,
                o = r === undefined || r,
                a = o ? i + 1 : i;
            return Array(a - n).join().split(",").map(function (e, t) {
                return t + n
            })
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t["default"] = n, Bizweb.range = null != t["default"] ? t["default"] : t
    }), t(function (e, t) {
        "use strict";

        function a(e) {
            var t = document.createElement("script");
            return Object.entries(e.attributes).forEach(function (e) {
                var n = i(e, 2),
                    r = n[0],
                    o = n[1];
                t.setAttribute(r, o)
            }), t
        }

        function s(e) {
            return null != e.name && "function" == typeof e.getModule
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var l = function () {
                function e(t) {
                    var n = this;
                    o(this, e), this.promises = t || {}, this.pageDependentPromises = {}, document.addEventListener("page:load", function () {
                        n.pageDependentPromises = {}
                    })
                }
                return r(e, [{
                    key: "requireScript",
                    value: function (e) {
                        if (!s(e)) throw new Error("Invalid Dependency Definition.");
                        var t = this.promises;
                        if (e.reloadAfterNavigation && (t = this.pageDependentPromises), t[e.name]) return t[e.name];
                        var n = a(e);
                        return t[e.name] = new Promise(function (t, i) {
                            function r() {
                                n.removeEventListener("load", r), n.removeEventListener("error", o), t(e.getModule())
                            }

                            function o(t) {
                                n.removeEventListener("load", r), n.removeEventListener("error", o), i(t)
                            }
                            document.head.appendChild(n), n.addEventListener("load", r), n.addEventListener("error", o)
                        }), t[e.name]
                    }
                }]), e
            }();
        t["default"] = l
    })),
        le = t(function (e, t) {
            "use strict";

            function i(e) {
                return o.requireScript(e)
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t["default"] = i;
            var r = n(ue),
                o = new r["default"];
            Bizweb.asyncRequire = null != t["default"] ? t["default"] : t
        });

    t(function (e, t) {
        "use strict";

        function r() {
            return Promise.resolve(h["default"].ajax("/admin/dashboard/token", {
                dataType: "json",
                global:false,
            })).then(function (e) {
                return e.token
            })
        }

        function o() {
            return null == p && (p = r()), p
        }

        function a(e) {
            p = Promise.resolve(e)
        }
        var first = true;
        function u(e, t) {
            var n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 2;
            return o().then(function (n) {
                return Promise.resolve(h["default"].ajax(_ + "/" + t.endpoint, {
                    dataType: "json",
                    method: "POST",
                    global: !first,
                    data: {
                        token: n,
                        q: e,
                        source: t.source
                    },
                    success: function () {
                        first = false;
                    }
                }))
            })["catch"](function (i) {
                if (i.status === m && n > 1) return p = null, u(e, t, n - 1);
                var r = i.responseJSON;
                return r && r.message ? Promise.reject(new Error("Query failed: " + r.message)) : Promise.reject(new Error("Query failed: " + i.responseText))
            })
        }

        function l(e, t) {
            for (var n = {}, i = 0; i < e.length; i++) {
                var r = e[i].query,
                    o = e[i].config,
                    a = o && o.endpoint ? o.endpoint : "queries",
                    s = o && o.source ? o.source : "Bizweb-home",
                    u = r.match(g);
                null != u && (u = u.slice(1).join(":")), u = u + ":" + a;
                var l = n[u] || [
                    [],
                    []
                ];
                n[u] = l, l[0].push(r), l[1].push(t[i]), l[2] = {
                    endpoint: a,
                    source: s
                }
            }
            return Object.values(n)
        }

        function c(e, t) {
            var n = l(e, t),
                r = !0,
                o = !1,
                a = undefined;
            try {
                for (var s, c = function () {
                        var e = i(s.value, 3),
                            t = e[0],
                            n = e[1];
                        u(t, e[2]).then(function (e) {
                            n.forEach(function (t, n) {
                                return t(Promise.resolve(e[n]))
                })
                })["catch"](function (e) {
                            n.forEach(function (t) {
                                return t(Promise.reject(e))
                })
                })
                }, d = n[Symbol.iterator]() ; !(r = (s = d.next()).done) ; r = !0) c()
            } catch (e) {
                o = !0, a = e
            } finally {
                try {
                    !r && d["return"] && d["return"]()
                } finally {
                    if (o) throw a
                }
            }
        }

        function d(e) {
            var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "queries",
                n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "Bizweb-home";
            if ("string" != typeof e) throw new Error("unexpected query " + (void 0 === e ? "undefined" : s(e)) + " " + e);
            return new Promise(function (i) {
                if (null == y || null == v) {
                    var r = y = [],
                        o = v = [];
                    setImmediate(function () {
                        c(r, o), y = null, v = null
                    })
                }
                var a = {
                    endpoint: t,
                    source: n
                };
                y.push({
                    query: e,
                    config: a
                }), v.push(i)
            })
        }

        function f(e) {
            return o().then(function (t) {
                var n = h["default"].param({
                    q: e,
                    format: "csv",
                    source: "bizweb-summary",
                    token: t,
                    beta: !0
                });
                return _ + "/query?" + n
            })
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.setToken = a, t.categorizeQueriesByTable = l, t.query = d, t.exportURL = f;
        var h = n($),
            m = 403,
            _ = "https://analytics.bizweb.vn",
            p = void 0,
            y = void 0,
            v = void 0,
            g = /FROM\s+(\w+)\b(?:.+?SINCE\s+([^\s]+)\b)?(?:.+?UNTIL\s+([^\s]+)\b)?/;
        Bizweb.AnalyticsAPI = null != t["default"] ? t["default"] : t
    });
    (function () {
        var e, t = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        e = "SHOW order_created_at FROM sales SINCE -1d UNTIL today ORDER BY order_created_at DESC LIMIT 1", Bizweb.StaleDataDetector = function () {
            function n(e, n) {
                this._showBannerIfStale = t(this._showBannerIfStale, this), this.lastMysqlOrderCreatedAt = moment(n), this._noRecentOrders() || (this.$node = $(e), this._fetchLastReportifyOrderCreatedAt())
            }
            return n.prototype._noRecentOrders = function () {
                return moment().diff(this.lastMysqlOrderCreatedAt, "days") > 1
            }, n.prototype._fetchLastReportifyOrderCreatedAt = function () {
                return Bizweb.AnalyticsAPI.query(e).then(this._showBannerIfStale.bind(this))["catch"](function () { })
            }, n.prototype._showBannerIfStale = function (e) {
                var t;
                if (t = moment(e.result.data[0][0]), this.lastMysqlOrderCreatedAt.diff(t, "minutes") > 10) return this.$node.removeClass("hide"), this.$node.parents(".stale-data-wrapper").removeClass("hide")
            }, n
        }()
    }).call(this);
    t(function (e, t) {
        "use strict";

        function i(e) {
            if (a["default"].isEmpty(e)) return "";
            if (1 === a["default"].size(e)) return e[0];
            if (2 === a["default"].size(e)) return e.join(" and ");
            var t = a["default"].last(e);
            return a["default"].take(e, a["default"].size(e) - 1).join(", ") + ", and " + t
        }

        function r(e) {
            var t = a["default"].camelCase(e);
            return t.charAt(0).toUpperCase() + t.slice(1)
        }

        function o(e) {
            return JSON.stringify(e).replace(/\u2028/g, "\\u2028").replace(/\u2029/g, "\\u2029")
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.humanizeList = i, t.pascalCase = r, t.separatorSafeJSONStringify = o;
        var a = n(_);
        Bizweb.String = null != t["default"] ? t["default"] : t
    });
    (function () {
        Bizweb.DateHandler = {
            setDateRangeCustom: function (e, t) {
                var n;
                return this.activeKey = "custom", n = $("#dateRangeSelect"), n.find('[value="custom"]').length || n.prepend("<option value='custom'>Custom</option>"), n.val("custom"), this.setDateRange(e, t)
            },
            extractDate: function (e) {
                var t, n, i, r, o, a, s, u, l;
                if ("absolute" === e[0][0]) return [e[0][1], e[1][1]];
                for (u = [], i = n = 0, r = e.length; n < r; i = ++n) o = e[i], a = o[0], l = o[1], s = o[2], t = Bizweb.Time.nowShop().moment[a](l, s), u.push(Bizweb.Time.fromShop(t).formatInShop());
                return u
            },
            setDateRangePreset: function (e) {
                var t, n, i;
                return n = this.extractDate(this.dateRangeFor(e)), i = n[0], t = n[1], this.setDateRange(i, t), this.datePicker.updateButton(this.humanizedDateLabelFor(e))
            },
            dateChangeHandler: function () {
                return this.setDateRangeCustom(this.datePicker.startDate(), this.datePicker.endDate())
            },
            dateRangeFor: function (e) {
                if (e) return Bizweb.DateRangeDb.getPeriod(e)
            },
            humanizedDateLabelFor: function (e) {
                return Bizweb.DateRangeDb.getTitle(e)
            },
            syncDataToYear: function (e, t) {
                return {
                    title: e.title.substring(0, e.title.length - 5) + t + ")",
                    days: {
                        start_date: moment(e.days.start_date).year(t),
                        end_date: moment(e.days.end_date).year(t)
                    }
                }
            }
        }
    }).call(this),
    function () {
        var e = [].slice;
        Bizweb.Mixin = function () {
            var t, n, i, r, o, a, s;
            for (a = arguments[0], o = 2 <= arguments.length ? e.call(arguments, 1) : [], t = 0, i = o.length; t < i; t++) {
                r = o[t];
                for (n in r) s = r[n], a[n] = s
            }
        }
    }.call(this);

    var ce = t(function (e, t) {
        "use strict";

        function n(e) {
            var t = e; -1 === e.indexOf("//") && "/" !== e[0] && (t = "/" + e);
            var n = document.createElement("a");
            return n.href = t, new URL(n.href)
        }

        function i(e) {
            return e.pathname.substring(1).split("/")
        }

        function r(e) {
            var t = e.password ? ":" + e.password : "";
            return [e.username ? "" + e.username + t + "@" : "", e.host].join("")
        }

        function o(e) {
            if (!e) return {};
            var t = e.replace(/&+/g, "&").replace(/^\?*&*|&+$/g, "");
            if (!t) return {};
            var n = t.split("&"),
                i = {},
                r = void 0,
                o = void 0,
                a = void 0,
                s = !0,
                u = !1,
                l = undefined;
            try {
                for (var c, d = n[Symbol.iterator]() ; !(s = (c = d.next()).done) ; s = !0) {
                    r = c.value.split("="), o = decodeURIComponent(r.shift().replace(/\+/g, "%20")), a = r.length ? decodeURIComponent(r.join("=").replace(/\+/g, "%20")) : null, "undefined" == typeof i[o] ? i[o] = a : f(i[o]) ? i[o].push(a) : (i[o] = [i[o]], i[o].push(a))
                }
            } catch (e) {
                u = !0, l = e
            } finally {
                try {
                    !s && d["return"] && d["return"]()
                } finally {
                    if (u) throw l
                }
            }
            return i
        }

        function a(e) {
            var t = "";
            return Object.keys(e).forEach(function (n) {
                if (f(e[n])) {
                    var i = {},
                        r = !0,
                        o = !1,
                        a = undefined;
                    try {
                        for (var s, u = e[n][Symbol.iterator]() ; !(r = (s = u.next()).done) ; r = !0) {
                            var l = s.value;
                            void 0 !== l && "undefined" == typeof i[String(l)] && (t += "&" + d(n, l), i[String(l)] = !0)
                        }
                    } catch (e) {
                        o = !0, a = e
                    } finally {
                        try {
                            !r && u["return"] && u["return"]()
                        } finally {
                            if (o) throw a
                        }
                    }
                } else "undefined" != typeof e[n] && (t += "&" + d(n, e[n]))
            }), t.substring(1)
        }

        function s(e, t) {
            var n = o(e.search);
            return Object.keys(t).forEach(function (e) {
                "undefined" == typeof n[e] ? n[e] = t[e] : f(n[e]) ? n[e].push(t[e]) : (n[e] = [n[e]], n[e].push(t[e]))
            }), e.search = a(n), e
        }

        function u(e, t) {
            var n = o(e.search);
            return Object.keys(t).forEach(function (e) {
                n[e] = t[e]
            }), e.search = a(n), e
        }

        function l(e) {
            var t = n(e);
            return t.protocol + "//" + r(t)
        }

        function c(e) {
            return encodeURIComponent(String(e)).replace(/%20/g, "+")
        }

        function d(e, t) {
            return c(e) + (null === t ? "" : "=" + c(t))
        }

        function f(e) {
            return "[object Array]" === Object.prototype.toString.call(e)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.getURL = n, t.getSegments = i, t.authority = r, t.parseSearchString = o, t.buildSearchString = a, t.addQuery = s, t.setQuery = u, t.origin = l, Bizweb.UrlMangler = null != t["default"] ? t["default"] : t
    }),
        de = (t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var n = {},
                i = {
                    findOrInit: function (e) {
                        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                        return n[e] || (n[e] = t)
                    }
                };
            t["default"] = i, Bizweb.VeryShortSession = null != t["default"] ? t["default"] : t
        }), t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t["default"] = {
                track: function () {
                    if (null != window.analytics) {
                        var e;
                        (e = window.analytics).track.apply(e, arguments)
                    }
                }
            }, Bizweb.analyticsHelper = null != t["default"] ? t["default"] : t
        })),
        fe = t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            }),
            //t.ANALYTICS_EVENTS =
            t.CLEAN_ICON_MAP = t.TYPE_ICON_MAP = t.STORAGE = t.ROUTES = t.ENDPOINTS = t.ATTRS = t.CLASSES = t.RECENT_SEARCHES = undefined;
            t.RECENT_SEARCHES = {
                LIST_SIZE: 3,
                CATEGORY_NAME: "recent_searches"
            }, t.CLASSES = {
                DOCUMENT_WRAPPER_VISIBLE: "quick-search-is-visible",
                WRAPPER: "quick-search",
                WRAPPER_VISIBLE: "quick-search--is-visible",
                CLOSE_BTN: "quick-search__close-btn",
                SPINNER: "quick-search__spinner",
                SPINNER_VISIBLE: "quick-search__spinner--is-visible",
                SPINNER_FULL_PAGE: "quick-search__spinner--full-page",
                BOX: "quick-search__box",
                INPUT: "quick-search__input",
                RESULTS: "quick-search__results",
                NO_RESULTS: "quick-search__no-results",
                RESULTS_MESSAGE: "quick-search__results-message",
                LIST_ITEM: "quick-search__list-item",
                RESULTS_ITEM: "quick-search__item",
                RESULTS_ITEM_ACTIVE: "quick-search__item--is-active",
                RESULT_TITLE: "quick-search__item-title",
                INSTRUCTIONS_BANNER: "quick-search__instructions-banner",
                INSTRUCTIONS_BANNER_VISIBLE: "quick-search__instructions-banner--is-visible"
            }, t.ATTRS = {
                RESULT_TOTAL_INDEX: "data-qs-total-result-index",
                RESULT_HREF: "href",
                RESULT_CATEGORY_NAME: "data-qs-category-name",
                RESULT_TARGET: "data-qs-target",
                RESULT_INDEX: "data-qs-result-index",
                MORE: "data-qs-more",
                CONTINUE_SEARCH_LINK: "data-continue-search-link"
            }, t.ENDPOINTS = {
                //SEARCH_INDEX: (0, h.quick_search_index)().html,
                SEARCH: "/admin/quick_search.json"
            }, t.ROUTES = {
                //LOGIN: (0, h.auth_login)().html
                LOGIN: "/admin/authorization/login"
            }, t.STORAGE = {
                CATEGORY_PREFIX: "quick-search__",
                INSTRUCTIONS_BANNER_COUNT_PREFIX: "quick-search__instructions-banner-count__",
                RECENT_SEARCHES: "quick-search__recent-searches"
            }, t.TYPE_ICON_MAP = {
                Customer: "icon-customer",
                Product: "icon-product",
                Order: "icon-order"
                //BlogArticle: "next-blogs",
                //Blog: "next-blogs",
                //Collection: "next-collections",
                //SmartCollection: "next-collections",
                //CustomCollection: "next-collections",
                //Customer: "next-customers",
                //Order: "next-orders",
                //StorefrontPage: "next-pages",
                //Product: "next-products"
            }, t.CLEAN_ICON_MAP = {
                orders: "icon-order",
                products: "icon-product",
                customers: "icon-customer"
                //help: "next-help",
                //shipping: "next-shipping",
                //topic: "next-topic",
                //products: "next-products",
                //email: "next-email",
                //marketing: "next-marketing",
                //themeSettings: "next-theme-settings",
                //notes: "next-notes",
                //phone: "next-phone",
                //calendar: "next-calendar",
                //apps: "next-apps",
                //settings: "next-settings",
                //checkout: "next-checkout",
                //customers: "next-customers",
                //domains: "next-domains",
                //orders: "next-orders",
                //giftcards: "next-giftcards",
                //reports: "next-reports",
                //dashboard: "next-dashboard",
                //collections: "next-collections",
                //add: "next-add",
                //blogPosts: "quick-search-temp/blog-posts",
                //blogAdd: "quick-search-temp/blog-add",
                //blogs: "quick-search-temp/blogs",
                //pages: "next-pages",
                //discounts: "next-discounts",
                //navigation: "next-navigation",
                //pos: "next-pos",
                //cash: "next-cash"
            }
            //, t.ANALYTICS_EVENTS = {
            //    ACT_ON_RESULT: "QuickSearch:ActOnResult",
            //    SEARCH: "QuickSearch:Search",
            //    SHOW_RESULTS: "QuickSearch:ShowResults",
            //    MORE_CLICK: "QuickSearch:MoreClick",
            //    CONTINUE_SEARCH_CLICK: "QuickSearch:ContinueSearchClick"
            //}
        });
    (function () {
        var e;
        e = ["rememberMe", "home_date_range", "homeSidebarDate", "homeSidebarChannel"], window.SafeLocalStorage = {
            get: function (e, t) {
                var n;
                if (2 !== arguments.length) throw "SafeLocalStorage developer error: You must supply a 2nd argument, a fallback/default value, to SafeLocalStorage.get()";
                try {
                    n = localStorage.getItem(e);
                    try {
                        return n = JSON.parse(n), "undefined" === n ? t : null != n ? n : t
                    } catch (e) {
                        return e, "undefined" === n ? t : null != n ? n : t
                    }
                } catch (e) {
                    return e, t
                }
            },
            set: function (e, t) {
                try {
                    return localStorage.setItem(e, JSON.stringify(t))
                } catch (e) { }
            },
            "delete": function (e) {
                try {
                    return localStorage.removeItem(e)
                } catch (e) { }
            },
            clear: function () {
                try {
                    return localStorage.clear()
                } catch (e) { }
            },
            clearUnsafeItems: function () {
                var t, n, i, r, o, a, s, u;
                try {
                    for (u = {}, t = 0, r = e.length; t < r; t++) i = e[t], null !== (s = this.get(i, null)) && (u[i] = s);
                    for (a = this.clear(), n = 0, o = e.length; n < o; n++) i = e[n], null !== (s = u[i]) && this.set(i, s);
                    return a
                } catch (e) { }
            }
        }
    }).call(this);
    var he = t(function (e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var i = n(window.SafeLocalStorage),
            a = function () {
                function e(t) {
                    var n = t.node,
                        i = t.uid,
                        r = t.hideAtCount;
                    o(this, e), this._hideAtCount = r, this._storageKey = "" + fe.STORAGE.INSTRUCTIONS_BANNER_COUNT_PREFIX + i, this._node = n
                }
                return r(e, [{
                    key: "hide",
                    value: function () {
                        this._node.classList.remove(fe.CLASSES.INSTRUCTIONS_BANNER_VISIBLE)
                    }
                }, {
                    key: "checkShow",
                    value: function () {
                        this._getCount() < this._hideAtCount ? this._node.classList.add(fe.CLASSES.INSTRUCTIONS_BANNER_VISIBLE) : this.hide()
                    }
                }, {
                    key: "incrementActionCount",
                    value: function () {
                        var e = this._getCount();
                        "number" == typeof e && (e++, i["default"].set(this._storageKey, e))
                    }
                }, {
                    key: "startActionCount",
                    value: function () {
                        "number" != typeof this._getCount() && i["default"].set(this._storageKey, 0)
                    }
                }, {
                    key: "_getCount",
                    value: function () {
                        return i["default"].get(this._storageKey, null)
                    }
                }]), e
            }();
        t["default"] = a
    }),
        me = t(function (t) {
            function n(e, t) {
                return null == e ? undefined : e[t]
            }

            function i(e) {
                var t = !1;
                if (null != e && "function" != typeof e.toString) try {
                    t = !!(e + "")
                } catch (e) { }
                return t
            }

            function r(e) {
                var t = -1,
                    n = e ? e.length : 0;
                for (this.clear() ; ++t < n;) {
                    var i = e[t];
                    this.set(i[0], i[1])
                }
            }

            function o() {
                this.__data__ = J ? J(null) : {}
            }

            function a(e) {
                return this.has(e) && delete this.__data__[e]
            }

            function s(e) {
                var t = this.__data__;
                if (J) {
                    var n = t[e];
                    return n === B ? undefined : n
                }
                return z.call(t, e) ? t[e] : undefined
            }

            function u(e) {
                var t = this.__data__;
                return J ? t[e] !== undefined : z.call(t, e)
            }

            function l(e, t) {
                return this.__data__[e] = J && t === undefined ? B : t, this
            }

            function c(e) {
                var t = -1,
                    n = e ? e.length : 0;
                for (this.clear() ; ++t < n;) {
                    var i = e[t];
                    this.set(i[0], i[1])
                }
            }

            function d() {
                this.__data__ = []
            }

            function f(e) {
                var t = this.__data__,
                    n = A(t, e);
                return !(n < 0) && (n == t.length - 1 ? t.pop() : Q.call(t, n, 1), !0)
            }

            function h(e) {
                var t = this.__data__,
                    n = A(t, e);
                return n < 0 ? undefined : t[n][1]
            }

            function m(e) {
                return A(this.__data__, e) > -1
            }

            function _(e, t) {
                var n = this.__data__,
                    i = A(n, e);
                return i < 0 ? n.push([e, t]) : n[i][1] = t, this
            }

            function p(e) {
                var t = -1,
                    n = e ? e.length : 0;
                for (this.clear() ; ++t < n;) {
                    var i = e[t];
                    this.set(i[0], i[1])
                }
            }

            function y() {
                this.__data__ = {
                    hash: new r,
                    map: new (Z || c),
                    string: new r
                }
            }

            function v(e) {
                return T(this, e)["delete"](e)
            }

            function g(e) {
                return T(this, e).get(e)
            }

            function b(e) {
                return T(this, e).has(e)
            }

            function E(e, t) {
                return T(this, e).set(e, t), this
            }

            function A(e, t) {
                for (var n = e.length; n--;)
                    if (O(e[n][0], t)) return n;
                return -1
            }

            function S(e) {
                return !(!R(e) || w(e)) && (I(e) || i(e) ? X : x).test(N(e))
            }

            function T(e, t) {
                var n = e.__data__;
                return k(t) ? n["string" == typeof t ? "string" : "hash"] : n.map
            }

            function C(e, t) {
                var i = n(e, t);
                return S(i) ? i : undefined
            }

            function k(e) {
                var t = typeof e;
                return "string" == t || "number" == t || "symbol" == t || "boolean" == t ? "__proto__" !== e : null === e
            }

            function w(e) {
                return !!G && G in e
            }

            function N(e) {
                if (null != e) {
                    try {
                        return K.call(e)
                    } catch (e) { }
                    try {
                        return e + ""
                    } catch (e) { }
                }
                return ""
            }

            function L(e, t) {
                if ("function" != typeof e || t && "function" != typeof t) throw new TypeError(D);
                var n = function () {
                    var i = arguments,
                        r = t ? t.apply(this, i) : i[0],
                        o = n.cache;
                    if (o.has(r)) return o.get(r);
                    var a = e.apply(this, i);
                    return n.cache = o.set(r, a), a
                };
                return n.cache = new (L.Cache || p), n
            }

            function O(e, t) {
                return e === t || e !== e && t !== t
            }

            function I(e) {
                var t = R(e) ? Y.call(e) : "";
                return t == P || t == M
            }

            function R(e) {
                var t = typeof e;
                return !!e && ("object" == t || "function" == t)
            }
            var D = "Expected a function",
                B = "__lodash_hash_undefined__",
                P = "[object Function]",
                M = "[object GeneratorFunction]",
                F = /[\\^$.*+?()[\]{}|]/g,
                x = /^\[object .+?Constructor\]$/,
                $ = "object" == typeof e && e && e.Object === Object && e,
                U = "object" == typeof self && self && self.Object === Object && self,
                H = $ || U || Function("return this")(),
                q = Array.prototype,
                j = Function.prototype,
                V = Object.prototype,
                W = H["__core-js_shared__"],
                G = function () {
                    var e = /[^.]+$/.exec(W && W.keys && W.keys.IE_PROTO || "");
                    return e ? "Symbol(src)_1." + e : ""
                }(),
                K = j.toString,
                z = V.hasOwnProperty,
                Y = V.toString,
                X = RegExp("^" + K.call(z).replace(F, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$"),
                Q = q.splice,
                Z = C(H, "Map"),
                J = C(Object, "create");
            r.prototype.clear = o, r.prototype["delete"] = a, r.prototype.get = s, r.prototype.has = u, r.prototype.set = l, c.prototype.clear = d, c.prototype["delete"] = f, c.prototype.get = h, c.prototype.has = m, c.prototype.set = _, p.prototype.clear = y, p.prototype["delete"] = v, p.prototype.get = g, p.prototype.has = b, p.prototype.set = E, L.Cache = p, t.exports = L
        }),
        _e = t(function (e, t) {
            "use strict";

            function n(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var i = function () {
                function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n];
                        i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                    }
                }
                return function (t, n, i) {
                    return n && e(t.prototype, n), i && e(t, i), t
                }
            }(),
                r = function () {
                    function e(t) {
                        n(this, e), this.string = t
                    }
                    return i(e, [{
                        key: "removeDiacritics",
                        value: function () {
                            return this._remove(this.string)
                        }
                    }, {
                        key: "_remove",
                        value: function () {
                            var e = /^[a-zA-Z0-9_ ]+$/g;
                            if (!this.string || e.exec(this.string)) return this.string;
                            for (var t = [{
                                base: "A",
                                letters: /[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g
                            }, {
                                base: "AA",
                                letters: /[\uA732]/g
                            }, {
                                base: "AE",
                                letters: /[\u00C6\u01FC\u01E2]/g
                            }, {
                                base: "AO",
                                letters: /[\uA734]/g
                            }, {
                                base: "AU",
                                letters: /[\uA736]/g
                            }, {
                                base: "AV",
                                letters: /[\uA738\uA73A]/g
                            }, {
                                base: "AY",
                                letters: /[\uA73C]/g
                            }, {
                                base: "B",
                                letters: /[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g
                            }, {
                                base: "C",
                                letters: /[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g
                            }, {
                                base: "D",
                                letters: /[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g
                            }, {
                                base: "DZ",
                                letters: /[\u01F1\u01C4]/g
                            }, {
                                base: "Dz",
                                letters: /[\u01F2\u01C5]/g
                            }, {
                                base: "E",
                                letters: /[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g
                            }, {
                                base: "F",
                                letters: /[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g
                            }, {
                                base: "G",
                                letters: /[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g
                            }, {
                                base: "H",
                                letters: /[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g
                            }, {
                                base: "I",
                                letters: /[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g
                            }, {
                                base: "J",
                                letters: /[\u004A\u24BF\uFF2A\u0134\u0248]/g
                            }, {
                                base: "K",
                                letters: /[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g
                            }, {
                                base: "L",
                                letters: /[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g
                            }, {
                                base: "LJ",
                                letters: /[\u01C7]/g
                            }, {
                                base: "Lj",
                                letters: /[\u01C8]/g
                            }, {
                                base: "M",
                                letters: /[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g
                            }, {
                                base: "N",
                                letters: /[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g
                            }, {
                                base: "NJ",
                                letters: /[\u01CA]/g
                            }, {
                                base: "Nj",
                                letters: /[\u01CB]/g
                            }, {
                                base: "O",
                                letters: /[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g
                            }, {
                                base: "OI",
                                letters: /[\u01A2]/g
                            }, {
                                base: "OO",
                                letters: /[\uA74E]/g
                            }, {
                                base: "OU",
                                letters: /[\u0222]/g
                            }, {
                                base: "P",
                                letters: /[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g
                            }, {
                                base: "Q",
                                letters: /[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g
                            }, {
                                base: "R",
                                letters: /[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g
                            }, {
                                base: "S",
                                letters: /[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g
                            }, {
                                base: "T",
                                letters: /[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g
                            }, {
                                base: "TZ",
                                letters: /[\uA728]/g
                            }, {
                                base: "U",
                                letters: /[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g
                            }, {
                                base: "V",
                                letters: /[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g
                            }, {
                                base: "VY",
                                letters: /[\uA760]/g
                            }, {
                                base: "W",
                                letters: /[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g
                            }, {
                                base: "X",
                                letters: /[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g
                            }, {
                                base: "Y",
                                letters: /[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g
                            }, {
                                base: "Z",
                                letters: /[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g
                            }, {
                                base: "a",
                                letters: /[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g
                            }, {
                                base: "aa",
                                letters: /[\uA733]/g
                            }, {
                                base: "ae",
                                letters: /[\u00E6\u01FD\u01E3]/g
                            }, {
                                base: "ao",
                                letters: /[\uA735]/g
                            }, {
                                base: "au",
                                letters: /[\uA737]/g
                            }, {
                                base: "av",
                                letters: /[\uA739\uA73B]/g
                            }, {
                                base: "ay",
                                letters: /[\uA73D]/g
                            }, {
                                base: "b",
                                letters: /[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g
                            }, {
                                base: "c",
                                letters: /[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g
                            }, {
                                base: "d",
                                letters: /[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g
                            }, {
                                base: "dz",
                                letters: /[\u01F3\u01C6]/g
                            }, {
                                base: "e",
                                letters: /[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g
                            }, {
                                base: "f",
                                letters: /[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g
                            }, {
                                base: "g",
                                letters: /[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g
                            }, {
                                base: "h",
                                letters: /[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g
                            }, {
                                base: "hv",
                                letters: /[\u0195]/g
                            }, {
                                base: "i",
                                letters: /[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g
                            }, {
                                base: "j",
                                letters: /[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g
                            }, {
                                base: "k",
                                letters: /[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g
                            }, {
                                base: "l",
                                letters: /[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g
                            }, {
                                base: "lj",
                                letters: /[\u01C9]/g
                            }, {
                                base: "m",
                                letters: /[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g
                            }, {
                                base: "n",
                                letters: /[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g
                            }, {
                                base: "nj",
                                letters: /[\u01CC]/g
                            }, {
                                base: "o",
                                letters: /[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g
                            }, {
                                base: "oi",
                                letters: /[\u01A3]/g
                            }, {
                                base: "ou",
                                letters: /[\u0223]/g
                            }, {
                                base: "oo",
                                letters: /[\uA74F]/g
                            }, {
                                base: "p",
                                letters: /[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g
                            }, {
                                base: "q",
                                letters: /[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g
                            }, {
                                base: "r",
                                letters: /[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g
                            }, {
                                base: "s",
                                letters: /[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g
                            }, {
                                base: "t",
                                letters: /[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g
                            }, {
                                base: "tz",
                                letters: /[\uA729]/g
                            }, {
                                base: "u",
                                letters: /[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g
                            }, {
                                base: "v",
                                letters: /[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g
                            }, {
                                base: "vy",
                                letters: /[\uA761]/g
                            }, {
                                base: "w",
                                letters: /[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g
                            }, {
                                base: "x",
                                letters: /[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g
                            }, {
                                base: "y",
                                letters: /[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g
                            }, {
                                base: "z",
                                letters: /[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g
                            }], n = 0; n < t.length; n++) this.string = this.string.replace(t[n].letters, t[n].base);
                            return this.string
                        }
                    }]), e
                }();
            t["default"] = r, Bizweb.DiacriticRemover = null != t["default"] ? t["default"] : t
        }),
        pe = t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function i(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function r(e) {
                return new c["default"](e.toLowerCase()).removeDiacritics()
            }

            function o(e) {
                var t = Array.from(e),
                    n = !0,
                    i = !1,
                    r = undefined;
                try {
                    for (var o, a = t.entries()[Symbol.iterator]() ; !(n = (o = a.next()).done) ; n = !0) {
                        var u = s(o.value, 2),
                            l = u[0],
                            c = u[1];
                        Array.isArray(c) && (t.splice(l, 1), t = t.concat(c))
                    }
                } catch (e) {
                    i = !0, r = e
                } finally {
                    try {
                        !n && a["return"] && a["return"]()
                    } finally {
                        if (i) throw r
                    }
                }
                return t
            }

            function a(e, t) {
                var n = [],
                    i = e.length,
                    r = t.length;
                if (0 === i) return r;
                if (0 === r) return i;
                var o = i + 1;
                do {
                    n[o] = []
                } while (o--);
                o = i + 1;
                do {
                    n[o][0] = o
                } while (o--);
                var a = r + 1;
                do {
                    n[0][a] = a
                } while (a--);
                for (var s = 1; s <= i; s++)
                    for (var u = e.charAt(s - 1), l = 1; l <= r; l++) {
                        if (s === l && n[s][l] > 4) return i;
                        var c = t.charAt(l - 1),
                            d = u === c ? 0 : 1,
                            f = n[s - 1][l] + 1,
                            h = n[s][l - 1] + 1,
                            m = n[s - 1][l - 1] + d;
                        h < f && (f = h), m < f && (f = m), n[s][l] = f
                    }
                return n[i][r]
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var s = function () {
                function e(e, t) {
                    var n = [],
                        i = !0,
                        r = !1,
                        o = undefined;
                    try {
                        for (var a, s = e[Symbol.iterator]() ; !(i = (a = s.next()).done) && (n.push(a.value), !t || n.length !== t) ; i = !0);
                    } catch (e) {
                        r = !0, o = e
                    } finally {
                        try {
                            !i && s["return"] && s["return"]()
                        } finally {
                            if (r) throw o
                        }
                    }
                    return n
                }
                return function (t, n) {
                    if (Array.isArray(t)) return t;
                    if (Symbol.iterator in Object(t)) return e(t, n);
                    throw new TypeError("Invalid attempt to destructure non-iterable instance")
                }
            }(),
                u = function () {
                    function e(e, t) {
                        for (var n = 0; n < t.length; n++) {
                            var i = t[n];
                            i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                        }
                    }
                    return function (t, n, i) {
                        return n && e(t.prototype, n), i && e(t, i), t
                    }
                }(),
                l = n(me),
                c = n(_e),
                d = function () {
                    function e(t, n) {
                        i(this, e), this.options = t || [], this._keyNames = n || [], this._maxEditDistance = 2, this._excludeWords = [], this._memoizedGetNormalizedQuery = (0, l["default"])(r), this._memoizedGetParameters = (0, l["default"])(this._getParameters), this._memoizedGetParametersSplitBySpaces = (0, l["default"])(this._getParametersSplitBySpaces)
                    }
                    return u(e, [{
                        key: "rank",
                        value: function (e) {
                            var t = this;
                            if (!this.options) return [];
                            if (!e) return this.options;
                            var n = this._memoizedGetNormalizedQuery(e),
                                i = n.trim().split(" ");
                            return this.options.map(function (e) {
                                return 1 === i.length ? e.lDistance = t._memoizedGetParametersSplitBySpaces(e).reduce(function (n, r) {
                                    return t._excludeWords.includes(r) ? n : t._memoizedGetParameters(e).some(function (e) {
                                        return 0 === e.indexOf(r)
                                    }) ? Math.min(n, a(r.slice(0, i[0].length), i[0])) : Math.min(n, a(r.slice(0, i[0].length), i[0]) + .1)
                                }, Infinity) : e.lDistance = t._memoizedGetParameters(e).reduce(function (e, i) {
                                    return t._excludeWords.includes(i) ? e : Math.min(e, a(i.slice(0, n.length), n))
                                }, Infinity), e
                            }).filter(function (e) {
                                return e.lDistance <= t._maxEditDistance
                            }).sort(function (e, t) {
                                return e.lDistance - t.lDistance
                            })
                        }
                    }, {
                        key: "_getParameters",
                        value: function (e) {
                            return o(this._keyNames.map(function (t) {
                                return e[t]
                            }).filter(function (e) {
                                return e
                            })).map(function (e) {
                                return new c["default"](e.toLowerCase()).removeDiacritics()
                            })
                        }
                    }, {
                        key: "_getParametersSplitBySpaces",
                        value: function (e) {
                            return o(this._keyNames.map(function (t) {
                                return e[t]
                            }).filter(function (e) {
                                return e
                            })).map(function (e) {
                                return e.split(" ")
                            }).reduce(function (e, t) {
                                return t.concat(e)
                            }, []).map(function (e) {
                                return new c["default"](e.toLowerCase()).removeDiacritics()
                            })
                        }
                    }, {
                        key: "keyNames",
                        set: function (e) {
                            this._keyNames = e, this._memoizedGetParameters = (0, l["default"])(this._getParameters), this._memoizedGetParametersSplitBySpaces = (0, l["default"])(this._getParametersSplitBySpaces)
                        }
                    }, {
                        key: "maxEditDistance",
                        set: function (e) {
                            isNaN(e) || (this._maxEditDistance = e)
                        }
                    }, {
                        key: "excludeWords",
                        set: function (e) {
                            this._excludeWords = e ? e.split(" ").map(function (e) {
                                return e.toLowerCase()
                            }) : []
                        }
                    }]), e
                }();
            t["default"] = d, Bizweb.LevenshteinDistanceRanker = null != t["default"] ? t["default"] : t
        }),
        ye = t(function (e, t) {
            "use strict";

            function n(e) {
                return e.trim().replace(/\\/g, "\\\\").replace(/"/g, '\\"')
            }

            function i() {
                window.location.assign(fe.ROUTES.LOGIN)
            }

            function r(e) {
                //var t = e.status,
                //    n = e.getResponseHeader;
                return 401 === e.status
            }

            function o(e, t) {
                var n = e.toLowerCase().split(/\s+/),
                    i = t.title,
                    r = t.description,
                    o = t.terms,
                    a = 0,
                    s = !0,
                    u = !1,
                    l = undefined;
                try {
                    for (var c, d = n[Symbol.iterator]() ; !(s = (c = d.next()).done) ; s = !0) {
                        var f = c.value,
                            h = i.toLowerCase(),
                            m = r ? r.toLowerCase() : "";
                        h.includes(f) && m.includes(f) ? a += 30 : h.includes(f) ? a += 20 : m.includes(f) && (a += 10)
                    }
                } catch (e) {
                    u = !0, l = e
                } finally {
                    try {
                        !s && d["return"] && d["return"]()
                    } finally {
                        if (u) throw l
                    }
                }
                var _ = !0,
                    p = !1,
                    y = undefined;
                try {
                    for (var v, g = o[Symbol.iterator]() ; !(_ = (v = g.next()).done) ; _ = !0) {
                        if (0 === v.value.indexOf(e)) {
                            a += 5;
                            break
                        }
                    }
                } catch (e) {
                    p = !0, y = e
                } finally {
                    try {
                        !_ && g["return"] && g["return"]()
                    } finally {
                        if (p) throw y
                    }
                }
                return a
            }

            function a(e) {
                var t = [],
                    n = fe.TYPE_ICON_MAP,
                    i = !0,
                    r = !1,
                    o = undefined;
                try {
                    for (var a, s = e[Symbol.iterator]() ; !(i = (a = s.next()).done) ; i = !0) {
                        var u = a.value,
                            l = u.node,
                            c = l.reference.__typename;
                        l.type = c, l.icon = n[c], t.push(l)
                    }
                } catch (e) {
                    r = !0, o = e
                } finally {
                    try {
                        !i && s["return"] && s["return"]()
                    } finally {
                        if (r) throw o
                    }
                }
                return t
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.sanitizeQuery = n, t.toLogin = i, t.checkLoginRequired = r, t.assignResultPoints = o, t.getNodesFromResults = a
        }),
        ge = t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var i = n($),
                a = n(_),
                //u = n(ve),
                l = function () {
                    function e(t) {
                        o(this, e);
                        this._categories = t;
                        //var n = this._dataCache = new u["default"](t);
                        //this._cacheRequest = n.getDataToCache()
                    }
                    return r(e, [{
                        key: "getResultCategories",
                        value: function (e, t) {
                            var n = this;
                            //return this._cacheRequest ? this._cacheRequest.then(function () {
                            //    return n._cacheRequest = null, n.getResultCategories(e, t)
                            //}) :
                            return new Promise(function (i, r) {
                                function o(n, r, o, u) {
                                    return a.push(c({
                                        categoryName: r,
                                        title: o
                                    }, n)), n.results.length > 0 && (s = !0), t({
                                        categories: a,
                                        query: e,
                                        resultsPresent: s
                                    }), u && i({
                                        categories: a,
                                        query: e,
                                        resultsPresent: s
                                    }), a
                                }
                                var a = [],
                                    s = !1,
                                    u = n._categories,
                                    l = Object.keys(u).length,
                                    d = Promise.resolve(),
                                    f = 0,
                                    h = !0,
                                    m = !1,
                                    _ = undefined;
                                try {
                                    for (var p, y = function () {
                                            var t = p.value,
                                                i = u[t],
                                                a = f === l - 1,
                                                s = void 0;
                                            //s = i.cached ? n._dataCache.getCachedResults.bind(n._dataCache) :
                                            s = n._getRemoteResults.bind(n), d.then(function () {
                                                return s(t, e, i.resultsLimit)
                                    }).then(function (e) {
                                                return o(e, t, i.title, a)
                                    })["catch"](function (r) {
                                        //console.log(r)
                                    }), f++
                                    }, v = Object.keys(u)[Symbol.iterator]() ; !(h = (p = v.next()).done) ; h = !0) y()
                                } catch (e) {
                                    m = !0, _ = e
                                } finally {
                                    try {
                                        !h && v["return"] && v["return"]()
                                    } finally {
                                        if (m) throw _
                                    }
                                }
                            })
                        }
                    }, {
                        key: "getResults",
                        value: function (e) {
                            for (var t = this._categories[e], n = arguments.length, i = Array(n > 1 ? n - 1 : 0), r = 1; r < n; r++) i[r - 1] = arguments[r];
                            //if (t.cached) {
                            //    var o;
                            //    return (o = this._dataCache).getCachedResults.apply(o, [e].concat(i))
                            //}
                            return this._getRemoteResults.apply(this, [e].concat(i))
                        }
                    }, {
                        key: "_getRemoteResults",
                        value: function (e, t, n) {
                            function r(e) {
                                if (e > 0) {
                                    var t = c._currResults || [],
                                        n = e < t.length ? e : t.length - 1;
                                    if (t[n]) return t[n].cursor
                                }
                                return null
                            }
                            var o = this,
                                u = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0,
                                l = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : null,
                                c = this._categories[e];
                            c._$currentRequest && c._$currentRequest.abort();
                            var d = (0, ye.sanitizeQuery)(t.toLowerCase());
                            return new Promise(function (t, f) {
                                var h = r(u),
                                    m = [];
                                h && m.push(', "after": "' + h + '"'), l && m.push(", \"types\": [\"" + l + "\"]");
                                var _ = '{"quick_search":{"query": "' + d + '", "first": ' + n + m.join("") + "}}";
                                o._categories[e]._$currentRequest = i["default"].ajax({
                                    method: "POST",
                                    url: c.endpoint,
                                    headers: {
                                        "Content-Type": "application/json"
                                    },
                                    data: _
                                }).done(function (n, i, r) {
                                    var u = r.status,
                                        l = a["default"].get(n, "data.shop.search");
                                    if (200 !== u || void 0 === l) return (0, ye.checkLoginRequired)(r) ? (0, ye.toLogin)() :
                                        //console.log(e),
                                        //"Throttled" !== a["default"].get(n, "errors[0].message"),
                                        void t({
                                        results: [],
                                        resultsAfter: 0
                                    });
                                    var c = l.edges;
                                    if (c.length < 1) return void t({
                                        results: [],
                                        resultsAfter: 0
                                    });
                                    o._categories[e]._currResults = c, t({
                                        results: (0, ye.getNodesFromResults)(c),
                                        resultsAfter: l.resultsAfterCount
                                    })
                                }).fail(function () {
                                    var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
                                    "abort" !== e.statusText && (0, ye.checkLoginRequired)(r) ? (0, ye.toLogin)() : f(e)
                                })
                            })
                        }
                    }]), e
                }();
            t["default"] = l
        }),
        be = t(function (e, t) {
            "use strict";

            function a(e, t) {
                var n = 0,
                    i = !0,
                    r = !1,
                    o = undefined;
                try {
                    for (var a, s = t[Symbol.iterator]() ; !(i = (a = s.next()).done) ; i = !0) {
                        var u = a.value;
                        if (u.categoryName === e) {
                            u.results.length < 1 && n--;
                            break
                        }
                        n += u.results.length
                    }
                } catch (e) {
                    r = !0, o = e
                } finally {
                    try {
                        !i && s["return"] && s["return"]()
                    } finally {
                        if (r) throw o
                    }
                }
                return n
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var u = function () {
                    function e(t) {
                        var n = t.getResults,
                            i = t.onChange,
                            r = t.getCurrentResults;
                        o(this, e), this._getResults = n, this._onChange = i, this._getCurrentResults = r
                    }
                    return r(e, [{
                        key: "bindEvents",
                        value: function (e) {
                            var t = this;
                            e.addEventListener("change", function (e) {
                                var n = e.target,
                                    i = n.getAttribute(fe.ATTRS.RESULT_CATEGORY_NAME);
                                if (i) {
                                    var r = n.value.trim();
                                    "" === r && (r = null), t._filterCategories(i, r)
                                }
                            })
                        }
                    }, {
                        key: "_filterCategories",
                        value: function (e, t) {
                            var n = this;
                            this._getResults(e, t).then(function (i) {
                                var r = n._prepCategory(e, function (e) {
                                    return e.results = i.results, e.resultsAfter = i.resultsAfter, e.activeFilterType = t, e
                                });
                                return n._onChange(r, a(e, r)), i
                            })["catch"](function (e) {
                                //console.log(e)
                            })
                        }
                    }, {
                        key: "_prepCategory",
                        value: function (e, t) {
                            var n = this._getCurrentResults(),
                                r = n.categories,
                                o = Array.from(r),
                                a = !0,
                                s = !1,
                                u = undefined;
                            try {
                                for (var l, c = o.entries()[Symbol.iterator]() ; !(a = (l = c.next()).done) ; a = !0) {
                                    var d = i(l.value, 2),
                                        f = d[0],
                                        h = d[1];
                                    h.categoryName === e && (o[f] = t(h))
                                }
                            } catch (e) {
                                s = !0, u = e
                            } finally {
                                try {
                                    !a && c["return"] && c["return"]()
                                } finally {
                                    if (s) throw u
                                }
                            }
                            return o
                        }
                    }]), e
                }();
            t["default"] = u
        }),
        Ee = t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var n = function () {
                function e(t) {
                    var n = t.buttonNode,
                        i = t.inputNode,
                        r = t.visibleClassName,
                        a = t.onClear;
                    o(this, e), this._buttonNode = n, this._inputNode = i, this._visibleClassName = r, this._onClear = a
                }
                return r(e, [{
                    key: "bindEvents",
                    value: function () {
                        this._inputNode.addEventListener("keyup", this._checkButtonVisible.bind(this)), this._buttonNode.addEventListener("click", this._clearInput.bind(this))
                    }
                }, {
                    key: "_checkButtonVisible",
                    value: function () {
                        this._inputNode.value.length < 1 ? this._hide() : this._show()
                    }
                }, {
                    key: "_clearInput",
                    value: function () {
                        var e = this._inputNode,
                            t = this._onClear,
                            n = e.value;
                        e.value = "", e.focus(), this._hide(), "function" == typeof t && t(n)
                    }
                }, {
                    key: "_hide",
                    value: function () {
                        this._buttonNode.classList.remove(this._visibleClassName)
                    }
                }, {
                    key: "_show",
                    value: function () {
                        this._buttonNode.classList.add(this._visibleClassName)
                    }
                }]), e
            }();
            t["default"] = n
        }),
        Ae = t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t["default"] = {
                //quick_actions: {
                //    title: "Quick Actions",
                //    cached: !0,
                //    moreOption: !0,
                //    resultsLimit: 2,
                //    endpoint: fe.ENDPOINTS.SEARCH_INDEX
                //},
                //admin: {
                //    title: "Bizweb Admin",
                //    cached: !0,
                //    moreOption: !0,
                //    resultsLimit: 2,
                //    breadcrumb: !0,
                //    endpoint: fe.ENDPOINTS.SEARCH_INDEX
                //},
                //resources: {
                //    title: "Resources",
                //    titleDetails: "(will open in new tab)",
                //    cached: !0,
                //    moreOption: !0,
                //    resultsLimit: 2,
                //    breadcrumb: !0,
                //    endpoint: fe.ENDPOINTS.SEARCH_INDEX
                //},
                //apps: {
                //    title: "Apps",
                //    cached: !0,
                //    moreOption: !0,
                //    resultsLimit: 2,
                //    breadcrumb: !0,
                //    endpoint: fe.ENDPOINTS.SEARCH_INDEX,
                //    lastResortButton: {
                //        text: 'Search "{query}" in the Bizweb App Store',
                //        href: "https://apps.bizweb.com/search/query?utf8=%E2%9C%93&q={query}"
                //    },
                //    middleware: {
                //        breadcrumb: function (e) {
                //            return /^.+\./.test(e) && !/^apps./.test(e) ? "(will open in new tab)" : e
                //        }
                //    }
                //},
                //expert_help: {
                //    title: "Expert Help",
                //    titleDetails: "(will open in new tab)",
                //    cached: !0,
                //    moreOption: !0,
                //    resultsLimit: 1,
                //    breadcrumb: !0,
                //    endpoint: fe.ENDPOINTS.SEARCH_INDEX
                //},
                store_results: {
                    title: "Kết quả tìm kiếm",
                    cached: !1,
                    moreOption: !0,
                    resultsLimit: 10,
                    endpoint: fe.ENDPOINTS.SEARCH,
                    filter: [{
                        text: "tất cả"
                    }, {
                        text: "sản phẩm",
                        type: "PRODUCT"
                    }, {
                        text: "đơn hàng",
                        type: "ORDER"
                    }, {
                        text: "khách hàng",
                        type: "CUSTOMER"
                    }]
                }
            }
        }),
        Se = t(function (e, t) {
            "use strict";

            function i(e) {
                var t = e.querySelector("svg").cloneNode(!0);
                t.setAttribute("focusable", "false");
                var n = document.createElement("div");
                return n.appendChild(t), n.innerHTML
            }

            function r(e) {
                return /^https?:\/\//.test(e) && !o(e)
            }

            function o(e) {
                return 0 === e.indexOf(location.origin)
            }

            function a(e) {
                var t = e.url,
                    n = e.navigation_path;
                if (!t) return null;
                if (o(t)) {
                    var i = t.replace(location.origin + "/admin/", "");
                    return i.includes("api_permissions") ? "(opens in a new tab)" : i.split("/").map(function (e) {
                        return e.charAt(0).toUpperCase() + e.slice(1)
                    }).join(" / ")
                }
                if (r(t)) {
                    var a = t.replace(/^(https?:\/\/(www\.)?)?([^?]+)(\?.+)?/, "$3");
                    return a.split("/").length > 2 ? a.replace(/\/([^\/]+)?$/, "") : a
                }
                return Array.isArray(n) ? n.length < 2 ? null : n.join(" / ") : t
            }

            function s(e, t) {
                var n = (0, h["default"])(t),
                    i = e.offsetHeight,
                    r = e.offsetTop - t.offsetTop,
                    o = r + i,
                    a = t.offsetHeight;
                return r > n.scrollTop() && o < n.scrollTop() + a
            }

            function u(e) {
                return (0, h["default"])(e).closest("." + fe.CLASSES.RESULTS_ITEM)[0]
            }

            function l(e, t, n) {
                var r = !1,
                    o = !0,
                    s = !1,
                    u = undefined;
                try {
                    for (var l, c = e[Symbol.iterator]() ; !(o = (l = c.next()).done) ; o = !0) {
                        var d = l.value,
                            f = d.categoryName,
                            h = d.resultsAfter,
                            m = d.results;
                        if (!(m.length < 1)) {
                            r = !0;
                            var _ = t[f],
                                p = m[m.length - 1];
                            d.titleDetails = _.titleDetails || "";
                            var y = !0,
                                v = !1,
                                g = undefined;
                            try {
                                for (var b, E = m[Symbol.iterator]() ; !(y = (b = E.next()).done) ; y = !0) {
                                    var A = b.value;
                                    if ("string" == typeof A.icon) {
                                        var S = fe.CLEAN_ICON_MAP[A.icon] || A.icon,
                                            T = document.querySelector('symbol[id^="' + S + '"]');
                                        T && (A.iconHTML = i(T))
                                    } !0 === _.breadcrumb && (A.breadcrumb = a(A), _.middleware && _.middleware.breadcrumb && (A.breadcrumb = _.middleware.breadcrumb(A.breadcrumb)))
                                }
                            } catch (e) {
                                v = !0, g = e
                            } finally {
                                try {
                                    !y && E["return"] && E["return"]()
                                } finally {
                                    if (v) throw g
                                }
                            }
                            //if (d.filter = _.filter, _.lastResortButton && h < 1 && !p.isLastResortButton)
                            //    m.push({
                            //        isLastResortButton: !0,
                            //        url: _.lastResortButton.href.replace("{query}", encodeURI(n)),
                            //        title: _.lastResortButton.text.replace("{query}", n)
                            //    });
                            //else if (_.moreOption && void 0 !== h)
                            //    if (!_.cached) {
                            //        if (p.more || h < 1) continue;
                            //        var C = m.length + h;
                            //        m.push({
                            //            more: f,
                            //            title: "Hiện toàn bộ " + C + " kết quả"
                            //        })
                            //    } else {
                            //        var k = _.resultsLimit,
                            //            w = k;
                            //        if (h < k && (w = h), !p.more && w > 0) {
                            //            var N = 1 === w ? "" : "s";
                            //            m.push({
                            //                more: f,
                            //                title: "Hiện thêm " + w + " kết quả" + N
                            //            })
                            //        }
                            //    }

                            // clone lại đoạn trên
                            if (d.filter = _.filter, _.moreOption && void 0 !== h) {
                                var k = _.resultsLimit,
                                    w = k;
                                if (h < k && (w = h), !p.more && w > 0) {
                                    //var N = 1 === w ? "" : "s";
                                    m.push({
                                        more: f,
                                        title: "Hiện thêm " + w + " kết quả" //+ N
                                    })
                                }
                            }
                        }
                    }
                } catch (e) {
                    s = !0, u = e
                } finally {
                    try {
                        !o && c["return"] && c["return"]()
                    } finally {
                        if (s) throw u
                    }
                }
                return {
                    categories: e,
                    resultsPresent: r
                }
            }

            function c(e, t, n) {
                var i = Array.from(t),
                    r = f["default"].find(i, {
                        categoryName: e
                    });
                return r.results.pop(), r.results = r.results.concat(n.results), r.resultsAfter = n.resultsAfter, r.hasResultsAfter = n.hasResultsAfter, i
            }

            function d(e, t, n) {
                var i = e.getAttribute(fe.ATTRS.RESULT_HREF),
                    o = e.getAttribute(fe.ATTRS.RESULT_CATEGORY_NAME),
                    a = r(i),
                    s = e.getAttribute(fe.ATTRS.RESULT_INDEX);
                return isNaN(s) || (s = Number(s)), r(i) && (i = (0, ce.addQuery)((0, ce.getURL)(i), {
                    itcat: "quick-search",
                    itterm: n
                }).href), a ? window.open(i, "_blank") : window.location.assign(i), {
                    categoryName: o,
                    href: i,
                    openInNewTab: a
                }
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.nodeInView = s, t.getResultItemFromTarget = u, t.prepareRawCategories = l, t.addToCategoryResults = c, t.actOnResult = d;
            var f = n(_),
                h = n($)
        }),
        Te = t(function (e, t) {
            "use strict";
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var i = n($),
                s = n(_),
                c = n(he),
                d = n(ge),
                f = n(be),
                h = n(Ee),
                m = n(Ae),
                p = a(Se),
                v = function () {
                    function e() {
                        var t = this;
                        o(this, e);
                        var n = this._node = document.querySelector("." + fe.CLASSES.WRAPPER);
                        if (this._input = document.getElementById("primary-nav-search-input"), this._input) {
                            this._closeBtn = n.querySelector("." + fe.CLASSES.CLOSE_BTN), this._spinner = n.querySelector("." + fe.CLASSES.SPINNER);
                            var i = this._resultsService = new d["default"](m["default"]);
                            this._instructionsBanner = new c["default"]({
                                node: n.querySelector("#" + fe.CLASSES.INSTRUCTIONS_BANNER + "-top"),
                                uid: "top-banner",
                                hideAtCount: 5
                            //}), this._tipBanner = new c["default"]({
                            //    node: n.querySelector("#" + fe.CLASSES.INSTRUCTIONS_BANNER + "-bottom"),
                            //    uid: "bottom-banner",
                            //    hideAtCount: 5
                            }), this._currentQuery = "", this._loadingResultsForQuery = null, this._results = {
                                wrapperNode: n.querySelector("." + fe.CLASSES.RESULTS),
                                resultsTemplate: null,
                                noResultsTemplate: null,
                                resultsMessageTemplate: null,
                                rawResults: {
                                    categories: [],
                                    query: null
                                },
                                nodes: [],
                                currentlyActive: {
                                    node: null,
                                    index: 0
                                }
                            };
                            var r = document.querySelector('[data-template-name="' + fe.CLASSES.RESULTS + '"]').innerHTML;
                            this._results.resultsTemplate = s["default"].template(r), r = document.querySelector('[data-template-name="' + fe.CLASSES.NO_RESULTS + '"]').innerHTML, this._results.noResultsTemplate = s["default"].template(r), r = document.querySelector('[data-template-name="' + fe.CLASSES.RESULTS_MESSAGE + '"]').innerHTML, this._results.resultsMessageTemplate = s["default"].template(r), this._openTrigger = null, this._noResultsStreak = 0, this._bindMouseEvents(), this._bindKeyboardEvents();
                            new f["default"]({
                                getResults: function (e, n) {
                                    var r = m["default"][e];
                                    return i.getResults(e, t._currentQuery, r.resultsLimit, null, n)
                                },
                                getCurrentResults: function () {
                                    return t._results.rawResults
                                },
                                onChange: function (e, n) {
                                    t._showResults(e, t._currentQuery, n, "next"), t._input.focus()
                                }
                            }).bindEvents(n);
                            new h["default"]({
                                buttonNode: document.querySelector(".top-bar-search__clear-btn-wrapper"),
                                inputNode: this._input,
                                visibleClassName: "top-bar-search__clear-btn-wrapper--visible",
                                onClear: function () {
                                    t._showResultsForQuery(""), t._close()
                                }
                            }).bindEvents(), te.rootDispatcher.register("QUICK_SEARCH_OPEN", function (e) {
                                var n = e.data;
                                return t.open(n.trigger, n.initialQuery)
                            }), this._lastFocus = null, this._focusRestrict()
                        }
                    }
                    return r(e, [{
                        key: "open",
                        value: function () {
                            var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null,
                                t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
                            this._isOpen() || (//"click" === e && this._tipBanner.incrementActionCount(),
                            this._node.classList.add(fe.CLASSES.WRAPPER_VISIBLE), this._node.setAttribute("hidden", "false"), this._node.setAttribute("aria-hidden", "false"), document.documentElement.classList.add(fe.CLASSES.DOCUMENT_WRAPPER_VISIBLE), this._lastFocus = document.activeElement, this._input.focus(), this._openTrigger = e,
                            t ? (this._input.value = t, this._showResultsForQuery(t)) : this._showEmptyState())
                        }
                    }, {
                        key: "_close",
                        value: function () {
                            this._isOpen() && (document.documentElement.classList.remove(fe.CLASSES.DOCUMENT_WRAPPER_VISIBLE), this._node.setAttribute("hidden", "true"), this._node.setAttribute("aria-hidden", "true"), this._node.classList.remove(fe.CLASSES.WRAPPER_VISIBLE), this._lastFocus.focus(),
                            this._input.value = "", this._showResultsForQuery(""))
                        }
                    }, {
                        key: "_focusRestrict",
                        value: function () {
                            var e = this;
                            document.addEventListener("focus", function (t) {
                                var n = e._node.contains(t.target);
                                e._isOpen() && !n && (t.stopPropagation(), e._input.focus())
                            }, !0)
                        }
                    }, {
                        key: "_isOpen",
                        value: function () {
                            return this._node.classList.contains(fe.CLASSES.WRAPPER_VISIBLE)
                        }
                    }, {
                        key: "_bindMouseEvents",
                        value: function () {
                            var e = this,
                                t = this._node,
                                n = t.querySelector("." + fe.CLASSES.BOX);
                            t.addEventListener("click", this._close.bind(this)), n.addEventListener("click", function (t) {
                                t.stopPropagation();
                                var n = t.target;
                                p.getResultItemFromTarget(t.target) ? t.metaKey || (t.preventDefault(), e._actOnActiveResult("click", t.metaKey)) : "INPUT" !== n.tagName && "SELECT" !== n.tagName && (e._input.focus(),
                                n.hasAttribute(fe.ATTRS.CONTINUE_SEARCH_LINK))
                            }), n.addEventListener("mousemove", function (t) {
                                var n = t.target,
                                    i = p.getResultItemFromTarget(n);
                                if (i) {
                                    var r = Number(i.getAttribute(fe.ATTRS.RESULT_TOTAL_INDEX));
                                    e._makeResultActive(r)
                                }
                            }), this._closeBtn.addEventListener("click", this._close.bind(this))
                        }
                    }, {
                        key: "_bindKeyboardEvents",
                        value: function () {
                            var e = this,
                                t = this._node,
                                n = this._input,
                                i = (0, C.debounce)(this._showResultsForQuery.bind(this), 300),
                                r = function () {
                                    e._instructionsBanner.startActionCount()
                                },
                                o = function (t) {
                                    switch (t.keyCode) {
                                        case y.UP:
                                            t.preventDefault(), e._makeAdjacentResultActive("prev"), r();
                                            break;
                                        case y.DOWN:
                                            t.preventDefault(), e._makeAdjacentResultActive("next"), r()
                                    }
                                },
                                a = function (t) {
                                    switch (t.keyCode) {
                                        case y.ENTER:
                                            e._actOnActiveResult("key"), r();
                                            break;
                                        case y.ESCAPE:
                                            e._close(), r()
                                    }
                                };
                            t.addEventListener("keydown", o), t.addEventListener("keyup", a), n.addEventListener("keydown", function (t) {
                                var n = e._results.nodes;
                                t.keyCode === y.TAB && (n.length > 0 ? (t.preventDefault(), n[0].focus(), e._makeResultActive(0)) : e._close()), o(t)
                            }), n.addEventListener("keyup", a), t.addEventListener("focus", function (t) {
                                var n = t.target;
                                if (n.classList.contains(fe.CLASSES.RESULTS_ITEM)) {
                                    var i = Number(n.getAttribute(fe.ATTRS.RESULT_TOTAL_INDEX));
                                    e._makeResultActive(i)
                                }
                            }, !0), n.addEventListener("keyup", function (t) {
                                var n = t.target;
                                switch (t.keyCode) {
                                    case y.ENTER:
                                    case y.ESCAPE:
                                        break;
                                    default:
                                        if (e._isOpen() && "" === n.value.trim()) return void e._close();
                                        e._isOpen() || e.open(), n.value !== e._currentQuery && (e._resetCurrentlyActiveNode(), i(n.value))
                                }
                            })
                        }
                    }, {
                        key: "_resetCurrentlyActiveNode",
                        value: function () {
                            this._results.currentlyActive.node = null
                        }
                    //}, {
                    //    key: "_hideEmptyState",
                    //    value: function () {
                    //        this._tipBanner.hide()
                    //    }
                    }, {
                        key: "_showEmptyState",
                        value: function () {
                            this._instructionsBanner.hide(),
                            //this._tipBanner.hide(),
                            this._resetCurrentlyActiveNode()
                        }
                    }, {
                        key: "_showResultsMessage",
                        value: function (e, t) {
                            var n = this._results;
                            n.wrapperNode.innerHTML = n.resultsMessageTemplate({
                                title: e,
                                description: t
                            }), this._instructionsBanner.hide(),
                            //this._tipBanner.hide(),
                            this._resetCurrentlyActiveNode()
                        }
                    }, {
                        key: "_showNoResults",
                        value: function (e) {
                            var t = this._results;
                            t.wrapperNode.innerHTML = t.noResultsTemplate({
                                query: e,
                                urlQuery: encodeURI(e),
                                noResultsStreak: this._noResultsStreak
                            }), this._instructionsBanner.hide(),
                            //this._tipBanner.hide(),
                            this._resetCurrentlyActiveNode(), this._noResultsStreak++
                        }
                    }, {
                        key: "_showResultsForQuery",
                        value: function (e) {
                            var t = this,
                                n = this._results;
                            this._currentQuery = e, n.wrapperNode.innerHTML = "", this._resetCurrentlyActiveNode();
                            var i = function (e) {
                                t._spinner.classList.add(fe.CLASSES.SPINNER_VISIBLE), e ? t._spinner.classList.add(fe.CLASSES.SPINNER_FULL_PAGE) : t._spinner.classList.remove(fe.CLASSES.SPINNER_FULL_PAGE)
                            },
                                r = function () {
                                    t._spinner.classList.remove(fe.CLASSES.SPINNER_VISIBLE)
                                };
                            if (e.length < 1) return this._showEmptyState(), r(), null;
                            //this._hideEmptyState();
                            var o = !0;
                            i(!0);
                            var a = {
                                query: e
                            };
                            return this._resultsService.getResultCategories(e, function (e) {
                                var r = e.categories,
                                    a = e.query,
                                    s = e.resultsPresent;
                                if (o) t._showResults(r, a, 0);
                                else {
                                    s && i(!1);
                                    var u = n.currentlyActive.index;
                                    u > n.nodes.length && (u = 0), t._showResults(r, a, u)
                                }
                                o = !1
                            }).then(function (e) {
                                var n = e.resultsPresent,
                                    i = e.query;
                                return "" === t._currentQuery.trim() && r(), i !== t._currentQuery ? null : (r(),
                                    n ? t._noResultsStreak = 0 : t._showNoResults(i), null)
                            })["catch"](function (n) {
                                r(), t._showResultsMessage("Có lỗi xảy ra", "Xin hãy thử lại sau.")
                                //console.log(n)
                            })
                        }
                    }, {
                        key: "_showResults",
                        value: function (e, t) {
                            var n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0,
                                i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;
                            if (this._currentQuery === t) {
                                var r = p.prepareRawCategories(e, m["default"], t),
                                    o = r.categories,
                                    a = r.resultsPresent;
                                this._showResultsLiteral(o, t, n, i), a && this._loadingResultsForQuery !== t && (this._instructionsBanner.incrementActionCount(), this._instructionsBanner.checkShow()), this._loadingResultsForQuery !== t && (this._loadingResultsForQuery = t)
                            }
                        }
                    }, {
                        key: "_showResultsLiteral",
                        value: function (e, t) {
                            var n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0,
                                i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null,
                                r = this._results;
                            this._results.rawResults = {
                                categories: e,
                                query: t
                            }, r.wrapperNode.innerHTML = r.resultsTemplate({
                                categories: e,
                                query: t
                            }), this._results.nodes = this._node.getElementsByClassName(fe.CLASSES.RESULTS_ITEM), this._makeResultActive(n, i)
                        }
                    }, {
                        key: "_loadMoreForCategory",
                        value: function (e) {
                            var t = this;
                            if (!this._loadingMore) {
                                var n = this._resultsService,
                                    i = m["default"][e],
                                    r = this._results.rawResults,
                                    o = r.categories,
                                    a = r.query,
                                    s = o.filter(function (t) {
                                        return t.categoryName === e
                                    })[0],
                                    l = s.results.length - 1,
                                    c = i.cached ? null : i.resultsLimit,
                                    d = document.activeElement.getAttribute(fe.ATTRS.RESULT_TOTAL_INDEX);
                                this._loadingMore = !0, n.getResults(e, a, c, l, s.activeFilterType).then(function (n) {
                                    var i = p.addToCategoryResults(e, o, n);
                                    if (t._results.wrapperNode.removeAttribute("aria-live"), t._showResults(i, a, t._results.currentlyActive.index, "next"), t._results.wrapperNode.setAttribute("aria-live", "assertive"), d && !isNaN(d)) {
                                        var r = Number(d);
                                        t._results.nodes[r].focus()
                                    }
                                    return t._loadingMore = !1, i
                                })["catch"](function (e) {
                                    t._loadingMore = !1
                                    //console.log(e)
                                }), this._input.focus()
                            }
                        }
                    }, {
                        key: "_actOnActiveResult",
                        value: function (e) {
                            var t = this._results,
                                n = t.currentlyActive,
                                i = t.rawResults,
                                r = document.activeElement,
                                o = n.node;
                            if (r.classList.contains(fe.CLASSES.CLOSE_BTN)) return void this._close();
                            if (o) {
                                var a = o.getAttribute(fe.ATTRS.MORE);
                                if (a) {
                                    var s = {
                                        query: this._currentQuery,
                                        categoryName: o.getAttribute(fe.ATTRS.RESULT_CATEGORY_NAME)
                                    };
                                    this._loadMoreForCategory(a)
                                } else {
                                    var c = {
                                        query: this._currentQuery,
                                        triggerEvent: e,
                                        categoryName: o.getAttribute(fe.ATTRS.RESULT_CATEGORY_NAME),
                                        resultTitle: o.querySelector("." + fe.CLASSES.RESULT_TITLE).textContent.trim(),
                                        href: o.getAttribute(fe.ATTRS.RESULT_HREF)
                                    };
                                    p.actOnResult(o, i.categories, this._currentQuery).openInNewTab || this._close()
                                }
                            }
                        }
                    }, {
                        key: "_makeAdjacentResultActive",
                        value: function (e) {
                            var t = this._results,
                                n = t.nodes,
                                i = t.currentlyActive;
                            if (i.node) {
                                var r = "next" === e ? i.index + 1 : i.index - 1;
                                r >= n.length ? r = 0 : r < 0 && (r = n.length - 1), this._makeResultActive(r, e)
                            }
                        }
                    }, {
                        key: "_makeResultActive",
                        value: function (e) {
                            var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null,
                                n = arguments.length > 2 && arguments[2] !== undefined && arguments[2],
                                r = this._results,
                                o = r.nodes,
                                a = r.currentlyActive,
                                s = r.wrapperNode,
                                u = o[e];
                            if (u) {
                                if (a.node && a.index !== e && a.node.classList.remove(fe.CLASSES.RESULTS_ITEM_ACTIVE), t || n) {
                                    var l = (0, i["default"])(s),
                                        c = u.offsetTop - s.offsetTop,
                                        d = s.offsetHeight,
                                        f = u.offsetHeight,
                                        h = p.nodeInView(u, s),
                                        m = 10;
                                    h || ("next" === t ? l.scrollTop(c - d + f + m) : ("prev" === t || n) && l.scrollTop(c - m))
                                }
                                u.classList.add(fe.CLASSES.RESULTS_ITEM_ACTIVE), document.activeElement.classList.contains(fe.CLASSES.RESULTS_ITEM) && u.focus(), this._results.currentlyActive = {
                                    node: u,
                                    index: e
                                }
                            }
                        }
                    }]), e
                }();
            t["default"] = v
        });
    t(function (e, t) {
        "use strict";
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var i = n(Te);
        t["default"] = i["default"], Bizweb.QuickSearch = null != t["default"] ? t["default"] : t
    });

    var Ce = t(function (e, t) {
        "use strict";

        function n(e) {
            return Boolean(e.offsetWidth || e.offsetHeight || e.getClientRects().length)
        }

        function i(e) {
            return !e.disabled && n(e)
        }

        function r(e) {
            var t = e.querySelectorAll(o);
            return Array.from(t).filter(i)
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        }), t.findAll = r;
        var o = ["a[href]", 'input:not([disabled]):not([type="hidden"])', "select:not([disabled])", "textarea:not([disabled])", "button:not([disabled])", '[tabindex]:not([tabindex="-1"])', "[contenteditable]", "iframe"].join(", ");
        Bizweb.Focusable = null != t["default"] ? t["default"] : t
    }),
        ke = t(function (e, t) {
            "use strict";

            function n(e) {
                if (e && e.__esModule) return e;
                var t = {};
                if (null != e)
                    for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                return t["default"] = e, t
            }

            function i(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var r = i(ie),
                o = n(x);
            t["default"] = function (e, t) {
                if ("abort" !== t) {
                    switch (e.status) {
                        case 402:
                            o.error("Gói dịch vụ bạn đang sử dụng không hỗ trợ tính năng này.");
                            break;
                        case 403:
                            o.error("Bạn không có quyền truy cập trang này.");
                            break;
                        case 404:
                            o.error("Trang bạn muốn truy cập không tồn tại.");
                            break;
                        case 422:
                            o.error("Không thể xử lý yêu cầu của bạn.");
                            break;
                        case 429:
                            o.error("Số request vượt quá giới hạn. Vui lòng thử lại sau.");
                            break;
                        case 500:
                            o.error("Có lỗi xảy ra.");
                            break;
                        default:
                            o.error("Có sự cố xảy ra.")
                    }
                    r["default"].stop()
                }
            }, Bizweb.handleError = null != t["default"] ? t["default"] : t
        }),
        we = t(function (e, t) {
            "use strict";

            function n() {
                var e = document.getElementById(o);
                a = window.scrollY, document.body.classList.add(r), null != e && (e.scrollTop = a)
            }

            function i() {
                window.requestAnimationFrame(function () {
                    document.body.classList.remove(r)
                })
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            }), t.lock = n, t.unlock = i;
            var r = "helper--scroll-lock",
                o = "wrapper",
                a = 0;
            Bizweb.ScrollLock = null != t["default"] ? t["default"] : t
        }),
        Ne = t(function (e, t) {
            "use strict";

            function n(e) {
                if (e && e.__esModule) return e;
                var t = {};
                if (null != e)
                    for (var n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);
                return t["default"] = e, t
            }

            function i(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function r(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function o(e) {
                O = e
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var a = function () {
                function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n];
                        i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                    }
                }
                return function (t, n, i) {
                    return n && e(t.prototype, n), i && e(t, i), t
                }
            }(),
                s = i($),
                u = i(g),
                l = n(Ce),
                c = n(H),
                d = i(ke),
                f = i(ie),
                h = n(b),
                m = n(we),
                _ = n(y),
                p = {
                    BASE: "ui-modal",
                    BODY: "ui-modal__body",
                    CLOSE_BUTTON: "ui-modal__close-button",
                    SECTION: "ui-modal__section"
                },
                v = {
                    HEADING_SUFFIX: "_heading"
                },
                E = {
                    BASE: {
                        VISIBLE: "ui-modal--is-visible",
                        TRANSITIONING: "ui-modal--is-transitioning"
                    },
                    BODY: {
                        SHADOW: "ui-modal__body--shadow",
                        BOTTOM_SHADOW: "ui-modal__body--bottom-shadow",
                        TOP_SHADOW: "ui-modal__body--top-shadow"
                    },
                    BACKDROP: {
                        VISIBLE: "ui-modal-backdrop--is-visible"
                    },
                    CONTENTS: {
                        VISIBLE: "ui-modal-contents--is-visible"
                    }
                },
                A = {
                    BASE: {
                        INSTANT: "ui-modal--instant"
                    }
                },
                S = {
                    BEFORE_SHOW: "ui-modal:before-show",
                    SHOW: "ui-modal:show",
                    SHOW_REMOTE: "ui-modal:show-remote",
                    HIDE: "ui-modal:hide",
                    HIDE_ALL: "ui-modal:hide-all",
                    AFTER_HIDE: "ui-modal:after-hide",
                    REMOTE_REQUEST_FINISHED: "ui-modal:remote-request-finished"
                },
                T = "ui-modal",
                k = "UIModalBackdrop",
                w = "UIModalContents",
                L = void 0,
                O = void 0,
                I = function () {
                    function e(t) {
                        var n = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
                        if (r(this, e), this.hide = this.hide.bind(this), this.show = this.show.bind(this), this.openAfterClose = this.openAfterClose.bind(this), this.toggleBodyScrollShadow = this.toggleBodyScrollShadow.bind(this), this.focusRestrict = this.focusRestrict.bind(this), this.node = t, this.options = n, this.$contentContainer = (0, s["default"])("#" + w), !this.$contentContainer.length) throw new Error("Couldn't find a UiModal container on the current page.");
                        if (!this.node) throw new Error("A valid node is required to create a modal. Placeholder node: " + this.options.placeholder.attributes["data-modal-context-ref-for"].textContent);
                        this.id = this.options.id || this.node.id;
                        var i = void 0,
                            o = void 0;
                        this.options.size && (i = this.options.size.height, o = this.options.size.width), this.size = {
                            height: i || this.optionFromAttribute("height"),
                            width: o || this.optionFromAttribute("width")
                        }, this.remote = this.options.contentFrom || this.optionFromAttribute("contentFrom"), this.remote && this.$contentContainer.append(this.node), this.reloadAlways = this.options.reloadAlways || this.optionFromAttribute("modalReloadAlways"), this.rebindAlways = this.options.rebindAlways || this.optionFromAttribute("rebindAlways"), this.preload = this.options.preload || this.optionFromAttribute("preload"), this.startVisible = this.options.startVisible || this.optionFromAttribute("startVisible"), this.$modal = (0, s["default"])(this.node), this.$body = this.$modal.find("." + p.BODY), this.$title = this.$modal.find("#" + (this.id + v.HEADING_SUFFIX)), L = (0, s["default"])("#" + k), this.lastFocus = document.activeElement, this.loadingRemote = !1, this.request = null, this.lastScrollPosition = null, this.firstElement = null, this.lastElement = null, this.isOpen = !1,
                        this.appFrame = document.querySelector("." + N.Classes.BASE), this.preload && this.fetchHTML(), this.startVisible && this.show(this.options)
                    }
                    return a(e, null, [{
                        key: "hide",
                        value: function () {
                            var e = arguments.length > 0 && arguments[0] !== undefined && arguments[0];
                            null != O && O.hide(), e || u["default"].dispatch({
                                type: S.HIDE_ALL
                            })
                        }
                    }, {
                        key: "isVisible",
                        value: function () {
                            return null != O
                        }
                    }]), a(e, [{
                        key: "dispatch",
                        value: function (e) {
                            return u["default"].dispatch({
                                type: e,
                                data: this
                            })
                        }
                    }, {
                        key: "optionFromAttribute",
                        value: function (e) {
                            return !(!this.node.dataset[e] || "false" === this.node.dataset[e]) && this.node.dataset[e]
                        }
                    }, {
                        key: "hide",
                        value: function () {
                            return this.isOpen = !1, this.unlockScroll(), L.removeClass(E.BACKDROP.VISIBLE), this.prepareTransition(), this.$modal.removeClass(E.BASE.VISIBLE).attr({
                                "aria-hidden": !0
                            }).off("." + T), this.hideContentContainer(), this.$body.off("." + T), O = null, null != this.lastFocus && this.lastFocus.focus(), this.dispatch(S.HIDE)
                        }
                    }, {
                        key: "hideContentContainer",
                        value: function () {
                            var e = this;
                            return this.$modal.hasClass(A.BASE.INSTANT) ? (this.$contentContainer.removeClass(E.CONTENTS.VISIBLE), this.dispatch(S.AFTER_HIDE)) : this.$modal.one(h.transitionEnd(), function () {
                                return e.$contentContainer.removeClass(E.CONTENTS.VISIBLE), e.dispatch(S.AFTER_HIDE)
                            })
                        }
                    }, {
                        key: "show",
                        value: function () {
                            var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
                            if (!this.isOpen) {
                                if (document.body.contains(this.node) || (this.node = document.getElementById(this.id), this.$modal = (0, s["default"])(this.node), this.$contentContainer = (0, s["default"])("#" + w)), this.isOpen = !0, this.shouldFetchRemote()) return void this.fetchHTML(t);
                                t.content && this.appendContent(t.content), this.setModalSize(t.size), O && O.isVisible() ? (u["default"].register(S.AFTER_HIDE, this.openAfterClose), e.hide()) : this.open()
                            }
                        }
                    }, {
                        key: "openAfterClose",
                        value: function () {
                            return u["default"].remove(S.AFTER_HIDE, this.openAfterClose), this.open()
                        }
                    }, {
                        key: "setModalSize",
                        value: function (e) {
                            var t = "",
                                n = "";
                            return null != e && e.width ? t = e.width + "px" : this.size.width && (t = this.size.width + "px"), null != e && e.height ? n = e.height + "px" : this.size.height && (n = this.size.height + "px"), this.$modal.css({
                                width: t
                            }), this.$body.css({
                                height: n
                            })
                        }
                    }, {
                        key: "prepareTransition",
                        value: function () {
                            var e = this;
                            this.$modal.hasClass(A.BASE.INSTANT) || (this.$modal.one(h.transitionEnd(), function () {
                                return e.$modal.removeClass(E.BASE.TRANSITIONING)
                            }), this.$modal.addClass(E.BASE.TRANSITIONING))
                        }
                    }, {
                        key: "shouldFetchRemote",
                        value: function () {
                            return (!(null != this.contentFetched) || this.reloadAlways) && this.remote && !this.loadingRemote
                        }
                    }, {
                        key: "open",
                        value: function () {
                            var e = this;
                            return this.dispatch(S.BEFORE_SHOW), this.setupModalEvents(), this.initializeScrollShadow(), this.lastFocus = document.activeElement, o(this), this.lockScroll(), this.resetModalBodyScroll(), L.addClass(E.BACKDROP.VISIBLE), this.$contentContainer.addClass(E.CONTENTS.VISIBLE), this.prepareTransition(), window.requestAnimationFrame(function () {
                                e.$modal.addClass(E.BASE.VISIBLE).attr({
                                    "aria-hidden": !1,
                                    tabindex: -1
                                }).focus(), e.dispatch(S.SHOW), e.remote && e.dispatch(S.SHOW_REMOTE);
                                var t = e.focusable();
                                return e.firstElement = t[0], e.lastElement = t[t.length - 1], e.lastElement
                            })
                        }
                    }, {
                        key: "resetModalBodyScroll",
                        value: function () {
                            null != this.$body[0] && (this.$body[0].scrollTop = 0)
                        }
                    }, {
                        key: "setupModalEvents",
                        value: function () {
                            return this.$modal.on("click." + T, "." + p.CLOSE_BUTTON, this.hide).on("keydown." + T, this.focusRestrict)
                        }
                    }, {
                        key: "initializeScrollShadow",
                        value: function () {
                            this.$body.length && (this.$body.on("scroll." + T, (0, C.debounce)(this.toggleBodyScrollShadow, 50)), this.toggleBodyScrollShadow())
                        }
                    }, {
                        key: "startRemoteLoad",
                        value: function () {
                            return this.preload || null != f["default"] && f["default"].start(), this.loadingRemote = !0, this.loadingRemote
                        }
                    }, {
                        key: "stopRemoteLoad",
                        value: function () {
                            return this.preload || null != f["default"] && f["default"].stop(), this.loadingRemote = !1, this.loadingRemote
                        }
                    }, {
                        key: "fetchHTML",
                        value: function () {
                            var e = this,
                                t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
                            return this.startRemoteLoad(), this.request = s["default"].ajax({
                                dataType: "html",
                                url: this.remote,
                                data: t.data
                            }), this.request.done(function (n) {
                                e.appendContent(n), e.preload || (e.isOpen = !1, e.show(t))
                            }), this.request.fail(d["default"]), this.request.always(function () {
                                return e.request = null, e.stopRemoteLoad()
                            })
                        }
                    }, {
                        key: "appendContent",
                        value: function (e) {
                            return this.contentFetched = !0, this.$modal.html(e), this.$body = this.$modal.find("." + p.BODY), this.$modal.on("click." + T, "." + p.CLOSE_BUTTON, this.hide)
                        }
                    }, {
                        key: "onClose",
                        value: function (t) {
                            var n = this,
                                i = function i(r) {
                                    r.data.id === n.id && (u["default"].remove(e.EVENTS.HIDE, i), t())
                                };
                            return u["default"].register(e.EVENTS.HIDE, i)
                        }
                    }, {
                        key: "toggleBodyScrollShadow",
                        value: function () {
                            var e = this;
                            return window.requestAnimationFrame(function () {
                                return c.update(e.$body[0])
                            })
                        }
                    }, {
                        key: "focusRestrict",
                        value: function (e) {
                            var t = void 0;
                            this.isVisible() && e.which === _.TAB && (t = this.focusable(), this.lastElement = t[t.length - 1], e.stopPropagation(), e.shiftKey || this.lastElement !== document.activeElement ? e.shiftKey && this.firstElement === document.activeElement && (this.lastElement.focus(), e.preventDefault()) : (this.firstElement.focus(), e.preventDefault()))
                        }
                    }, {
                        key: "focusable",
                        value: function () {
                            return l.findAll(this.$modal[0])
                        }
                    }, {
                        key: "isVisible",
                        value: function () {
                            return this.$modal.hasClass(E.BASE.VISIBLE) && document.body.contains(this.node)
                        }
                    }, {
                        key: "lockScroll",
                        value: function () {
                            if (this.appFrame) return void (0, N.lockScroll)();
                            m.lock()
                        }
                    }, {
                        key: "unlockScroll",
                        value: function () {
                            if (this.appFrame) return void (0, N.unlockScroll)();
                            m.unlock()
                        }
                    }, {
                        key: "title",
                        get: function () {
                            return this.$title.text()
                        },
                        set: function (e) {
                            this.$title.text(e)
                        }
                    }]), e
                }();
            I.CLASSES = p, I.STATES = E, I.EVENTS = S, I.EVENT_NAMESPACE = T, I.BACKDROP_ID = k, t["default"] = I, (0, s["default"])(document).keyup(function (e) {
                e.keyCode === _.ESCAPE && I.hide()
            }), (0, s["default"])(function () {
                L = (0, s["default"])("#" + k), L.on("touchmove", function () {
                    return !1
                })
            }), Bizweb.UIModal = null != t["default"] ? t["default"] : t
        });

    var Be = t(function (e, t) {
        "use strict";

        function n(e, t) {
            if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
        }
        Object.defineProperty(t, "__esModule", {
            value: !0
        });
        var i = function () {
            function e(e, t) {
                for (var n = 0; n < t.length; n++) {
                    var i = t[n];
                    i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                }
            }
            return function (t, n, i) {
                return n && e(t.prototype, n), i && e(t, i), t
            }
        }(),
            r = function () {
                function e(t) {
                    n(this, e), this.node = t, this.announceNode = this._makeAnnounceNode()
                }
                return i(e, [{
                    key: "announce",
                    value: function (e) {
                        this.announceNode.textContent = e
                    }
                }, {
                    key: "_makeAnnounceNode",
                    value: function () {
                        var e = document.createElement("div");
                        return e.classList.add("helper--visually-hidden"), e.setAttribute("role", "status"), e.setAttribute("aria-live", "polite"), this.node.parentElement.appendChild(e), e
                    }
                }]), e
            }();
        t["default"] = r, Bizweb.AccessibilityAnnouncer = null != t["default"] ? t["default"] : t
    }),
        Pe = (t(function () {
            "use strict";

            function e(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function t(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }

            function n() {
                Array.from(document.querySelectorAll("[data-searchable-select]")).forEach(function (e) {
                    return e.hasAttribute("data-has-searchable-select-controller") ? null : new c(e)
                })
            }
            var i = function () {
                function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n];
                        i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                    }
                }
                return function (t, n, i) {
                    return n && e(t.prototype, n), i && e(t, i), t
                }
            }(),
                r = e(g),
                o = e(j),
                a = e(pe),
                s = e(Be),
                u = {
                    LIST_ITEM_SELECTED: "next-list__item--is-selected",
                    LIST_ITEM_APPLIED: "next-list__item--is-applied",
                    GROUP_DIVIDER: "searchable-select-group-divider"
                },
                l = function () {
                    function e(n, i, r) {
                        t(this, e), this.resultsNode = n, this.inputNode = i, this.accessibilityAnnouncer = r
                    }
                    return i(e, [{
                        key: "routeEvent",
                        value: function (e) {
                            var t = null;
                            switch (e.which) {
                                case y.DOWN:
                                    this._selectNextOption(), e.stopPropagation(), e.preventDefault();
                                    break;
                                case y.UP:
                                    this._selectPreviousOption(), e.stopPropagation(), e.preventDefault();
                                    break;
                                case y.ENTER:
                                    t = this._getSelectedItem(), e.stopPropagation(), e.preventDefault();
                                    break;
                                case y.TAB:
                                    t = this._getSelectedItem()
                            }
                            return t
                        }
                    }, {
                        key: "setOptionSelected",
                        value: function (e, t) {
                            if (t) {
                                e.classList.add(u.LIST_ITEM_SELECTED);
                                e.parentNode.parentNode.scrollTop = e.offsetTop, this.accessibilityAnnouncer.announce(e.textContent)
                            } else e.classList.remove(u.LIST_ITEM_SELECTED)
                        }
                    }, {
                        key: "_selectNextOption",
                        value: function () {
                            var e = this.resultsNode.querySelector("." + u.LIST_ITEM_SELECTED);
                            e && e.nextElementSibling ? (this.setOptionSelected(e, !1), this.setOptionSelected(e.nextElementSibling, !0)) : e || this.resultsNode.firstChild.classList.contains("is-disabled") || this.setOptionSelected(this.resultsNode.firstChild, !0)
                        }
                    }, {
                        key: "_selectPreviousOption",
                        value: function () {
                            var e = this.resultsNode.querySelector("." + u.LIST_ITEM_SELECTED);
                            e && e.previousSibling && (this.setOptionSelected(e, !1), this.setOptionSelected(e.previousSibling, !0))
                        }
                    }, {
                        key: "_getSelectedItem",
                        value: function () {
                            return this.resultsNode.querySelector("." + u.LIST_ITEM_SELECTED)
                        }
                    }]), e
                }(),
                c = function () {
                    function e(n) {
                        if (t(this, e), this.node = n, this.node.dataset.hasSearchableSelectController = !0, this.selectNode = this.node.querySelector("[data-searchable-select-select]"), this.inputNode = this.node.querySelector("[data-searchable-select-input]"), this.resultsNode = this.node.querySelector("[data-searchable-select-results]"), this.popover = o["default"]["for"](this.resultsNode), this.normalIcon = this.inputNode.nextElementSibling.children[0], this.removeIcon = this.inputNode.nextElementSibling.children[1], this.options = this._parseOptions(), this.optionsRanker = new a["default"](this.options, ["textContent", "value", "alias"]), this.accessibilityAnnouncer = new s["default"](this.selectNode), this.keyboardEvents = new l(this.resultsNode, this.inputNode, this.accessibilityAnnouncer), this.optionsRanker.maxEditDistance = this.selectNode.dataset.maxEditDistance, this.optionsRanker.excludeWords = this.selectNode.dataset.excludeWords, this.isEmptyAllowed = this.options.some(function (e) {
                                return !e.value
                        }), this.isQueryEmpty = !0, this._initializeResults(), this._setupForAccessibility(), this._setupEventListeners(), this._clearButtonPressed = this._clearButtonPressed.bind(this), this._pickOption = this._pickOption.bind(this), this._onNewOptions = this._onNewOptions.bind(this), this.node.hasAttribute("data-searchable-select-event-name")) {
                            var i = this.node.getAttribute("data-searchable-select-event-name");
                            this.optionPickedEvent = "searchable-select:" + i + ":option_picked", this.receiveNewOptionsEvent = "searchable-select:" + i + ":update_options", r["default"].register(this.receiveNewOptionsEvent, this._onNewOptions).bindToNode(this.node), r["default"].dispatch({
                                type: this.optionPickedEvent,
                                value: this.selectNode.value
                            })
                        }
                    }
                    return i(e, [{
                        key: "updateResults",
                        value: function (e) {
                            this.isQueryEmpty = !e, this._clearResults();
                            var t = this.optionsRanker.rank(e);
                            if (this._appendResults(t), 0 === t.length) this.accessibilityAnnouncer.announce("No results found");
                            else {
                                var n = t.filter(function (e) {
                                    return e.value
                                }).length,
                                    i = "result" + (t.length > 1 ? "s" : "");
                                this.accessibilityAnnouncer.announce(n + " " + i)
                            }
                        }
                    }, {
                        key: "handleKeyboard",
                        value: function (e) {
                            var t = this.keyboardEvents.routeEvent(e);
                            if (e.which === y.ENTER ? this.isEnterKeyDown = !0 : e.which === y.ESCAPE && this.popover.isActive() && (this.popoverKeyUpActive = !0), t) {
                                var n = this.options.find(function (e) {
                                    return e.value === t.dataset.value
                                });
                                this._pickOption(n)
                            } else e.which === y.ENTER && this.popover.deactivate()
                        }
                    }, {
                        key: "_pickOption",
                        value: function (e) {
                            var t = this;
                            this.option = e, this.selectNode.value = this.option.value, this.selectNode.dataset.textContent = this.option.textContent, this.inputNode.value = this.option.textContent, this.inputNode.placeholder = this.inputNode.value, this.optionPickedEvent && r["default"].dispatch({
                                type: this.optionPickedEvent,
                                value: this.selectNode.value
                            }), this.selectNode.dispatchEvent(new CustomEvent("change")), this.accessibilityAnnouncer.announce(this.option.textContent + " selected");
                            var n = this.resultsNode.querySelector("." + u.LIST_ITEM_APPLIED);
                            n && n.classList.remove(u.LIST_ITEM_APPLIED), Array.from(this.resultsNode.children).find(function (e) {
                                return e.dataset.value === t.option.value
                            }).classList.add(u.LIST_ITEM_APPLIED), this.isEmptyAllowed && this.option.value ? this._showClearButton() : this._hideClearButton(), this.popover.deactivate()
                        }
                    }, {
                        key: "_onNewOptions",
                        value: function (e) {
                            function t(e, t) {
                                if ("string" == typeof e || e instanceof String) {
                                    var n = document.createElement("option");
                                    n.setAttribute("value", e), n.appendChild(document.createTextNode(e)), t.appendChild(n)
                                } else if (e === Object(e)) {
                                    var i = e.value,
                                        r = e.textContent || i,
                                        o = document.createElement("option");
                                    o.setAttribute("value", i), o.appendChild(document.createTextNode(r)), e.alias && (o.dataset.alias = e.alias), t.appendChild(o)
                                }
                            }
                            var n = this;
                            if (e.data) {
                                var i = e.data,
                                    r = i.options,
                                    o = i.maxEditDistance,
                                    s = i.excludeWords;
                                if (r) {
                                    for (this.selectNode.dataset.maxEditDistance = isNaN(o) ? this.selectNode.dataset.maxEditDistance : o, this.selectNode.dataset.excludeWords = s || this.selectNode.dataset.excludeWords; this.selectNode.hasChildNodes() ;) this.selectNode.removeChild(this.selectNode.lastChild);
                                    r.constructor === Array ? r.forEach(function (e) {
                                        t(e, n.selectNode)
                                    }) : r === Object(r) && Object.keys(r).forEach(function (e) {
                                        var i = document.createElement("optgroup");
                                        i.setAttribute("label", e), r[e].forEach(function (e) {
                                            t(e, i)
                                        }), n.selectNode.appendChild(i)
                                    }), this.options = this._parseOptions(), this.optionsRanker = new a["default"](this.options, ["textContent", "value", "alias"]), this.optionsRanker.maxEditDistance = this.selectNode.dataset.maxEditDistance, this.optionsRanker.excludeWords = this.selectNode.dataset.excludeWords, this.isEmptyAllowed = this.options.some(function (e) {
                                        return !e.value
                                    }) || 0 === this.options.length, this.isQueryEmpty = !0, this._initializeResults()
                                }
                            }
                        }
                    }, {
                        key: "_parseOptions",
                        value: function () {
                            var e = [],
                                t = Array.from(this.selectNode.querySelectorAll("option")),
                                n = Array.from(this.selectNode.querySelectorAll("optgroup option:last-child"));
                            return t.forEach(function (i, r) {
                                var o = {
                                    textContent: i.textContent,
                                    value: i.value,
                                    index: r,
                                    alias: i.dataset.alias || ""
                                };
                                n.includes(i) && r < t.length - 1 && (o.lastInGroup = !0), e.push(o)
                            }), e
                        }
                    }, {
                        key: "_initializeResults",
                        value: function () {
                            this.updateResults(""), this.isEmptyAllowed ? (this.selectNode.value = "", this.selectNode.dataset.textContent = "", this.inputNode.value = "", this.inputNode.placeholder = "") : this.selectNode.selectedIndex >= 0 && this._pickOption(this.options[this.selectNode.selectedIndex])
                        }
                    }, {
                        key: "_clearButtonPressed",
                        value: function (e) {
                            "click" !== e.type && 13 !== e.which || (this.option = null, this.selectNode.value = "", this.selectNode.dataset.textContent = "", this.inputNode.value = "", this.inputNode.placeholder = "", this.accessibilityAnnouncer.announce("Selection cleared"), this._hideClearButton(), e.stopPropagation(), this.popover.deactivate())
                        }
                    }, {
                        key: "_clearResults",
                        value: function () {
                            for (; this.resultsNode.lastChild;) this.resultsNode.removeChild(this.resultsNode.lastChild)
                        }
                    }, {
                        key: "_showClearButton",
                        value: function () {
                            this.normalIcon.setAttribute("class", this.normalIcon.getAttribute("class") + " hide"), this.removeIcon.setAttribute("class", this.removeIcon.getAttribute("class").split(" ").filter(function (e) {
                                return "hide" !== e
                            }).join(" ")), this.removeIcon.parentNode.addEventListener("click", this._clearButtonPressed), this.removeIcon.parentNode.addEventListener("keydown", this._clearButtonPressed)
                        }
                    }, {
                        key: "_hideClearButton",
                        value: function () {
                            this.normalIcon.setAttribute("class", this.normalIcon.getAttribute("class").split(" ").filter(function (e) {
                                return "hide" !== e
                            }).join(" ")), this.removeIcon.setAttribute("class", this.removeIcon.getAttribute("class") + " hide"), this.removeIcon.parentNode.removeEventListener("click", this._clearButtonPressed), this.removeIcon.parentNode.removeEventListener("keydown", this._clearButtonPressed)
                        }
                    }, {
                        key: "_appendResults",
                        value: function (e) {
                            var t = this,
                                n = document.createDocumentFragment();
                            if (0 === e.length) {
                                var i = document.createElement("li");
                                i.classList.add("next-list__item"), i.classList.add("is-disabled"), i.textContent = "No results found", n.appendChild(i)
                            }
                            e.forEach(function (e) {
                                if (e.value) {
                                    var i = document.createElement("li");
                                    i.classList.add("next-list__item"), i.textContent = e.textContent, i.setAttribute("role", "option"), i.dataset.value = e.value, i.addEventListener("mousedown", function () {
                                        t.isClickPickingOption = !0
                                    }), i.addEventListener("click", function () {
                                        t.isClickPickingOption = !1, t._pickOption(e)
                                    }), t.isQueryEmpty && e.lastInGroup && i.classList.add(u.GROUP_DIVIDER), t.selectNode.value === e.value && i.classList.add(u.LIST_ITEM_APPLIED), n.appendChild(i)
                                }
                            }), this.resultsNode.appendChild(n), !this.isQueryEmpty && e.length >= 1 && this.keyboardEvents.setOptionSelected(this.resultsNode.children[0], !0)
                        }
                    }, {
                        key: "_setupForAccessibility",
                        value: function () {
                            var e = this.selectNode.parentElement.querySelector("label");
                            this.inputNode.setAttribute("role", "combobox"), this.inputNode.setAttribute("aria-label", "Search and select an option for " + (e && e.textContent)), this.inputNode.setAttribute("aria-expanded", "false"), this.inputNode.setAttribute("aria-autocomplete", "list"), this.inputNode.setAttribute("aria-owns", this.selectNode.id + "-searchable-select"), this.resultsNode.setAttribute("id", this.selectNode.id + "-searchable-select"), this.resultsNode.setAttribute("role", "listbox"), this.removeIcon.setAttribute("aria-label", "Clear selection"), this.removeIcon.setAttribute("role", "button")
                        }
                    }, {
                        key: "_setupEventListeners",
                        value: function () {
                            var e = this;
                            this.selectNode.addEventListener("bindings:change", function () {
                                e.updateResults("");
                                var t = e.options.find(function (t) {
                                    return t.value === e.selectNode.value
                                });
                                t && e._pickOption(t)
                            }), this.inputNode.addEventListener("change", function (t) {
                                if (!e.isClickPickingOption) {
                                    var n = e.options.find(function (e) {
                                        return e.value === t.target.value
                                    });
                                    n && e._pickOption(n), e.popover.deactivate()
                                }
                            }), this.inputNode.addEventListener("keyup", function (t) {
                                if (e.oldValue === t.target.value || e.isEnterKeyDown || !t.which || [y.UP, y.DOWN, y.ENTER, y.TAB, y.ESCAPE].includes(t.which))
                                    if (t.which !== y.UP && t.which !== y.DOWN || e.popover.isActive()) {
                                        if (t.which === y.ENTER) e.isEnterKeyDown = !1;
                                        else if (t.which === y.ESCAPE && e.popoverKeyUpActive) return e.popoverKeyUpActive = !1, t.stopPropagation(), void t.preventDefault()
                                    } else e.popover.activate();
                                else e.updateResults(t.target.value), e.popover.activate();
                                e.oldValue = t.target.value
                            }), this.inputNode.addEventListener("focus", function () {
                                e.inputNode.placeholder = e.inputNode.value, e.inputNode.value = "", e.updateResults(""), e.inputNode.setAttribute("aria-expanded", "true")
                            }), this.inputNode.addEventListener("blur", function () {
                                e.inputNode.value = e.selectNode.dataset.textContent, e.inputNode.setAttribute("aria-expanded", "false")
                            }), this.inputNode.addEventListener("keydown", this.handleKeyboard.bind(this)), this.inputNode.addEventListener("click", function (t) {
                                e.inputNode === document.activeElement && t.stopPropagation()
                            })
                        }
                    }]), e
                }();
            document.addEventListener("page:load", n), document.addEventListener("DOMContentLoaded", n), document.addEventListener("ui-searchable-select-start", n)
        }), t(function (e, t) {
            "use strict";

            function n(e) {
                return e && e.__esModule ? e : {
                    "default": e
                }
            }

            function i(e) {
                if (Array.isArray(e)) {
                    for (var t = 0, n = Array(e.length) ; t < e.length; t++) n[t] = e[t];
                    return n
                }
                return Array.from(e)
            }

            function r(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }
            Object.defineProperty(t, "__esModule", {
                value: !0
            });
            var o = function () {
                function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                        var i = t[n];
                        i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
                    }
                }
                return function (t, n, i) {
                    return n && e(t.prototype, n), i && e(t, i), t
                }
            }(),
                a = n($),
                s = {
                    HIDE: "hide",
                    HIDE_POPOVER_ITEM: "action-bar__popover-hidden-item",
                    MORE_POPOVER_HASMANY: "action-bar__more--has-many",
                    VISUALLY_HIDDEN: "action-bar__item--visually-hidden",
                    POPOVER_CONTAINS_NEW_FEATURE: "action-bar__label--has-new-feature"
                },
                u = {
                    TOP_LEVEL_CONTAINER: ".action-bar__item--link-container",
                    TOP_LEVEL_LINK_CONTAINER: ".action-bar__top-links",
                    TOP_LEVEL_LINKS: ".action-bar__link",
                    POPOVER_CONTAINER: ".action-bar__more",
                    POPOVER_ITEMS: "[data-popover-index]",
                    POPOVER_LABEL: ".action-bar__more-label"
                },
                l = 40,
                c = function () {
                    function e(t) {
                        var n = this;
                        r(this, e);
                        var i = (0, a["default"])(t);
                        this.$topLevelContainer = i.find(u.TOP_LEVEL_CONTAINER), this.$topLevelLinkContainer = i.find(u.TOP_LEVEL_LINK_CONTAINER), this.$topLevelLinks = this.$topLevelLinkContainer.find(u.TOP_LEVEL_LINKS), this.$popoverContainer = i.find(u.POPOVER_CONTAINER), this.$popoverItems = this.$popoverContainer.find(u.POPOVER_ITEMS), this.$popoverLabel = i.find(u.POPOVER_LABEL), this.popoverItemCount = this.$popoverItems.length, window.requestAnimationFrame(function () {
                            n.cacheDOMLookups(), n.checkLinkVisibility(), window.requestAnimationFrame(n.initShowActions.bind(n))
                        }), (0, a["default"])(window).on("resize", (0, C.throttle)(function () {
                            window.requestAnimationFrame(n.checkLinkVisibility.bind(n))
                        }, 80))
                    }
                    return o(e, [{
                        key: "initShowActions",
                        value: function () {
                            this.$topLevelContainer.removeClass(s.VISUALLY_HIDDEN)
                        }
                    }, {
                        key: "cacheDOMLookups",
                        value: function () {
                            this.$topLevelLinks.length > 0 ? this.linksWidthArray = this.$topLevelLinks.map(function (e, t) {
                                return (0, a["default"])(t).outerWidth(!0)
                            }).get() : this.linksWidthArray = [], this.totalLinksWidth = this.linksWidthArray.length > 0 ? this.linksWidthArray.reduce(function (e, t) {
                                return e + t
                            }) : 0, this.$popoverLabel.text(this.$popoverLabel.data("multiple-label")), this.moreActionsWidth = this.$popoverContainer.outerWidth(!0), this.$popoverLabel.text(this.$popoverLabel.data("singular-label")), this.actionsWidth = this.$popoverContainer.outerWidth(!0), this.alwaysShowMoreActions = this.popoverItemCount > this.$topLevelLinks.length
                        }
                    }, {
                        key: "checkLinkVisibility",
                        value: function () {
                            var e = this.visibleLinksInContainer(this.availableWidth);
                            this.currentVisibleTopLinks !== e && (this.currentVisibleTopLinks = e, this.showLinksInTopLevel(e), this.setPopoverLabel(e), this.setPopoverVisibility(e), this.checkLinkVisibility(), this.checkNewActionIndicatorVisiblity())
                        }
                    }, {
                        key: "checkNewActionIndicatorVisiblity",
                        value: function () {
                            var e = this.$popoverContainer[0];
                            if (e) {
                                var t = e.querySelector(u.POPOVER_LABEL);
                                this.checkContainerHasVisibleNewLinks(e) ? (t.classList.add(s.POPOVER_CONTAINS_NEW_FEATURE), t.parentNode.setAttribute("aria-label", t.textContent + " (contains a new feature)")) : (t.classList.remove(s.POPOVER_CONTAINS_NEW_FEATURE), t.parentNode.removeAttribute("aria-label"))
                            }
                        }
                    }, {
                        key: "checkContainerHasVisibleNewLinks",
                        value: function (e) {
                            if (!e) return !1;
                            var t = e.querySelectorAll("[data-contains-new-link]");
                            return [].concat(i(t)).filter(function (e) {
                                return !e.classList.contains(s.HIDE_POPOVER_ITEM)
                            }).length > 0
                        }
                    }, {
                        key: "showLinksInTopLevel",
                        value: function (e) {
                            var t = this;
                            this.$topLevelLinks.slice(0, e).removeClass(s.HIDE), this.$topLevelLinks.slice(e).addClass(s.HIDE), this.$topLevelLinks.filter("." + s.HIDE).each(function (e, n) {
                                var i = (0, a["default"])(n).data("popover-index");
                                t.$popoverContainer.find('[data-popover-index="' + i + '"]').removeClass(s.HIDE_POPOVER_ITEM)
                            }), this.$topLevelLinks.not("." + s.HIDE).each(function (e, n) {
                                var i = (0, a["default"])(n).data("popover-index");
                                t.$popoverContainer.find('[data-popover-index="' + i + '"]').addClass(s.HIDE_POPOVER_ITEM)
                            })
                        }
                    }, {
                        key: "setPopoverVisibility",
                        value: function (e) {
                            e === this.popoverItemCount ? this.$popoverContainer.addClass(s.HIDE) : this.$popoverContainer.removeClass(s.HIDE)
                        }
                    }, {
                        key: "setPopoverLabel",
                        value: function (e) {
                            0 === e ? (this.$popoverContainer.addClass(s.MORE_POPOVER_HASMANY), this.$popoverLabel.text(this.$popoverLabel.data("singular-label"))) : (this.$popoverContainer.removeClass(s.MORE_POPOVER_HASMANY), this.$popoverLabel.text(this.$popoverLabel.data("multiple-label")))
                        }
                    }, {
                        key: "visibleLinksInContainer",
                        value: function (e) {
                            if (1 === this.linksWidthArray.length && this.totalLinksWidth <= this.actionsWidth) return 1;
                            var t = this.alwaysShowMoreActions ? this.moreActionsWidth : 0;
                            if (e >= this.totalLinksWidth + t + l) return this.linksWidthArray.length;
                            var n = e - this.moreActionsWidth - l,
                                i = 0,
                                r = 0;
                            return this.linksWidthArray.forEach(function (e) {
                                i += e, n >= i && r++
                            }), r
                        }
                    }, {
                        key: "availableWidth",
                        get: function () {
                            return this.$topLevelContainer.width()
                        }
                    }]), e
                }();
            t["default"] = c, Bizweb.TitleBarActions = null != t["default"] ? t["default"] : t
        }));

}("undefined" != typeof global ? global : "undefined" != typeof window ? window : this);

{
    var TIME_DELAY = 1500;
    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            if (settings.url.indexOf("analytics.bizweb.vn") == -1 && (settings.type.toLowerCase() == "post" || settings.type.toLowerCase() == "put" || settings.type.toLowerCase() == "delete")) { xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content')) }
        }
    });

    // =======================================
    // Global Functions
    // =======================================

    //Hàm format string như C# sử dụng "Test format {0}".format("abc")
    if (!String.prototype.format) {
        String.prototype.format = function () {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function (match, number) {
                return typeof args[number] != 'undefined'
                    ? args[number]
                    : match
                ;
            });
        };
    }

    function surrogateCtor() { }

    function extend(base, sub, methods) {
        surrogateCtor.prototype = base.prototype;
        sub.prototype = new surrogateCtor();
        sub.prototype.constructor = sub;
        // Add a reference to the parent's prototype
        sub.base = base.prototype;

        // Copy the methods passed in to the prototype
        for (var name in methods) {
            sub.prototype[name] = methods[name];
        }
        // so we can define the constructor inline
        return sub;
    }

    var _autoNumericOptions = {
        allowDecimalPadding: false,
        showWarnings: false,
        //unformatOnSubmit: true,
        maximumValue: '999999999999999.99', // 999,999,999,999,999.99
        minimumValue: '0',
        decimalPlacesOverride: 5
    };
    function initAutoNumeric() {
        setTimeout(function () {
            $('[data-autonumeric="autoNumeric"]').each(function (index) {
                var options = $.extend(true, {}, _autoNumericOptions);
                if ($(this).data('autonumeric-max') != undefined) {
                    options.maximumValue = $(this).data('autonumeric-max');
                }
                if ($(this).data('autonumeric-min') != undefined) {
                    options.minimumValue = $(this).data('autonumeric-min');
                }

                var price = $(this).val();
                if (price) {
                    price = price.replace(/,/g, "");
                }
                $(this).val(price);
                $(this).autoNumeric('init', options);
                $(this).autoNumeric('set', price);

                $(this).on('input', function (ev) {
                    $(this).trigger('change');
                });
            });
        }, 50);
    }
    function unSetAutoNumeric() {
        $('[data-autonumeric="autoNumeric"]').autoNumeric('unSet');
    }
    function unSetAutoNumericForm() {
        $('[data-autonumeric="autoNumeric"]').autoNumeric('unSet');
        setTimeout(function () {
            $('[data-autonumeric="autoNumeric"]').autoNumeric('reSet');
        }, 50);
        return true;
    }
    function reSetAutoNumeric() {
        $('[data-autonumeric="autoNumeric"]').autoNumeric('unSet');
        $('[data-autonumeric="autoNumeric"]').autoNumeric('reSet');
    }

    function unFomatPrice(price) {
        if (price) {
            price = price.toString().replace(/,/g, "");
        }
        if (!isNaN(parseFloat(price)) && isFinite(price)) {
            price = parseFloat(price);
        }
        return price;
    }

    function OrderPaymentStatus(status) {
        var text = "";
        switch (status) {
            case "pending":
                text = "<span class='badge badge--status-warning badge--progress-incomplete'>Chưa thanh toán</span>";
                break;
            case "paid":
                text = "<span class='badge badge--status-complete badge--progress-complete'>Đã thanh toán</span>";
                break;
            case "partially_paid":
                text = "<span class='badge badge--status-complete badge--progress-complete'>Thanh toán một phần</span>";
                break;
            case "partially_refunded":
                text = "<span class='badge badge--status-complete badge--progress-complete'>Hoàn trả một phần</span>";
                break;
            case "refunded":
                text = "<span class='badge badge--status-complete badge--progress-complete'>Hoàn trả toàn bộ</span>";
                break;
            case "authorized":
                text = "<span class='badge badge--status-warning badge--progress-incomplete'>Thanh toán chờ xác nhận</span>";
                break;
            default: text = "";
                break;
        }
        return text;
    }

    function OrderFulfillStatus(status) {
        var text = "";
        switch (status) {
            case "partial":
                text = "<span class='badge badge--status-warning badge--progress-partially-complete'>Chuyển một phần</span>";
                break;
            case "fulfilled":
                text = "<span class='badge badge--status-complete badge--progress-complete'>Chuyển toàn bộ</span>";
                break;
            case "restocked":
                text = "<span class='badge badge--status-complete badge--progress-complete'>Đã hoàn kho</span>";
                break;
            default:
                text = "<span class='badge badge--status-attention badge--progress-incomplete'>Chưa chuyển</span>";
                break;
        }
        return text;
    }

    function OrderStatus(status) {
        var text = "";
        switch (status) {
            case "closed":
                text = "is-archived";
                break;
            case "cancelled":
                text = "is-cancelled";
                break;
            default:
                text = "";
                break;
        }
        return text;
    }

    function validateEmail(email) {
        var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }

    function stripScripts(s) {
        var div = document.createElement('div');
        div.innerHTML = s;
        var scripts = div.getElementsByTagName('script');
        var i = scripts.length;
        while (i--) {
            scripts[i].parentNode.removeChild(scripts[i]);
        }
        return div.innerHTML;
    }

    function scrollPaggingMobile(tableNode) {
        var lastTableElement = $(tableNode + ' table tbody tr:last');
        if (lastTableElement.length == 0) return false;
        var baseTop = 0;
        var top = $(window).scrollTop();
        var bottom_top = lastTableElement.offset().top - 600;
        if (top < bottom_top) {
            $('.show-when-scroll').css({
                "position": "fixed",
                "bottom": "0px",
                "padding-top": "5px",
                "width": "100%"
            }).addClass('display-pagging-mobile');
        }
        else {
            $('.show-when-scroll').css({
                "position": "relative",
                "top": "",
                "width": "",
                "padding-top": "25px"
            }).removeClass('display-pagging-mobile');
        }

        if (top == 0) {
            $('.show-when-scroll').css({
                "position": "relative",
                "top": "",
                "width": "",
                "padding-top": "25px"
            }).removeClass('display-pagging-mobile');
        }
    }

    // =======================================
    // BIZWEB JS API
    // =======================================

    (function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        $(document).keyup(function (e) {
            if (e.keyCode === 27) return Bizweb.Modal.hide(), Bizweb.Dropdown.hide()
        }), Bizweb.Modal = function () {
            function t(t, n) {
                var i, r;
                this.node = t, this.options = null != n ? n : {},
                this.appFrame = document.querySelector("." + Bizweb.AppFrame.Classes.BASE),
                this.reverseFocusRestrict = e(this.reverseFocusRestrict, this), this.focusRestrict = e(this.focusRestrict, this), this.onAnimationEnd = e(this.onAnimationEnd, this), this.show = e(this.show, this), this.isFullscreen = !1, this.options.autoShow && setTimeout(this.show, 0), r = this.$modalButton(), r.length && (r.attr({
                    role: "button",
                    tabindex: 0
                }), r.on("keydown", this.launchModal), i = this.$container(), i.length && i.attr({
                    role: "dialog",
                    "aria-hidden": !0
                }))
            }
            var n, i, r, o, a, s, u, l, c;
            return a = "modal_container", r = "modal_backdrop", o = "modal-button", i = "animationend webkitAnimationEnd", s = "reverseFocusRestrict", c = !1, l = function () {
                try {
                    return document.activeElement
                } catch (e) {
                    return u = e, null
                }
            }(), n = null, t.currentModal = null, t.container = function () {
                return document.getElementById(a)
            }, t.backdrop = function () {
                return document.getElementById(r)
            }, t.button = function () {
                return document.getElementsByClassName(o)[0]
            }, t.prototype.$container = function () {
                return $(this.constructor.container())
            }, t.prototype.$backdrop = function () {
                return $(this.constructor.backdrop())
            }, t.prototype.$modalButton = function () {
                return $(this.constructor.button())
            }, t.hide = function (e) {
                var t;
                if (null == e && (e = !1), null != (t = Bizweb.Modal.currentModal) && t.hide(), !e) return Bizweb.UIModal.hide(!0)
            }, t.onClickHide = function (e) {
                return e.preventDefault(), Bizweb.Modal.hide()
            }, t.isActive = function (e) {
                var t;
                return null == e && (e = !1), t = null != Bizweb.Modal.currentModal, e || t || (t = Bizweb.UIModal.isVisible(!0)), t
            }, t.prototype.bindingsContext = function () {
                return Bindings.childContext(this.node)
            }, t.prototype.show = function (e) {
                var t, r, o, a, u, d, f;
                if (null == e && (e = {}), e.context || (e.context = this.bindingsContext()),
                    l = document.activeElement, c = !0,
                    t = this.$backdrop(), o = this.$container(), o.length)
                    return e.keepOpen ? Bizweb.UIModal.hide(!0) : Bizweb.Modal.hide(), Bizweb.Modal.currentModal = this, this.lockScroll(), null == e.content && (d = this.node.href) ? void this.fetchHTML(d, e) : (this.options.noscroll && o.addClass("no-scroll"), this.options.move ? o.append(this.node.children) : (o.html(e.content || this.node.innerHTML), Bindings.bind(o[0], e.context).refreshImmediately()), o.one(i, this.onAnimationEnd), setTimeout(function () {
                        return o.off(i, this.onAnimationEnd)
                    }, 1e3), o.show(), e.keepOpen || o.addClass("modal-animate"), this.setSize(this.options.size), this.setHeight(this.options.height), o.on("click", ".close-modal", this.constructor.onClickHide), t.addClass("visible"), $("#wrapper").addClass("hide-when-printing"), "function" == typeof e.onRender && e.onRender(), a = o.find("h1, h2, h3, h4, h5, h6").first(), f = a.attr("id") || "ModalTitle", a.attr("id", f), o.attr({
                        "aria-hidden": !1,
                        "aria-labelledby": f,
                        tabindex: -1
                    }), o.focus(), o.on("keydown." + s, this.reverseFocusRestrict), t.attr("tabindex", 0), u = Bizweb.Focusable.findAll(o[0]), n = $(u[0]), t.on("keydown", this.focusRestrict), r = o.find("[class=close-modal]"), r.attr({
                        role: "button",
                        "aria-label": "Close dialog"
                    }), r.on("keydown", function (e) {
                        var t;
                        if ((t = e.which) === 13 || t === 32) return e.preventDefault(), Bizweb.Modal.hide()
                    })), o.trigger("modal:opened")
            }, t.prototype.hide = function (e) {
                var t, n, i;
                if (null == e && (e = {}), this.isShown()) return t = this.$backdrop(), n = this.$container(), null != (i = this.request) && i.abort(), this.isFullscreen = !1, !1 !== e.trigger && n.trigger("modal:close"), this.options.noscroll && n.addClass("no-scroll"), this.options.move ? $(this.node).append(n.children()) : n[0] && Bindings.unbind(n[0]), n.removeClass(function (e, t) {
                    return (t.match(/\b\S+-modal/g) || []).join(" ")
                }), n.is(":visible") && (n.attr("aria-hidden", !0), c = !1, null != l && l.focus()), n.off("keydown." + s), n.hide().empty().off(), t.removeClass("visible").off(), t.attr("tabindex", -1), $("#wrapper").removeClass("hide-when-printing"), Bizweb.Modal.currentModal = null, this.unlockScroll(), this.options.move ? $(this.node).trigger("modal:closed") : void 0
            }, t.prototype.fetchHTML = function (e, t) {
                return null == t && (t = {}), Bizweb.Loading.start(),
                    this.request = $.ajax({
                        dataType: "html",
                        url: e,
                        data: t.data,
                        traditional: true
                    }), this.request.done(function (e) {
                        return function (n) {
                            var i;
                            return e.request.getResponseHeader("X-Bizweb-Login-Required") ? (i = window.location.pathname.split("/admin/")[1], window.location.replace(Bizweb.routes.auth_login({
                                redirect: i
                            }).html)) : e.show({
                                context: t.context,
                                content: "<div>" + n + "</div>",
                                onRender: t.onRender,
                                keepOpen: t.keepOpen || !1
                            })
                        }
                    }(this)), this.request.fail(t.onError || Bizweb.handleError), this.request.always(function (e) {
                        return function () {
                            return e.request = null, Bizweb.Loading.stop()
                        }
                    }(this))
            }, t.prototype.isShown = function () {
                return Bizweb.Modal.currentModal === this
            }, t.prototype.setSize = function (e) {
                if (this.isShown()) return e && e.match(/^\b\S+$/) ? this.$container().addClass(e + "-modal") : void 0
            }, t.prototype.setHeight = function (e) {
                if (null == e && (e = 300), this.isShown()) return (e = Math.min(700, Math.max(100, e))) ? this.$container().find(".modal-iframe").css("height", e) : void 0
            }, t.prototype.toggleFullscreen = function () {
                if (this.isShown()) return this.$container().toggleClass("real-fullscreen-modal", !this.isFullscreen), this.isFullscreen = !this.isFullscreen
            }, t.prototype.onClose = function (e) {
                if (this.isShown()) return this.$container().one("modal:close", e)
            }, t.prototype.onAnimationEnd = function () {
                return this.$container().removeClass("modal-animate")
            }, t.prototype.launchModal = function (e) {
                var t;
                if (!c && ((t = e.which) === 13 || t === 32)) return e.preventDefault(), e.target.click()
            }, t.prototype.focusRestrict = function (e) {
                if (c && e.which === 9) return e.stopPropagation(), this.$container().focus()
            }, t.prototype.reverseFocusRestrict = function (e) {
                return e.which === 16 ? e.stopPropagation() : c && e.shiftKey && n.is(":focus") ? (e.stopPropagation(), this.$backdrop().focus()) : void 0
            }, t.prototype.lockScroll = function () {
                if (this.appFrame) return void (0, Bizweb.AppFrame.lockScroll)();
            }, t.prototype.unlockScroll = function () {
                if (this.appFrame) return void (0, Bizweb.AppFrame.unlockScroll)();
            }, t
        }(), $(document).on("ready page:load", function () {
            if (Bizweb.Modal.container()) return Bizweb.Modal.currentModal && !Bizweb.Modal.container().innerHTML.trim().length && Bizweb.Modal.hide(), Bizweb.rootDispatcher.register("ui-modal:hide-all", function () {
                return function () {
                    return Bizweb.Modal.hide(!0)
                }
            }())
        })
    }).call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.Flash
        //
        // Working with Global Notifications.
        // ---------------------------------------------------------------------------------

        $(document).on("ready page:load", function () {
            if (!$(".ui-flash-wrapper").hasClass("ui-flash-wrapper--is-visible")) {
                var $container = $(".ui-flash__message");
                var hasError = $(".ui-flash").hasClass("ui-flash--error");

                var message = $container.text();
                if (message !== null && message != "")
                    Bizweb.Flash.display(message, hasError);
            }
            var t = Bizweb,
                    n = document.getElementById("flash-message-component");
            if (null != n) {
                var i = n.getAttribute("data-isError"),
                    r = n.getAttribute("data-message");
                if (i) {
                    i = i.toLowerCase();
                }
                r.length > 0 && ("true" == i ? t.Flash.error(r) : t.Flash.notice(r)), n.setAttribute("data-isError", ""), n.setAttribute("data-message", "")
            }
        });

        Bizweb.Flash = {
            error: function (message, timeout) {
                if (timeout == null)
                    timeout = 5e3;

                Bizweb.Flash.display(message, true, timeout);
            },
            notice: function (message, timeout) {
                if (timeout == null)
                    timeout = 3e3;

                Bizweb.Flash.display(message, false, timeout);
            },
            display: function (message, hasError, timeout) {
                var $container = $(".ui-flash-wrapper");

                if (hasError != null)
                    $(".ui-flash").toggleClass("ui-flash--error", hasError);
                if (timeout == null)
                    timeout = 3e3;

                clearTimeout(timeout);
                $(".ui-flash__message").text(message);
                $container.addClass("ui-flash-wrapper--is-visible");
                setTimeout(Bizweb.Flash.hide.bind(this), timeout);
            },
            hide: function () {
                $(".ui-flash-wrapper").removeClass("ui-flash-wrapper--is-visible");
                $(".ui-flash__message").text("");
            }
        };
    }.call(this),
    function () {
        var handleJsonError = function (request, fallbackMessage) {
            if (!!request && request.responseJSON) {
                Bizweb.Flash.error(request.responseJSON.error);
            } else {
                Bizweb.Flash.error(fallbackMessage);
            }
        };
        Bizweb.handleJsonError = function (request, args) {
            if ("abort" !== args) {
                switch (request.status) {
                    case 402:
                        handleJsonError(request, "Gói dịch vụ bạn đang sử dụng không hỗ trợ tính năng này.");
                        break;
                    case 403:
                        handleJsonError(request, "Bạn không có quyền truy cập trang này.");
                        break;
                    case 404:
                        handleJsonError(request, "Trang bạn muốn truy cập không tồn tại.");
                        break;
                    case 422:
                        handleJsonError(request, "Không thể xử lý yêu cầu của bạn.");
                        break;
                    case 429:
                        handleJsonError(request, "Số request vượt quá giới hạn. Vui lòng thử lại sau.");
                        break;
                    case 500:
                        handleJsonError(request, "Có lỗi xảy ra.");
                        break;
                    default:
                        handleJsonError(request, "Có sự cố xảy ra.")
                }
                Bizweb.Loading.stop()
            }
        }
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.Inflection
        //
        // Working with Inflection, example: inflection Alias from Name or Title .
        // ---------------------------------------------------------------------------------

        $(document).on("focus", ":input[editable-placeholder]", function (e) {
            if (e.target.value === "") {
                e.target.value = e.target.placeholder;
                Bindings.change(e.target);
            }
        });
        $(document).on("blur", ":input[editable-placeholder]", function (e) {
            if (e.target.value === e.target.placeholder) {
                e.target.value = "";
                Bindings.change(e.target);
            }
        })

        Bizweb.Inflection = {
            handleize: function (t) {
                return t = t.toLowerCase(), t = t.replace(/'|\"|\(|\)|\[|\]/g, ""), t = t.replace(/\W+/g, "-"), "-" === t.slice(-1) && (t = t.replace(/-+$/, "")), "-" === t.slice(0, 1) && (t = t.replace(/^-+/, "")), t
            },
            removeVietnamChar: function (text) {
                text = text.toLowerCase();
                text = text.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g, "a");
                text = text.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g, "e");
                text = text.replace(/ì|í|ị|ỉ|ĩ/g, "i");
                text = text.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g, "o");
                text = text.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g, "u");
                text = text.replace(/ỳ|ý|ỵ|ỷ|ỹ/g, "y");
                text = text.replace(/đ/g, "d");
                return text;
            },
            generateAlias: function (text, length) {
                text = this.removeVietnamChar(text.toLowerCase()).replace(/'|\"|\(|\)|\[|\]/g, "").replace(/\W+/g, "-");
                if (text.slice(-1) === "-")
                    text = text.replace(/-+$/, "");

                if (text.slice(0, 1) === "-")
                    text = text.replace(/^-+/, "");

                if (length && text.length > length)
                    text = text.substring(0, length);

                return text;
            },
            pluralize: function (t, e, n) {
                return n || (n = e + "s"), 1 === t ? e : n
            },
            pluralizeWithCount: function (t, e, n) {
                var i;
                return n || (n = e + "s"), i = Bizweb.Inflection.pluralize(t, e, n), t + " " + i
            },
            titleize: function (t, e) {
                var n;
                return null == e && (e = !1), n = t.replace(/-|_/g, " ").split(" ").map(function (t, n) {
                    return e && 0 !== n ? t : t.charAt(0).toUpperCase() + t.substring(1)
                }), n.join(" ")
            },
            classify: function (t) {
                return t.split("_").map(function (t) {
                    return t.charAt(0).toUpperCase() + t.substring(1)
                }).join("")
            },
            truncate: function (t, e) {
                return t.length > e ? t.substring(0, e).trim() + '...' : t
            },
            humanize: function (e) {
                return e.split("_").join(" ")
            }
        };
    }.call(this),
    function () {
        Bizweb.Form = function () {
            function form(ele, options) {
                var $this = $(ele);
                var that = this;
                this.$form = $(ele);
                this.url = this.$form.attr("action");

                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                if (!this.sleep) {
                    this.sleep = 0;
                }

                var urlLoadAjaxContinue = "";
                if (!!this.url_callback) {
                    urlLoadAjaxContinue = this.url_callback;
                }
                else {
                    urlLoadAjaxContinue = window.location.href;
                }

                this.$form.submit(function () {
                    var submit = $(ele).find("[type='submit']");
                    if (!!submit) {
                        submit = $(ele).find('#submitForm');
                    }
                    var submitHtml = submit.html();
                    submit.addClass("disabled").addClass('is-loading');
                    Bizweb.Loading.start();
                    $.ajax({
                        url: $(ele).attr("action"),
                        data: $(ele).serialize(),
                        type: "POST",
                        global: false,
                        success: function (data) {
                            submit.removeClass("disabled").html(submitHtml).removeClass('is-loading');
                            setTimeout(function () {
                                Bizweb.Utility.loadAjax(urlLoadAjaxContinue, that.node_change, function () {
                                    if (that.callback) {
                                        that.callback();
                                    }

                                    if (!!data.message) {
                                        Bizweb.Flash.notice(data.message);
                                    }
                                });
                            }, that.sleep);
                        },
                        error: function (data) {
                            if (data.responseJSON && data.responseJSON.error) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Cập nhật thông tin thất bại");
                            }
                            submit.removeClass("disabled").html(submitHtml).removeClass('is-loading');
                            Bizweb.Loading.stop();
                        }
                    });
                    return false;
                });
            }

            return form;
        }();
    }.call(this),
    function () {
        Bizweb.FormOrderQuickView = function () {
            function form(ele, nodeChange, callback, sleep, urlCallback) {
                $this = $(ele);
                this.$form = $(ele);
                var url = $this.attr("action");
                if (!sleep) {
                    sleep = 0;
                }

                var urlLoadAjaxContinue = "";
                if (!!urlCallback) {
                    urlLoadAjaxContinue = urlCallback;
                }
                else {
                    urlLoadAjaxContinue = window.location.href;
                }

                $this.submit(function () {
                    //if (!$this.valid()) {
                    //    return;
                    //}
                    var submit = $(ele).find("[type='submit']");
                    var submitHtml = submit.html();
                    submit.addClass("disabled").html(Bizweb.LOADING);
                    Bizweb.Loading.start();
                    $.ajax({
                        url: url,
                        data: $(ele).serialize(),
                        type: "POST",
                        global: false,
                        success: function (data) {
                            $(document).find("#payment-status-" + data.order_id).html(OrderPaymentStatus(data.payment_status));
                            $(document).find("#fulfill-status-" + data.order_id).html(OrderFulfillStatus(data.fulfill_status));
                            var parentquickview = $(document).find("#parent-quick-view-" + data.order_id);
                            $(parentquickview).removeClass();
                            $(parentquickview).addClass(OrderStatus(data.order_status));
                            setTimeout(function () {
                                Bizweb.Utility.loadAjax(urlLoadAjaxContinue, nodeChange, function () {
                                    if (callback) {
                                        callback();
                                    } else {
                                        if (data.message) {
                                            if (!!data && !!data.payment_status && !!data.fulfill_status && !!data.order_id) {

                                            }
                                            Bizweb.Flash.notice(data.message);
                                        }
                                    }
                                });
                            }, sleep);
                        },
                        error: function (data) {
                            if (data.responseJSON && data.responseJSON.error) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Cập nhật thông tin thất bại");
                            }
                            submit.removeClass("disabled").html(submitHtml);
                            Bizweb.Loading.stop();
                        }
                    });
                    return false;
                });
            }

            return form;
        }();
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.NestedLink
        // ---------------------------------------------------------------------------------
        var e, t = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        e = "a, a *, input, button, [data-bind-event-click], [bind-event-click], [aria-haspopup], td.select, .ui-popover *", Bizweb.NestedLinkContainer = function () {
            function i(e) {
                var i;
                if (this.node = e, this.linkTo = t(this.linkTo, this), i = $(this.node), this.linkNode = i.find("a[data-nested-link-target]"), !this.linkNode.is("a")) throw new Error("NestedLinkContainer must be constructed with a node that is an <a> tag");
                i.on("click", this.linkTo)
            }
            return i.BLACK_LIST = e, i.prototype.linkTo = function (t) {
                if (!($(t.target).filter(e).length > 0 || this._hasSelection())) return this.navigateTo()
            }, i.prototype.navigateTo = function () {
                return this.linkNode[0].click()
            }, i.prototype._hasSelection = function () {
                return window.getSelection().toString().length > 0
            }, i
        }()
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.ThemeEditor
        //
        // Working with ThemeEditor.
        // ---------------------------------------------------------------------------------

        var tabTemplate = '<li class="theme-editor-tab">\n  <a class="theme-editor-tab-filename"></a>\n  <a class="theme-editor-close-tab">x</a>\n</li>';
        var assetItemTemplate = '<li><a class="asset-listing-theme-file" data-asset-key=""></a></li>';
        var addOptionTemplate = '<option value=""></option>';
        var applyObjectToEvent = function (event, object) {
            return function () {
                return event.apply(object, arguments)
            }
        }

        Bizweb.ThemeAsset = function () {
            function ThemeAsset(asset, theme, buckets, requiredFiles) {
                this.theme = theme;
                this.key = asset.key;
                this.publicUrl = asset.public_url;
                this.basename = this.key.substr(this.key.indexOf("/") + 1);
                this.oldBasename = this.basename
                this.bucketName = this.key.substr(0, this.key.indexOf("/")).replace(/\//g, "").toLowerCase();
                this.bucket = buckets[this.bucketName];

                if (this.isVersionable())
                    this.versions = [];

                if (requiredFiles.indexOf(this.key.toLowerCase()) != -1)
                    this.isRequired = true;

                if (asset.content_type.indexOf("image") !== -1)
                    this.isImage = true;
                else
                    this.isImage = false;

                if (asset.content_type.indexOf("flash") !== -1)
                    this.isFlash = true;
                else
                    this.isFlash = false;

                this.version = -1;
            };

            // BEGIN: ThemeEditor - Public Static Functions
            ThemeAsset.getNameWithoutType = function (assetKey) {
                var basename = ThemeAsset.getBaseName(assetKey);
                return basename.replace("." + ThemeAsset.getType(assetKey), "");
            }
            ThemeAsset.getBaseName = function (assetKey) {
                return assetKey.substr(assetKey.indexOf("/") + 1);
            }
            ThemeAsset.getType = function (assetKey) {
                var positionOfDot = assetKey.lastIndexOf(".");
                var type = "";

                if (positionOfDot > 0)
                    type = assetKey.substring(positionOfDot + 1, assetKey.length);

                if (assetKey.toLowerCase().endsWith(".js.bwt"))
                    type = "js";

                if (assetKey.toLowerCase().endsWith(".css.bwt"))
                    type = "css";

                return type;
            }
            // END: ThemeEditor - Public Static Functions

            // BEGIN: ThemeEditor - Public Functions
            ThemeAsset.prototype.listItem = function () {
                return $("[data-asset-key='" + this.key + "']");
            };
            ThemeAsset.prototype.getType = function () {
                var positionOfDot = this.key.lastIndexOf(".");
                var type = "";

                if (positionOfDot > 0)
                    type = this.key.substring(positionOfDot + 1, this.key.length);

                if (this.key.toLowerCase().endsWith(".js.bwt"))
                    type = "js";

                if (this.key.toLowerCase().endsWith(".css.bwt"))
                    type = "css";

                return type;
            }
            ThemeAsset.prototype.getNameWithoutType = function () {
                return this.basename.replace("." + this.getType(), "");
            }
            ThemeAsset.prototype.render = function () {
                var listItem = $(assetItemTemplate);
                listItem.children("a").text(this.basename);
                listItem.children("a").attr("data-asset-key", this.key);
                listItem.children("a").addClass("file-type-" + this.getType());
                this.bucket.element().children(".asset-listing-list").append(listItem);

                switch (this.bucket.key) {
                    case "layouts":
                        if (this.getNameWithoutType() != "exam-topic-id.php" && this.getNameWithoutType() != "checkout") {
                            this._renderAddOption();
                        }
                        break;
                    case "locales":
                        this._renderAddOption(true);
                        break;
                }
            };
            ThemeAsset.prototype._renderAddOption = function (withType) {
                var $modalTemplate = $($("#modal-add-" + this.bucket.key).html());

                var $option = $(addOptionTemplate);

                if (withType) {
                    $option.attr("value", this.basename);
                    $option.text(this.basename);
                }
                else {
                    $option.attr("value", this.getNameWithoutType());
                    $option.text(this.getNameWithoutType());
                }

                $modalTemplate.find("#theme-source-" + this.bucket.key).prepend($option);

                $("#modal-add-" + this.bucket.key).html($modalTemplate);
            };
            ThemeAsset.prototype.reRender = function () {
                if (this.oldKey !== null && this.oldKey !== "") {
                    var assetItem = $(".asset-listing-list li a[data-asset-key='" + this.oldKey + "']");
                    assetItem.text(this.basename);
                    assetItem.attr("data-asset-key", this.key);

                    switch (this.bucket.key) {
                        case "layouts":
                            this._reRenderAddOption();
                            break;
                        case "locales":
                            this._reRenderAddOption(true);
                            break;
                    }
                }
            };
            ThemeAsset.prototype._reRenderAddOption = function (withType) {
                var $modalTemplate = $($("#modal-add-" + this.bucket.key).html());
                var $selector = $modalTemplate.find("#theme-source-" + this.bucket.key);

                if (withType) {
                    var oldValue = ThemeAsset.getBaseName(this.oldKey);
                    var $option = $selector.find("option[value='" + oldValue + "']");

                    $($option[0]).attr("value", this.basename);
                    $($option[0]).text(this.basename);
                }
                else {
                    var oldValue = ThemeAsset.getNameWithoutType(this.oldKey);
                    var $option = $selector.find("option[value='" + oldValue + "']");

                    $($option[0]).attr("value", this.getNameWithoutType());
                    $($option[0]).text(this.getNameWithoutType());
                }

                $("#modal-add-" + this.bucket.key).html($modalTemplate);
            };
            ThemeAsset.prototype.destroy = function () {
                switch (this.bucket.key) {
                    case "layouts":
                        if (this.getNameWithoutType() != "exam-topic-id.php" && this.getNameWithoutType() != "checkout") {
                            this._removeAddOption();
                        }
                        break;
                    case "locales":
                        this._removeAddOption(true);
                        break;
                }

                this.listItem().parent().remove();
            };
            ThemeAsset.prototype._removeAddOption = function (withType) {
                var $modalTemplate = $($("#modal-add-" + this.bucket.key).html());

                if (withType) {
                    $modalTemplate.find("option[value='" + this.basename + "']").remove();
                }
                else {
                    $modalTemplate.find("option[value='" + this.getNameWithoutType() + "']").remove();
                }

                $("#modal-add-" + this.bucket.key).html($modalTemplate);
            };
            ThemeAsset.prototype.url = function (action, hasKey) {
                var url = Bizweb.routes.themes + "/" + action + "/" + this.theme.id;

                if (hasKey)
                    url += "?key=" + this.key;

                return url;
            }
            ThemeAsset.prototype.isVersionable = function () {
                return this.getType() == 'bwt' || this.getType() == 'css' || this.getType() == 'js';
            }
            // END: ThemeEditor - Public Functions

            ThemeAsset.name = "ThemeAsset";
            return ThemeAsset;
        }();

        Bizweb.ThemeEditor = function () {
            function ThemeEditor(data) {
                this.search = applyObjectToEvent(this.search, this);
                this.assetListClicked = applyObjectToEvent(this.assetListClicked, this);
                this.toggleBucket = applyObjectToEvent(this.toggleBucket, this);
                this.updateIsDirty = applyObjectToEvent(this.updateIsDirty, this);
                this.saveAsset = applyObjectToEvent(this.saveAsset, this);
                this.activateNextTab = applyObjectToEvent(this.activateNextTab, this);
                this.activatePreviousTab = applyObjectToEvent(this.activatePreviousTab, this);
                this.onBeforeUnload = applyObjectToEvent(this.onBeforeUnload, this);

                this.tabsContainer = $("#theme-editor-tabs");
                this.codeContainer = $("#code-asset-container").hide();
                this.imageContainer = $("#image-asset-container").hide();
                this.versionContainer = $(".all-asset-versions").addClass('hide');
                this.allVersionLink = $('.show-all-versions-link').hide();
                this.theme = data.exam;
                this.currentTab = {};
                this.newAssetTab = "upload";
                this.buckets = [];
                this.assets = [];
                this._assets = [];
                this.tabs = []
                this.requiredFiles = data.required_files.map(function (elem) { return elem.toLowerCase(); });
                this.isLoading = false;
                this._onAnchorClick = false;

                var that = this;

                // Buckets Binding
                for (var i = 0; i < data.buckets.length; i++) {
                    var bucket = data.buckets[i];
                    bucket.key = bucket.key.toLowerCase();
                    bucket.element = function () {
                        return $("#bucket-" + this.key);
                    };

                    if (bucket.collapsed)
                        bucket.element().addClass("is-collapsed");

                    bucket.wasOpen = !bucket.element().hasClass("is-collapsed");

                    this.buckets[bucket.key] = bucket;
                }

                // Assets Binding
                for (var i = 0; i < data.assets.length; i++) {
                    this.assets[data.assets[i].key] = new Bizweb.ThemeAsset(data.assets[i], this.theme, this.buckets, this.requiredFiles);
                }

                // BEGIN: Events Installation
                $("#asset-search").on("input", this.search);
                $(document.body).on("click", "[data-asset-key]", this.assetListClicked);
                $(window).on("resize", this.resize);
                $(window).on('beforeunload', this.onBeforeUnload);

                var bizwebConfirm = new Bizweb.Confirm();
                $('a:not([target="_blank"])').on('click', function (event) {
                    var $href = $(this).attr('href');
                    if ($href != null && $href.indexOf('/admin') !== -1) {
                        var e, t;
                        for (t in that._assets) {
                            if (e = that._assets[t], e.isDirty) {
                                event.preventDefault();
                                var n;
                                n = bizwebConfirm.show(), n.done(function () {
                                    window.location.href = $href;
                                    that._onAnchorClick = true;
                                }), n.fail(function () {
                                });
                                return false;
                            }
                        }
                    }
                });
                // END: Event Installation

                this.resize();
                this.initializeEditor();
                this.parseState();

                this.viewportSize = 'desktop';
            };

            // BEGIN: ThemeEditor - Event Handling
            ThemeEditor.prototype.assetListClicked = function (e) {
                var assetClickedKey = e.currentTarget.getAttribute("data-asset-key");

                if (this.assets[assetClickedKey].isImage || this.assets[assetClickedKey].isFlash) {
                    this.activateTabForAsset(this.assets[assetClickedKey])
                }
                else {
                    this.getAsset(assetClickedKey, function (asset) {
                        return this.activateTabForAsset(asset, false);
                    });
                }
            };
            ThemeEditor.prototype.search = function (e) {
                var searchRegex;

                var searchKey = e.target.value;
                if (searchKey !== null && searchKey !== "") {
                    searchRegex = new RegExp(searchKey, "g");
                }

                for (bucketKey in this.buckets) {
                    this.buckets[bucketKey].shouldOpen = false;
                }

                for (assetKey in this.assets) {
                    var asset = this.assets[assetKey];
                    var $listItem = asset.listItem();
                    $listItem.html(asset.basename);
                    $listItem.show();

                    if (searchKey !== null && searchKey !== "") {
                        if (assetKey.indexOf(searchKey) !== -1) {
                            $listItem.html(asset.basename.replace(searchRegex, "<strong>" + searchKey + "</strong>"));
                            asset.bucket.shouldOpen = true;
                        }
                        else {
                            $listItem.hide();
                        }
                    }
                }

                for (bucketKey in this.buckets) {
                    var bucket = this.buckets[bucketKey];

                    if (searchKey !== null && searchKey !== "") {
                        bucket.element()[bucket.shouldOpen ? "removeClass" : "addClass"]("is-collapsed");
                    }
                    else {
                        if (bucket.wasOpen)
                            bucket.element().removeClass("is-collapsed");
                        else
                            bucket.element().addClass("is-collapsed");
                    }
                }
            };
            ThemeEditor.prototype.resize = function () {
                if (this.$container == null)
                    this.$container = $(".theme-editor-container");

                var windowHeight = $(window).height();
                windowHeight -= this.$container.offset().top;
                this.$container[0].style.height = "" + windowHeight + "px";

                if (this.assetContainer == null)
                    this.assetContainer = $(".asset-container")[0];

                windowHeight -= this.assetContainer.offsetTop;
                windowHeight -= 1;
                this.assetContainer.style.height = "" + windowHeight + "px";
            };
            // End: ThemeEditor - Event Handling

            // BEGIN: ThemeEditor - Public Functions
            ThemeEditor.prototype.initializeEditor = function () {
                this.bindKeys({
                    "Ctrl-Space": "autocomplete",
                    "Cmd-S": this.saveAsset,
                    "Cmd-O": function () {
                        return $("#asset-search").focus()
                    },
                    "Cmd-/": "toggleComment",
                    "Cmd-Alt-Left": this.activatePreviousTab,
                    "Cmd-Alt-Right": this.activateNextTab,
                    "Cmd-Alt-[": this.activatePreviousTab,
                    "Cmd-Alt-]": this.activateNextTab,
                    "Cmd-Shift-[": this.activatePreviousTab,
                    "Cmd-Shift-]": this.activateNextTab
                });

                this.editor = CodeMirror(this.codeContainer[0], {
                    extraKeys: this.extraKeys,
                    lineNumbers: true,
                    styleActiveLine: true,
                    mode: "application/x-ejs",
                    htmlMode: true,
                    indentUnit: 4,
                    indentWithTabs: true,
                    foldGutter: true,
                    gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                    matchTags: {
                        bothTags: true
                    },
                    autoCloseTags: {
                        whenOpening: false,
                        whenClosing: true
                    }
                });

                this.editor.setSize("100%", "100%");
                this.editor.on("change", this.updateIsDirty);
            };
            ThemeEditor.prototype.parseState = function () {
                var assetKey = Bizweb.Utility.getParameter("key");
                if (assetKey !== null && assetKey !== "") {
                    this.getAsset(assetKey, function (e) {
                        return this.activateTabForAsset(e, false);
                    });
                }
            };
            ThemeEditor.prototype.updateState = function (configs) {
                var params = [];
                for (var key in configs) {
                    var param = configs[key];
                    if (param) {
                        params.push("" + key + "=" + param);
                    }
                }

                history.replaceState(configs, "", "?" + params.join("&"));
            };
            ThemeEditor.prototype.bindKeys = function (bindKeys) {
                var t, i;
                this.extraKeys || (this.extraKeys = {});
                for (i in bindKeys) {
                    t = bindKeys[i],
                    this.extraKeys[i] = t,
                    -1 !== i.indexOf("Cmd") && (this.extraKeys[i.replace("Cmd", "Ctrl")] = t);
                }
                return this.extraKeys
            };
            ThemeEditor.prototype.toggleBucket = function (bucketKey) {
                var selectedBucket = this.buckets[bucketKey];
                selectedBucket.element().toggleClass("is-collapsed");
                selectedBucket.wasOpen = !selectedBucket.element().hasClass("is-collapsed");
            };
            ThemeEditor.prototype.getAsset = function (key, func) {
                var that = this;
                var themeEditor = this;
                var selectedAsset = this.assets[key];
                if (!selectedAsset) {
                    return;
                }

                if (selectedAsset.value == null) {
                    $.ajax({
                        type: 'GET',
                        url: selectedAsset.url("assets", true),
                        contentType: "application/json; charset=utf-8",
                        success: function (asset) {
                            if (asset.value != null)
                                selectedAsset.value = asset.value;

                            that._assets[key] = {
                                key: key,
                                isDirty: false,
                            };

                            if (typeof func == "function")
                                func.call(themeEditor, selectedAsset);
                        },
                        error: function (error) {
                            Bizweb.Flash.error("Đã có lỗi xảy ra khiến tệp tin " + selectedAsset.basename + " không thể tải được nội dung.");
                        }
                    });
                }
                else {
                    if (typeof func == "function")
                        func.call(themeEditor, selectedAsset);
                }
            };
            ThemeEditor.prototype.activateTabForAsset = function (asset, unUpdateState) {
                this.showAsset(asset);
                this.tabsContainer.find(".active").removeClass("active");
                this.currentTab = asset;
                this.updateIsDirty();

                if (unUpdateState == false) {
                    this.currentTab.isDirty = false;
                    this._assets[asset.key].isDirty = false;
                    $("#save-button").addClass("disabled");
                }

                if (!unUpdateState) {
                    this.updateState({
                        key: asset != null ? asset.key : void 0
                    });
                }

                if (asset.tab == null)
                    this.addTabForAsset(asset);

                asset.tab.addClass("active");
                Bindings.refreshImmediately();

                this.resize();
                this.initVersionSelector();
            };
            ThemeEditor.prototype.showAsset = function (asset) {
                if (!asset.bucket.wasOpen)
                    asset.bucket.element().removeClass("is-collapsed");

                if (asset.isImage) {
                    this.imageContainer.find("img").attr("src", asset.publicUrl);
                    this.imageContainer.find("embed").attr("src", "");
                    this.imageContainer.find("embed").hide();
                    this.codeContainer.hide();
                    this.imageContainer.show();
                }
                else if (asset.isFlash) {
                    this.imageContainer.find("embed").attr("src", asset.publicUrl);
                    this.imageContainer.find("embed").show();
                    this.imageContainer.find("img").attr("src", "");
                    this.codeContainer.hide();
                    this.imageContainer.show();
                }
                else {
                    this.imageContainer.hide();
                    this.codeContainer.show();

                    if (asset.value === null || typeof asset.value === "undefined")
                        asset.value = "";

                    if (asset.doc == null)
                        asset.doc = CodeMirror.Doc(asset.value, this.getModeForAsset(asset));

                    this.editor.swapDoc(asset.doc);
                    this.editor.focus();
                }
            };
            ThemeEditor.prototype.getModeForAsset = function (asset) {
                if (asset.mode == null) {
                    if (asset.getType() === "json" || asset.getType() === "js" || asset.key.endsWith(".js.bwt"))
                        asset.mode = "javascript";
                    else if (asset.getType() === "css" || asset.key.endsWith(".css.bwt") || asset.getType() === "scss" || asset.key.endsWith(".scss.bwt"))
                        asset.mode = "css";
                    else if (asset.key.endsWith("bwt"))
                        asset.mode = "htmlmixedliquid";
                    else
                        asset.mode = "application/x-ejs";
                }

                return asset.mode;
            };
            ThemeEditor.prototype.addTabForAsset = function (asset) {
                var themeEditor = this;

                asset.tab = $(tabTemplate);
                asset.tab.data("asset", asset)
                asset.tab.on("click", function () {
                    return themeEditor.activateTabForAsset(asset)
                });
                asset.tab.find(".theme-editor-close-tab").on("click", function () {
                    return themeEditor.closeTabForAsset(asset)
                });
                asset.tab.find(".theme-editor-tab-filename").text(asset.basename);

                this.tabsContainer.append(asset.tab);

                if (this.tabs.indexOf(asset))
                    this.tabs.push(asset);
            };
            ThemeEditor.prototype.closeTabForAsset = function (asset) {
                var e = this._assets[asset.key];
                if (e != null && e.isDirty
                    && !confirm("Bạn có các thay đổi chưa lưu trong " + e.key + ". Bạn có chắc chắn muốn đóng nó?"))
                    return;

                var prevTab = asset.tab.prev();
                if (prevTab.length === 0)
                    prevTab = asset.tab.next();

                var prevAsset = prevTab.data("asset");
                this.removeTabForAsset(asset);
                delete asset.value;
                delete asset.doc;

                delete this._assets[asset.key];

                if (prevAsset != null) {
                    this.activateTabForAsset(prevAsset);
                }
                else {
                    this.currentTab = {};
                    this.codeContainer.hide();
                    this.imageContainer.hide();
                    Bindings.refreshImmediately();
                }

                this.currentTab.selectHtml = "";
            };
            ThemeEditor.prototype.removeTabForAsset = function (asset) {
                this.tabs.splice(this.tabs.indexOf(asset), 1);
                asset.tab.removeData();
                asset.tab.remove();
                asset.tab = null;
            };
            ThemeEditor.prototype.activateNextTab = function () {
                var tabIndex = this.tabs.indexOf(this.currentTab) + 1;
                if (tabIndex >= this.tabs.length)
                    tabIndex = 0;

                this.activateTabForAsset(this.tabs[tabIndex]);
            };
            ThemeEditor.prototype.activatePreviousTab = function () {
                var tabIndex = this.tabs.indexOf(this.currentTab) - 1;
                if (tabIndex < 0)
                    tabIndex = this.tabs.length - 1;

                this.activateTabForAsset(this.tabs[tabIndex]);
            };
            ThemeEditor.prototype.saveAsset = function () {
                if (!this.currentTab.isDirty)
                    return;

                var themeEditor = this;
                var currentAsset = this.currentTab;
                var assetContent;
                if (this.currentTab)
                    assetContent = this.currentTab.doc.getValue();

                var data = {
                    theme_id: this.currentTab.exam.id,
                    key: this.currentTab.key,
                    value: assetContent
                };

                $.ajax({
                    type: 'POST',
                    url: currentAsset.url("UpdateAssets", true),
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(data),
                    dataType: "json",
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }
                        if (themeEditor.currentTab.version >= 0) {
                            themeEditor.currentTab.version = 0;
                            themeEditor.currentTab.versions[0].doc = themeEditor.currentTab.doc;
                            themeEditor.getAllVersions();
                            $("<select class='select-all-asset-versions'></select>").val(0);
                        }
                        themeEditor.currentTab.value = data.value;
                        themeEditor.updateIsDirty();
                        Bizweb.Flash.notice("Nội dung chỉnh sửa đã được lưu.");
                    },
                    error: function (data) {
                        themeEditor.updateIsDirty();

                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Đã xảy ra lỗi khiến quá trình lưu tài nguyên thất bại.");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            };
            ThemeEditor.prototype.renameAsset = function (asset) {
                var themeEditor = this;
                var that = this;

                $.ajax({
                    type: 'POST',
                    url: asset.url("RenameAssets", true),
                    data: {
                        "key": asset.key,
                        "newName": asset.basename
                    },
                    dataType: "json",
                    success: function (data) {
                        var newKey = "" + asset.bucketName + "/" + asset.basename;
                        asset.oldBasename = asset.basename;
                        themeEditor.assets[newKey] = asset;
                        themeEditor.assets[asset.key] = null;
                        asset.oldKey = asset.key;
                        asset.key = newKey;
                        asset.reRender();
                        asset.tab.find(".theme-editor-tab-filename").text(asset.basename);

                        that._assets[asset.key] = that._assets[asset.oldKey];
                        delete that._assets[asset.oldKey];

                        themeEditor.updateState({
                            key: asset != null ? asset.key : void 0
                        });
                    },
                    error: function (data) {
                        themeEditor.currentTab.basename = themeEditor.currentTab.oldBasename

                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Đã xảy ra lỗi khiến quá trình đổi tên tài nguyên thất bại.");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            };
            ThemeEditor.prototype.deleteAsset = function () {
                var that = this;
                this.isLoading = true;
                var themeEditor = this;
                var selectAsset = this.currentTab;

                $.ajax({
                    type: 'POST',
                    url: selectAsset.url("DeleteAssets", true),
                    contentType: "application/json; charset=utf-8",
                    complete: function () {
                        themeEditor.isLoading = false;
                        Bizweb.Modal.hide();
                    },
                    success: function (data) {
                        themeEditor.closeTabForAsset(selectAsset);
                        selectAsset.destroy();
                        themeEditor.assets[selectAsset.key] = null;
                        delete themeEditor.assets[selectAsset.key];
                        delete that._assets[selectAsset.key];

                        Bizweb.Flash.notice("Tài nguyên giao diện đã bị xóa.");

                        themeEditor.updateState({
                            key: ""
                        });
                    },
                    error: function (data) {
                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Đã xảy ra lỗi khiến quá trình xóa tài nguyên thất bại.");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            };
            ThemeEditor.prototype.createAsset = function (type, options) {
                this.isLoading = true;
                var themeEditor = this;
                var processData = true;
                var contentType = "application/json; charset=utf-8";
                var createData = jQuery.extend({}, this[type]);

                if (this.newAsset != null && this.newAssetTab === "upload") {
                    if (createData.file === null)
                        return

                    createData = createData.file;
                    contentType = false;
                    processData = false;
                }
                else {
                    this.prepareDataForCreateAsset(createData, options);
                    createData = JSON.stringify(createData);
                }

                $.ajax({
                    type: 'POST',
                    url: Bizweb.routes.themes + "/AddAssets/" + themeEditor.theme.id,
                    contentType: contentType,
                    processData: processData,
                    data: createData,
                    complete: function () {
                        themeEditor[type] = null;
                        themeEditor.isLoading = false;
                        Bizweb.Modal.hide();
                    },
                    success: function (data) {
                        themeEditor.assets[data.key] = new Bizweb.ThemeAsset(data, themeEditor.theme, themeEditor.buckets, themeEditor.requiredFiles);
                        themeEditor.assets[data.key].render();
                        themeEditor.getAsset(data.key, function (asset) {
                            return this.activateTabForAsset(asset)
                        });
                        Bizweb.Flash.notice("Thêm tài nguyên thành công.");
                    },
                    error: function (data) {
                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Đã xảy ra lỗi khiến quá trình thêm tài nguyên thất bại.");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            };
            ThemeEditor.prototype.prepareDataForCreateAsset = function (data, options) {
                data.themeId = this.theme.id;

                if (options.bucket != null) {
                    switch (options.bucket) {
                        case "layouts":
                        case "templates":
                            if (data.isDuplicate) {
                                if (data.key === null || data.key === "")
                                    return false;

                                data.key = "" + options.bucket + "/" + data.sourceKey + "." + data.key + "." + Bizweb.config.theme_extension;
                                data.sourceKey = "" + options.bucket + "/" + data.sourceKey + "." + Bizweb.config.theme_extension;
                            }
                            else {
                                data.key = "" + options.bucket + "/" + data.sourceKey + "." + Bizweb.config.theme_extension;
                                delete data.sourceKey;
                            }
                            break;
                        case "snippets":
                            data.key = "" + options.bucket + "/" + data.key + "." + Bizweb.config.theme_extension;
                            break;
                        case "assets":
                            data.key = "" + options.bucket + "/" + data.key + data.extension;
                            break;
                        case "locales":
                            if (data.isDuplicate) {
                                if (data.key === null || data.key === "")
                                    return false;

                                data.key = "" + options.bucket + "/" + data.key + ".json";
                                data.sourceKey = "" + options.bucket + "/" + data.sourceKey;
                            }
                            else {
                                data.key = "" + options.bucket + "/" + data.key + ".json";
                                delete data.sourceKey;
                            }

                            data.value = "{\n}";
                            break;
                    }
                }

                if (!data.key)
                    return false;
            };
            ThemeEditor.prototype.updateIsDirty = function () {
                var key = this.currentTab.key;
                if (this._assets[key] == null) {
                    this._assets[key] = {
                        key: key,
                    };
                }

                if (this.currentTab.doc != null) {
                    if (this.currentTab.doc.getValue() !== this.currentTab.value) {
                        this.currentTab.isDirty = true;
                        this._assets[key].isDirty = true;
                    }
                    else {
                        this.currentTab.isDirty = false;
                        this._assets[key].isDirty = false;
                    }
                }
                if (key == "configs/settings_schema.json"
                    || !(key.endsWith('.bwt') || key.endsWith('.scss') || key.endsWith('.css') || key.endsWith('.js') || key.endsWith('.json'))) {
                    this._assets[key].isDirty = false;
                }

                if (this.currentTab.isDirty)
                    $("#save-button").removeClass("disabled");
                else
                    $("#save-button").addClass("disabled");
            };
            ThemeEditor.prototype.updateNewLayoutModal = function (node, event) {
                if (typeof event != "undefined" && event.keyCode == 13)
                    $(node).closest(".modal-dialog").find(".btn-add:not(.disabled)").click();

                if (this.newLayout == null)
                    this.newLayout = {};

                if (this.assets["Layouts/" + this.newLayout.sourceKey + "." + Bizweb.config.theme_extension] != null || this.assets["layouts/" + this.newLayout.sourceKey + "." + Bizweb.config.theme_extension] != null || this.assets["Layouts/" + this.newLayout.sourceKey.toLowerCase() + "." + Bizweb.config.theme_extension] != null || this.assets["layouts/" + this.newLayout.sourceKey.toLowerCase() + "." + Bizweb.config.theme_extension] != null)
                    this.newLayout.isDuplicate = true;
                else
                    this.newLayout.isDuplicate = false;

                if (this.newLayout.isDuplicate && (this.newLayout.key === null || this.newLayout.key === ""))
                    $("#create-layout-button").addClass("disabled");
                else
                    $("#create-layout-button").removeClass("disabled");
            };
            ThemeEditor.prototype.updateNewTemplateModal = function (node, event) {
                if (typeof event != "undefined" && event.keyCode == 13)
                    $(node).closest(".modal-dialog").find(".btn-add:not(.disabled)").click();

                if (this.newTemplate == null)
                    this.newTemplate = {};

                this.newTemplate.sourceKey = $("#theme-source-templates").val();
                this.newTemplate.key = $("#theme-key-templates").val();

                if (this.assets["Templates/" + this.newTemplate.sourceKey + "." + Bizweb.config.theme_extension] != null || this.assets["templates/" + this.newTemplate.sourceKey + "." + Bizweb.config.theme_extension] != null || this.assets["Templates/" + this.newTemplate.sourceKey.toLowerCase() + "." + Bizweb.config.theme_extension] != null || this.assets["templates/" + this.newTemplate.sourceKey.toLowerCase() + "." + Bizweb.config.theme_extension] != null)
                    this.newTemplate.isDuplicate = true;
                else
                    this.newTemplate.isDuplicate = false;

                if (this.newTemplate.isDuplicate && (this.newTemplate.key === null || this.newTemplate.key === ""))
                    $("#create-template-button").addClass("disabled");
                else
                    $("#create-template-button").removeClass("disabled");
            };
            ThemeEditor.prototype.updateNewSnippetModal = function (node, event) {
                if (typeof event != "undefined" && event.keyCode == 13)
                    $(node).closest(".modal-dialog").find(".btn-add:not(.disabled)").click();

                if (this.newSnippet == null)
                    this.newSnippet = {};

                this.newSnippet.key = $("#theme-key-snippets").val();

                if (this.newSnippet.key === null || this.newSnippet.key === "")
                    $("#create-snippet-button").addClass("disabled");
                else
                    $("#create-snippet-button").removeClass("disabled");
            };
            ThemeEditor.prototype.updateNewAssetModal = function (node, event) {
                if (typeof event != "undefined" && event.keyCode == 13)
                    $(node).closest(".modal-dialog").find(".btn-add:not(.disabled)").click();

                if (this.newAsset == null)
                    this.newAsset = {};

                if (this.newAssetTab !== "upload") {
                    this.newAsset.key = $("#theme-key-assets").val();
                    this.newAsset.extension = $("#theme-extension-assets").val();

                    if (this.newAsset.key == null || this.newAsset.key == "")
                        $("#create-asset-button").addClass("disabled");
                    else
                        $("#create-asset-button").removeClass("disabled");
                }
                else {
                    if (this.newAsset.file == null)
                        $("#create-asset-button").addClass("disabled");
                    else
                        $("#create-asset-button").removeClass("disabled");
                }
            };
            ThemeEditor.prototype.updateNewLocaleModal = function (node, event) {
                if (typeof event != "undefined" && event.keyCode == 13)
                    $(node).closest(".modal-dialog").find(".btn-add:not(.disabled)").click();

                if (this.newLocale == null)
                    this.newLocale = {};

                if (this.newLocale.sourceKey !== "scratch")
                    this.newLocale.isDuplicate = true;
                else
                    this.newLocale.isDuplicate = false;

                if (this.newLocale.key === null || this.newLocale.key === "")
                    $("#create-locale-button").addClass("disabled");
                else
                    $("#create-locale-button").removeClass("disabled");
            };
            ThemeEditor.prototype.activeNewAssetTab = function (name) {
                this.newAssetTab = name;
                this.updateNewAssetModal();
            };
            ThemeEditor.prototype.fileInputChanged = function (uploader) {
                this.newAsset.file = null;

                if (uploader.files != null && uploader.files[0] != null) {
                    var uploadAsset = new FormData;
                    uploadAsset.append("key", "assets/" + uploader.files[0].name);
                    uploadAsset.append("upload", uploader.files[0]);
                    uploadAsset.append("theme_id", this.theme.id);
                    this.newAsset.file = uploadAsset;
                }

                this.updateNewAssetModal();
            };
            ThemeEditor.prototype.showModal = function (name) {
                this.newAssetTab = "upload";
                this["new" + name] = null;
                this[name].show();

                var funcName = "updateNew" + name + "Modal";
                if (typeof this[funcName] == "function")
                    this[funcName]();
            };
            ThemeEditor.prototype.initVersionSelector = function () {
                this.allVersionLink.hide();
                $('.select-all-asset-versions').remove();

                if (this.currentTab.isVersionable()) {
                    this.currentTab.versions[0] = {};
                    this.currentTab.versions[0].doc = this.currentTab.doc;
                    if (this.currentTab.version >= 0 && this.currentTab.selectHtml) {
                        var $select = $("<select class='select-all-asset-versions'></select>");
                        $select.append(this.currentTab.selectHtml);
                        $select.val(this.currentTab.version);
                        var themeEditor = this;
                        $select.on("change", function () {
                            return themeEditor.chooseAssetVersion();
                        });
                        this.versionContainer.prepend($select);
                        this.versionContainer.removeClass('hide');
                    } else {
                        this.versionContainer.addClass('hide');
                        this.allVersionLink.show();
                    }
                } else {
                    this.versionContainer.addClass('hide');
                }
            };
            ThemeEditor.prototype.getAllVersions = function () {
                this.currentTab.version = 0;
                var themeEditor = this;
                var key = this.currentTab.key;

                $.ajax({
                    type: 'GET',
                    url: '/admin/topic/GetAllAssetVersions',
                    data: {
                        themeId: this.currentTab.exam.id,
                        key: this.currentTab.key
                    },
                    contentType: "application/json; charset=utf-8",
                    success: function (allVersions) {
                        themeEditor.renderVersionSelector(allVersions);
                    },
                    error: function (error) {
                        Bizweb.Flash.error("Đã có lỗi xảy ra");
                    }
                });

            }
            ThemeEditor.prototype.renderVersionSelector = function (versions) {
                $('.select-all-asset-versions').remove();

                var themeEditor = this;

                var $select = $("<select class='select-all-asset-versions'></select>");
                $select.append($('<option value="0">Hiện tại</option>'));

                for (var i = 0; i < versions.length; i++) {
                    $select.append($('<option value=' + versions[i].id + '>' + (versions.length - i) + " - " + versions[i].created_on + '</option>'));
                }

                $select.on("change", function () {
                    return themeEditor.chooseAssetVersion();
                });

                this.versionContainer.prepend($select);
                this.versionContainer.removeClass('hide');
                $('.show-all-versions-link').hide();
                this.currentTab.selectHtml = $('.select-all-asset-versions').html();
            }
            ThemeEditor.prototype.chooseAssetVersion = function () {
                this.currentTab.versions[0].value = this.currentTab.value;
                var themeEditor = this;

                var version = $('.select-all-asset-versions option:selected').val();
                if (version == 0) {
                    this.chooseOriginAsset();
                    this.updateIsDirty();
                    return;
                }

                if (this.currentTab.versions == null)
                    this.currentTab.versions = [];

                if (this.currentTab.versions[version] != null && this.currentTab.versions[version].value != null) {
                    this.currentTab.version = version;
                    this.currentTab.doc = CodeMirror.Doc(this.currentTab.versions[version].value, themeEditor.getModeForAsset(themeEditor.currentTab));
                    this.editor.swapDoc(this.currentTab.doc);
                    this.editor.focus();
                    this.updateIsDirty();
                }
                else {
                    $.ajax({
                        type: 'GET',
                        url: '/admin/topic/GetDetailAssetVersion',
                        data: {
                            themeId: this.currentTab.exam.id,
                            key: this.currentTab.key,
                            version: version
                        },
                        contentType: "application/json; charset=utf-8",
                        success: function (assetVersion) {
                            themeEditor.currentTab.version = assetVersion.id;
                            themeEditor.currentTab.versions[assetVersion.id] = assetVersion;
                            themeEditor.currentTab.doc = CodeMirror.Doc(assetVersion.value, themeEditor.getModeForAsset(themeEditor.currentTab));
                            themeEditor.editor.swapDoc(themeEditor.currentTab.doc);
                            themeEditor.currentTab.selectHtml = $('.select-all-asset-versions').html();
                            themeEditor.editor.focus();
                            themeEditor.updateIsDirty();
                        },
                        error: function (error) {
                            Bizweb.Flash.error("Đã có lỗi xảy ra");
                        }
                    });
                }

            }
            ThemeEditor.prototype.chooseOriginAsset = function () {
                this.currentTab.version = 0;
                this.currentTab.doc = CodeMirror.Doc(this.currentTab.value, this.getModeForAsset(this.currentTab));
                this.editor.swapDoc(this.currentTab.doc);
                this.editor.focus();
                this.currentTab.selectHtml = $('.select-all-asset-versions').html();
            }
            ThemeEditor.prototype.cancelAllVersions = function () {
                this.chooseOriginAsset();
                this.currentTab.version = -1;
                $('.select-all-asset-versions').remove();
                $('.show-all-versions-link').show();
                this.versionContainer.addClass('hide');
            }
            ThemeEditor.prototype.onBeforeUnload = function () {
                if (this._onAnchorClick) {
                    this._onAnchorClick = false;
                    return;
                }

                var e, t, i;
                i = this._assets;
                for (t in i)
                    if (e = i[t], e.isDirty) return e.key + " has unsaved changes. If you leave this page, they will be lost. Are you sure you want to leave this page?"
            }
            ThemeEditor.prototype.toggleViewportSize = function () {
                if (this.viewportSize == 'desktop') {
                    $('body').addClass('theme-editor--fullscreen');
                    $('.action__zoom-in').addClass('hide');
                    $('.action__zoom-out').removeClass('hide');

                    this.viewportSize = 'fullscreen';

                } else if (this.viewportSize == 'fullscreen') {
                    $('body').removeClass('theme-editor--fullscreen');
                    $('.action__zoom-in').removeClass('hide');
                    $('.action__zoom-out').addClass('hide');

                    this.viewportSize = 'desktop'
                }
                this.resize();
            }
            // BEGIN: ThemeEditor - Functions

            ThemeEditor.name = "ThemeEditor";
            return ThemeEditor;
        }();
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        Bizweb.Remote = function () {
            function t(t, i, n, a) {
                this.ajaxOptions = null != t ? t : {}, this.refreshOnSuccess = i, this.refreshOnError = n, this.fullRefresh = null != a && a, this.submit = e(this.submit, this)
            }
            return t.prototype.submit = function () {
                var e;
                Bizweb.Loading.start(), e = $.ajax(this.ajaxOptions), e.always(function () {
                    return Bizweb.Loading.stop()
                }), e.done(function (e) {
                    return function (t, i, n) {
                        var a, o, s;
                        return (a = n.getResponseHeader("X-Next-Redirect")) ? void Page.visit(a, {
                            reload: !0
                        }) :
                        (null != (o = e.ajaxOptions.done) && o.apply(null, arguments), s = e.refreshOnSuccess ? e.refreshOnSuccess.split(" ") : [], e.fullRefresh ? Page.refresh({
                            onlyKeys: s
                        }) : "false" !== e.refreshOnSuccess ? Page.refresh({
                            response: n,
                            onlyKeys: s
                        }) : void 0)
                    }
                }(this)),
                e.fail(function (e) {
                    return function (t, i, n) {
                        var a;
                        if (null != (a = e.ajaxOptions.fail) && a.apply(null, arguments), "false" !== e.refreshOnError) return e.refreshOnError ? Page.refresh({
                            response: t,
                            onlyKeys: e.refreshOnError.split(" ")
                        }) : Bizweb.handleError(t, i, n)
                    }
                }(this))
            }, t
        }()
    }.call(this),
    function () {
        var e = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };

        $(document).on("keypress", "form[no-submit-on-enter] input", function (t) {
            return 13 === t.which ? t.preventDefault() : void 0
        });
        $(document).on("keydown", "form[submit-on-cmd-enter] input", function (t) {
            return t.which === 13 ? t.metaKey || t.ctrlKey ? this.form.submit() : t.preventDefault() : void 0
        });
        $(document).on("keypress", ".click-on-enter", function (t) {
            return 13 === t.which ? $(t.target).click() : void 0
        });

        Page.onChange(function () {
            return Bizweb.OldForm._dirtyForm
        }, function () {
            return Bizweb.OldForm._dirtyForm = !1
        });

        Bizweb.OldForm = function () {
            function t(t, n) {
                this.opts = null != n ? n : {},
                    this.stopLoading = e(this.stopLoading, this),
                    this.startLoading = e(this.startLoading, this),
                    this.submit = e(this.submit, this),
                    this._updateDirtyState = e(this._updateDirtyState, this),
                    this._updateDirty = e(this._updateDirty, this),
                    this.bindingsFinished = e(this.bindingsFinished, this),
                    this.$form = $(t),
                    this.ajaxSubmit = this.$form.attr("ajax");
                this.$primaryButtons = this.$form.find(this.PRIMARY_BUTTON_SELECTOR);

                (null != t ? t.id : void 0) && (this.$primaryButtons = this.$primaryButtons.add(".js-btn-primary[form='" + t.id + "']"));

                this.$loadableButtons = this.$form.find(this.LOADABLE_BUTTON_SELECTOR);

                (null != t ? t.id : void 0) && (this.$loadableButtons = this.$loadableButtons.add(".js-btn-loadable[form='" + t.id + "']"));

                this.$loadableButtons.addClass("has-loading");
                this.$form.on("input change paste bindings:change", this._updateDirty);
                this.$form.on("submit", this.submit);
                this.$form.on("fail done", this.stopLoading);
                this.opts.disabledUntilDirty && this.$primaryButtons.addClass("disabled").attr("disabled", "disabled");
                this.opts.observer && this.opts.observer.register(this, this.$form);
                Twine.afterBound(this.bindingsFinished)

                initAutoNumeric();
            }

            t.prototype.PRIMARY_BUTTON_SELECTOR = "a.js-btn-primary, input.js-btn-primary, button.js-btn-primary";
            t.prototype.LOADABLE_BUTTON_SELECTOR = "a.js-btn-loadable, input.js-btn-loadable, button.js-btn-loadable, select.js-btn-loadable";
            t._dirtyForm = !1;
            t.withIgnoreUnsavedChanges = function (t) {
                var e;
                return e = this._dirtyForm, this._dirtyForm = !1, t.call(), this._dirtyForm = e
            };
            t.makeClean = function () {
                return this._dirtyForm = !1
            };

            t.prototype.bindingsFinished = function () {
                return this.resetDirtyTracking(), this.opts.startDirty ? this.makeDirty() : void 0
            };
            t.prototype._getInputValues = function () {
                var t;
                return t = this.$form.find("input, select, textarea").not(".js-no-dirty"), _.map(t, function (t) {
                    var e;
                    return "checkbox" === (e = t.type) || "radio" === e ? {
                        value: t.checked,
                        disabled: t.disabled
                    } : {
                        value: t.value,
                        disabled: t.disabled
                    }
                })
            };
            t.prototype._alertIfFormDirty = function () {
                return Bizweb.OldForm._dirtyForm = !0
            };
            t.prototype._updateDirty = function (t) {
                var e, n;
                n = t.target, n.classList.contains("js-no-dirty") || ("form" === (e = n.nodeName.toLowerCase()) || "input" === e || "textarea" === e || "select" === e) && ("hidden" !== n.type || null != $(n).data("dirty-trigger")) && (null == this.debounceValidate && (this.debounceValidate = _.debounce(this._updateDirtyState, 10, {
                    leading: !0,
                    trailing: !0
                })), this.debounceValidate())
            };
            t.prototype._updateDirtyState = function () {
                return this._matchEnabledValues(this._getInputValues(), this.initialValues) ? this.makeClean() : this.makeDirty()
            };
            t.prototype._matchEnabledValues = function (t, e) {
                return _.size(t) !== _.size(e) ? !1 : _(t).zip(e).every(function (t) {
                    var e, n;
                    return n = t[0], e = t[1], n.disabled || n.value === e.value
                })
            };
            t.prototype.makeDirty = function () {
                return this.isDirty = !0, this.opts.alertUnsavedChanges && this._alertIfFormDirty(), this.disabled ? void 0 : (this.$primaryButtons.removeClass("disabled").removeAttr("disabled", "disabled"), this.$form.addClass("frm-dirty")), this.enablePrimaryButtons(), this.opts.disabledUntilDirty && !this.opts.disableContextBar && this.showContextBar()
            };
            t.prototype.enablePrimaryButtons = function () {
                return !0;
            };
            t.prototype.showContextBar = function () {
                var e = {
                    form: this.$form.attr("id")
                },
                t = Object.assign(e, this.primaryAttr);
                Bizweb.rootDispatcher.dispatch({
                    type: "CONTEXT_BAR_ON_EVENT",
                    data: {
                        primaryAttr: t
                    }
                })
            };
            t.prototype.makeClean = function () {
                return this.isDirty = !1, Bizweb.OldForm._dirtyForm = !1, this.$form.removeClass("frm-dirty"), this.opts.disabledUntilDirty ? this.$primaryButtons.addClass("disabled").attr("disabled", "disabled") : void 0
            };
            t.prototype.resetDirtyTracking = function () {
                return this.makeClean(), this.initialValues = this._getInputValues()
            };
            t.prototype.enable = function () {
                return this.disabled = !1, this.isDirty ? this.makeDirty() : void 0
            };
            t.prototype.disable = function () {
                return this.disabled = !0, this.$primaryButtons.addClass("disabled").attr("disabled", "disabled")
            };
            t.prototype.submit = function (t) {
                //if (!this.$form.valid()) {
                //    return;
                //}
                var e, n;
                Bizweb.OldForm._dirtyForm = !1;
                unSetAutoNumericForm();
                n = null != (e = this.opts.submit) ? e.apply(this, arguments) : void 0;
                (null != t ? t.isImmediatePropagationStopped() : void 0) || this.startLoading()

                if (this.opts.ajax) {
                    this.submitWithAjax(t);
                    return false;
                }

                return n
            };
            t.prototype.submitWithAjax = function (t) {
                var that = this;
                unSetAutoNumeric();
                var n = {
                    type: this.$form.attr("method"),
                    url: this.$form.attr("action"),
                    data: this.$form.serialize(),
                    dataType: "html",
                    waitMilliseconds: 1150,
                    beforeSend: function () {
                        reSetAutoNumeric();
                    },
                    fail: function () {
                        return that.$form.trigger("fail", arguments)
                    },
                    done: function () {
                        return that.$form.trigger("done", arguments)
                    }
                };
                var r = new Bizweb.Remote(n, this.$form.attr("refresh-on-success"), this.$form.attr("refresh-on-error"));

                r.submit();
            };
            t.prototype.startLoading = function (t) {
                var e;
                return e = this.$loadableButtons, (null != t ? t.loadingElements : void 0) && (e = t.loadingElements), Bizweb.Loading.start(), e.attr("disabled", "disabled").addClass("is-loading")
            };
            t.prototype.stopLoading = function (t) {
                var e;
                return e = this.$loadableButtons, (null != t ? t.loadingElements : void 0) && (e = t.loadingElements), Bizweb.Loading.stop(), e.removeAttr("disabled").removeClass("is-loading")
            };
            t.prototype.disableHiddenInputs = function () {
                return this.$form.find(".disable-inputs-when-hidden:visible :input").prop("disabled", !1), this.$form.find(".disable-inputs-when-hidden:not(:visible) :input").prop("disabled", "disabled")
            };

            //t.prototype.cancel = function () {
            //    if (this._dirtyForm) {
            //        if (this.cancelAlert) {
            //            this.cancelAlert.show();
            //        }
            //    }
            //    else {
            //        //redirect luon
            //        var location = window.location.href;
            //        if (location.indexOf("create") > -1) {
            //            window.location.href = window.location.href.replace("/create", "");
            //        } else {
            //            window.location.href = window.location.href;
            //        }
            //    }
            //}

            return t;
        }()
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = function (e, t) {
                function n() {
                    this.constructor = e
                }
                for (var r in t) i.call(t, r) && (e[r] = t[r]);
                return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
            },
            i = {}.hasOwnProperty;
        Bizweb.Confirm = function (i) {
            function n(t) {
                this.options = null != t ? t : {}, this.show = e(this.show, this), n.__super__.constructor.call(this, null, this.options)
            }
            return t(n, i), n.prototype.message = function () {
                return this.options.message || "Nếu bạn rời khỏi trang này, tất cả thay đổi chưa lưu sẽ bị mất. Bạn có chắc chắn muốn rời khỏi trang này?"
            }, n.prototype.accept_button_text = function () {
                return this.options.accept_text || "Rời khỏi trang này"
            }, n.prototype.header_text = function () {
                return this.options.header_text || "Rời khỏi trang?"
            }, n.prototype.content = function () {
                return '<div class="modal-dialog" id="bizweb__confirm"><div class="modal-content"><div class="ui-modal__header"> <div class="ui-modal__header-title"> <h2 class="ui-title">' + this.header_text() + '</h2> </div><div class="ui-modal__header-actions"> <div class="ui-modal__close-button"> <button class="ui-button ui-button--transparent close-modal" data-dismiss="modal" aria-label="Close modal" type="button" name="button"> <svg class="next-icon next-icon--color-ink-lighter next-icon--size-20"> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#cancel-small-minor"></use> </svg> </button> </div></div></div><div class="ui-modal__body"> <div class="ui-modal__section"> <p>' + this.message() + '</p></div></div><div class="ui-modal__footer"> <div class="ui-modal__footer-actions"> <div class="ui-modal__secondary-actions"> <a class="btn close-modal" data-no-turbolink="true">Hủy</a> </div><div class="ui-modal__primary-actions"> <a class="btn btn-destroy-no-hover accept-modal" data-no-turbolink="true">' + this.accept_button_text() + '</a> </div></div></div></div></div>';
            }, n.prototype.link = function () {
                return this.options.link
            }, n.prototype.show = function (e) {
                var t;
                return null == e && (e = {}),
                    t = $.Deferred(), e.content = this.content(), n.__super__.show.call(this, e),
                    $(".modal").on("click", ".close-modal", t._reject),
                    $(".modal").on("click", ".accept-modal", t.resolve), t.promise()
            }, n
        }(Bizweb.Modal)
    }.call(this),
    function () {
        Bizweb.SortableImages = function () {
            function e() { }
            return e.prototype.initSortable = function (e, t) {
                return e.sortable({
                    opacity: .3,
                    helper: this._defineHelper,
                    tolerance: "pointer",
                    placeholder: "product-photo-grid__item",
                    forcePlaceholderSize: !1,
                    update: function () {
                        return function () {
                            return e.removeClass("is-sorting"), "function" == typeof t.onUpdate ? t.onUpdate() : void 0
                        }
                    }(),
                    start: function (t) {
                        return function (i, n) {
                            return t._handleFirstImageSize(i, n), n.placeholder.html('<div class="product-photo__sort-placeholder"> <div class="product-photo__sort-placeholder__content"></div> </div>'), e.addClass("is-sorting")
                        }
                    }(this),
                    stop: function () {
                        return function () {
                            return e.removeClass("is-sorting"), e.find(".product-photo-grid--featured").removeClass("product-photo-grid--featured")
                        }
                    }(),
                    change: function (e) {
                        return function (t, i) {
                            return e._handleFirstImageSize(t, i)
                        }
                    }(this)
                })
            }, e.prototype._handleFirstImageSize = function (e, t) {
                var i;
                if (0 === t.item.index()) return i = $(e.target).find(".product-photo-grid__item"), i.removeClass("product-photo-grid--featured"), $(i[1]).addClass("product-photo-grid--featured")
            }, e.prototype._defineHelper = function (e, t) {
                var i;
                return i = t.clone(), i.find(".product-photo-hover-overlay").hide(), i.show(), i
            }, e
        }()
    }.call(this),
    function () {
        Bizweb.XHR2Upload = function () {
            function e() { }
            return e.prototype.submit = function (e, t, i) {
                var n, r, o, s;
                return null == t && (t = {}), null == i && (i = {}), n = $.Deferred(),
                    o = n.promise(), window.FormData ? (r = new FormData, this.dataToFormData(t, r),
                        s = new XMLHttpRequest, s.open(i.method || "POST", e, !0), s.onreadystatechange = function () {
                            if (4 === s.readyState) return s.status >= 200 && s.status < 400 ? n.resolve(s) : n._reject(s)
                        }, s.upload.onprogress = function (e) {
                            return n.notify(e)
                        }, s.setRequestHeader("X-CSRF-Token", $('meta[name="csrf-token"]').attr("content")),
                        s.setRequestHeader("X-Requested-With", "XMLHttpRequest"), s.send(r), o.abort = function () {
                            return s.abort(), n._reject()
                        }, o) : (n._reject(null), o)
            }, e.prototype.dataToFormData = function (e, t) {
                var i, n, r, o, s, a, u, l, c;
                if (e instanceof Array)
                    for (n = 0, s = e.length; n < s; n++) i = e[n], this.dataToFormData(i, t);
                else
                    for (o in e)
                        if ((l = e[o]) instanceof FileList)
                            for (r = 0, a = l.length; r < a; r++) u = l[r], c = {}, c[o] = u, this.dataToFormData(c, t);
                        else t.append(o, l)
            }, e
        }()
    }.call(this),
    function () {
        Page.onChange(function () {
            var e;
            return !0 === (null != (e = window.imageUploader) ? e.uploading : void 0)
        }, function () {
            var e;
            return null != (e = window.imageUploader) ? e.uploading = !1 : void 0
        }), Bizweb.ImageUploader = function () {
            function e() {
                this.reset()
            }
            return e.FAILED = "failed", e.DONE = "done", e.prototype.reset = function () {
                return this.uploading = !1, this.uploadedImages = {}
            }, e.prototype.getStatus = function (e) {
                return this.uploadedImages[e] || !1
            }, e.prototype.uploadImages = function (e, t, i) {
                var n, r, o;
                return this.uploading = !0,
                    this.abort_error = null,
                    Bizweb.Loading.start(),
                    n = _.sortBy(e, "position"),
                    r = new Bizweb.XHR2Upload, (o = function (e) {
                        return function (n) {
                            var a;
                            if (e.uploading) return a = n.shift(), r.submit(Bizweb.routes.products + "/" + t + "/images.json", {
                                "image[attachment]": a.file,
                                "image[alt]": a.alt
                            }).done(function () {
                                return e.uploadedImages[a.imageId] = Bizweb.ImageUploader.DONE
                            }).fail(function (t) {
                                var i = JSON.parse(t.response);
                                e.uploadedImages[a.imageId] = Bizweb.ImageUploader.FAILED;
                                e.abort_error = _.get(i, "errors.image[0]");
                                if (e.abort_error == undefined) {
                                    e.abort_error = _.get(i, "errors.storage[0]");
                                    if (e.abort_error != null && e.abort_error.indexOf("maximum is") > -1) {
                                        e.abort_error = "Website của bạn đã hết dung lượng lưu trữ";
                                    }
                                }
                                if (e.abort_error == undefined) {
                                    e.abort_error = t.response;
                                }
                            }).always(function () {
                                return Bindings.refresh(), e.abort_error ? (Bizweb.Flash.error(e.abort_error), Bizweb.Loading.stop(), i()) : _.isEmpty(n) ? (Bizweb.Loading.stop(), i()) : o(n)
                            })
                        }
                    }(this))(n)
            }, e
        }()
    }.call(this),
    function () {
        Bizweb.FileDragHelper = function () {
            function e() {
                this.dragging = !1, this.dragCount = 0
            }
            return e.prototype.start = function (e) {
                if (this.isFileDragEvent(e)) return this.dragCount = (this.dragCount || 0) + 1, this.dragging = !0, e.stopPropagation(), e.preventDefault()
            }, e.prototype.over = function (e) {
                return e.originalEvent.dataTransfer.dropEffect = "copy", e.stopPropagation(), e.preventDefault()
            }, e.prototype.cancel = function (e) {
                return this.dragCount = Math.max(0, (this.dragCount || 0) - 1), 0 === this.dragCount && (this.dragging = !1), e.stopPropagation(), e.preventDefault()
            }, e.prototype.isFileDragEvent = function (e) {
                var t, i;
                return (null != (t = e.originalEvent.dataTransfer) && null != (i = t.types[0]) ? i.toLowerCase().indexOf("file") : void 0) >= 0
            }, e
        }()
    }.call(this),
    function () {
        var e, t, i, n;
        n = 20, i = 1, t = 1e3 * n * 1e3, e = 1e3 * i * 1e3, Bizweb.ImageUtils = {}, Bizweb.ImageUtils.fileTypeError = function (e) {
            return "image/svg+xml" === e.type ? "Không phải tập tin ảnh (.jpg, .gif, .png)" : null
        }, Bizweb.ImageUtils.filesizeError = function (t) {
            return t.size > e ? "Vượt quá dung lượng " + i + "MB cho phép" : null
        }, Bizweb.ImageUtils.dimensionError = function (e) {
            return null;
            //var i;
            //return i = e.width * e.height, i > t ? "Vượt quá " + n + " megapixels" : i <= 0 || isNaN(i) ? "bị lỗi hoặc không phải tập tin ảnh (.jpg, .gif, .png)" : null
        }
    }.call(this),
    function () {
        Bizweb.UploadErrors = function () {
            o = function (e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            },
            r = function () {
                function e(e, t) {
                    for (var i = 0; i < t.length; i++) {
                        var n = t[i];
                        n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(e, n.key, n)
                    }
                }
                return function (t, i, n) {
                    return i && e(t.prototype, i), n && e(t, n), t
                }
            }()
            function e(t) {
                var i = t.$errorContainer,
                    n = t.$errorTemplate;
                o(this, e), this.add = this.add.bind(this), this.clear = this.clear.bind(this), this.$errorContainer = i,
                this.errors = [], this.errorMessageTemplate = Bizweb.Templates.precompile(n.html())
            }
            return r(e, [{
                key: "hasErrors",
                value: function () {
                    return this.errors.length > 0
                }
            }, {
                key: "add",
                value: function (e, t) {
                    this.errors.push({
                        filename: e,
                        error: t
                    })
                }
            }, {
                key: "clear",
                value: function () {
                    this.errors = [], this.$errorContainer.empty()
                }
            }, {
                key: "renderErrors",
                value: function () {
                    if (this.hasErrors()) {
                        var e = !0,
                            t = !1,
                            i = undefined;
                        try {
                            for (var r, o = this.errors[Symbol.iterator]() ; !(e = (r = o.next()).done) ; e = !0) {
                                var a = r.value;
                                Bizweb.Templates.renderAndAppend(this.errorMessageTemplate, a, this.$errorContainer)
                            }
                        } catch (e) {
                            t = !0, i = e
                        } finally {
                            try {
                                !e && o["return"] && o["return"]()
                            } finally {
                                if (t) throw i
                            }
                        }
                        Bindings.refresh()
                    }
                }
            }]), e
        }();
    }.call(this),
    function () {
        Bizweb.Notifications = function () {
            function Notifications(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            Notifications.prototype.toggle = function (e) {
                Bizweb.Utility.loadAjax($(e).attr("href"), ".content-notification");
            }

            Notifications.prototype.sendTest = function (id, type) {
                if (type == 'web') {
                    if (Notification.permission !== "granted")
                        Notification.requestPermission();
                    else {
                        var notification = new Notification('Bạn có đơn hàng mới', {
                            icon: 'https://bizweb.dktcdn.net/assets/images/logo-icon.png',
                            body: Bizweb.store.settings.storeName + " có 1 đơn hàng mới trị giá 500.000đ bao gồm 3 sản phẩm. Xem chi tiết",
                            tag: "orderPlacedNotification",
                        });
                    }
                    return;
                }
                var url = "/admin/settings/notifications/test" + type + "/" + id;

                $.ajax({
                    url: url,
                    type: "POST",
                    success: function (data) {
                        if (data.message) {
                            Bizweb.Flash.notice(data.message);
                        }
                    },
                    error: function (data) {
                        if (data.responseJSON && data.responseJSON.error) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        else {
                            Bizweb.Flash.error("Gửi thông tin thử nghiệm thất bại");
                        }
                    }
                });
            }

            Notifications.prototype.enableNotification = function () {
                window.messaging.requestPermission()
                    .then(function () {
                        console.log('Notification permission granted.');
                        window.messaging.getToken()
                            .then(function (currentToken) {
                                Bizweb.Loading.start();
                                $.ajax({
                                    type: "POST",
                                    url: "/admin/notifications",
                                    data: {
                                        token: currentToken
                                    },
                                    global: false,
                                    success: function (data) {
                                        Bizweb.Utility.loadAjax(window.location.href, ".content-notification", function () {
                                            Bizweb.Flash.notice(data.message);
                                        });
                                        setTokenSentToServer(true);
                                    },
                                    error: function (data) {
                                        if (data.responseJSON && data.responseJSON.error) {
                                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                                        }
                                        else {
                                            Bizweb.Flash.error("Cập nhật thông tin thất bại");
                                        }
                                        Bizweb.Loading.stop();
                                    }
                                });
                            })
                            .catch(function (err) {
                                console.log('Error retrieving Instance ID token. ', err);
                                Bizweb.Flash.error("Lỗi không nhận được token từ trình duyệt");
                            });
                        // TODO(developer): Retrieve an Instance ID token for use with FCM.
                    })
                    .catch(function (err) {
                        console.log('Unable to get permission to notify.', err);
                        Bizweb.Flash.error("Xin hãy cho phép trình duyệt nhận thông báo từ Bizweb");
                    });
            }

            Notifications.prototype.disableNotification = function () {
                window.messaging.getToken()
                    .then(function (currentToken) {
                        Bizweb.Loading.start();
                        $.ajax({
                            type: "POST",
                            url: "/admin/notifications/remove",
                            data: {
                                token: currentToken
                            },
                            global: false,
                            success: function (data) {
                                Bizweb.Utility.loadAjax(window.location.href, ".content-notification", function () {
                                    Bizweb.Flash.notice(data.message);
                                });
                                setTokenSentToServer(false);
                            },
                            error: function (data) {
                                if (data.responseJSON && data.responseJSON.error) {
                                    Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                                }
                                else {
                                    Bizweb.Flash.error("Cập nhật thông tin thất bại");
                                }
                                Bizweb.Loading.stop();
                            }
                        });
                    })
                    .catch(function (err) {
                        console.log('Error retrieving Instance ID token. ', err);
                        Bizweb.Flash.error("Lỗi không nhận được token từ trình duyệt");
                    });
            }

            Notifications.prototype.showRevertEmailTemplateToDefaultModal = function (template) {
                this.revertEmailTemplateToDefaultModal.show();
                $('.form-revert-email-default input[name="template"]').val(template);
            }
            Notifications.prototype.showRevertOrderPrintTemplateToDefaultModal = function (template) {
                this.revertOrderPrintTemplateToDefaultModal.show();
            }
            Notifications.prototype.showRevertShipmentPrintTemplateToDefaultModal = function (template) {
                this.revertShipmentPrintTemplateToDefaultModal.show();
            }

            Notifications.prototype.showDeleteWebhook = function (webhookId) {
                this.deleteWebhookModal.show();
                $('.form-delete-webhook input[name="webhookId"]').val(webhookId);
            }

            Notifications.prototype.updateCommentSetting = function (ele) {
                Bizweb.Loading.start();
                var commentSetting = $(ele).is(':checked');
                $.ajax({
                    type: "POST",
                    url: Bizweb.routes.setting.notifications + "/UpdateCommentNotificationSetting",
                    data: {
                        CommentNotificationSetting: commentSetting
                    },
                    global: false,
                    success: function (data) {
                        if (data.message) {
                            Bizweb.Flash.notice(data.message);
                        } else {
                            Bizweb.Flash.notice("Cập nhật cấu hình thành công");
                        }
                        Bizweb.Loading.stop();
                    },
                    error: function (data) {
                        if (data.responseJSON && data.responseJSON.error) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        else {
                            Bizweb.Flash.error("Cập nhật cấu hình thất bại");
                        }
                        $(ele).prop('checked', !commentSetting);
                        Bizweb.Loading.stop();
                    }
                });
            }

            return Notifications;
        }();
    }.call(this),
    function () {
        var t = function (e, t) {
            function n() {
                this.constructor = e
            }
            for (var r in t) i.call(t, r) && (e[r] = t[r]);
            return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
        }, i = {}.hasOwnProperty;
        Bizweb.NotificationDetail = function (parent) {
            function NotificationDetail(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.opts = { alertUnsavedChanges: true, disabledUntilDirty: true };
                this.element = element;
                this.changedSettings = !1;

                $("textarea").height($("textarea")[0].scrollHeight);

                NotificationDetail.__super__.constructor.call(this, this.form, this.opts);
            };
            t(NotificationDetail, parent);

            NotificationDetail.prototype.changeSettings = function () {
                this.changedSettings = !0;
            };

            NotificationDetail.prototype.previewEmailTemplate = function () {
                var emailTemplateContent = $('#email-template-content').val();
                var emailTemplateSubject = $('#email-template-subject').val();
                var that = this;
                $.ajax({
                    url: '/admin/settings/notifications/PreviewEmailTemplate',
                    type: "POST",
                    data: {
                        Subject: emailTemplateSubject,
                        Content: emailTemplateContent,
                    },
                    success: function (result) {
                        Bindings.refresh()
                        that.viewTemplate.show();
                        $('#viewTemplate').find('.ui-modal__body').find('.nofification-detail').find('#email_template_iframe').attr('srcdoc', stripScripts(result.email));
                        $('#viewTemplate').find('.ui-modal__body').find('.notification-subject').text(result.subject);
                    }
                });
            };

            NotificationDetail.prototype.sendTestEmail = function (template) {
                $.ajax({
                    url: '/admin/settings/notifications/SendTestMail',
                    type: "POST",
                    data: {
                        template: template,
                    },
                    success: function (result) {
                        if (result != "OK") {
                            Bizweb.Flash.error("Gửi email thử nghiệm không thành công");
                        } else {
                            Bizweb.Flash.notice("Gửi email thử nghiệm thành công");
                        }
                    }
                });
            };

            NotificationDetail.prototype.showRevertEmailTemplateToDefaultModal = function (template) {
                this.revertEmailTemplateToDefaultModal.show();
                $('.form-revert-email-default input[name="template"]').val(template);
            }

            NotificationDetail.prototype.resizeIframe = function (e) {
                setTimeout(function () { $(e).height(e.contentWindow.document.body.scrollHeight + 40) }, 300);
                //return $(e).height(e.contentWindow.document.body.scrollHeight + 50)
            }

            return NotificationDetail;
        }(Bizweb.Forms);
    }.call(this),
    function () {
        Bizweb.EmailTemplateOperations = function () {
            function EmailTemplateOperations(e) {
                this.$node = $(e);
                this.$colorPicker = this.$node.find("#shop_accent_color");
                this.preview = _.debounce(this.preview, 150);
                this.$imageWidth = this.$node.find("#shop_logo_width");
                this.$previewBox = $("#preview-email-box");
                this.imagePicker = new Bizweb.ImagePicker("logo_key", e);
                this.changedSettings = !1;
                Page.onChange(function (e) {
                    return function () {
                        return e.changedSettings
                    }
                }(this), function (e) {
                    return function () {
                        return e.changedSettings = !1
                    }
                }(this))
            }

            EmailTemplateOperations.prototype.changeSettings = function () {
                this.changedSettings = !0;
                this.preview();
            };

            EmailTemplateOperations.prototype.editPreview = function (e, t, i) {
                var n;
                return this.activeView = "preview", n = $.ajax({
                    data: t.$form.serialize().replace(/_method=patch/, ""),
                    type: "post",
                    url: e.href
                }), n.success(function (e, t, n) {
                    return Page.refresh({
                        onlyKeys: ["preview_email_template", "preview_sms_template"],
                        response: n
                    }), i.show()
                }), n.fail(function (e, t, i) {
                    return 422 === e.status ? Bizweb.Flash.error(e.responseText) : Bizweb.handleError(e, t, i)
                })
            };

            EmailTemplateOperations.prototype.preview = function (e) {
                var t;
                return t = $.ajax({
                    data: {
                        index: null != e ? e : this.$previewBox.data("index"),
                        emailSettings: {
                            accentColor: this.$colorPicker.val(),
                            logoKey: this.imagePicker.$input.val(),
                            logoWidth: this.$imageWidth.val()
                        }
                    },
                    type: "post",
                    url: this.$node.data("target")
                }), t.success(function (e, t, i) {
                    return Page.refresh({
                        onlyKeys: ["preview_email_template", "preview_sms_template"],
                        response: i
                    })
                }), t.fail(function (e, t, i) {
                    Bizweb.Flash.error(e.responseText);
                })
            };

            EmailTemplateOperations.prototype.save = function (e) {
                var that = this;
                $.ajax({
                    type: "post",
                    url: e.href,
                    data: {
                        emailSettings: {
                            accentColor: this.$colorPicker.val(),
                            logoKey: this.imagePicker.$input.val(),
                            logoWidth: this.$imageWidth.val()
                        }
                    },
                    success: function (data) {
                        that.changedSettings = !1;
                        Bizweb.Flash.notice("Lưu cấu hình email thành công");
                    },
                    error: function (error) {
                        Bizweb.Flash.error("Đã xảy ra lỗi");
                    }
                })
            };

            EmailTemplateOperations.prototype.resizeIframe = function (e) {
                return $(e).height(e.contentWindow.document.body.scrollHeight + 50)
            };

            return EmailTemplateOperations;
        }()
    }.call(this),
    function () {
        Bizweb.HTML = {
            unsafeStrip: function (input, max_length) {
                var nonNullableInput = input || "",
                result = nonNullableInput.replace(/<style[^<]*>[\s\S]*?<\/style>/gi, "").replace(/<script[^<]*>[\s\S]*?<\/script>/gi, "").replace(/<[^>]+>/g, "").replace(/\s+/g, " ").replace(/^\s+|\s+$/g, "");
                return max_length && (result = result.substring(0, max_length)), result;
            },
            unsafeStripWithoutNbsp: function (input, max_length) {
                var nonNullableInput = input || "",
                result = nonNullableInput.replace(/<style[^<]*>[\s\S]*?<\/style>/gi, "").replace(/<script[^<]*>[\s\S]*?<\/script>/gi, "").replace(/<[^>]+>/g, "").replace(/&nbsp;/g, " ").replace(/\s+/g, " ").replace(/^\s+|\s+$/g, "");
                return max_length && (result = result.substring(0, max_length)), result;
            },
            escapeEntities: function (input) {
                return input.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            },
            unescapeEntities: function (input) {
                return input.replace(/&quot;/g, '"').replace(/&#39;/g, "'").replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
            }
        }
    }.call(this),
    function () {
        Bizweb.EditSeo = function () {
            function EditSeo(node, properties) {
                this.max_alias_length = 255;
                if (properties.max_alias_length)
                    this.max_alias_length = properties.max_alias_length;
                this.max_seo_title_length = 70;
                if (properties.max_seo_title_length)
                    this.max_seo_title_length = properties.max_seo_title_length;
                this.max_seo_description_length = 320;
                if (properties.max_seo_description_length)
                    this.max_seo_description_length = properties.max_seo_description_length;
                this.seo_visible = false;
                this.object_name = properties.object_name;
                this.object_reference = properties.object_reference;
                this.original_handle = properties.original_handle;
                this.node = node;
                this.object = Bindings.context(this.node)[this.object_reference];
                this.new_handle = this.original_handle;
            }

            EditSeo.prototype.shouldShowPreview = function () {
                return !this.missingText();
            }

            EditSeo.prototype.missingText = function () {
                var missingFields = [];
                if (!this.googleTitle())
                    missingFields.push('Tiêu đề');
                if (!this.googleDescription())
                    missingFields.push('Mô tả');
                if (0 === missingFields.length)
                    return '';
                else
                    return 'Xin hãy nhập ' + missingFields.join(' và ') + ' để xem trước kết quả tìm kiếm của ' + this.object_name + ' này';
            }

            EditSeo.prototype.googleTitle = function () {
                var google_title;
                if (this.object.meta_title)
                    google_title = this.object.meta_title;
                else if (this.object.name)
                    google_title = this.object.name;
                else
                    google_title = '';

                return Bizweb.Inflection.truncate(google_title, this.max_seo_title_length);
            }

            EditSeo.prototype.googleDescription = function () {
                var google_description;
                if (this.object.meta_description) {
                    google_description = this.object.meta_description;
                }
                else if (this.object.content) {
                    google_description = this.object.content;
                    //CKEDITOR.instances["Content"].getData().replace(/(\r?\n|\r)/gm, ' ').trim();
                }
                else {
                    google_description = '';
                }

                return Bizweb.Inflection.truncate(google_description, this.max_seo_description_length);
            }

            EditSeo.prototype.googlePath = function () {
                if (this.new_handle)
                    return this.new_handle;
                else return Bizweb.Inflection.generateAlias(this.object.name, 320);
            }

            EditSeo.prototype.urlChanged = function () {
                return this.googlePath() !== this.original_handle;
            }

            EditSeo.prototype.isSeoVisible = function () {
                return this.seo_visible;
            }

            EditSeo.prototype.showSeo = function () {
                this.seo_visible = true;
                $('.seo-section').show();
                return this.seo_visible;
            }

            EditSeo.prototype.titleCharsRemainingText = function () {
                if (typeof this.object.meta_title === "undefined" || !this.object.meta_title) return Math.min((this.object.name || '').length, this.max_seo_title_length);
                return this.object.meta_title.length;
            }
            EditSeo.prototype.descriptionCharsRemainingText = function () {
                if (typeof this.object.meta_description === "undefined" || !this.object.meta_description)
                    return Math.min((this.object.content || '').length, this.max_seo_description_length);
                return this.object.meta_description.length;
            }
            EditSeo.prototype.titlePlaceHolder = function () {
                if (this.object.name)
                    return this.object.name.replace(/(\r?\n|\r)/gm, ' ').trim().substr(0, this.max_seo_title_length);
                return '';
            }
            EditSeo.prototype.descriptionPlaceHolder = function () {
                if (this.object.content)
                    return this.object.content.substr(0, this.max_seo_description_length);
                return '';
            }
            EditSeo.prototype.aliasPlaceHolder = function () {
                return Bizweb.Inflection.generateAlias(this.object.name).substr(0, this.max_alias_length);
            }

            return EditSeo;
        }();
    }.call(this),
    function () {
        Bizweb.PreviewEmailTemplate = function () {
            function PreviewEmailTemplate(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            PreviewEmailTemplate.prototype.previewEmailTemplate = function () {
                var emailTemplateContent = $('#email-template-content').val();
                var emailTemplateSubject = $('#email-template-subject').val();
                var that = this;
                $.ajax({
                    url: '/admin/settings/notifications/PreviewEmailTemplate',
                    type: "POST",
                    data: {
                        Subject: emailTemplateSubject,
                        Content: emailTemplateContent,
                    },
                    success: function (result) {
                        //$('.btn-back-to-edit').removeClass('hide');
                        //$('.btn-preview').addClass('hide');
                        //('.email-template-edit').addClass('hide');
                        //$('.modal-title').html("Xem trước mẫu Email");
                        //$(".email-template-subject-preview").html(result.subject);
                        //$('.email-template-content-preview').html(result.email);
                        //$('.email-template-preview').removeClass('hide');
                        //console.log($('#viewTemplate').find('.modal-body').html(result.email));
                    }
                });
            }

            PreviewEmailTemplate.prototype.backToEditEmailTemplate = function (name) {
                $('.btn-back-to-edit').addClass('hide');
                $('.btn-preview').removeClass('hide');
                $('.email-template-edit').removeClass('hide');
                $('.modal-title').html("Chỉnh sửa mẫu email " + name);
                $('.email-template-preview').addClass('hide');
            }

            PreviewEmailTemplate.prototype.sendTestEmail = function (template) {
                $.ajax({
                    url: '/admin/settings/notifications/SendTestMail',
                    type: "POST",
                    data: {
                        template: template,
                    },
                    success: function (result) {
                        if (result != "OK") {
                            Bizweb.Flash.error("Gửi email thử nghiệm không thành công");
                        } else {
                            Bizweb.Flash.notice("Gửi email thử nghiệm thành công");
                        }
                    }
                });
            }

            return PreviewEmailTemplate;
        }();
    }.call(this),
    function () {
        Bizweb.PreviewPrintOrderTemplate = function () {
            function PreviewPrintOrderTemplate(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            PreviewPrintOrderTemplate.prototype.previewPrintOrderTemplate = function () {
                var emailTemplateContent = $('#email-template-content').val();
                var that = this;
                $.ajax({
                    url: '/admin/settings/notifications/PreviewPrintTemplate',
                    type: "POST",
                    data: {
                        Content: emailTemplateContent,
                    },
                    success: function (result) {
                        $('.btn-back-to-edit').removeClass('hide');
                        $('.btn-preview').addClass('hide');
                        $('.email-template-edit').addClass('hide');
                        $('.modal-title').html("Xem trước mẫu In đơn hàng");
                        //$(".email-template-subject-preview").html(result.subject);
                        $('.email-template-content-preview').html(result.email);
                        $('.email-template-preview').removeClass('hide');
                    }
                });
            }

            PreviewPrintOrderTemplate.prototype.backToEditPrintOrderTemplate = function (name) {
                $('.btn-back-to-edit').addClass('hide');
                $('.btn-preview').removeClass('hide');
                $('.email-template-edit').removeClass('hide');
                $('.modal-title').html("Chỉnh sửa mẫu " + name);
                $('.email-template-preview').addClass('hide');
            }

            PreviewPrintOrderTemplate.prototype.printTestOrder = function (template) {
                $.ajax({
                    url: '/admin/settings/notifications/PrintTestOrder',
                    type: "POST",
                    data: {
                        template: template,
                    },
                    success: function (data) {
                        if (data.result != "OK") {
                            Bizweb.Flash.error("In thử nghiệm không thành công");
                        } else {
                            window.frames["print_frame"].document.body.innerHTML = data.content;
                            window.frames["print_frame"].window.focus();
                            window.frames["print_frame"].window.print();
                        }
                    }
                });
            }

            return PreviewPrintOrderTemplate;
        }();
    }.call(this),
    function () {
        Bizweb.PreviewPrintShipmentTemplate = function () {
            function PreviewPrintShipmentTemplate(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            PreviewPrintShipmentTemplate.prototype.previewPrintShipmentTemplate = function () {
                var emailTemplateContent = $('#email-template-content').val();
                var that = this;
                $.ajax({
                    url: '/admin/settings/notifications/PreviewPrintTemplate',
                    type: "POST",
                    data: {
                        Content: emailTemplateContent,
                    },
                    success: function (result) {
                        $('.btn-back-to-edit').removeClass('hide');
                        $('.btn-preview').addClass('hide');
                        $('.email-template-edit').addClass('hide');
                        $('.modal-title').html("Xem trước mẫu In vận đơn");
                        //$(".email-template-subject-preview").html(result.subject);
                        $('.email-template-content-preview').html(result.email);
                        $('.email-template-preview').removeClass('hide');
                    }
                });
            }

            PreviewPrintShipmentTemplate.prototype.backToEditPrintShipmentTemplate = function (name) {
                $('.btn-back-to-edit').addClass('hide');
                $('.btn-preview').removeClass('hide');
                $('.email-template-edit').removeClass('hide');
                $('.modal-title').html("Chỉnh sửa mẫu " + name);
                $('.email-template-preview').addClass('hide');
            }

            PreviewPrintShipmentTemplate.prototype.printTestShipment = function (template) {
                $.ajax({
                    url: '/admin/settings/notifications/PrintTestShipment',
                    type: "POST",
                    data: {
                        template: template,
                    },
                    success: function (data) {
                        if (data.result != "OK") {
                            Bizweb.Flash.error("In thử nghiệm không thành công");
                        } else {
                            var printwindow = window.frames["print_frame"];

                            var htmlNode = $(data.content);
                            htmlNode.find(".print_barcode").each(function () {
                                var barcode = $(this).attr("val");
                                $(this).JsBarcode(barcode, {
                                    width: 1,
                                    height: 40,
                                    quite: 10,
                                    format: "CODE128",
                                    displayValue: true,
                                    font: "monospace",
                                    textAlign: "center",
                                    fontSize: 12,
                                    backgroundColor: "",
                                    lineColor: "#000"
                                }
                                )
                            });
                            if (!!htmlNode["0"]) {
                                printwindow.document.body.innerHTML = htmlNode["0"].innerHTML;
                            } else {
                                printwindow.document.body.innerHTML = data.content;
                            }
                            setTimeout(function () { // wait until all resources loaded 
                                printwindow.document.close(); // necessary for IE >= 10
                                printwindow.focus(); // necessary for IE >= 10
                                printwindow.print(); // change window to winPrint
                                printwindow.close(); // change window to winPrint
                            }, 250);


                        }
                    }
                });
            }

            return PreviewPrintShipmentTemplate;
        }();
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.FilterAndSavedSearch
        //
        // Working with Filter and SavedSearch.
        // ---------------------------------------------------------------------------------

        Bizweb.FilterAndSavedSearch = function () {
            function FilterAndSavedSearch(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.isValid = false;
                this.$filterForm = $("#frmFilter");
                this.submitQuery = _.debounce(this.submitQuery, 300);

                // BEGIN: Events Installation
                $('.ui-btn-filter').on('click', this.openFilterMenu);
                //$('#svg-filter').on('click', this.openFilterMenu);
                $('body').on('click', this.closeFilterMenu);
                // END: Events Installation
                $('#more-savedsearch').on('click', this.openSavedSearchMenu);

                this.showFilterBar(this.type);
            };

            FilterAndSavedSearch.optionsNeedingValue = ["greater_than", "less_than", "equals", "not_equals"];

            // BEGIN: FilterAndSavedSearch - Event Handling
            FilterAndSavedSearch.prototype.openSavedSearchMenu = function (e) {
                if ($(e.currentTarget).parent().children(".dropdown-hidden-search").hasClass('show'))
                    $(e.currentTarget).parent().children(".dropdown-hidden-search").removeClass('show');
                else
                    $(e.currentTarget).parent().children(".dropdown-hidden-search").addClass('show');
            }
            FilterAndSavedSearch.prototype.openFilterMenu = function (e) {
                if ($(e.currentTarget).parent().children(".dropdown-filter").hasClass('show'))
                    $(e.currentTarget).parent().children(".dropdown-filter").removeClass('show');
                else
                    $(e.currentTarget).parent().children(".dropdown-filter").addClass('show');
            }
            FilterAndSavedSearch.prototype.closeFilterMenu = function (e) {
                if (e.target.id !== 'ui-btn-filter' && e.target.id !== 'btn__text--deprioritize-filter' && e.target.id !== 'svg-filter' && $('.dropdown-filter.show').has(e.target).length === 0 && $(e.target).parent().attr('id') !== 'svg-filter') {
                    $('.dropdown-filter').removeClass('show');
                }
                if (e.target.id !== 'more-savedsearch' && e.target.id !== 'svg-msaved' && $('.dropdown-hidden-search.show').has(e.target).length === 0 && $(e.target).parent().attr('id') !== 'svg-msaved') {
                    $(".dropdown-hidden-search").removeClass('show');
                }
            }

            // END: FilterAndSavedSearch - Event Handling

            // BEGIN: FilterAndSavedSearch - Public Functions
            FilterAndSavedSearch.prototype.showFilterBar = function () {
                var lengthSearchBar = 0;
                var tabIndexStop = 0;
                var listTabFallDown = [];
                lengthSearchBar += $("#filter-tab-all").width();
                var lengthTabList = $(".filter-tab-list").width();
                var $dropdownHiddenSearch = $('#dropdown-hidden-search');
                var tabFixedWidth = 32;
                if ($("#filter-tab-item-always").size() == 1) {
                    tabFixedWidth = 117.5;
                }
                $('#filter-tab-list').find('.filter-tab-item').each(function () {
                    var $this = $(this);
                    lengthSearchBar += $this.width();
                    if (lengthSearchBar >= lengthTabList - tabFixedWidth) {
                        listTabFallDown.push($this);
                        lengthSearchBar -= $this.width();
                    }
                })
                if (listTabFallDown.length > 0) {
                    for (var i = 0; i < listTabFallDown.length; i++) {
                        var tab = listTabFallDown[i];
                        var id = tab.attr('data-tab-id');
                        var name = tab.attr('data-tab-name');

                        $dropdownHiddenSearch.append(this.generateHiddenTabItem(id, name, this.type));
                        tab.remove();
                    }
                    //$("#hidden-search").width(lengthTabList - lengthSearchBar);
                    $("#hidden-search").show();
                }
                $(".filter-tab-list").removeClass("overflow-hidden-x");
            }
            FilterAndSavedSearch.prototype.generateHiddenTabItem = function (id, name, type) {
                var linkPrefix = window.location.pathname;
                var intId = parseInt(id);
                if (intId !== NaN) {
                    return '<li> <a style="width:100%" type="button" class="ui-action-list-action" href="' + linkPrefix + '?savedSearchId=' + id + '">' + name + '</a></li>';
                }
                return '<li> <button style="width:100%" type="button" class="ui-action-list-action" bind-event-click="openSavedSearch(' + id + ');">' + name + '</button></li>';;
            }
            FilterAndSavedSearch.prototype.resetFilter = function () {
                this.option = "";
                this.value = null;
                this.isValid = false;
                $(".filter-builder .filter-select").val("");
            }
            FilterAndSavedSearch.prototype.resetValue = function () {
                this.value = null;
                this.isValid = false;
            }
            FilterAndSavedSearch.prototype.optionSelected = function () {
                if (this.option != null && this.option != "")
                    return true;

                return false;
            }
            FilterAndSavedSearch.prototype.hasValue = function () {
                if (this.value != null && this.option != "")
                    return true;

                return false;
            }
            FilterAndSavedSearch.prototype.optionRequiresValue = function () {
                if (this.constructor.optionsNeedingValue.indexOf(this.option) >= 0)
                    return true;

                return false;
            }
            FilterAndSavedSearch.prototype.needValue = function () {
                return !this.option || this.optionRequiresValue();
            }

            FilterAndSavedSearch.prototype.remoteFilter = function (options) {
                if (options == null)
                    options = {};
                var formData = this.$filterForm.serialize();
                var params = this.cleanExtraValue(Bizweb.UrlMangler.parseSearchString(formData));

                Page.refresh(_.extend(options, {
                    queryParams: params
                }));
            }
            FilterAndSavedSearch.prototype.cleanExtraValue = function (params) {
                if (params['Limit'] && 50 == params['Limit'])
                    delete params['Limit'];

                if (params['Page'] && 1 >= params['Page'])
                    delete params['Page'];

                if (typeof this.default_values !== undefined && this.default_values != null) {
                    for (var key in this.default_values) {
                        if (this.default_values[key] == params[key]) {
                            delete params[key];
                        }
                    }
                }

                return _.pickBy(params, function (value, key) { return value != '' || (key != null && key.toLowerCase() == 'query') });
            }

            FilterAndSavedSearch.prototype.removeFilterItem = function (key) {
                var $filterItem = this.$filterForm.find("input[name=" + key + "]");
                $filterItem.remove();
                this.removeFilterFormSaveSearch();
                //this.$filterForm.submit();
                this.remoteFilter();
            }
            FilterAndSavedSearch.prototype.submitFilter = function (e) {
                var queryName = "";
                var queryValue = "";
                if (this.needValue()) {
                    queryName = this.generateKeyWithOption(this.filterKey, this.option);
                    queryValue = this.value;
                }
                else {
                    queryName = this.filterKey;
                    queryValue = this.option;
                }

                if (queryValue === null || queryValue === "") {
                    this.isValid = true;
                    return;
                }

                this.setFilterFormQueryValue(queryName, queryValue);
                this.removeFilterFormSaveSearch();

                this.setFilterFormQueryValue("Page", 1);
                //this.$filterForm.submit();
                this.remoteFilter();
                return false;
            }

            FilterAndSavedSearch.prototype.submitQuery = function (e) {
                var queryName = "Query";
                var queryValue = this.query.trim();

                this.setFilterFormQueryValue(queryName, queryValue);
                this.removeFilterFormSaveSearch();

                this.setFilterFormQueryValue("Page", 1);

                Bizweb.Utility.loadAjax(document.location.pathname, "." + this.type_filter, function (data) {
                    var $html = $(data);
                    if ($html.find(".has-saved-search-actions").size()) {
                        $("#has-saved-search-actions").attr("class", "has-saved-search-actions")
                    } else {
                        $("#has-saved-search-actions").attr("class", "")
                    }
                    var $button = $html.find(".saved-search-actions-next");
                    if ($button.size()) {
                        $(".saved-search-actions-next").html($button.html());
                        $(".saved-search-actions-next").removeClass("hide");
                        Bindings.unbind($(".saved-search-actions-next").get(0));
                        Bindings.bind($(".saved-search-actions-next").get(0));
                    }
                    $html = null;
                }, {
                    "data": $.param(_.filter(this.$filterForm.serializeArray(), function (t) { return t.value != '' || (t.name != null && t.name.toLowerCase() == 'query') })),
                    "pushState": true,
                    "abort": true
                });
            }

            FilterAndSavedSearch.prototype.generateKeyWithOption = function (key, option) {
                switch (option) {
                    case "less_than":
                        return "" + key + "Max";
                    case "greater_than":
                        return "" + key + "Min";
                    case "not_equals":
                        return "" + key + "Not";
                    default:
                        return key
                }
            }

            FilterAndSavedSearch.prototype.setFilterFormQueryValue = function (name, value) {
                var $filterItem = this.$filterForm.find("input[name=" + name + "]");
                if ($filterItem.length == 0) {
                    this.$filterForm.append("<input type='hidden' name='" + name + "' value='' />");
                    $filterItem = this.$filterForm.find("input[name=" + name + "]");
                }
                $filterItem.val(value);
            }
            FilterAndSavedSearch.prototype.removeFilterFormSaveSearch = function () {
                var savedSearchItem = document.getElementById("frmFilter").elements.namedItem("savedSearchId");
                if (savedSearchItem != null) {
                    savedSearchItem.parentNode.removeChild(savedSearchItem);
                } else {
                    savedSearchItem = document.getElementById("frmFilter").elements.namedItem("SavedSearchId");
                    if (savedSearchItem != null) {
                        savedSearchItem.parentNode.removeChild(savedSearchItem);
                    }
                }
            }
            FilterAndSavedSearch.prototype.showAllItems = function () {
                $(".filter-tab").removeClass("filter-tab-active").removeClass("next-tab--is-active");
                $(".show-all-items").addClass("filter-tab-active").addClass("next-tab--is-active");
                $("#frmFilter").empty();
                document.getElementById("frmFilter").submit();
            }

            FilterAndSavedSearch.prototype.openSavedSearch = function (savedSearchId) {
                $("#frmFilter").empty();
                var newHiddenFilterItem = document.createElement('input');
                newHiddenFilterItem.type = "hidden";
                newHiddenFilterItem.name = "savedSearchId";
                newHiddenFilterItem.value = savedSearchId;
                document.getElementById("frmFilter").appendChild(newHiddenFilterItem);
                document.getElementById("frmFilter").submit();
            }
            FilterAndSavedSearch.prototype.showDeleteSavedSearchModal = function (savedSearchId) {
                var that = this;
                bootbox.dialog({
                    message: "Bạn có muốn xóa kết quả tìm kiếm này? Thao tác này không thể khôi phục.",
                    title: "Bạn muốn xóa dữ liệu này?",
                    buttons: {
                        cancel: {
                            label: "Hủy"
                        },
                        danger: {
                            label: "Xóa",
                            className: "btn-destroy-no-hover",
                            callback: function () {
                                that.deleteSavedSearch(savedSearchId);
                            }
                        }
                    }
                });
            }
            FilterAndSavedSearch.prototype.deleteSavedSearch = function (savedSearchId) {
                $("#frmRemoveSavedSearch input[name='savedSearchId']").val(savedSearchId);
                $("#frmRemoveSavedSearch").attr("action", this.urlDeleteSavedSearch);
                $("#frmRemoveSavedSearch").submit();
            }
            FilterAndSavedSearch.prototype.addSavedSearch = function () {
                var currentUrl = $(this.addSaveSearchModel.node).attr("href");
                currentUrl = currentUrl.split('?')[0] + '?' + $("#frmFilter").serialize();

                $(this.addSaveSearchModel.node).attr("href", currentUrl);
                this.addSaveSearchModel.show();
            }
            // END: FilterAndSavedSearch - Public Functions

            FilterAndSavedSearch.name = "FilterAndSavedSearch";
            return FilterAndSavedSearch;
        }();
    }.call(this),
    function () {
        Bizweb.BulkActions = function () {
            function BulkActions(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.init();
                this.selectedItems = [];

                this.multiSelectClick = this.applyFunction(this.multiSelectClick, this);
                this.initializeMultiSelect();

                $('.btn-dropdown-bulkaction').on('click', this.openBulkActionMenu);
                $('body').on('click', this.closeBulkActionMenu);
            };

            BulkActions.prototype.init = function () {
                $('.bulk-action-item').prop('checked', false);
            }

            BulkActions.prototype.openBulkActionMenu = function (e) {
                if ($(e.currentTarget).parent().children(".dropdown-bulkaction").hasClass('show'))
                    $(e.currentTarget).parent().children(".dropdown-bulkaction").removeClass('show');
                else
                    $(e.currentTarget).parent().children(".dropdown-bulkaction").addClass('show');
            }

            BulkActions.prototype.closeBulkActionMenu = function (e) {
                if (e.target.id !== 'btn-dropdown-bulkaction' && $(e.target).parent().attr('id') !== 'btn-dropdown-bulkaction' && $('.dropdown-bulkaction.show').has(e.target).length === 0 && e.target.id !== 'svg-bulkaction' && $(e.target).parent().attr('id') !== 'svg-bulkaction') {
                    $('.dropdown-bulkaction').removeClass('show');
                }
            }

            BulkActions.prototype.addOrRemoveBulkActionItem = function (bulkActionItemId, eleCheckBox) {
                bulkActionItemId = bulkActionItemId.toString();

                var checked = eleCheckBox.checked;
                var selectedBulkActionItems = $('.bulk-action-items-count').attr("selected-bulk-action-items");
                if (checked) {
                    if (this.selectedItems.indexOf(bulkActionItemId) < 0) {
                        this.selectedItems.push(bulkActionItemId);
                        var newBulkActionItem = document.createElement('input');
                        newBulkActionItem.type = "hidden";
                        newBulkActionItem.name = "ids";
                        newBulkActionItem.value = bulkActionItemId;
                        newBulkActionItem.id = "bulk-action-item-" + bulkActionItemId;
                        document.getElementById("frmBulkActions").appendChild(newBulkActionItem);
                        selectedBulkActionItems++;

                        //hightlight selected
                        $(eleCheckBox).closest('tr').addClass("selected");
                    }
                } else {
                    var index = this.selectedItems.indexOf(bulkActionItemId);
                    if (index > -1) {
                        this.selectedItems.splice(index, 1);
                    }
                    var removeBulkActionItem = document.getElementById("bulk-action-item-" + bulkActionItemId);
                    if (removeBulkActionItem != null) {
                        removeBulkActionItem.parentNode.removeChild(removeBulkActionItem);
                        selectedBulkActionItems--;
                    }

                    //remove hightlight
                    $(eleCheckBox).closest('tr').removeClass("selected");
                }

                this.showBulkActionItemsCount(selectedBulkActionItems);
            }

            BulkActions.prototype.selectBulkActionItem = function (bulkActionItemId) {
                $('#bulk-action-' + bulkActionItemId).prop('checked', true);

                $('#bulk-action-' + bulkActionItemId).trigger('change');
            }

            BulkActions.prototype.addOrRemoveAllBulkActionItems = function (eleAllCheckBox) {
                this.selectedItems = [];

                var allBulkActionItems = $("#frmBulkActions input[name='ids']");
                if (allBulkActionItems != null && allBulkActionItems.length > 0) {
                    allBulkActionItems.remove();
                }

                var allChecked = $('.all-bulk-action').prop('checked');
                if (allChecked) {
                    var selectedBulkActionItems = 0;
                    var that = this;
                    $('.bulk-action-context').find('.bulk-action-item').each(function () {
                        var $this = $(this);
                        $this.prop('checked', true);
                        var bulkActionItemId = $this.val();
                        that.selectedItems.push(bulkActionItemId);
                        var newBulkActionItem = document.createElement('input');
                        newBulkActionItem.type = "hidden";
                        newBulkActionItem.name = "ids";
                        newBulkActionItem.value = bulkActionItemId;
                        newBulkActionItem.id = "bulk-action-item-" + bulkActionItemId;
                        document.getElementById("frmBulkActions").appendChild(newBulkActionItem);
                        selectedBulkActionItems++;

                        //hightlight selected
                        $(this).closest('tr').addClass("selected");
                    });
                    this.showBulkActionItemsCount(selectedBulkActionItems);

                } else {
                    $('.bulk-action-context').find('.bulk-action-item').each(function () {
                        var $this = $(this);
                        $this.prop('checked', false);

                        //remove hightlight
                        $(this).closest('tr').removeClass("selected");
                    });
                    this.showBulkActionItemsCount(0);
                }
            }

            BulkActions.prototype.checkAllBulkActionItems = function () {
                $('.all-bulk-action').prop('checked', true);
                this.addOrRemoveAllBulkActionItems();
            }

            BulkActions.prototype.uncheckAllBulkActionItems = function () {
                $('.all-bulk-action').prop('checked', false);
                this.addOrRemoveAllBulkActionItems();
            }

            BulkActions.prototype.showBulkActionItemsCount = function (selectedBulkActionItems) {
                $('.bulk-action-items-count').attr("selected-bulk-action-items", selectedBulkActionItems);
                var allItems = $('.bulk-actions').attr("all-items");
                var totalRecords = $('.bulk-actions').attr("total-records");
                var pageSize = $('.bulk-actions').attr("items-page");
                var selectAllBulkActionItems = $("#frmBulkActions input[name='SelectedAll']");
                if (selectAllBulkActionItems == null || selectAllBulkActionItems.length <= 0) {
                    var allBulkActionItems = document.createElement('input');
                    allBulkActionItems.type = "hidden";
                    allBulkActionItems.name = "SelectedAll";
                    allBulkActionItems.value = false;
                    document.getElementById("frmBulkActions").appendChild(allBulkActionItems);
                }
                $("#frmBulkActions input[name='SelectedAll']").prop('value', false);
                if (selectedBulkActionItems > 0) {
                    $('.bulk-actions').removeClass('hide');
                    $('.bulk-action-items-count .display-bulk-action-items-count').html(selectedBulkActionItems);
                    if (selectedBulkActionItems == allItems) {
                        $('.all-bulk-action').prop('checked', true);
                        $('.all-bulk-action').prop('indeterminate', false);
                        $('.bulk-select-all .bulk-action-all-selector').html('Đã chọn tất cả ' + this.type + '<span class="on-this-page-text"> trên trang này.</span>');
                        if (totalRecords - pageSize > 0) {
                        } else {
                            if (this.type == 'variant') {
                                $('.bulk-select-all .bulk-action-all-selector').html('Đã chọn tất cả ' + this.type + ' của sản phẩm.</span>');
                            } else {
                                $('.bulk-select-all .bulk-action-all-selector').html('Đã chọn tất cả ' + this.type + ' trên trang này.</span>');
                            }
                        }
                        $("#frmBulkActions input[name='SelectedAll']").prop('value', true);
                    } else {
                        $('.bulk-select-all .bulk-action-all-selector').html('');
                        $('.bulk-action-all-selector .multipage-selected-all').addClass("hide");
                        //$('.all-bulk-action').prop('checked', false);
                        $('.all-bulk-action').prop('indeterminate', true);
                    }
                } else {
                    $('.all-bulk-action').prop('checked', false);
                    $('.all-bulk-action').prop('indeterminate', false);
                    $('.bulk-actions').addClass('hide');
                }

            }

            BulkActions.prototype.addBulkActionAll = function () {
                var existBulkActionAll = document.getElementById("frmBulkActions").elements.namedItem("SelectedAll");
                if (existBulkActionAll == null) {
                    var bulkActionAll = document.createElement('input');
                    bulkActionAll.type = "hidden";
                    bulkActionAll.name = "SelectedAll";
                    bulkActionAll.value = true;
                    document.getElementById("frmBulkActions").appendChild(bulkActionAll);
                } else {
                    existBulkActionAll.value = true;
                }
                $('.bulk-select-all .bulk-action-all-selector').html('Đã chọn tất cả ' + this.type + ' trên trang này.</span>');
                $('.bulk-action-all-selector .multipage-selected-all').addClass("hide");
                $('.bulk-action-all-selector .clear-multipage-selection').removeClass("hide");
            }

            BulkActions.prototype.removeBulkActionAll = function () {
                var existBulkActionAll = document.getElementById("frmBulkActions").elements.namedItem("SelectedAll");
                if (existBulkActionAll == null) {
                    var bulkActionAll = document.createElement('input');
                    bulkActionAll.type = "hidden";
                    bulkActionAll.name = "SelectedAll";
                    bulkActionAll.value = false;
                    document.getElementById("frmBulkActions").appendChild(bulkActionAll);
                } else {
                    existBulkActionAll.value = false;
                }
                $('.bulk-select-all .bulk-action-all-selector').html('Đã chọn tất cả ' + this.type + '<span class="on-this-page-text"> trên trang này.</span>');
                $('.bulk-action-all-selector .multipage-selected-all').removeClass("hide");
                $('.bulk-action-all-selector .clear-multipage-selection').addClass("hide");
            }

            BulkActions.prototype.showDeleteItemsModal = function () {
                this.deleteItemsModal.show();
                $("#frmBulkActions input[name='ids']").each(function (index, ele) {
                    $(".variantDeleteIds").append("<input type='hidden' name='ids' value='" + $(ele).val() + "' />");
                });
            }

            BulkActions.prototype.deleteItems = function () {
                var button = $(".btn-delete-bulk-action");
                button.addClass("disabled").addClass('is-loading');
                Bizweb.Loading.start();
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                $.ajax({
                    url: this.urlBulkActionDelete,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                if (data.message) {
                                    Bizweb.Flash.notice(data.message);
                                }
                                else if (data.result && data.result.message) {
                                    Bizweb.Flash.notice(data.result.message);
                                }
                                else {
                                    Bizweb.Flash.notice("Xóa thành công");
                                }
                            });
                        }, time);
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        button.removeClass("disabled").html("Xóa");
                        Bizweb.Loading.stop();
                    }
                });
            }

            BulkActions.prototype.publishItems = function () {
                Bizweb.Loading.start();
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                $.ajax({
                    url: this.urlBulkActionPublish,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                if (data.message) {
                                    Bizweb.Flash.notice(data.message);
                                } else if (data.result && data.result.message) {
                                    Bizweb.Flash.notice(data.result.message);
                                } else {
                                    Bizweb.Flash.notice("Tiến trình đang được thực hiện");
                                }
                            });
                        }, time);
                    },
                    error: function (data) {
                        if (data != null && data.responseJSON != null) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        Bizweb.Loading.stop();
                    }
                });
            }

            BulkActions.prototype.unPublishItems = function () {
                Bizweb.Loading.start();
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                $.ajax({
                    url: this.urlBulkActionUnPublish,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                if (data.message) {
                                    Bizweb.Flash.notice(data.message);
                                } else if (data.result && data.result.message) {
                                    Bizweb.Flash.notice(data.result.message);
                                } else {
                                    Bizweb.Flash.notice("Tiến trình đang được thực hiện");
                                }
                            });
                        }, time);
                    },
                    error: function (data) {
                        if (data != null && data.responseJSON != null) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        Bizweb.Loading.stop();
                    }
                });
            }

            BulkActions.prototype.approveItems = function () {
                Bizweb.Loading.start();
                var time = 1500;

                $.ajax({
                    url: this.urlBulkActionApprove,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        Bizweb.Flash.notice(data.result.message);
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content");
                        }, time);
                    },
                    error: function (data) {
                        if (data != null && data.responseJSON != null) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        Bizweb.Loading.stop();
                    }
                });
            }

            BulkActions.prototype.addTags = function () {
                var returnUrl = window.location.href;
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionAddTag + '?' + $("#frmBulkActions").serialize() + '&ReturnUrl=' + encodeURIComponent(returnUrl),
                    success: function (data) {
                        $("#bizweb-modal").html(data);
                        $("#bizweb-modal").modal({ backdrop: 'static' });
                        $("#bizweb-modal").modal("show");
                        $(".tag-value-input").tagsinput({});
                    },
                    global: false,
                    error: function (data) {
                        if (data != null && data.responseJSON != null) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                    },
                    complete: function (data) {
                        Bizweb.Loading.stop();
                    }
                })
            }

            BulkActions.prototype.removeTags = function () {
                var returnUrl = window.location.href;
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionRemoveTag + '?' + $("#frmBulkActions").serialize() + '&ReturnUrl=' + encodeURIComponent(returnUrl),
                    success: function (data) {
                        $("#bizweb-modal").html(data);
                        $("#bizweb-modal").modal("show");
                        $(".tag-value-input").tagsinput({});
                    },
                    global: false,
                    error: function (data) {
                        if (data != null && data.responseJSON != null) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                    },
                    complete: function (data) {
                        Bizweb.Loading.stop();
                    }
                })
            }

            BulkActions.prototype.postAction = function (url) {
                $.ajax({
                    url: url,
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        //Bizweb.Flash.notice(data.result.message);
                        window.location.href = window.location.href;
                    }
                });
            }

            BulkActions.prototype.appLink = function (t) {
                if (this.selectedItems.length > 0) {
                    return t + "&ids=" + this.selectedItems.join(",");
                }
                else {
                    return t;
                }
            }

            BulkActions.prototype.allSelected = function () {
                var allItems = $('.bulk-actions').attr("all-items");
                return this.selectedItems.length == allItems;
            }

            BulkActions.prototype.initializeMultiSelect = function () {
                return this.lastChecked = null, this.$items = $(this.element).find(".select input[type=checkbox]"), this.$items.on("click", this.multiSelectClick)
            }

            BulkActions.prototype.multiSelectClick = function (t) {
                var endCheckedIndex = this.$items.index(this.lastChecked);
                var startCheckedIndex = this.$items.index(t.target);
                var n = 0, allItem;
                if (!this.lastChecked) return void (this.lastChecked = t.target);
                if (t.shiftKey) {
                    for (allItem = this.$items.slice(Math.min(startCheckedIndex, endCheckedIndex) + 1, Math.max(startCheckedIndex, endCheckedIndex)) ; n < allItem.length; n++) {
                        var id = "#" + allItem[n].id;
                        $(id).prop('checked', this.lastChecked.checked);
                        this.addOrRemoveBulkActionItem(allItem[n].value, allItem[n]);
                    }
                }
                return this.lastChecked = t.target
            }

            BulkActions.prototype.applyFunction = function (t, e) {
                return function () {
                    return t.apply(e, arguments)
                }
            }
            return BulkActions;
        }();
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.LinklistForm
        //
        // Working with Linklist's Form(Add or Edit linklist).
        // ---------------------------------------------------------------------------------
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = function (e, t) {
                function n() {
                    this.constructor = e
                }
                for (var r in t) i.call(t, r) && (e[r] = t[r]);
                return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
            },
            i = {}.hasOwnProperty;

        var applyObjectToEvent = function (event, context) {
            return function () {
                return event.apply(context, arguments)
            }
        }

        Bizweb.LinklistForm = function () {
            function LinklistForm(element, options) {
                this.prepareSubmitForm = applyObjectToEvent(this.prepareSubmitForm, this);

                this.$form = $(element);

                if (this.newResourceId == null)
                    this.newResourceId = 0;

                this.$form.on("submit", this.prepareSubmitForm);

                this.initializeSortable(element);

                //this.submit = e(this.prepareSubmitForm, this);
                LinklistForm.__super__.constructor.call(this, element, options);
            };

            t(LinklistForm, Bizweb.Forms);

            // BEGIN: LinklistForm - Event Handling
            LinklistForm.prototype.prepareSubmitForm = function () {
                this.disableHiddenInputs();
                this.setIndexForMultiObjectPost();
            };
            // END: LinklistForm - Event Handling

            // BEGIN: LinklistForm - Public Functions
            LinklistForm.prototype.initializeSortable = function (ele) {
                var linklistForm = this;

                //".link-list-group", this.$form
                this.linklist = $(".link-list-group").sortable({
                    items: ".link-list-group-item",
                    placeholder: "ui-sortable__placeholder",
                    helper: "original",
                    opacity: .7,
                    update: function () {
                        linklistForm.updatePositions();
                    },
                    start: function (event, element) {
                        element.placeholder.height(element.helper.height());
                    }
                })
            }
            LinklistForm.prototype.updatePositions = function () {
                $(".link-position", this.node).each(function (t, e) {
                    return $(e).val(t + 1)
                })
                this._updateDirtyState();
            };
            LinklistForm.prototype.setIndexForMultiObjectPost = function () {
                var linkContainers = this.$form.find(".link-list-group-item");

                for (var i = 0; i < linkContainers.length; i++) {
                    var inputs = $(linkContainers[i]).find(":input");
                    for (var j = 0; j < inputs.length; j++) {
                        var inputName = $(inputs[j]).attr("name");
                        if (typeof inputName !== "undefined" && inputName.indexOf("[]") >= 0) {
                            inputName = inputName.replace("[]", "[" + i + "]");
                            $(inputs[j]).attr("name", inputName);
                        }
                    }
                }
            };
            LinklistForm.prototype.disableHiddenInputs = function () {
                this.$form.find(".disable-hidden-input:visible :input").prop("disabled", false);
                this.$form.find(".disable-hidden-input:not(:visible) :input").prop("disabled", "disabled");
            };
            LinklistForm.prototype.insertLinks = function () {
                var linklistForm = this;
                this.newResourceId++;

                $.ajax({
                    url: "/admin/links/GetLinkRow",
                    type: "GET",
                    dataType: "html",
                    data: {
                        index: this.newResourceId
                    },
                    success: function (html) {
                        var $html = $(html);
                        $(".link-list-group").append($html);
                        Bindings.bind($html[0]);
                        linklistForm.updatePositions();
                    }
                });
            };
            LinklistForm.prototype.removeLink = function (element) {
                var linkContainer = $(element).closest(".link-list-group-item");
                linkContainer.remove();
                this._updateDirtyState();
            };
            LinklistForm.prototype.countLinks = function () {
                return this.$form.find("li.link-list-group-item").length;
            };
            // BEGIN: LinklistForm - Functions

            LinklistForm.name = "LinklistForm";
            return LinklistForm;
        }();
    }.call(this),
    function () {
        Bizweb.EditOrder = function () {
            function EditOrder(e, b) {
                if (b) {
                    var property;
                    for (property in b) this[property] = b[property];
                }
            }

            EditOrder.prototype.showModal = function (name) {
                this[name].show();
            };

            EditOrder.prototype.updateFulfillment = function (form) {
                var $form = $(form);
                var that = this;
                //if ($form.valid()) {
                var url = $form.attr("action");
                var method = $form.attr("method");
                var that = this;
                Bizweb.Loading.start();
                $.ajax({
                    url: url,
                    type: method,
                    global: false,
                    data: $form.serialize(),
                    success: function (result) {
                        Bizweb.Utility.loadAjax(Bizweb.routes.orders + "/" + that.id, ".timeline", function () {
                            Bizweb.Flash.notice("Cập nhật vận đơn thành công");
                        });
                    },
                    error: function (data) {
                        if (data != null && data.responseJSON != null) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        Bizweb.Loading.stop();
                    }
                });
                //}
                return false;
            }

            EditOrder.prototype.updateOrderDetails = function () {
                var that = this;
                var tags = $('input[name="Tags"]').val();
                var note = $('#Note').val();
                var noteAttributes = [];
                var noteAttributesInputs = $('input#noteAttributes');
                for (var i = 0; i < noteAttributesInputs.length; i++) {
                    var noteAttributeInput = $(noteAttributesInputs)[i];
                    var noteAttribute = {
                        'name': $(noteAttributeInput).attr('attribute-name'),
                        'value': $(noteAttributeInput).val()
                    }
                    noteAttributes.push(noteAttribute);
                }
                Bizweb.Loading.start();
                var button = $(".update-order-btn");
                button.addClass("disabled").html(Bizweb.LOADING);
                $.ajax({
                    url: Bizweb.routes.orders + "/" + that.id,
                    data: { note: note, tags: tags, noteAttributes: noteAttributes },
                    type: "POST",
                    global: false,
                    success: function (data) {
                        var url = Bizweb.routes.orders + "/" + that.id
                        Bizweb.Utility.loadAjax(url, ".order-info", function () {
                            if (data.message) {
                                Bizweb.Flash.notice(data.message);
                            } else {
                                Bizweb.Flash.notice("Cập nhật đơn hàng thành công");
                            }
                        });
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        button.removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
            }

            EditOrder.prototype.updateOrderDetailsIndex = function (orderId) {
                var that = this;
                var tags = $('input[id="tags_' + orderId + '"]').val();
                var note = $('#note_' + orderId).val();
                var noteAttributes = [];
                var noteAttributesInputs = $('input#noteAttributes');
                for (var i = 0; i < noteAttributesInputs.length; i++) {
                    var noteAttributeInput = $(noteAttributesInputs)[i];
                    var noteAttribute = {
                        'name': $(noteAttributeInput).attr('attribute-name'),
                        'value': $(noteAttributeInput).val()
                    }
                    noteAttributes.push(noteAttribute);
                }
                Bizweb.Loading.start();
                var button = $(".update-order-btn");
                button.addClass("disabled").html(Bizweb.LOADING);
                $.ajax({
                    url: Bizweb.routes.orders + "/" + orderId,
                    data: { note: note, tags: tags, noteAttributes: noteAttributes },
                    type: "POST",
                    global: false,
                    success: function (data) {
                        var url = window.location.href;
                        Bizweb.Utility.loadAjax(url, ".orderContext", function () {
                            if (data.message) {
                                Bizweb.Flash.notice(data.message);
                            } else {
                                Bizweb.Flash.notice("Lưu ghi chú thành công");
                            }
                        });
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        button.removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
            }

            EditOrder.prototype.updateOrderNoteAndTagQuickViewIndex = function (orderId, urlCallback) {
                var that = this;
                var tags = $('input[id="tags_' + orderId + '"]').val();
                var note = $('#note_' + orderId).val();
                var noteAttributes = [];
                var noteAttributesInputs = $('input#noteAttributes');
                for (var i = 0; i < noteAttributesInputs.length; i++) {
                    var noteAttributeInput = $(noteAttributesInputs)[i];
                    var noteAttribute = {
                        'name': $(noteAttributeInput).attr('attribute-name'),
                        'value': $(noteAttributeInput).val()
                    }
                    noteAttributes.push(noteAttribute);
                }
                Bizweb.Loading.start();
                var button = $(".update-order-btn");
                button.addClass("disabled").html(Bizweb.LOADING);

                var urlContinue = "";
                if (!!urlCallback) {
                    urlContinue = urlCallback;
                }
                else {
                    urlContinue = window.location.href;
                }

                $.ajax({
                    url: Bizweb.routes.orders + "/" + orderId,
                    data: { note: note, tags: tags, noteAttributes: noteAttributes },
                    type: "POST",
                    global: false,
                    success: function (data) {
                        var url = window.location.href;
                        Bizweb.Utility.loadAjax(urlContinue, "#quick-view-order-" + orderId, function () {
                            if (data.message) {
                                Bizweb.Flash.notice(data.message);
                            } else {
                                Bizweb.Flash.notice("Lưu ghi chú thành công");
                            }
                        });
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        button.removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
            }

            EditOrder.updateOrderEmail = function () {
                var orderEmail = $("#order-email").val();
                var updateProfile = $("#update-profile").is(":checked");
                var id = $('input[name="orderId"]').val();
                var customerId = $('input[name="customerId"]').val();
                var that = this;
                $.ajax({
                    url: Bizweb.routes.orders + "/UpdateOrderEmail",
                    dataType: "html",
                    data: { email: orderEmail, updateProfile: updateProfile, id: that.id, customerId: customerId },
                    type: "post",
                    success: function (result) {
                        if (result != "OK") {
                            $(".order-email-error-refresh").html(result);
                        }
                        else {
                            Bizweb.Modal.hide();
                            Bizweb.Flash.notice("Cập nhật email đơn hàng thành công");
                            window.location.reload();
                        }
                    }
                });
            }

            return EditOrder;
        }();
    }.call(this),
    function () {
        Bizweb.OrderAction = function () {
            function OrderAction(e, b) {
                if (b) {
                    var property;
                    for (property in b) {
                        this[property] = b[property];
                    }
                }
            }

            OrderAction.prototype.showModal = function (name) {
                this[name].show();
            };

            OrderAction.prototype.archiveOrder = function (url, isArchive) {
                var resultText = "";
                if (isArchive) {
                    resultText = "Lưu trữ";
                } else {
                    resultText = "Hủy lưu trữ";
                }
                $.ajax({
                    url: url,
                    type: "post",
                    data: { isArchive: isArchive },
                    success: function (result) {
                        if (result != "OK") {
                            Bizweb.Flash.notice(resultText + " đơn hàng không thành công");
                        } else {
                            window.location.reload();
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            };

            OrderAction.prototype.archiveOrderQuickView = function (url, isArchive, nodeChange, urlCallback) {
                var resultText = "";
                if (isArchive) {
                    resultText = "Lưu trữ";
                } else {
                    resultText = "Hủy lưu trữ";
                }
                $.ajax({
                    url: url,
                    type: "post",
                    data: { isArchive: isArchive },
                    success: function (result) {
                        if (result.message != "OK") {
                            Bizweb.Utility.loadAjax(urlCallback, nodeChange, function () {
                                Bizweb.Flash.notice(resultText + " đơn hàng không thành công");
                            });

                        } else {
                            var parentquickview = $(document).find("#parent-quick-view-" + result.order_id);
                            $(parentquickview).removeClass();
                            $(parentquickview).addClass(OrderStatus(result.order_status));
                            Bizweb.Utility.loadAjax(urlCallback, nodeChange, function () {
                                Bizweb.Flash.notice(resultText + " đơn hàng thành công");
                            });
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            };

            OrderAction.prototype.getTotalRestock = function () {
                var totalRefund = 0;
                $(".refund-quantity.restockable").each(function () {
                    totalRefund += parseInt($(this).val());
                });
                if (totalRefund == 0) {
                    $("#Restock").prop("checked", false);
                }
                return totalRefund;
            };

            OrderAction.prototype.getTotalRefundAmount = function (maxAmount) {
                var totalRefundAmount = 0;
                $(".refund-quantity").each(function () {
                    totalRefundAmount += parseFloat($(this).attr("value-per-item")) * parseInt($(this).val());
                });
                if (totalRefundAmount > maxAmount) {
                    totalRefundAmount = maxAmount;
                }
                return totalRefundAmount;
            }

            OrderAction.prototype.updateRefundedNet = function (element) {
                var refundedNed = 0;
                $(".refund-quantity").each(function () {
                    var itemPrice = $(this).attr("value-per-item");
                    var quantity = $(this).val();
                    var roundQuantity = Math.floor(quantity);
                    $(this).val(roundQuantity);
                    refundedNed += parseInt($(this).val()) * parseFloat(itemPrice);
                });

                $('.refundedNet').html(Bizweb.Utility.textMoneyWithSymbol(refundedNed, this.culture_code).replace(" ", ""));
                this.updateRefundAmounts(refundedNed);

                var itemPosition = $(element).attr("item-position");
                var itemPrice = $(element).attr("value-per-item");
                var totalRefund = itemPrice * $(element).val();
                $('.refundTotal-' + itemPosition).html(Bizweb.Utility.textMoneyWithSymbol(totalRefund, this.culture_code).replace(" ", ""));
            };

            OrderAction.prototype.updateRefundAmounts = function (refundedNed) {
                if (refundedNed <= 0) {
                    $(".refund-amount").each(function () {
                        $(this).val(0);
                    });
                } else {
                    var totalRefundAmounts = 0;
                    $(".refund-amount").each(function () {
                        if (totalRefundAmounts <= refundedNed) {
                            var refundAmount = parseFloat((refundedNed - totalRefundAmounts));
                            var maxRefundAmount = parseFloat($(this).attr("data-autonumeric-max"));
                            if (maxRefundAmount < refundAmount) {
                                refundAmount = maxRefundAmount;
                            }
                            $(this).val(refundAmount);
                            totalRefundAmounts += parseFloat(refundAmount);
                        }
                    });
                    reSetAutoNumeric();
                }
            };

            return OrderAction;
        }();
    }.call(this),
    function () {
        Bizweb.OrderPaymentProcessing = function () {
            function OrderPaymentProcessing(e, b) {
                if (b) {
                    var property;
                    for (property in b) this[property] = b[property];
                }

                this.$form = $(".refund-form");
                this.hasNoAmountToCapture = false;
                this.hasNoAmountToRefund = true;
                this.hasSelectedQuantity = false;
                this.isCalculating = false;
                this.shipping = {};
                this.transactions = {};
                this.refundLineItems = {};
                this.totalCartDiscountAmount = 0;
                this.totalLineItemPrice = 0;
                this.totalRefund = 0;
                this.restock = false;
                this.updateRefundedNet = _.debounce(this.updateRefundedNet, 500);
                this.totalRestock = 0;
            }

            OrderPaymentProcessing.prototype.showModal = function (name) {
                this[name].show();
            };

            OrderPaymentProcessing.prototype.calculateRestock = function () {
                var that = this;
                if ($('#Restock').is(':checked')) {
                    if (that.totalRestock > 0) {
                        this.restock = true;
                    }
                }
                else {
                    that.restock = false;
                }
            };

            OrderPaymentProcessing.prototype.getTotalRestock = function () {
                var totalRefund = 0;
                $(".refund-quantity.restockable").each(function () {
                    if ($(this).val() && $(this).val().trim() != "")
                        totalRefund += parseInt($(this).val());
                });
                this.totalRestock = totalRefund;
                if (totalRefund == 0) {
                    this.restock = 0;
                    $("#Restock").prop("checked", false);
                }
                return totalRefund;
            };

            OrderPaymentProcessing.prototype.updateRefundedNet = function (element) {
                var that = this;

                if (Bizweb.OrderPaymentProcessing.updateRefundedNetAjax)
                    Bizweb.OrderPaymentProcessing.updateRefundedNetAjax.abort();

                var refundCalculatingRequest = {};
                refundCalculatingRequest.refundLineItems = [];
                refundCalculatingRequest.shipping = {
                    "amount": unFomatPrice(this.shippingAmount)
                }

                for (var lineItemId in this.refundLineItems) {
                    if (this.refundLineItems[lineItemId].quantity > 0)
                        refundCalculatingRequest.refundLineItems.push({ "lineItemId": lineItemId, "quantity": this.refundLineItems[lineItemId].quantity });
                }

                this.isCalculating = true;
                Bindings.refreshImmediately();

                Bizweb.OrderPaymentProcessing.updateRefundedNetAjax = $.ajax({
                    url: "/admin/orders/calculateRefund/{id}".replace("{id}", this.orderId),
                    type: "POST",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify(refundCalculatingRequest),
                    complete: function () {
                        that.isCalculating = false;
                    },
                    success: function (result) {
                        if (result && result.refund) {
                            var refund = result.refund;
                            that.resetCurrentAmount();

                            if (refund.transactions.length > 0) {
                                for (var i = 0; i < refund.transactions.length; i++) {
                                    var suggestTransaction = refund.transactions[i];
                                    if (!that.transactions[suggestTransaction.parent_id])
                                        that.transactions[suggestTransaction.parent_id] = {};

                                    that.transactions[suggestTransaction.parent_id].amount = suggestTransaction.amount;
                                }

                                that.recalculateTotalRefund();
                            }

                            if (refund.refund_line_items.length > 0) {
                                for (var i = 0; i < refund.refund_line_items.length; i++) {
                                    that.totalCartDiscountAmount += refund.refund_line_items[i].total_cart_discount_amount;

                                    var lineItemId = refund.refund_line_items[i].line_item_id;
                                    that.refundLineItems[lineItemId].amount = refund.refund_line_items[i].price * refund.refund_line_items[i].quantity;
                                    that.refundLineItems[lineItemId].amountString = Bizweb.Utility.textMoneyWithSymbol(that.refundLineItems[lineItemId].amount, that.cultureCode);

                                    that.totalLineItemPrice += that.refundLineItems[lineItemId].amount;
                                }
                            }
                        }

                        that.totalLineItemPriceString = Bizweb.Utility.textMoneyWithSymbol(that.totalLineItemPrice, that.cultureCode);
                        that.totalCartDiscountAmountString = Bizweb.Utility.textMoneyWithSymbol(-that.totalCartDiscountAmount, that.cultureCode);

                        Bindings.refreshImmediately();
                        reSetAutoNumeric();
                    }
                });
                reSetAutoNumeric();
            };

            OrderPaymentProcessing.prototype.resetCurrentAmount = function () {
                this.totalRefund = 0;
                this.totalCartDiscountAmount = 0;
                this.totalLineItemPrice = 0;

                for (var id in this.transactions) {
                    this.transactions[id].amount = 0;
                }

                for (var lineItemId in this.refundLineItems) {
                    this.refundLineItems[lineItemId].amount = 0
                    this.refundLineItems[lineItemId].amountString = Bizweb.Utility.textMoneyWithSymbol(this.refundLineItems[lineItemId].amount, this.cultureCode);
                }
            }

            OrderPaymentProcessing.prototype.recalculateTotalRefund = function () {
                this.totalRefund = 0;

                for (var id in this.transactions) {
                    this.totalRefund += unFomatPrice(this.transactions[id].amount);
                }
                this.totalRefundString = Bizweb.Utility.textMoneyWithSymbol(this.totalRefund, this.cultureCode);
            }

            OrderPaymentProcessing.prototype.actionRefund = function (form) {
                var $form = $(form);
                this.prepareFormDataToSubmit(form);

                //if ($form.valid()) {
                var url = $form.attr("action");
                var method = $form.attr("method");
                var that = this;
                unSetAutoNumeric();
                $.ajax({
                    url: url,
                    type: method,
                    data: $form.serialize(),
                    beforeSend: function () {
                        reSetAutoNumeric();
                    },
                    success: function (result) {
                        if (result.message != "OK") {
                            Bizweb.Flash.error("Thao tác thất bại. Xin kiểm tra lại thông tin hoàn trả.");
                        } else {
                            Bizweb.Modal.hide();
                            window.location.reload();
                            //Bizweb.Flash.notice("Hoàn trả thành công");
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
                reSetAutoNumeric();
                //}
                return false;
            };

            OrderPaymentProcessing.prototype.actionRefundQuickView = function (form, nodeChange, urlCallback) {
                var $form = $(form);
                this.prepareFormDataToSubmit(form);

                //if ($form.valid()) {
                var url = $form.attr("action");
                var method = $form.attr("method");
                var that = this;
                unSetAutoNumeric();
                $.ajax({
                    url: url,
                    type: method,
                    data: $form.serialize(),
                    beforeSend: function () {
                        reSetAutoNumeric();
                    },
                    success: function (result) {
                        if (result.message != "OK") {
                            Bizweb.Utility.loadAjax(urlCallback, nodeChange, function () {
                                Bizweb.Flash.error("Thao tác thất bại. Xin kiểm tra lại thông tin hoàn trả.");
                            });

                        } else {
                            $(document).find("#payment-status-" + result.order_id).html(OrderPaymentStatus(result.payment_status));
                            $(document).find("#fulfill-status-" + result.order_id).html(OrderFulfillStatus(result.fulfill_status));
                            Bizweb.Utility.loadAjax(urlCallback, nodeChange, function () {
                                Bizweb.Modal.hide();
                                Bizweb.Flash.notice("Hoàn trả thành công");
                            });

                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
                reSetAutoNumeric();
                //}
                return false;
            };

            OrderPaymentProcessing.prototype.prepareFormDataToSubmit = function (form) {
                var $form = $(form);

                $form.find(".refund-quantity").each(function () {
                    if (!$(this).val() || $(this).val().trim() == "")
                        $(this).val("0")
                });

                $form.find(".refund-amount").each(function () {
                    if (!$(this).val() || $(this).val().trim() == "")
                        $(this).val("0")
                });
            };

            OrderPaymentProcessing.prototype.updateCaptureAmount = function (elementCaptureAmount) {
                var formattedCaptureAmount = 0;
                var captureAmounts = $('.capture-amount');
                for (var i = 0; i < captureAmounts.length; i++) {
                    var captureAmountElement = captureAmounts[i];
                    var captureAmount = unFomatPrice($(captureAmountElement).val());
                    if (isNaN(captureAmount)) {
                        captureAmount = 0;
                        $(captureAmountElement).val(0);
                    }
                    formattedCaptureAmount += captureAmount;
                }
                if (formattedCaptureAmount > 0) {
                    this.hasNoAmountToCapture = false;
                } else {
                    this.hasNoAmountToCapture = true;
                }
                $('.formattedCaptureAmount').html(formattedCaptureAmount);
            }

            OrderPaymentProcessing.prototype.actionCapture = function (form) {
                var $form = $(form);
                //if ($form.valid()) {
                var url = $form.attr("action");
                var method = $form.attr("method");
                var that = this;
                unSetAutoNumeric();
                $.ajax({
                    url: url,
                    type: method,
                    data: $form.serialize(),
                    beforeSend: function () {
                        reSetAutoNumeric();
                    },
                    success: function (result) {
                        if (result != "OK") {
                            $form.html($(result).find(".capture-form").html());
                            Bindings.bind($form.get(0), that);
                        } else {
                            Bizweb.Modal.hide();
                            window.location.reload();
                            Bizweb.Flash.notice("Nhận tiền thành công");
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
                reSetAutoNumeric();
                //}
                return false;
            };

            OrderPaymentProcessing.prototype.actionCaptureQuickView = function (form, nodeChange, urlCallback) {
                var $form = $(form);
                //if ($form.valid()) {
                var url = $form.attr("action");
                var method = $form.attr("method");
                var that = this;
                unSetAutoNumeric();
                $.ajax({
                    url: url,
                    type: method,
                    data: $form.serialize(),
                    beforeSend: function () {
                        reSetAutoNumeric();
                    },
                    success: function (result) {
                        if (result.message != "OK") {
                            $form.html($(result).find(".capture-form").html());
                            Bindings.bind($form.get(0), that);
                        } else {
                            $(document).find("#payment-status-" + result.order_id).html(OrderPaymentStatus(result.payment_status));
                            $(document).find("#fulfill-status-" + result.order_id).html(OrderFulfillStatus(result.fulfill_status));
                            Bizweb.Utility.loadAjax(urlCallback, nodeChange, function () {
                                Bizweb.Modal.hide();
                                Bizweb.Flash.notice("Nhận tiền thành công");
                            });
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
                reSetAutoNumeric();
                //}
                return false;
            };

            return OrderPaymentProcessing;
        }();
    }.call(this),
    function () {
        Bizweb.EditCheckout = function () {
            function EditCheckout(e, b) {
                if (b) {
                    var property;
                    for (property in b) this[property] = b[property];
                }
            }

            EditCheckout.prototype.showModal = function (name) {
                this[name].show();
            };
            EditCheckout.prototype.updateOrderDetails = function () {
                var that = this;
                var note = $('#Note').val();
                Bizweb.Loading.start();
                var button = $(".update-order-btn");
                button.addClass("disabled").html(Bizweb.LOADING);
                $.ajax({
                    url: Bizweb.routes.checkouts + "/" + that.id,
                    data: { note: note },
                    type: "POST",
                    global: false,
                    success: function (data) {
                        var url = Bizweb.routes.checkouts + "/" + that.id
                        Bizweb.Utility.loadAjax(url, ".order-info", function () {
                            if (data.message) {
                                Bizweb.Flash.notice(data.message);
                            } else {
                                Bizweb.Flash.notice("Cập nhật thành công");
                            }
                        });
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        button.removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
            }

            EditCheckout.prototype.unscheduleEmail = function () {
                var that = this;
                Bizweb.Loading.start();
                $.ajax({
                    url: Bizweb.routes.checkouts + "/" + that.id + "/unschedule",
                    data: { id: that.id },
                    type: "POST",
                    global: false,
                    success: function (data) {
                        var url = Bizweb.routes.checkouts + "/" + that.id
                        Bizweb.Utility.loadAjax(url, ".checkoutContext", function () {
                            if (data.message) {
                                Bizweb.Flash.notice(data.message);
                            } else {
                                Bizweb.Flash.notice("Cập nhật thành công");
                            }
                        });
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        button.removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
            }

            return EditCheckout;
        }();
    }.call(this),
    function () {
        var t = [].indexOf || function (t) {
            for (var e = 0, n = this.length; n > e; e++)
                if (e in this && this[e] === t) return e;
            return -1
        };
        Bizweb.CollectionRules = function () {
            function r(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$rulesTable = $("#smart-filter-conditions");

                this.$container = $(element);
                this.$form = this.$container.parents('form');
                this.formContext = null;
                if (this.$form.size()) {
                    this.formContext = Bindings.context(this.$form.get(0));
                }
            };

            r.prototype.isOnlyRule = function () {
                return 1 === $(".collection-rule", this.$rulesTable).length;
            }

            r.prototype.removeRule = function (t) {
                this.isOnlyRule() || $(t).closest(".collection-rule").remove();
                if (this.formContext && this.formContext.form) {
                    this.formContext.form.makeDirty();
                }
            }

            r.prototype.addRule = function () {
                var t, e;
                var lastRule = $(".collection-rule", this.$rulesTable).last();
                var newId = lastRule.attr('id');
                if (newId) {
                    var i = parseInt(newId.replace('collection-rule-', ''));
                    newId = 'collection-rule-' + (i + 1);
                }
                t = $(".collection-rule", this.$rulesTable).first().clone(), $(t).attr('id', newId), $(".rule-field, .rule-relation", t).each(function () {
                    return this.selectedIndex = 0
                }), $(".rule-condition", t).val(""), this.$rulesTable.append(t), Bindings.bind(t[0])
            }
            return r;
        }();

        Bizweb.CollectionRule = function () {
            function r(element, rulesOptions) {
                this.options = rulesOptions;
                this.element = element;
                this.$node = $(element);
                this.ruleFieldChanged();
            };
            r.prototype.ruleFieldChanged = function () {
                this.field = $(".rule-field", this.$node).val();
                this.prefix = this.options.prefixes[this.field] || "";
                this.suffix = this.options.suffixes[this.field] || "";
                Bindings.refreshImmediately();
                var t = $(".rule-relation", this.$node);
                if ($("option:selected:disabled", t).length > 0) {
                    t[0].selectedIndex = 0;
                }
                unSetAutoNumeric();
                var ruleCondition = $(".rule-condition", this.$node);
                if (this.field == 'variant_price') {
                    $(ruleCondition).attr('data-autonumeric', 'autoNumeric').attr('data-autonumeric-min', '-999999999.99');
                    if (!Bizweb.Utility.isNumeric($(ruleCondition).val())) {
                        $(ruleCondition).val("0");
                    }
                    initAutoNumeric();
                } else if ($(ruleCondition).attr('data-autonumeric') !== undefined) {
                    $(ruleCondition).removeAttr('data-autonumeric');
                    var selector = $(ruleCondition).clone();
                    $(ruleCondition).autoNumeric("destroy");
                    $(selector).replaceAll(ruleCondition);
                }
                reSetAutoNumeric();
            }

            r.prototype.isRelationDisabled = function (e) {
                return t.call(this.options.restrictions[this.field] || [], e) < 0;
            }
            return r;
        }();
    }.call(this),
    function () {
        Bizweb.ProductBulkActions = function () {
            function ProductBulkActions(element, options) {
                this.typeFormAds = "";
                this.isFacebook = false;
                this.infoCus = {};
                ProductBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, ProductBulkActions);

            ProductBulkActions.prototype.addCollections = function () {
                var returnUrl = window.location.href;
                $.ajax({
                    url: this.urlBulkActionAddCollections + '?type=custom&' + $("#frmBulkActions").serialize() + '&ReturnUrl=' + encodeURIComponent(returnUrl),
                    success: function (data) {
                        $("#bizweb-modal").html(data);
                        $("#bizweb-modal").modal("show");
                    }
                })
            }

            ProductBulkActions.prototype.removeCollections = function () {
                var returnUrl = window.location.href;
                $.ajax({
                    url: this.urlBulkActionRemoveCollections + '?type=custom&' + $("#frmBulkActions").serialize() + '&ReturnUrl=' + encodeURIComponent(returnUrl),
                    success: function (data) {
                        $("#bizweb-modal").html(data);
                        $("#bizweb-modal").modal("show");
                    }
                })
            }

            ProductBulkActions.prototype.showModelSendAdsToDms = function (type) {
                if (type === 'google') {
                    this.typeFormAds = "Google";
                    this.isFacebook = false;
                }
                if (type === 'facebook') {
                    this.typeFormAds = "Facebook";
                    this.isFacebook = true;
                }

                if (typeof ticketData == "undefined" || typeof ticketData != "object") {
                    this.infoCus = {};
                }
                else {
                    this.infoCus.name = ticketData.TicketName;
                    this.infoCus.email = ticketData.TicketEmail;
                    this.infoCus.phone = ticketData.TicketPhone;
                }

                this.sendFormAdsToDMS.show();
            };

            ProductBulkActions.prototype.submitFormRequestAdvice = function () {
                var $that = this;
                var fullName = $("#inputCustomerFullName").val().trim();
                var phone = $("#inputCustomerPhone").val().trim();
                var email = $("#inputCustomerEmail").val().trim();
                var categoryId = $("#inputCategoryId").val().trim();
                if (!!fullName && !!phone && !!email) {
                    //$that.sendFormAdsToDMS.hide();
                    if (validateEmail(email)) {
                        if (phone.length >= 8 && phone.length <= 12 && !isNaN(phone)) {
                            var html = "<button aria-hidden='true' data-dismiss='modal' class='close close-modal' style='z-index:9999' type='button'>×</button>" +
                                "<div class='modal-body'>" +
                                "<div class='title' style='padding: 20px 40px;'>" +
                                "<img src='/frontend/topic/portal/admin/images/icon-success-popup.jpg' style='margin-bottom:10px;' />" +
                                "<h2 style='color:#1757b6;font-weight:500;font-size:27px;'>Cảm ơn Quý khách đã gửi yêu cầu tư vấn Quảng cáo tới DKT Media</h2>" +
                                "</div>" +
                                "<hr style='margin: 0 20px 20px;border-top: 1px dashed #ddd;'/>" +
                                "<div class='form-group form-contact-success' style='text-align: left;'>" +
                                "<div style='text-align:center'>" +
                                "<p style='font-size:14px;margin:0 auto'>Chúng tôi sẽ liên lạc với Quý khách trong vòng 2h. Để biết thêm thông tin chi tiết, Quý</p>" +
                                "<p style='font-size:14px;margin:0 auto'> khách có thể liên hệ với chúng tôi theo số điện thoại:</p>" +
                                "</div>" +
                                "<div class='row' style='padding: 15px 30px; text-align: center;font-size:16px;'>" +
                                "<div class='advice-contact'>" +
                                "<img style='display: -webkit-inline-box;' src='/frontend/topic/portal/admin/images/icon-phone-popup.jpg' /> Tại Hà Nội: <b>024 7303 6880</b>" +
                                "</div>" +
                                "<div class='advice-contact'>" +
                                "<img style='display: -webkit-inline-box;' src='/frontend/topic/portal/admin/images/icon-phone-popup.jpg' /> Tại TP.HCM: <b>028 7303 6880</b>" +
                                "</div>" +
                                "</div>" +
                                "</div>" +
                                "</div>";
                            var formData = new FormData();
                            formData.append("Name", fullName);
                            formData.append("Phone", phone);
                            formData.append("Email", email);
                            formData.append("CategoryId", categoryId);
                            if (this.isFacebook) {
                                formData.append("Type", "facebook");
                            }
                            else {
                                formData.append("Type", "google");
                            }
                            $.ajax({
                                type: "POST",
                                url: "/admin/products/SendFormRequestAdviceToDms",
                                data: formData,
                                contentType: false,
                                processData: false,
                                success: function (data) {
                                    if (data == "OK") {
                                        $("#formRequestAdvice").find(".modal-content").html(html);
                                    }
                                    else {
                                        Bizweb.Flash.error("Có lỗi xảy ra!");
                                        return;
                                    }
                                }
                            })
                        }
                        else {
                            Bizweb.Flash.error("Sai định dạng số điện thoại!");
                            return;
                        }
                    }
                    else {
                        Bizweb.Flash.error("Sai định dạng email!");
                        return;
                    }
                }
                else {
                    Bizweb.Flash.error("Các trường thông tin không được để trống!");
                    return;
                }
            };

            return ProductBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.MediaFile = function () {
            function MediaFile(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            MediaFile.prototype.uploadFiles = function () {
                var formData = new FormData();
                var totalFiles = $("#fileUpload")[0].files.length;
                if (totalFiles <= 0) {
                    return;
                }
                for (var i = 0; i < totalFiles; i++) {
                    var file = document.getElementById("fileUpload").files[i];
                    formData.append("mediaImages", file);
                }
                var mediaFile = this;
                $.ajax({
                    type: "POST",
                    url: '/admin/settings/files/Upload',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (response) {

                        if (response.error) {
                            Bizweb.Flash.error(response.error);
                            return;
                        }

                        Bizweb.Utility.loadAjax(window.location.href, ".mediafiles", function () {
                            Bizweb.Flash.notice("Tải lên thành công");
                        });
                    },
                    error: function (error) {

                    }
                });
            }

            MediaFile.prototype.openFileUpload = function () {
                $("#fileUpload").click();
            }

            return MediaFile;
        }();
    }.call(this),
    function () {
        Bizweb.FileBulkActions = function () {
            function FileBulkActions(element, options) {
                FileBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, FileBulkActions);

            FileBulkActions.prototype.previewImage = function (path) {
                this.previewImageModal.show();
                $(".image-show").attr("src", path);
            }

            FileBulkActions.prototype.showDeleteFileModal = function (fileId) {
                this.deleteFileModal.show();
                $('.form-delete-file input[name="fileId"]').val(fileId);
            }

            FileBulkActions.prototype.deleteFile = function (e) {
                $(e).addClass('disabled is-loading');
                $.ajax({
                    type: "POST",
                    url: '/admin/settings/files/Delete',
                    data: $(".form-delete-file").serialize(),
                    dataType: "json",
                    success: function (response) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                Bizweb.Flash.notice("Xóa file thành công");
                            });
                        }, 500);
                    },
                    error: function (error) {

                    }
                });
            }

            return FileBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.Account = function () {
            function Account(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.action = "";
                this.plan = "";
                this.source = "";
                this.choice = "";
                this.text1 = "";
                this.text2 = "";
            };

            Account.prototype.showStopAllSession = function () {
                this.stopAllSessionModal.show();
            }

            Account.prototype.showStopAllSessionCollaborator = function () {
                this.stopAllSessionCollaborator.show();
            }

            Account.prototype.stopAllSession = function (isCollaborator) {
                $.ajax({
                    url: '/admin/settings/account/StopAllSession',
                    type: "POST",
                    data: { isCollaborator: isCollaborator },
                    success: function (result) {
                        window.location = "/admin/dashboard";
                    }
                });
            }

            Account.prototype.stopUserSession = function (id) {
                $.ajax({
                    url: '/admin/settings/account/stop_user_session/' + id,
                    type: "POST",
                    success: function (result) {
                        window.location.reload();
                    }
                });
            }

            Account.prototype.showDeleteUser = function (userId) {
                this.deleteUserModal.show();
                $('.form-delete-user input[name="userId"]').val(userId);
            }
            Account.prototype.takePlan = function (channel, packageName, period) {
                if (!period)
                    period = 0;

                $.ajax({
                    url: Bizweb.routes.plans + "/takeplan",
                    type: "POST",
                    data: {
                        channel: channel,
                        packageName: packageName,
                        period: period
                    },
                    success: function (data) {
                        if (data != null && data.charge_id > 0)
                            window.location = Bizweb.routes.charges + "/" + data.charge_id;
                        if (data != null && data.redirect)
                            window.location = data.redirect;
                    },
                    error: function (data) {
                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Thao tác thất bại");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            }

            Account.prototype.clickPackage = function (plan, action) {
                this.plan = plan;
                this.action = action;
                switch (action) {
                    case "resign": {
                        this.choice = "gia hạn";
                    }
                        break;
                    case "upgrade": {
                        this.choice = "nâng cấp";
                    }
                    case "choose": {
                        this.choice = "";
                    }
                }
                this.confirmPackage();
            }

            Account.prototype.confirmPackage = function () {
                var that = this;
                $.ajax({
                    url: Bizweb.routes.plans + "/ChoosePackage",
                    type: "POST",
                    data: {
                        plan: that.plan,
                        action: that.action
                    },
                    success: function (data) {
                        if (data.result == "OK") {
                            switch (that.action) {
                                case "resign": {
                                    that.text1 = "lựa chọn gia hạn";
                                    that.text2 = "gia hạn";
                                }
                                    break;
                                case "upgrade": {
                                    that.text1 = "lựa chọn nâng cấp lên";
                                    that.text2 = "nâng cấp";
                                }
                                case "choose": {
                                    that.text1 = "lựa chọn",
                                    that.text2 = "lựa chọn"
                                }
                            }

                            that.customerChoosePackageConfirm.show();
                        }
                        else {
                            Bizweb.Flash.error("Thao tác thất bại");
                            return;
                        }
                    },
                    error: function (data) {
                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Thao tác thất bại");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            }

            Account.prototype.upgradeOmniTrial = function () {
                this.customerUpdateOmniTrial.show();

            }

            Account.prototype.upgradeOmniTrialConfirm = function () {
                var htmlSuccess = "<button aria-hidden='true' data-dismiss='modal' class='close close-modal' style='font-size: 31px; top: 0; position: absolute; right: 10px;' type='button'>×</button><div class='omni-modal'><p class='omni-title'>Yêu cầu chuyển đổi sang gói dùng thử Omnichannel của bạn đã thành công !</p><p class='omni-des'>Vui lòng chờ trong giây lát để chúng tôi thiết lập hệ thống cho bạn</p><div id='loadingbar'></div><p class='omni-result'>Dữ liệu đang được cài đặt...</p><p class='omni-result'>Bạn sẽ được chuyển đến hệ thống Omnichannel sau khi cài đặt xong</p></div>";
                var htmlError = "<button aria-hidden='true' data-dismiss='modal' class='close close-modal' style='font-size: 31px; top: 0; position: absolute; right: 10px;' type='button'>×</button><div class='omni-error'>{error}</div>";

                $("#btn-upgrade-omni-trial").addClass("is-loading");
                var container = $("#formUpgradeOmniTrial");

                var passUser = $(".passUser").val();
                if (!!passUser) {
                    $.ajax({
                        url: Bizweb.routes.plans + "/UpgradeToOmniTrial",
                        type: "POST",
                        data: {
                            pass: passUser
                        },
                        success: function (data) {

                            $(container).html(htmlSuccess);

                            var bar = new ProgressBar.Circle(loadingbar, {
                                color: '#08f',
                                // This has to be the same size as the maximum width to
                                // prevent clipping
                                strokeWidth: 4,
                                trailWidth: 1,
                                easing: 'easeInOut',
                                duration: 9800,
                                text: {
                                    autoStyleContainer: false
                                },
                                from: { color: '#08f', width: 1 },
                                to: { color: '#08f', width: 2 },
                                // Set default step function for all animate calls
                                step: function (state, circle) {
                                    circle.path.setAttribute('stroke', state.color);
                                    circle.path.setAttribute('stroke-width', state.width);

                                    var value = Math.round(circle.value() * 100) + " %";
                                    if (value === 0) {
                                        circle.setText('');
                                    } else {
                                        circle.setText(value);
                                    }

                                }
                            });
                            bar.text.style.fontFamily = '"Raleway", Helvetica, sans-serif';
                            bar.text.style.fontSize = '2.8rem';

                            bar.animate(1.0);

                            console.log(data);

                            setTimeout(function () {
                                window.location.href = data.result.redirect_url;
                            }, 10000);
                        },
                        error: function (data) {

                            if (typeof data.responseJSON === "undefined") {
                                htmlError = htmlError.replace("{error}", "Có lỗi xảy ra trong quá trình đăng ký. Bạn vui lòng liên hệ với chúng tôi để được hỗ trợ.");
                                $(container).html(htmlError);
                                return;
                            }

                            if (data.responseJSON.error !== null && data.responseJSON.error !== "") {
                                if (data.responseJSON.error.contains("length must be between 6 and 20")) {
                                    htmlError = htmlError.replace("{error}", "Mật khẩu không hợp lệ. Mật khẩu từ 6 đến 20 ký tự");
                                }
                                else {
                                    htmlError = htmlError.replace("{error}", data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                                }
                            } 

                            $(container).html(htmlError);
                        }
                    });
                }
                else {
                    htmlError = htmlError.replace("{error}", "Mật khẩu không được để trống!");
                    $(container).html(htmlError);
                    return;
                }
            }

            return Account;
        }();
    }.call(this),
    function () {
        Bizweb.DiscountBulkActions = function () {
            function DiscountBulkActions(element, options) {
                DiscountBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, DiscountBulkActions);

            DiscountBulkActions.prototype.showDeleteDiscountModal = function (id) {
                this.deleteDiscountModal.show();
                $('.form-delete-discount input[name="id"]').val(id);
            }

            DiscountBulkActions.prototype.deleteDiscount = function () {
                var id = $('.form-delete-discount input[name="id"]').val();
                $.ajax({
                    type: "POST",
                    url: '/admin/discounts/Delete',
                    data: $(".form-delete-discount").serialize(),
                    dataType: "json",
                    success: function (response) {
                        Bizweb.Flash.notice("Xóa mã khuyến mãi thành công");
                        Bizweb.Modal.hide();
                        window.location.href = window.location.href;
                    },
                    error: function (error) {

                    }
                });
            }

            return DiscountBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.PaymentSetting = function () {
            function r(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$ele = $(element);
                this.id = "#" + element.id;
            };

            function focusPayment(divId) {
                $('html, body').animate({
                    scrollTop: $(divId).offset().top - 90,
                }, 300);
            }

            r.prototype.saveSetting = function (form) {
                var $form = $(form);
                //if ($form.valid()) {
                var url = $form.attr("action");
                var method = $form.attr("method");
                var divId = $(form).parents(this.id);
                var that = this;
                Bizweb.Loading.start();
                $.ajax({
                    url: url,
                    type: method,
                    data: $form.serialize(),
                    global: false,
                    success: function (data) {
                        Bizweb.Utility.loadAjax(Bizweb.routes.setting.payments, that.id, function () {
                            Bizweb.Flash.notice("Cập nhật thành công");
                            focusPayment(divId);
                        });
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        Bizweb.Loading.stop();
                    }
                });
                //}
                return false;
            }

            r.prototype.removeSetting = function (ele) {
                var that = this;
                Bizweb.Loading.start();
                $.ajax({
                    url: $(ele).attr("action"),
                    type: $(ele).attr("method"),
                    global: false,
                    success: function (data) {
                        Bizweb.Utility.loadAjax(Bizweb.routes.setting.payments, that.id, function () {
                            Bizweb.Flash.notice("Ngưng sử dụng cấu hình thành công");
                        });
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        Bizweb.Loading.stop();
                    }
                });
            }
            return r;
        }();
    }.call(this),
    function () {
        Bizweb.ShippingMethod = function () {
            function r(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$ele = $(element);
                this.shippingProviderId = 0;
                this.changeProvider();

                initAutoNumeric();
            }

            r.prototype.changeProvider = function () {
                for (var propertyName in this) {
                    if (this[propertyName] && this[propertyName].shippingProviderId && this[propertyName].shippingProviderId == this.shippingProviderId && this[propertyName].loadData)
                        this[propertyName].loadData();
                }

                $(".shipping-provider-html:not('.shipping-provider-html-" + this.shippingProviderId + "') :input").prop("disabled", true);
                $(".shipping-provider-html.shipping-provider-html-" + this.shippingProviderId + " :input").prop("disabled", false);

                for (var propertyName in this) {
                    if (this[propertyName] && this[propertyName].shippingProviderId && this[propertyName].shippingProviderId == this.shippingProviderId && this[propertyName].postLoadData)
                        this[propertyName].postLoadData();
                }
            }

            return r;
        }();
    }.call(this),
    function () {
        Bizweb.Fulfilment = function () {
            function r(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$ele = $(element);
            }

            r.prototype.checkValid = function (ele, i) {
                var quantity = $(ele).val();
                var roundQuantity = parseInt(Math.floor(quantity));
                var maxQuantity = parseInt($(ele).attr("max"));
                var result = 0;
                if (roundQuantity > maxQuantity) {
                    result = maxQuantity;
                } else {
                    result = roundQuantity;
                }
                $(ele).val(result);
                this.grams[i].quantity = result;

                var grams = 0;
                if (this.grams) {
                    for (var i = 0; i < this.grams.length; i++) {
                        grams += this.grams[i].quantity * this.grams[i].grams;
                    }
                }
                this.$ele.find("input[name='Grams']").val(grams).trigger("change");
            }

            r.prototype.updateFulfillments = function () {
                var that = this;
                $(".btn-fulfill").addClass("disabled").html(Bizweb.LOADING);
                Bizweb.Loading.start();
                unSetAutoNumeric();
                $.ajax({
                    url: Bizweb.routes.orders + "/" + that.order_id + '/fulfillments/create',
                    type: "post",
                    data: $(".fulfill-item-form").serialize(),
                    global: false,
                    beforeSend: function () {
                        reSetAutoNumeric();
                    },
                    success: function (result) {
                        Bizweb.Utility.loadAjax(window.location.href, ".orderContext", function () {
                            Bizweb.Flash.notice("Cập nhật thông tin giao hàng thành công");
                            Bizweb.Utility.changeUrl(window.location.href);
                        });
                    },
                    error: function (data) {
                        if (data.responseJSON) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        else {
                            Bizweb.Flash.error("Cập nhật thất bại");
                        }
                        $(".btn-fulfill").removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
                reSetAutoNumeric();
            }

            r.prototype.updateFulfillmentsQuickView = function (nodeChange, urlCallback) {
                var that = this;
                $(".btn-fulfill").addClass("disabled").html(Bizweb.LOADING);
                Bizweb.Loading.start();
                unSetAutoNumeric();
                $.ajax({
                    url: Bizweb.routes.orders + "/" + that.order_id + '/fulfillments/create',
                    type: "post",
                    data: $(".fulfill-item-form").serialize(),
                    global: false,
                    beforeSend: function () {
                        reSetAutoNumeric();
                    },
                    success: function (result) {
                        $(document).find("#payment-status-" + result.order_id).html(OrderPaymentStatus(result.payment_status));
                        $(document).find("#fulfill-status-" + result.order_id).html(OrderFulfillStatus(result.fulfill_status));
                        Bizweb.Utility.loadAjax(urlCallback, nodeChange, function () {
                            Bizweb.Flash.notice("Cập nhật thông tin giao hàng thành công");
                        });
                    },
                    error: function (data) {
                        if (data.responseJSON) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        else {
                            Bizweb.Flash.error("Cập nhật thất bại");
                        }
                        $(".btn-fulfill").removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
                reSetAutoNumeric();
            }

            return r;
        }();
    }.call(this),
    function () {
        Bizweb.GHNShipping = function () {
            function GHNShipping(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$ele = $(element);

                this.$warehouse = $(".shipping-provider-html.ghn-provider-context .warehouse");
                this.$province = $(".shipping-provider-html.ghn-provider-context .province");
                this.$district = $(".shipping-provider-html.ghn-provider-context .district");
                this.$service = $(".shipping-provider-html.ghn-provider-context .service");
                this.$provinceHiddenInput = $(".shipping-provider-html.ghn-provider-context input[name=Province]");
                this.$districtHiddenInput = $(".shipping-provider-html.ghn-provider-context input[name=District]");
                this.$pickHubHiddenInput = $(".shipping-provider-html.ghn-provider-context input[name=PickHub]");

                var grams = 0;
                var gramsArr = Bindings.context($('.fulfill-item-form').get(0)).fulfillContext.grams;
                if (gramsArr) {
                    for (var i = 0; i < gramsArr.length; i++) {
                        grams += gramsArr[i].quantity * gramsArr[i].grams;
                    }
                }
                this.grams = grams;
            }

            GHNShipping.prototype.loadData = function () {
                var that = this;

                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.ghn + "?province=" + this.province,
                        success: function (data) {
                            that.dataLoaded = true;

                            var hubOptionHtml = "";

                            for (var i = 0; i < data.pick_hubs.length; i++) {
                                var pickHub = data.pick_hubs[i];
                                hubOptionHtml += "<option district='" + pickHub.district_code + "' " + (pickHub.main ? "selected='selected'" : "") + " value='" + pickHub.pick_hub_id + "'>" + pickHub.address + "( " + pickHub.district_name + " )" + "</option>";
                            }

                            that.$warehouse.empty();
                            that.$warehouse.html(hubOptionHtml);
                            that.bindSelectedPickHubInput();

                            var provinceOptionHtml = "";
                            for (var i = 0; i < data.provinces.length; i++) {
                                var province = data.provinces[i];
                                provinceOptionHtml += "<option " + (data.province == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                            }

                            that.$province.empty();
                            that.$province.html(provinceOptionHtml);
                            that.bindSelectedProvinceInput();

                            if (data.province != null) {
                                var districts = data.districts;
                                that.bindDistrict(districts, that.district);
                            }
                            else {
                                that.changeProvince();
                            }
                        },
                        error: function (data) {
                            if (data.responseJSON) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Thông tin giao hàng nhanh không đúng.");
                            }
                        }
                    });
                }
            }
            GHNShipping.prototype.bindDistrict = function (districts, selected) {
                var districtOptionHtml = "<option ghn='' value=''>Chọn quận/huyện</option>";
                var toDistrict = "";
                for (var i = 0; i < districts.length; i++) {
                    var district = districts[i];
                    if (selected == district.bw_district_code) {
                        toDistrict = district.ghn_district_code;
                    }
                    districtOptionHtml += "<option " + (selected == district.bw_district_code ? "selected='selected'" : "") + " ghn='" + district.ghn_district_code + "' value='" + district.bw_district_code + "," + district.ghn_district_code + "'>" + district.bw_district_name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                this.changeDistrict(toDistrict);
            }
            GHNShipping.prototype.changeProvince = function () {
                this.bindSelectedProvinceInput();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.ghn + "/getdistrict?province=" + $(".shipping-provider-html.ghn-provider-context .province").val(),
                    success: function (data) {
                        if (data != undefined && data != '' && data.length) {
                            that.bindDistrict(data, "");
                        }
                    }
                });
            }
            GHNShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }
            GHNShipping.prototype.changeDistrict = function (to) {
                this.bindSelectedDistrictInput();

                var that = this;
                if (to == undefined) {
                    to = that.$district.find("option:selected").attr("ghn");
                }
                if (to != "") {
                    $.ajax({
                        url: Bizweb.routes.ghn + "/getservicelist?from=" + that.$warehouse.find("option:selected").attr("district") + "&to=" + to,
                        success: function (data) {
                            if (data != undefined && data != "" && data.length) {
                                var serviceOptionHtml = "<option value='0'>Chọn gói giao hàng</option>";
                                for (var i = 0; i < data.length; i++) {
                                    var service = data[i];
                                    serviceOptionHtml += "<option value='" + service.shipping_service_id + "'>" + service.name + "</option>";
                                }

                                that.$service.empty();
                                that.$service.html(serviceOptionHtml);
                            }
                        }
                    });
                }
                else {
                    that.$service.empty();
                }
            }
            GHNShipping.prototype.bindSelectedDistrictInput = function () {
                var selectedDistrict = this.$district.children("option:selected");
                if (selectedDistrict) {
                    this.$districtHiddenInput.val(selectedDistrict.text());
                }
            }
            GHNShipping.prototype.bindSelectedPickHubInput = function () {
                var selectedPickHub = this.$warehouse.children("option:selected");
                if (selectedPickHub) {
                    this.$pickHubHiddenInput.val(selectedPickHub.text());
                }
            }

            return GHNShipping;
        }();
    }.call(this),
    function () {
        Bizweb.ScShipping = function () {
            function ScShipping(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = element;
                this.$ele = $(element);

                this.$province = $(".shipping-provider-html.sc-provider-context .province");
                this.$district = $(".shipping-provider-html.sc-provider-context .district");
                this.$warehouse = $(".shipping-provider-html.sc-provider-context .warehouse");
                this.$provinceHiddenInput = $(".shipping-provider-html.sc-provider-context input[name=Province]");
                this.$districtHiddenInput = $(".shipping-provider-html.sc-provider-context input[name=District]");
                this.$shippingFee = $(".shipping-provider-html.sc-provider-context .shipping-fee");

                var grams = 0;
                var gramsArr = Bindings.context($('.fulfill-item-form').get(0)).fulfillContext.grams;
                if (gramsArr) {
                    for (var i = 0; i < gramsArr.length; i++) {
                        grams += gramsArr[i].quantity * gramsArr[i].grams;
                    }
                }
                this.grams = grams;
                this.shippingCollect = "Chưa tính";
                this.shippingFee = "Chưa tính";
                this.debounceCalculateFee = _.debounce(this.calculateFee, 300);
                this.parentContext = Bindings.context($(".shipping-provider-html").get(0));
            }

            ScShipping.prototype.loadData = function () {
                var that = this;
                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.shipchung + "?province=" + this.province,
                        success: function (data) {
                            that.dataLoaded = true;
                            that.renderProvincesSelector(data.provinces, data.province);
                            that.renderPickHubsSelector(data.store_addresses);

                            if (data.province != null) {
                                var districts = data.districts;
                                that.bindDistrict(districts, that.district);
                            }
                            else {
                                that.changeProvince();
                            }
                        },
                        error: function (data) {
                            if (data.responseJSON) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Địa chỉ giao hàng không đúng.");
                            }
                        }
                    });
                }
            }
            ScShipping.prototype.postLoadData = function () {
                if (this.shipping_type != 2)
                    $(".sc-provider-context input#inventoryId").prop("disabled", true);
            }
            ScShipping.prototype.renderProvincesSelector = function (provinces, selectedProvince) {
                var provinceOptionHtml = "";
                for (var i = 0; i < provinces.length; i++) {
                    var province = provinces[i];
                    provinceOptionHtml += "<option " + (selectedProvince == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                }

                this.$province.empty();
                this.$province.html(provinceOptionHtml);
            }
            ScShipping.prototype.renderPickHubsSelector = function (storeAddresses) {
                var hubOptionHtml = "";

                for (var i = 0; i < storeAddresses.length; i++) {
                    var bizwebPickHub = storeAddresses[i];
                    hubOptionHtml += "<option " + (bizwebPickHub.default_address ? "selected='selected'" : "") + " value='" + bizwebPickHub.id + "' bizweb-address='true'>" + bizwebPickHub.name + "(" + bizwebPickHub.address + ")" + "</option>";
                }

                this.$warehouse.empty();
                this.$warehouse.html(hubOptionHtml);
            }
            ScShipping.prototype.bindDistrict = function (districts, selected) {
                var districtOptionHtml = "<option sc='' value=''>Chọn quận/huyện</option>";
                for (var i = 0; i < districts.length; i++) {

                    var district = districts[i];
                    districtOptionHtml += "<option " + (selected == district.bw_district_code ? "selected='selected'" : "") + " sc='" + district.sc_district_code + "' value='" + district.bw_district_code + "," + district.sc_district_code + "'>" + district.bw_district_name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                this.bindSelectedDistrictInput(!selected);
            }
            ScShipping.prototype.changeProvince = function () {
                this.bindSelectedProvinceInput();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.shipchung + "/getdistrict?province=" + $(".shipping-provider-html.sc-provider-context .province").val(),
                    success: function (data) {
                        if (data != undefined && data != '' && data.length) {
                            that.bindDistrict(data, "");

                            that.shippingFee = "Chưa tính";
                            that.shipping_collect = "Chưa tính";
                        }
                    }
                });
            }
            ScShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }
            ScShipping.prototype.bindSelectedDistrictInput = function (notUpdate) {
                var selectedDistrict = this.$district.children("option:selected");
                if (selectedDistrict) {
                    this.$districtHiddenInput.val(selectedDistrict.text());
                }
                if (!notUpdate) {
                    this.calculateFee();
                }
            }
            ScShipping.prototype.updateFee = function () {
                if (this.parentContext.shippingProviderId == 2) {
                    if (this.grams != 0) {
                        this.debounceCalculateFee();
                    } else {
                        this.shippingCollect = "Chưa tính";
                        this.shippingFee = "Chưa tính";
                    }
                }
            }
            ScShipping.prototype.calculateFee = function () {
                Bizweb.Loading.start();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.shipchung + "/calculateshippingfee",
                    method: "POST",
                    data: $(".fulfill-item-form").serialize(),
                    complete: function () {
                        Bizweb.Loading.stop();
                    },
                    success: function (data) {
                        if (data && data.fee) {
                            that.shippingFee = data.fee;
                            that.shippingCollect = data.collect;
                        }
                    },
                    error: function (error) {
                        if (error.responseJSON) {
                            that.shippingFee = error.responseJSON.fee;
                        } else {
                            that.shippingFee = "Không xác định";
                        }
                        
                        that.shippingCollect = "Chưa tính";
                    }
                });
            }

            return ScShipping;
        }();
    }.call(this),
    function () {
        Bizweb.GHTKShipping = function () {
            function GHTKShipping(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = element;
                this.$element = $(element);
                this.$province = $(".shipping-provider-html.ghtk-provider-context .province");
                this.$district = $(".shipping-provider-html.ghtk-provider-context .district");
                this.$warehouse = $(".shipping-provider-html.ghtk-provider-context .warehouse");
                this.$provinceHiddenInput = $(".shipping-provider-html.ghtk-provider-context input[name=Province]");
                this.$districtHiddenInput = $(".shipping-provider-html.ghtk-provider-context input[name=District]");
                this.$shippingFee = $(".shipping-provider-html.ghtk-provider-context .shipping-fee");

                var grams = 0;
                var gramsArr = Bindings.context($('.fulfill-item-form').get(0)).fulfillContext.grams;
                if (gramsArr) {
                    for (var i = 0; i < gramsArr.length; i++) {
                        grams += gramsArr[i].quantity * gramsArr[i].grams;
                    }
                }
                this.grams = grams;
            }

            GHTKShipping.prototype.loadData = function () {
                var that = this;
                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.ghtk + "?province=" + this.province,
                        success: function (data) {
                            that.dataLoaded = true;
                            that.renderProvincesSelector(data.provinces, data.province);
                            that.renderPickHubsSelector(data.pick_hubs, data.store_addresses);

                            that.bindSelectedProvinceInput();

                            if (data.province != null) {
                                var districts = data.districts;
                                that.bindDistrict(districts, that.district);
                            }
                            else {
                                that.changeProvince();
                            }
                        },
                        error: function (data) {
                            if (data.responseJSON) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Thông tin giao hàng tiết kiệm không đúng.");
                            }
                        }
                    });
                }
            }
            GHTKShipping.prototype.renderProvincesSelector = function (provinces, selectedProvince) {
                var provinceOptionHtml = "";
                for (var i = 0; i < provinces.length; i++) {
                    var province = provinces[i];
                    provinceOptionHtml += "<option " + (selectedProvince == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                }

                this.$province.empty();
                this.$province.html(provinceOptionHtml);
            }
            GHTKShipping.prototype.renderPickHubsSelector = function (ghtkPickHubs, storeAddresses) {
                var hubOptionHtml = "";

                var defaultAddress;
                for (var i = 0; i < storeAddresses.length; i++) {
                    var bizwebPickHub = storeAddresses[i];
                    if (bizwebPickHub.default_address)
                        defaultAddress = bizwebPickHub;

                    hubOptionHtml += "<option " + (bizwebPickHub.default_address ? "selected='selected'" : "") + " value='" + bizwebPickHub.id + "' bizweb-address='true'>" + bizwebPickHub.name + "(" + bizwebPickHub.address + ")" + "</option>";
                }

                if (defaultAddress != null)
                    this.$element.find("input[name=StoreAddressId]").val(defaultAddress.id);
                else
                    this.$element.find("input[name=StoreAddressId]").val(storeAddresses[0].id);

                for (var i = 0; i < ghtkPickHubs.length; i++) {
                    var pickHub = ghtkPickHubs[i];
                    hubOptionHtml += "<option value='" + pickHub.hub_code + "'>Giao hàng tiết kiệm(" + pickHub.address + ")" + "</option>";
                }

                this.$warehouse.empty();
                this.$warehouse.html(hubOptionHtml);
            }
            GHTKShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }
            GHTKShipping.prototype.bindDistrict = function (districts, selected) {
                var districtOptionHtml = "<option ghtk='' value=''>Chọn quận/huyện</option>";
                for (var i = 0; i < districts.length; i++) {
                    var district = districts[i];
                    districtOptionHtml += "<option " + (selected == district.code ? "selected='selected'" : "") + "value='" + district.code + "'>" + district.name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                this.bindSelectedDistrictInput(!selected);
            }
            GHTKShipping.prototype.bindSelectedDistrictInput = function (notUpdate) {
                var selectedDistrict = this.$district.children("option:selected");
                if (selectedDistrict) {
                    this.$districtHiddenInput.val(selectedDistrict.text());
                }
                if (!notUpdate) {
                    this.calculateFee();
                }
            }
            GHTKShipping.prototype.changeProvince = function () {
                this.bindSelectedProvinceInput();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.ghtk + "/getdistrict?province=" + $(".shipping-provider-html.ghtk-provider-context .province").val(),
                    success: function (data) {
                        if (data != undefined && data != '' && data.length) {
                            that.bindDistrict(data, "");

                            that.$shippingFee.text("Chưa tính");
                        }
                    }
                });
            }
            GHTKShipping.prototype.changePickAddress = function (e) {
                var isBizwebAddress = $(e).find("option:selected").attr("bizweb-address");
                if (isBizwebAddress)
                    this.$element.find("input[name=StoreAddressId]").val(this.pickHubId);
                else
                    this.$element.find("input[name=StoreAddressId]").val(0);
                this.calculateFee();
            }
            GHTKShipping.prototype.calculateFee = function () {
                Bizweb.Loading.start();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.ghtk + "/calculatefee",
                    method: "POST",
                    data: $(".fulfill-item-form").serialize(),
                    complete: function () {
                        Bizweb.Loading.stop();
                    },
                    success: function (data) {
                        if (data && data.fee)
                            that.$shippingFee.text(data.fee);
                    },
                    error: function (error) {
                        that.$shippingFee.text("Không xác định");
                    }
                });
            }

            return GHTKShipping;
        }();
    }.call(this),
    function () {
        Bizweb.VTPShipping = function () {
            function VTPShipping(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = element;
                this.$ele = $(element);

                this.$province = $(".shipping-provider-html.vtp-provider-context .province");
                this.$district = $(".shipping-provider-html.vtp-provider-context .district");
                this.$ward = $(".shipping-provider-html.vtp-provider-context .ward");
                this.$pick_ward = $(".shipping-provider-html.vtp-provider-context .pick-ward");
                this.$warehouse = $(".shipping-provider-html.vtp-provider-context .warehouse");
                this.$service_type = $(".shipping-provider-html.vtp-provider-context .service-type");
                this.$service = $(".shipping-provider-html.vtp-provider-context .service");

                this.$provinceHiddenInput = $(".shipping-provider-html.vtp-provider-context input[name=Province]");
                this.$districtHiddenInput = $(".shipping-provider-html.vtp-provider-context input[name=District]");

                var grams = 0;
                var gramsArr = Bindings.context($('.fulfill-item-form').get(0)).fulfillContext.grams;
                if (gramsArr) {
                    for (var i = 0; i < gramsArr.length; i++) {
                        grams += gramsArr[i].quantity * gramsArr[i].grams;
                    }
                }
                this.grams = grams;

                this.service_cache = [];
                this.district_cache = {};
                this.ward_cache = {};
                this.cached_ward_count = 0;
                this.cached_district_count = 0;
                this.shippingFee = "Chưa tính";
                this.debounceCalculateFee = _.debounce(this.calculateFee, 300);
                this.parentContext = Bindings.context($(".shipping-provider-html").get(0));
            }

            VTPShipping.prototype.loadData = function () {
                var that = this;
                var province = this.province;
                var district = this.district;
                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.vtp + "?province=" + province + "&district=" + district,
                        success: function (data) {
                            that.dataLoaded = true;
                            that.renderProvincesSelector(data.provinces, data.province);
                            that.renderPickHubsSelector(data.store_addresses);
                            that.bindSelectedProvinceInput();

                            that.store_addresses = data.store_addresses;

                            if (data.store_address_ward.length > 0) {
                                that.populateWardCache(data.store_address_ward, "d_" + data.store_address_ward[0].bw_district_code);
                                that.bindWard(data.store_address_ward, "", false);

                                if (district && district == that.store_address_district_code) {
                                    that.bindWard(data.store_address_ward, "", true);
                                }
                            }

                            if (data.wards.length > 0) {
                                that.populateWardCache(data.wards, "d_" + data.wards[0].bw_district_code);
                                that.bindWard(data.wards, "", true);
                            }

                            if (data.province != null) {
                                var districts = data.districts;
                                that.bindDistrict(districts, that.district);
                            } else {
                                that.changeProvince();
                            }
                        },
                        error: function (data) {
                            if (data.responseJSON) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            } else {
                                Bizweb.Flash.error("Địa chỉ giao hàng không đúng.");
                            }
                        }
                    });

                    this.changeServiceType(true);
                }
            }

            VTPShipping.prototype.postLoadData = function () {
                var that = this;
                $('select[multiple=multiple]').multiselect({
                    buttonClass: "ui-button btn-blank ",
                    buttonWidth: '100%',
                    buttonContainer: '<div class="btn-group" />',
                    nonSelectedText: 'Chọn dịch vụ cộng thêm',
                    allSelectedText: 'Toàn bộ dịch vụ cộng thêm',
                    checkboxClass: "next-checkbox",
                    useCheckboxOverlay: true,
                    onChange: function () {
                        that.debounceCalculateFee();
                    },
                    templates: {
                        button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span><svg class="next-icon next-icon--size-16"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#select-chevron"></use></svg></button>',
                        ul: '<ul class="multiselect-container dropdown-menu"></ul>',
                        li: '<li><a tabindex="0" class="next-input-wrapper"><label class="next-input-wrapper next-label"></label></a></li>',
                        divider: '<li class="multiselect-item divider"></li>',
                        liGroup: '<li class="multiselect-item multiselect-group"><label></label></li>',
                        checkboxOverlay: '<span class="next-checkbox--styled"><svg class="next-icon next-icon--size-10 checkmark"> <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#next-checkmark-thick"></use> </svg></span>'
                    }
                });
            }

            VTPShipping.prototype.renderProvincesSelector = function (provinces, selectedProvince) {
                var provinceOptionHtml = "";
                for (var i = 0; i < provinces.length; i++) {
                    var province = provinces[i];
                    provinceOptionHtml += "<option " + (selectedProvince == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                }

                this.$province.empty();
                this.$province.html(provinceOptionHtml);
            }

            VTPShipping.prototype.renderPickHubsSelector = function (storeAddresses) {
                var hubOptionHtml = "";

                for (var i = 0; i < storeAddresses.length; i++) {
                    var bizwebPickHub = storeAddresses[i];
                    hubOptionHtml += "<option " + (bizwebPickHub.default_address ? "selected='selected'" : "") + " value='" + bizwebPickHub.id + "' bizweb-address='true'>" + bizwebPickHub.name + "(" + bizwebPickHub.address + ")" + "</option>";

                    if (bizwebPickHub.default_address) {
                        this.store_address_province = bizwebPickHub.province ? bizwebPickHub.province : "Chưa cấu hình";
                        this.store_address_district = bizwebPickHub.district ? bizwebPickHub.district : "Chưa cấu hình";

                        this.store_address_district_code = bizwebPickHub.district_code;
                        Bindings.refreshImmediately();
                    }
                }

                this.$warehouse.empty();
                this.$warehouse.html(hubOptionHtml);
            }

            VTPShipping.prototype.changeStoreAddress = function (element) {
                var target = $(element);
                var storeAddress = this.store_addresses.find(function (element) {
                    return element.id == target.val();
                });

                this.changeWard(storeAddress.district_code, false);
                this.store_address_province = storeAddress.province ? storeAddress.province : "Chưa cấu hình";
                this.store_address_district = storeAddress.district ? storeAddress.district : "Chưa cấu hình";

                Bindings.refreshImmediately();

                this.debounceCalculateFee();
            }

            VTPShipping.prototype.bindDistrict = function (districts, selected) {
                var districtOptionHtml = "<option value=''>Chọn Quận / Huyện</option>";
                for (var i = 0; i < districts.length; i++) {
                    var district = districts[i];
                    districtOptionHtml += "<option " + (selected == district.code ? "selected='selected'" : "") + " value='" + district.code + "'>" + district.name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                this.bindSelectedDistrictInput();
            }

            VTPShipping.prototype.changeProvince = function () {
                this.bindSelectedProvinceInput();

                var province_code = this.$province.val();
                if (!province_code) {
                    this.bindDistrict([], "");
                    return false;
                }

                var cached_district = this.cached_district_count ? this.district_cache["p_" + province_code] : null;
                if (cached_district && cached_district.length) {
                    this.bindDistrict(cached_district, "");
                } else {
                    var that = this;
                    $.ajax({
                        url: Bizweb.routes.vtp + "/getdistrict?province=" + province_code,
                        success: function (data) {
                            if (data != undefined && data != '' && data.length) {
                                that.bindDistrict(data, "");
                                that.populateDistrictCache(data, "p_" + province_code);
                            }
                        }
                    });
                }

                this.shippingFee = "Chưa tính";
            }

            VTPShipping.prototype.changeServiceType = function (disableLoad) {
                var currentService = this.$service_type.val();
                if (!currentService) {
                    this.$service.empty();
                    this.$service.html("<option value=\"\" selected>Chọn dịch vụ</option>");
                } else {
                    if (this.service_cache.length > 0 && this.service_cache[currentService]) {
                        this.bindService(this.service_cache[currentService].services, "first");
                    } else {
                        var that = this;
                        $.ajax({
                            url: Bizweb.routes.vtp + "/getservice?type=" + currentService,
                            global: disableLoad == null || !disableLoad,
                            success: function (data) {
                                if (!!data) {
                                    if (data.services && data.services.length > 0) {
                                        that.bindService(data.services, "first");
                                        that.service_cache[currentService] = data;
                                    } else if (data.error) {
                                        Bizweb.Flash.error(data.error);
                                    }
                                }
                            }
                        });
                    }
                }
            }

            VTPShipping.prototype.changeDistrict = function () {
                this.bindSelectedDistrictInput();
                var district_code = this.$district.val();
                this.changeWard(district_code, true);

                this.debounceCalculateFee();
            }

            VTPShipping.prototype.changeWard = function (district_code, isShippingAddress) {
                if (!district_code) {
                    this.bindWard([], "", isShippingAddress);
                    return false;
                }

                var cached_ward = this.cached_ward_count ? this.ward_cache["d_" + district_code] : null;
                if (cached_ward && cached_ward.length) {
                    this.bindWard(cached_ward, "", isShippingAddress);
                } else {
                    var that = this;
                    $.ajax({
                        url: Bizweb.routes.vtp + "/getward?district=" + district_code,
                        success: function (data) {
                            if (data != undefined && data != '' && data.length) {
                                that.populateWardCache(data, "d_" + district_code);
                                that.bindWard(data, "", isShippingAddress);
                            }
                        }
                    });
                }
            }

            VTPShipping.prototype.bindWard = function (wards, selected, isShippingAddress) {
                var wardOptionHtml = "<option value=''>Chọn Phường / Xã</option>";
                for (var i = 0; i < wards.length; i++) {
                    var ward = wards[i];
                    wardOptionHtml += "<option " + (selected == ward.vtp_ward_id ? "selected='selected'" : "") + " value='" + ward.vtp_ward_id + "'>" + ward.vtp_ward_name + "</option>";
                }

                if (isShippingAddress) {
                    this.$ward.empty();
                    this.$ward.html(wardOptionHtml);
                } else {
                    this.$pick_ward.empty();
                    this.$pick_ward.html(wardOptionHtml);
                }
            }

            VTPShipping.prototype.populateDistrictCache = function (districts, provinceCode) {
                if (!!provinceCode) {
                    this.district_cache[provinceCode] = districts;
                    ++this.cached_district_count;
                }
            }

            VTPShipping.prototype.populateWardCache = function (wards, districtCode) {
                if (!!districtCode) {
                    this.ward_cache[districtCode] = wards;
                    ++this.cached_ward_count;
                }
            }

            VTPShipping.prototype.bindService = function (services, selected) {
                if ("first" == selected && !!services && services.length > 0) {
                    selected = services[0].service_code;
                }
                var optionHtml = "<option value=\"\">Chọn dịch vụ</option>";
                for (var i = 0; i < services.length; i++) {
                    var service = services[i];
                    optionHtml += "<option " + (selected == service.service_code ? "selected='selected'" : "") + " value='" + service.service_code + "'>" + service.service_name + "</option>";
                }

                this.$service.empty();
                this.$service.html(optionHtml);

                this.debounceCalculateFee();
            }

            VTPShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }

            VTPShipping.prototype.bindSelectedDistrictInput = function () {
                var selectedDistrict = this.$district.children("option:selected");
                if (selectedDistrict) {
                    this.$districtHiddenInput.val(selectedDistrict.text());
                }
            }

            VTPShipping.prototype.updateFee = function () {
                if (this.parentContext.shippingProviderId == 4) {
                    if (this.grams != 0) {
                        this.debounceCalculateFee();
                    } else {
                        this.shippingFee = "Chưa tính";
                    }
                }
            }

            VTPShipping.prototype.calculateFee = function () {
                Bizweb.Loading.start();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.vtp + "/calculatefee",
                    method: "POST",
                    data: $(".fulfill-item-form").serialize(),
                    complete: function () {
                        Bizweb.Loading.stop();
                    },
                    success: function (data) {
                        if (data && data.service_fee) {
                            that.shippingFee = data.service_fee[0].price.toLocaleString() + "₫";
                        }
                    },
                    error: function (error) {
                        if (error.responseJSON) {
                            that.shippingFee = error.responseJSON.error;
                        } else {
                            that.shippingFee = "Không xác định";
                        }
                    }
                });
            }

            return VTPShipping;
        }();
    }.call(this),
    function () {
        Bizweb.SGPShipping = function () {
            function SGPShipping(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = element;
                this.$element = $(element);
                this.$province = $(".shipping-provider-html.sgp-provider-context .province");
                this.$district = $(".shipping-provider-html.sgp-provider-context .district");
                this.$shippingFee = $(".shipping-provider-html.sgp-provider-context .shipping-fee");
                this.$provinceHiddenInput = $(".shipping-provider-html.sgp-provider-context input[name=Province]");
                this.$warehouse = $(".shipping-provider-html.sgp-provider-context .warehouse");
                var grams = 0;
                var gramsArr = Bindings.context($('.fulfill-item-form').get(0)).fulfillContext.grams;
                if (gramsArr) {
                    for (var i = 0; i < gramsArr.length; i++) {
                        grams += gramsArr[i].quantity * gramsArr[i].grams;
                    }
                }
                this.grams = grams;
            }

            SGPShipping.prototype.loadData = function () {
                var that = this;
                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.sgp + "?province=" + this.province,
                        success: function (data) {
                            that.dataLoaded = true;
                            that.renderProvincesSelector(data.provinces, data.province);
                            that.renderPickHubsSelector(data.store_addresses);
                            that.bindSelectedProvinceInput();

                            if (data.province != null) {
                                var districts = data.districts;
                                that.bindDistrict(data.locations);
                            }
                            else {
                                that.changeProvince(true);
                            }
                        },
                        error: function () {
                            Bizweb.Flash.error("Thông tin Saigon Post không đúng.");
                        }
                    });
                }
            }
            SGPShipping.prototype.renderProvincesSelector = function (provinces, selectedProvince) {
                var provinceOptionHtml = "";
                for (var i = 0; i < provinces.length; i++) {
                    var province = provinces[i];
                    provinceOptionHtml += "<option " + (selectedProvince == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                }

                this.$province.empty();
                this.$province.html(provinceOptionHtml);
            }
            SGPShipping.prototype.renderPickHubsSelector = function (storeAddresses) {
                var hubOptionHtml = "";

                for (var i = 0; i < storeAddresses.length; i++) {
                    var bizwebPickHub = storeAddresses[i];
                    hubOptionHtml += "<option " + (bizwebPickHub.default_address ? "selected='selected'" : "") + " value='" + bizwebPickHub.id + "' bizweb-address='true'>" + bizwebPickHub.name + "(" + bizwebPickHub.address + ")" + "</option>";
                }

                this.$warehouse.empty();
                this.$warehouse.html(hubOptionHtml);
            }
            SGPShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }
            SGPShipping.prototype.bindDistrict = function (locations) {
                var districtOptionHtml = "<span class='text-danger small'>Không hỗ trợ vận chuyển.</span>";

                if (locations && locations.length > 0) {
                    districtOptionHtml = "<select name='District' class='form-control' bind-event-change='calculateFee()'><option value='0' selected>Trung tâm tỉnh</option><option value='1'>Đi huyện xã</option></select>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                Bindings.bind(this.$district.get(0), this);
            }
            SGPShipping.prototype.changeProvince = function (noneUpdateFee) {
                this.bindSelectedProvinceInput();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.sgp + "/getlocation?province=" + $(".shipping-provider-html.sgp-provider-context .province").val(),
                    success: function (data) {
                        if (data) {
                            that.bindDistrict(data);

                            if (!noneUpdateFee)
                                that.calculateFee();
                        }
                    }
                });
            }
            SGPShipping.prototype.calculateFee = function () {
                Bizweb.Loading.start();
                var that = this;
                $.ajax({
                    url: Bizweb.routes.sgp + "/calculatefee",
                    method: "POST",
                    data: $(".fulfill-item-form").serialize(),
                    complete: function () {
                        Bizweb.Loading.stop();
                    },
                    success: function (data) {
                        if (data && data.fee)
                            that.$shippingFee.text(data.fee);
                    },
                    error: function (error) {
                        that.$shippingFee.text("Không xác định");
                    }
                });
            }

            return SGPShipping;
        }();
    }.call(this),
    function () {
        Bizweb.VNPShipping = function () {
            function VNPShipping(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$element = $(element);
                this.$province = $(".shipping-provider-html.vnp-provider-context .province");
                this.$district = $(".shipping-provider-html.vnp-provider-context .district");
                this.$provinceHiddenInput = $(".shipping-provider-html.vnp-provider-context input[name=Province]");
                this.$districtHiddenInput = $(".shipping-provider-html.vnp-provider-context input[name=District]");
                this.$warehouse = $(".shipping-provider-html.vnp-provider-context .warehouse");
            }

            VNPShipping.prototype.loadData = function () {
                var that = this;
                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.vnp + "?province=" + this.province,
                        success: function (data) {
                            that.dataLoaded = true;
                            that.renderProvincesSelector(data.provinces, data.province);
                            that.renderPickHubsSelector(data.store_addresses);

                            that.bindSelectedProvinceInput();

                            if (data.province != null) {
                                var districts = data.districts;
                                that.bindDistrict(districts, that.district);
                            }
                            else {
                                that.changeProvince();
                            }
                        },
                        error: function (data) {
                            if (data.responseJSON) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Địa chỉ giao hàng không đúng.");
                            }
                        }
                    });
                }
            }

            VNPShipping.prototype.renderProvincesSelector = function (provinces, selectedProvince) {
                var provinceOptionHtml = "";
                for (var i = 0; i < provinces.length; i++) {
                    var province = provinces[i];
                    provinceOptionHtml += "<option " + (selectedProvince == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                }

                this.$province.empty();
                this.$province.html(provinceOptionHtml);
            }
            VNPShipping.prototype.renderPickHubsSelector = function (storeAddresses) {
                var hubOptionHtml = "";

                for (var i = 0; i < storeAddresses.length; i++) {
                    var bizwebPickHub = storeAddresses[i];
                    hubOptionHtml += "<option " + (bizwebPickHub.default_address ? "selected='selected'" : "") + " value='" + bizwebPickHub.id + "' bizweb-address='true'>" + bizwebPickHub.name + "(" + bizwebPickHub.address + ")" + "</option>";
                }

                this.$warehouse.empty();
                this.$warehouse.html(hubOptionHtml);
            }
            VNPShipping.prototype.bindDistrict = function (districts, selected) {
                var districtOptionHtml = "<option sc='' value=''>Chọn quận/huyện</option>";
                for (var i = 0; i < districts.length; i++) {
                    var district = districts[i];
                    districtOptionHtml += "<option " + (selected == district.code ? "selected='selected'" : "") + " value='" + district.code + "'>" + district.name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                this.bindSelectedDistrictInput();
            }
            VNPShipping.prototype.changeProvince = function () {
                this.bindSelectedProvinceInput();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.vtp + "/getdistrict?province=" + $(".shipping-provider-html.vnp-provider-context .province").val(),
                    success: function (data) {
                        if (data != undefined && data != '' && data.length) {
                            that.bindDistrict(data, "");
                        }
                    }
                });
            }
            VNPShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }
            VNPShipping.prototype.bindSelectedDistrictInput = function () {
                var selectedDistrict = this.$district.children("option:selected");
                if (selectedDistrict) {
                    this.$districtHiddenInput.val(selectedDistrict.text());
                }
            }

            return VNPShipping;
        }();
    }.call(this),
    function () {
        Bizweb.DHLShipping = function () {
            function DHLShipping(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$ele = $(element);

                this.$warehouse = $(".shipping-provider-html.dhl-provider-context .warehouse");
                this.$province = $(".shipping-provider-html.dhl-provider-context .province");
                this.$district = $(".shipping-provider-html.dhl-provider-context .district");
                this.$service = $(".shipping-provider-html.dhl-provider-context .service");
                this.$provinceHiddenInput = $(".shipping-provider-html.dhl-provider-context input[name=Province]");
                this.$districtHiddenInput = $(".shipping-provider-html.dhl-provider-context input[name=District]");
                this.$pickHubHiddenInput = $(".shipping-provider-html.dhl-provider-context input[name=PickHub]");

                var grams = 0;
                var gramsArr = Bindings.context($('.fulfill-item-form').get(0)).fulfillContext.grams;
                if (gramsArr) {
                    for (var i = 0; i < gramsArr.length; i++) {
                        grams += gramsArr[i].quantity * gramsArr[i].grams;
                    }
                }
                this.grams = grams;
            }

            DHLShipping.prototype.loadData = function () {
                var that = this;

                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.dhl + "?province=" + this.province,
                        success: function (data) {
                            that.dataLoaded = true;

                            var hubOptionHtml = "";

                            that.$warehouse.empty();
                            that.$warehouse.html(hubOptionHtml);
                            that.bindSelectedPickHubInput();

                            var provinceOptionHtml = "";
                            for (var i = 0; i < data.provinces.length; i++) {
                                var province = data.provinces[i];
                                provinceOptionHtml += "<option " + (data.province == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                            }

                            that.$province.empty();
                            that.$province.html(provinceOptionHtml);
                            that.bindSelectedProvinceInput();

                            that.renderPickHubsSelector(data.store_addresses);

                            if (data.province != null) {
                                var districts = data.districts;
                                that.bindDistrict(districts, that.district);
                            }
                            else {
                                that.changeProvince();
                            }
                        },
                        error: function (data) {
                            if (data.responseJSON) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Thông tin giao hàng không đúng.");
                            }
                        }
                    });
                }
            }
            DHLShipping.prototype.bindDistrict = function (districts, selected) {
                var districtOptionHtml = "<option dhl='' dhl_support_type='' value=''>Chọn quận/huyện</option>";
                var toDistrict = "";
                for (var i = 0; i < districts.length; i++) {
                    var district = districts[i];
                    if (selected == district.bw_district_code) {
                        toDistrict = district.ghn_district_code;
                    }
                    districtOptionHtml += "<option " + (selected == district.bw_district_code ? "selected='selected'" : "") + " dhl='" + district.bw_district_code + "' dhl_support_type='" + district.dhl_support_type + "' value='" + district.bw_district_code + "'>" + district.bw_district_name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                this.changeDistrict(toDistrict);
            }
            DHLShipping.prototype.changeProvince = function () {
                this.bindSelectedProvinceInput();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.dhl + "/getdistrict?province=" + $(".shipping-provider-html.dhl-provider-context .province").val(),
                    success: function (data) {
                        if (data != undefined && data != '' && data.length) {
                            that.bindDistrict(data, "");
                        }
                    }
                });
            }
            DHLShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }
            DHLShipping.prototype.changeDistrict = function (supportType) {
                this.bindSelectedDistrictInput();

                var that = this;
                if (supportType == undefined) {
                    supportType = that.$district.find("option:selected").attr("dhl_support_type");
                }
                if (supportType != "") {
                    var serviceOptionHtml = "<option value='PDO'>PDO</option>";
                    if (supportType == "PDO/PDE") {
                        serviceOptionHtml += "<option value='PDE'>PDE</option>";
                    }

                    that.$service.empty();
                    that.$service.html(serviceOptionHtml);
                }
                else {
                    that.$service.empty();
                }
            }
            DHLShipping.prototype.bindSelectedDistrictInput = function () {
                var selectedDistrict = this.$district.children("option:selected");
                if (selectedDistrict) {
                    this.$districtHiddenInput.val(selectedDistrict.text());
                }
            }
            DHLShipping.prototype.bindSelectedPickHubInput = function () {
                var selectedPickHub = this.$warehouse.children("option:selected");
                if (selectedPickHub) {
                    this.$pickHubHiddenInput.val(selectedPickHub.text());
                }
            }
            DHLShipping.prototype.renderPickHubsSelector = function (storeAddresses) {
                var hubOptionHtml = "";

                for (var i = 0; i < storeAddresses.length; i++) {
                    var bizwebPickHub = storeAddresses[i];
                    hubOptionHtml += "<option " + (bizwebPickHub.default_address ? "selected='selected'" : "") + " value='" + bizwebPickHub.id + "' bizweb-address='true'>" + bizwebPickHub.name + "(" + bizwebPickHub.address + ")" + "</option>";
                }

                this.$warehouse.empty();
                this.$warehouse.html(hubOptionHtml);
            }

            return DHLShipping;
        }();
    }.call(this),
    function () {
        Bizweb.BoxmeShipping = function () {
            function BoxmeShipping(ele, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = ele;
                this.$element = $(ele);

                var grams = 0;
                var gramsArr = Bindings.context($('.fulfill-item-form').get(0)).fulfillContext.grams;
                if (gramsArr) {
                    for (var i = 0; i < gramsArr.length; i++) {
                        grams += gramsArr[i].quantity * gramsArr[i].grams;
                    }
                }
                this.grams = grams;

                this.parentContext = Bindings.context($(".shipping-provider-html").get(0));

                this.$province = $(".shipping-provider-html.boxme-provider-context .province");
                this.$district = $(".shipping-provider-html.boxme-provider-context .district");
                this.$provinceHiddenInput = $(".shipping-provider-html.boxme-provider-context input[name=Province]");
                this.$districtHiddenInput = $(".shipping-provider-html.boxme-provider-context input[name=District]");

                this.$pickupId = $(".shipping-provider-html.boxme-provider-context .warehouse");
                this.$pickupCountry = $(".shipping-provider-html.boxme-provider-context input[name=PickupCountry]");
                this.$pickHubName = $(".shipping-provider-html.boxme-provider-context input[name=PickHubName]");

                this.$deliveryService = $(".shipping-provider-html.boxme-provider-context .service");

                this.debounceCalculateFee = _.debounce(this.calculateFee, 300);
                this.pickHubs = [];
            }

            BoxmeShipping.prototype.loadData = function () {
                var that = this;
                if (!this.dataLoaded) {
                    $.ajax({
                        url: Bizweb.routes.boxme + "?province=" + this.province,
                        success: function (data) {
                            that.dataLoaded = true;
                            that.renderProvincesSelector(data.provinces, data.province);
                            that.renderPickHubsSelector(data.pick_hubs);
                            that.pickHubs = data.pick_hubs;

                            if (data.province != null) {
                                var districtMappings = data.district_mappings;
                                that.bindDistrict(districtMappings, that.district);
                            } else {
                                that.changeProvince();
                            }
                        },
                        error: function (data) {
                            if (data.responseJSON) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            } else {
                                Bizweb.Flash.error("Địa chỉ giao hàng không đúng.");
                            }
                        }
                    });
                }
            }

            BoxmeShipping.prototype.postLoadData = function () {

            }

            BoxmeShipping.prototype.renderProvincesSelector = function (provinces, selectedProvince) {
                var provinceOptionHtml = "";
                for (var i = 0; i < provinces.length; i++) {
                    var province = provinces[i];
                    provinceOptionHtml += "<option " + (selectedProvince == province.code ? "selected='selected'" : "") + " value='" + province.code + "'>" + province.name + "</option>";
                }

                this.$province.empty();
                this.$province.html(provinceOptionHtml);
            }
            
            BoxmeShipping.prototype.renderPickHubsSelector = function (pickHubs) {
                if (pickHubs.length > 0) {
                    var hubOptionHtml = "";
                    for (var i = 0; i < pickHubs.length; i++) {
                        var boxmePickHub = pickHubs[i];
                        if (boxmePickHub.active == 1) {
                            hubOptionHtml += "<option " + (boxmePickHub.priority == 1 ? "selected='selected'" : "") + " value='" + boxmePickHub.id + "' bizweb-address='false'>" + boxmePickHub.pickup_name + "</option>";
                        }
                        if (boxmePickHub.priority == 1) {
                            this.$pickupCountry.val(boxmePickHub.country)
                            this.$pickHubName.val(boxmePickHub.pickup_name)
                        }
                    }
                } else {
                    var hubOptionHtml = "<option value='0' bizweb-address='false'>Chưa có địa chỉ kho Boxme</option>"
                }

                this.$pickupId.empty();
                this.$pickupId.html(hubOptionHtml);
            }

            BoxmeShipping.prototype.bindDistrict = function (districtMappings, selected) {
                var districtOptionHtml = "<option boxme='' value=''>Chọn quận/huyện</option>";
                for (var i = 0; i < districtMappings.districts.length; i++) {
                    var district = districtMappings.districts[i];
                    districtOptionHtml += "<option " + (selected == district.bw_district_code ? "selected='selected'" : "") + " boxme='" + district.boxme_district_id + "' value='" + district.bw_district_code + "," + district.boxme_district_id + "'>" + district.bw_district_name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
                this.bindSelectedDistrictInput(!selected);
            }

            BoxmeShipping.prototype.changeProvince = function () {
                this.bindSelectedProvinceInput();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.boxme + "/getlocation?province=" + $(".shipping-provider-html.boxme-provider-context .province").val(),
                    success: function (data) {
                        if (data !== undefined && data !== null && data.districts.length) {
                            that.bindDistrict(data, "");
                        }
                    }
                });

                this.resetDeliveryService();
            }

            BoxmeShipping.prototype.bindSelectedProvinceInput = function () {
                var selectedProvince = this.$province.children("option:selected");
                if (selectedProvince) {
                    this.$provinceHiddenInput.val(selectedProvince.text());
                }
            }

            BoxmeShipping.prototype.bindSelectedDistrictInput = function (notUpdate) {
                var selectedDistrict = this.$district.children("option:selected");
                if (selectedDistrict) {
                    this.$districtHiddenInput.val(selectedDistrict.text());
                }
                if (!notUpdate) {
                    this.calculateFee();
                }
            }

            BoxmeShipping.prototype.changePickHub = function () {
                var selectedPickupId = this.$pickupId.children("option:selected");
                for (var i = 0; i < this.pickHubs.length; i++) {
                    if (("" + this.pickHubs[i].id) === selectedPickupId) {
                        this.$pickupCountry.val(this.pickHubs[i].country)
                        this.$pickHubName.val(this.pickHubs[i].pickup_name)
                        break;
                    }
                }
                this.debounceCalculateFee();
            }

            BoxmeShipping.prototype.resetDeliveryService = function () {
                this.$deliveryService.empty();
                this.$deliveryService.html("<option value=''>Chọn dịch vụ</option>");
            }

            BoxmeShipping.prototype.bindDeliveryService = function (couriers) {
                var deliveryServiceOptionHtml = "<option value=''>Chọn dịch vụ</option>";
                if (couriers.length >= 1) {
                    var first = couriers[0];
                    deliveryServiceOptionHtml += "<option selected='selected' value='" + first.service_code + "'>" + first.courier_name + " - " + first.service_name + " - " + first.total_fee + "₫" + "</option>";
                    for (var i = 1; i < couriers.length; i++) {
                        var courier = couriers[i];
                        deliveryServiceOptionHtml += "<option value='" + courier.service_code + "'>" + courier.courier_name + " - " + courier.service_name + " - " + courier.total_fee + "₫" + "</option>";
                    }
                }
                
                this.$deliveryService.empty();
                this.$deliveryService.html(deliveryServiceOptionHtml);
            }
            
            BoxmeShipping.prototype.calculateFee = function () {
                Bizweb.Loading.start();

                var that = this;
                $.ajax({
                    url: Bizweb.routes.boxme + "/calculateshippingfee",
                    method: "POST",
                    data: $(".fulfill-item-form").serialize(),
                    complete: function () {
                        Bizweb.Loading.stop();
                    },
                    success: function (data) {
                        that.bindDeliveryService(data.services);
                    },
                    error: function (error) {
                        if (error.responseJSON) {
                            Bizweb.Flash.error(error.responseJSON.error)
                        }
                    }
                });
            }

            BoxmeShipping.prototype.updateFee = function () {
                if (this.parentContext.shippingProviderId == 8 && this.grams != 0) {
                    this.debounceCalculateFee();
                } else {
                    Bizweb.Flash.error("Tổng khối lượng phải lớn hơn 0");
                }
            }

            return BoxmeShipping;
        }();
    }.call(this),
    function () {
        Bizweb.ShippingAreaSetting = function () {
            function r(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$ele = $(element);

                initAutoNumeric();
            };

            return r;
        }();
    }.call(this),
    function () {
        Bizweb.ShippingRate = function () {
            this.loaded = false;
            function r(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$ele = $(element);
            };

            r.prototype.toggleShippingRateEditor = function () {
                return this.selected = !this.selected;
            }

            r.prototype.showModifiedMoney = function (value1, value2, cultureCode) {
                if (value1) {
                    value1 = value1.toString().replace(/,/g, "");
                }
                if (value2) {
                    value2 = value2.toString().replace(/,/g, "");
                }
                var price = this.calculatePrice(value1, value2);
                return this.textMoneyWithSymbol(price, cultureCode);
            }

            r.prototype.calculatePrice = function (value1, value2) {
                if (Bizweb.Utility.isNumeric(value1)) {
                    if (Bizweb.Utility.isNumeric(value2)) {
                        return parseInt(value1) + parseInt(value2);
                    } else {
                        return parseInt(value1);
                    }
                } else {
                    if (Bizweb.Utility.isNumeric(value2)) {
                        return parseInt(value2);
                    } else {
                        return 0;
                    }
                }
            }

            r.prototype.textMoneyWithSymbol = function (value, cultureCode) {
                Globalize.culture = Globalize.cultures[cultureCode];
                if (value) {
                    value = parseFloat(value.toString().replace(/,/g, ""));
                }
                if (!Bizweb.Utility.isNumeric(value)) {
                    value = 0;
                }
                var formatedValue = Globalize.format(parseInt(value), "c", Globalize.culture.name);
                if (Globalize.culture.numberFormat["."] == ",") {
                    formatedValue = formatedValue.replace(/\./g, '..');
                    formatedValue = formatedValue.replace(/,/g, ".");
                    formatedValue = formatedValue.replace(/\.\./g, ",");
                }
                return formatedValue;
            }
            r.prototype.showShippingRate = function () {
                var that = this;
                if (!this.loaded) {
                    this.loaded = true;
                    Page.refresh(
                        {
                            url: "/admin/settings/shipping/editshippingrate/" + this.id,
                            updatePushState: false,
                            onlyKeys: ["rate-" + this.id],
                            partialReplace: true
                        },
                        function () {
                            that.selected = !that.selected;
                            reSetAutoNumeric();
                        });
                }
                else {
                    this.selected = !this.selected;
                    reSetAutoNumeric();
                }
            }

            return r;
        }();
    }.call(this),
    function () {
        var applyObjectToEvent = function (event, context) {
            return function () {
                return event.apply(context, arguments)
            }
        }
        Bizweb.Discount = function () {
            function Discount(element, options) {
                this.prepareSubmitForm = applyObjectToEvent(this.prepareSubmitForm, this);
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$form = $(element);
                this.$form.on("submit", this.prepareSubmitForm);

                initAutoNumeric();
            };

            Discount.prototype.generateCode = function () {
                var t, e, n, o, i, code;
                for (t = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ", code = "", i = [], e = o = 8; o >= 1; e = --o) {
                    n = Math.floor(Math.random() * t.length);
                    i.push(code += t.substring(n, n + 1));
                }
                $("#discount_code").val(code);
            }
            Discount.prototype.disableHiddenInputs = function () {
                this.$form.find(".disable-hidden-input:visible :input").prop("disabled", false);
                this.$form.find(".disable-hidden-input:not(:visible) :input").prop("disabled", "disabled");
            };
            Discount.prototype.prepareSubmitForm = function () {
                unSetAutoNumericForm()
                this.disableHiddenInputs();
            };
            Discount.prototype.unlimitedUsageChanged = function () {
                var noLimit = $('input[name="NoLimit"]').prop("checked");
                if (noLimit) {
                    $('.infinity').removeClass('hide');
                    $('#discount_usage_limit').prop("disabled", true);
                    $('#discount_usage_limit').val("");
                } else {
                    $('.infinity').addClass('hide');
                    $('#discount_usage_limit').prop("disabled", false);
                    $("#discount_usage_limit").focus();
                }
            }

            Discount.prototype.neverExpiresChanged = function () {
                var noLimit = $('input[name="NeverExpires"]').prop("checked");
                if (noLimit) {
                    $('input[name="Ends"]').prop("disabled", true);
                } else {
                    $('input[name="Ends"]').prop("disabled", false);
                }
            }

            Discount.prototype.startsAtChanged = function () {
                var startAt = $('input[name=StartsAt]').val().split("/");
                var endAt = $('input[name=EndsAt]').val().split("/");

                var startAtDate = new Date(startAt[2], startAt[1] - 1, startAt[0]);
                var endAtDate = new Date(endAt[2], endAt[1] - 1, endAt[0]);

                var date = new Date();
                if (startAtDate <= endAtDate) {
                    date = endAtDate;
                } else {
                    date = startAtDate;
                }

                $('input[name=EndsAt]').datepicker("setDate", date);
                $('input[name=EndsAt]').datepicker('option', 'minDate', date);
            }

            return Discount;
        }();
    }.call(this),
    function () {
        function convertStringToDate(dateString) {
            var parts = dateString.split("/");
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        var g = {
            CART: "cart",
            PRODUCTS: "products",
            COLLECTIONS: "collections"
        }, y = {
            FREE_SHIPPING: "free_shipping",
            AMOUNT: "amount",
            PERCENTAGE: "percentage"
        }, v = {
            ALL: "all",
            PREREQUISITE: "prerequisite"
        }, s = {
            ALL: "all",
            SELECTED: "selected"
        };

        function findProductIndex(id, products) {
            var length = products == null ? 0 : products.length;
            if (0 == length) {
                return -1;
            }

            for (var i = 0; i < length; i++) {
                if (products[i].product.id == id) {
                    return i;
                }
            }

            return -1;
        }

        function findIndex(id, array) {
            var length = array == null ? 0 : array.length;
            if (0 == length) {
                return -1;
            }

            for (var i = 0; i < length; i++) {
                if (array[i].id == id) {
                    return i;
                }
            }

            return -1;
        }

        function find(id, array) {
            var length = array == null ? 0 : array.length;
            if (0 == length) {
                return null;
            }

            for (var i = 0; i < length; i++) {
                if (array[i].id == id) {
                    return array[i];
                }
            }

            return null;
        }

        function bindChecked(type, datas, $html, isSelected) {
            for (var i = 0; i < datas.length; i++) {
                var data = datas[i];

                var element = $html.find("#" + type + "_checkbox_" + data.id);
                element.prop('checked', true);

                if (isSelected)
                    element.parents('div[selectable]').removeAttr('data-bind-event-click').removeAttr('define').removeAttr('selectable').addClass('next-list__item--disabled');

                element = null;
            }
        }

        function bindCheckedProducts(products, $html, isSelected) {
            for (var i = 0; i < products.length; i++) {
                var data = products[i];
                var productCheckbox = $html.find("#product_checkbox_" + data.product.id);

                if (data.product.is_default) {
                    productCheckbox.prop('checked', true);

                    if (isSelected)
                        productCheckbox.parents('div[selectable]').removeAttr('data-bind-event-click').removeAttr('define').removeAttr('selectable').addClass('next-list__item--disabled');
                } else {
                    var variants = data.variants;
                    if (variants.length > 0) {
                        for (var j = 0; j < variants.length; j++) {
                            var variant = variants[j];
                            var variantCheckbox = $html.find("#variant_checkbox_" + variant.id);
                            variantCheckbox.prop('checked', true);
                            variantCheckbox.parents('div[selectable]').removeAttr('data-bind-event-click').removeAttr('define').removeAttr('selectable').addClass('next-list__item--disabled');

                            variantCheckbox = null;
                        }
                        var totalLength = $html.find(".variant_checkbox_product_" + data.product.id).length;
                        if (totalLength > variants.length) {
                            productCheckbox.prop("indeterminate", true);
                            productCheckbox.prop("checked", false);
                        } else {
                            productCheckbox.prop("indeterminate", false);
                            productCheckbox.prop("checked", true);

                            if (isSelected) {
                                productCheckbox.parent().addClass('hidden');
                                productCheckbox.parents('div[selectable]').removeAttr('data-bind-event-click').removeAttr('define').removeAttr('selectable').addClass('next-list__item--disabled');
                            }
                        }
                    }
                }

                productCheckbox = null;
            }
        }

        function getCustomerGroups() {
            var e = $(".savedsearch-resource li").map(function () {
                return $(this).find(".ui-stack-item").text().trim();
            }).get();
            return e;
        };
        function getMoment(e) {
            return moment(e, "DD/MM/YYYY");
        };
        function checkDate(e) {
            return e === moment().format("DD/MM/YYYY");
        };
        function getDateString(e) {
            var t = moment(e, "DD/MM/YYYY").get("year"),
                i = moment().get("year"),
                n = t === i ? "DD/MM" : "DD/MM/YYYY";
            return moment(e, "DD/MM/YYYY").format(n)
        };
        function getVariantTitle(v) {
            var s = v.option1;
            if (v.option2 != null && v.option2 != "")
                s = s + " / " + v.option2;
            if (v.option3 != null && v.option3 != "")
                s = s + " / " + v.option3;

            return s;
        };

        var applyObjectToEvent = function (event, context) {
            return function () {
                return event.apply(context, arguments)
            }
        }

        Bizweb.DiscountNext = function () {
            function DiscountNext(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.ajax = null;
                this.element = element;
                this.$form = $(element);
                if (this.products == null) {
                    this.products = [];
                }
                if (this.collections == null) {
                    this.collections = [];
                }
                if (this.provinces == null) {
                    this.provinces = [];
                }
                if (this.savedsearchs == null) {
                    this.savedsearchs = [];
                }
                this.maxId = 0;
                this.endLoad = false;

                this.initEventHandler();

                this.submitQuery = _.debounce(this.submitQuery, 300);
                this.tempProduct = [];
                this.tempCollection = [];
                this.tempProvince = [];
                this.tempSavedSearch = [];

                initAutoNumeric();

                $('#frmEditDiscount').submit(function () {
                    unSetAutoNumericForm();
                    return true;
                });
            };

            DiscountNext.prototype.initEventHandler = function () {
                this.modalOpenHandler = applyObjectToEvent(this.modalOpenHandler, this);
                this.modalCloseHandler = applyObjectToEvent(this.modalCloseHandler, this);

                $(document).on('modal:opened', '.modal', this.modalOpenHandler);
                $(document).on('modal:close', '.modal', this.modalCloseHandler);

                //clean up before replace
                document.addEventListener('page:before-replace', function () {
                    $(document).off('modal:opened', '.modal', this.modalOpenHandler);
                    $(document).off('modal:close', '.modal', this.modalCloseHandler);
                }, { once: true });
            }
            DiscountNext.prototype.modalOpenHandler = function () {
                var that = this;
                setTimeout(function () {
                    $(".modal .js-resource-browser-input").focus();
                }, 300);
                if (this.appliesTo == g.PRODUCTS || this.appliesTo == g.COLLECTIONS) {
                    $('.ui-modal__body').on('scroll', function () {
                        var $this = $(this);
                        if ($this.scrollTop() + $this.innerHeight() >= $this[0].scrollHeight - 100) {
                            if (!that.loading && !that.endLoad) {
                                that.loading = true;
                                Bindings.refreshImmediately();
                                that.submitQuery();
                            }
                        }
                    });
                }
            }
            DiscountNext.prototype.modalCloseHandler = function () {
                this.input = "";
                this.maxId = 0;
                if (this.ajax) {
                    this.ajax.abort();
                }
                this.endLoad = false;
                this.loading = false;

                Bindings.refreshImmediately();
            }

            DiscountNext.prototype.summaryIsEmpty = function () {
                return !(this.code || this.showAppliedSummary() || this.showApplicationMethodSummary() || this.showUsageLimitSummary() || this.minimumPurchase && unFomatPrice(this.minimumPurchaseValue) > 0 || this.showDateSummary() || this.showCustomerGroupSummary())
            }
            DiscountNext.prototype.showAppliedSummary = function () {
                return this.amountValue && !isNaN(unFomatPrice(this.amountValue)) && this.discountType === y.AMOUNT || this.percentageValue && !isNaN(this.percentageValue) && this.discountType === y.PERCENTAGE || this.discountType === y.FREE_SHIPPING
            }
            DiscountNext.prototype.showApplicationMethodSummary = function () {
                return this.discountType === y.AMOUNT && this.appliesTo !== g.CART
            }
            DiscountNext.prototype.showUsageLimitSummary = function () {
                return this.limitedUseSelected && this.limitedUseTotal > 0 || this.customerLimit
            }
            DiscountNext.prototype.showDateSummary = function () {
                if (!this.code || !this.showAppliedSummary()) return !1;

                var e = getMoment(this.startDate).isValid();
                if (this.scheduleEndDate) {
                    var t = getMoment(this.endDate).isValid();
                    return e && t
                }
                return e
            }
            DiscountNext.prototype.showCustomerGroupSummary = function () {
                var e = getCustomerGroups(),
                            t = e.length;
                return this.customerSelection === v.PREREQUISITE && t > 0
            }

            DiscountNext.prototype.appliedSummary = function () {
                var e = money(unFomatPrice(this.amountValue), this.money_format),
                    t = void 0;
                switch (this.discountType) {
                    case y.FREE_SHIPPING:
                        t = "Miễn phí vận chuyển cho toàn bộ đơn hàng";
                        break;
                    case y.AMOUNT:
                        t = "Giảm " + e + " cho " + this.selectedItemsSummary();
                        break;
                    case y.PERCENTAGE:
                        t = "Giảm " + this.percentageValue + "% cho " + this.selectedItemsSummary()
                }
                return t
            }
            DiscountNext.prototype.selectedItemsSummary = function () {
                var e = this.collections,
                    t = void 0;
                switch (this.appliesTo) {
                    case g.CART:
                        t = "toàn bộ đơn hàng";
                        break;
                    case g.PRODUCTS:
                        t = this.selectedProductsSummary();
                        break;
                    case g.COLLECTIONS:
                        t = e.length > 1 ? e.length + " danh mục" : 1 === e.length ? "danh mục " + e[0].name : "danh mục"
                }
                return t
            }
            DiscountNext.prototype.minimumPurchaseSummary = function () {
                return "Tổng giá trị sản phẩm được khuyến mãi tối thiểu " + money(unFomatPrice(this.minimumPurchaseValue), this.money_format)
            }
            DiscountNext.prototype.applicationMethodSummary = function () {
                return this.applicationMethod ? "Áp dụng 1 lần cho mỗi đơn hàng" : "Áp dụng cho từng mặt hàng trong giỏ hàng"
            }
            DiscountNext.prototype.shippingCountrySummary = function () {
                var e = this.provinces,
                    t = this.countrySelection,
                    i = void 0;
                if (this.discountType === y.FREE_SHIPPING) switch (t) {
                    case s.ALL:
                        i = "Tất cả tỉnh/thành";
                        break;
                    case s.SELECTED:
                        i = 1 === e.length ? "Áp dụng với " + e[0].name : "Áp dụng với " + e.length + " tỉnh/thành"
                        break;
                }
                return i;
            }
            DiscountNext.prototype.customerGroupSummary = function () {
                var e = getCustomerGroups(),
                    t = e.length,
                    i = void 0;

                if (this.customerSelection === v.PREREQUISITE)
                    if (1 === t) {
                        i = "Áp dụng với nhóm khách hàng " + e[0]
                    } else i = "Áp dụng với " + t + " nhóm khách hàng";
                return i
            }
            DiscountNext.prototype.shippingRateSummary = function () {
                return "Áp dụng với phí vận chuyển dưới " + money(unFomatPrice(this.maximumShippingRateValue), this.money_format)
            }
            DiscountNext.prototype.showShippingRateSummary = function () {
                return this.discountType === y.FREE_SHIPPING && this.maximumShippingRate && unFomatPrice(this.maximumShippingRateValue) > 0
            }
            DiscountNext.prototype.usageLimitSummary = function () {
                var e = void 0,
                    t = parseInt(this.limitedUseTotal, 10);
                return this.limitedUseSelected && t > 0 ? (e = "Mã được phép sử dụng " + t + " lần", this.customerLimit && (e += ", mỗi khách hàng được sử dụng 1 lần")) : this.customerLimit && (e = "Mỗi khách hàng được sử dụng 1 lần"), e
            }
            DiscountNext.prototype.dateSummary = function () {
                return getMoment(this.startDate).isSame(getMoment(this.endDate)) && this.scheduleEndDate ? "Áp dụng từ " + (checkDate(this.startDate) ? this.startsTimeDate + " hôm nay" : getDateString(this.startDate)) : "" + this.dateSummaryStart() + this.dateSummaryEnd()
            }
            DiscountNext.prototype.dateSummaryStart = function () {
                return checkDate(this.startDate) ? "Áp dụng từ " + this.startsTimeDate + " hôm nay" : "Áp dụng từ " + this.startsTimeDate + " " + getDateString(this.startDate)
            }
            DiscountNext.prototype.dateSummaryEnd = function () {
                return this.scheduleEndDate ? " đến " + this.endsTimeDate + " " + getDateString(this.endDate) : ""
            }

            DiscountNext.prototype.selectedProductsSummary = function () {
                var e = this.products;
                return (e.length > 1 ? e.length + " sản phẩm" : 1 === e.length ? (e[0].variants != null && e[0].variants.length == 1 ? "sản phẩm " + e[0].product.name + " (" + getVariantTitle(e[0].variants[0]) + ")" : "sản phẩm " + e[0].product.name) : "sản phẩm");
            }

            DiscountNext.prototype.toggleCustomerLimit = function () {
                this.customerLimit = !this.customerLimit;
            }
            DiscountNext.prototype.discountTypeChanged = function () {
                this.discountType === y.FREE_SHIPPING ? (this.appliesTo = g.CART, this.disableAppliesTo = !0) : this.disableAppliesTo = !1
            }
            DiscountNext.prototype.generateCode = function () {
                var e, t, i, n;
                for (e = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ", this.code = "", i = [], t = 12; t >= 1; --t) n = Math.floor(Math.random() * e.length), i.push(this.code += e.substring(n, n + 1));
                return i
            }
            DiscountNext.prototype.startsOnChanged = function () {
                var start_date = $('input[name=startsDateOn]').val();
                var end_date = $('input[name=endsDateOn]').val();
                var startDate = convertStringToDate(start_date);
                var endDate = convertStringToDate(end_date);
                if (startDate > endDate) {
                    var startDate = start_date.split("/");
                    var iso_date = new Date(startDate[2], startDate[1] - 1, startDate[0]);
                    $('input[name=endsDateOn]').datepicker('setDate', iso_date);
                }
                $('input[name=endsDateOn]').datepicker('setStartDate', start_date);
            }
            DiscountNext.prototype.openModal = function (evt) {
                this.maxId = 0;
                var that = this,
                    isSavedSearch = $(evt.target).hasClass("saved-search-input");

                if (!isSavedSearch && (this.discountType == y.PERCENTAGE || this.discountType == y.AMOUNT)) {
                    switch (this.appliesTo) {
                        case g.PRODUCTS:
                            this.searchProductModal.show();
                            this.submitQuery();
                            break;
                        case g.COLLECTIONS:
                            this.searchCollectionModal.show();
                            this.submitQuery();
                            break;
                    }
                } else {
                    if (isSavedSearch) {
                        this.searchSavedSearchModal.show();
                    } else {
                        this.searchProvinceModal.show();
                    }
                    setTimeout(function () {
                        var $result;
                        if (isSavedSearch) {
                            $result = $(".savedsearch-results");
                            bindChecked("savedsearch", that.tempSavedSearch, $result, false);
                            bindChecked("savedsearch", that.savedsearchs, $result, true);
                        } else {
                            $result = $(".province-results");
                            bindChecked("province", that.tempProvince, $result, false);
                            bindChecked("province", that.provinces, $result, true);
                        }
                    }, 300);
                }
            }
            DiscountNext.prototype.submitQuery = function (newSearch) {
                var that = this;
                if (newSearch) {
                    that.maxId = 0;
                }
                $.ajax({
                    url: "/admin/discounts/search" + that.appliesTo + "?query=" + that.input + "&maxId=" + that.maxId,
                    success: function (data, textStatus, xhr) {
                        that.loading = false;
                        if (xhr.status == 200) {
                            var $html = $(data);
                            switch (that.appliesTo) {
                                case g.PRODUCTS:
                                    bindCheckedProducts(that.products, $html, true);
                                    bindCheckedProducts(that.tempProduct, $html, false);
                                    break;
                                case g.COLLECTIONS:
                                    bindChecked("collection", that.collections, $html, true);
                                    bindChecked("collection", that.tempCollection, $html, false);
                                    break;
                            }

                            if (newSearch) {
                                $(".modal-content .js-results-list").html($html);
                            } else {
                                $(".modal-content .js-results-list").append($html);
                            }

                            that.maxId = $(".modal-content .js-results-list li.li-root").last().attr("data-id");
                            Bindings.bind($(".modal-content .js-results-list").get(0));
                        } else if (xhr.status == 204) {
                            if (that.maxId == 0) {
                                $(".modal-content .js-results-list").html("<li>Không tìm thấy kết quả phù hợp</li>");
                            }
                            that.endLoad = true;
                        }
                    },
                });
            }
            DiscountNext.prototype.isloading = function () {
                return this.loading;
            }
            DiscountNext.prototype.toggleDefaultProduct = function (defaultProduct) {
                var found = findProductIndex(defaultProduct.id, this.tempProduct);

                if (found > -1) {
                    this.tempProduct.splice(found, 1);
                } else {
                    this.tempProduct.push({ product: defaultProduct });
                }
                $("#product_checkbox_" + defaultProduct.id).prop("checked", found == -1);
            }
            DiscountNext.prototype.toggleCollection = function (collection) {
                var found = findIndex(collection.id, this.tempCollection);

                if (found > -1) {
                    this.tempCollection.splice(found, 1);
                } else {
                    this.tempCollection.push(collection);
                }
                $("#collection_checkbox_" + collection.id).prop("checked", found == -1);
            }

            DiscountNext.prototype.toggleProvince = function (province) {
                var found = findIndex(province.id, this.tempProvince);

                if (found > -1) {
                    this.tempProvince.splice(found, 1);
                } else {
                    this.tempProvince.push(province);
                }
                $("#province_checkbox_" + province.id).prop("checked", found == -1);
            }
            DiscountNext.prototype.toggleSavedSearch = function (savedsearch) {
                var found = findIndex(savedsearch.id, this.tempSavedSearch);

                if (found > -1) {
                    this.tempSavedSearch.splice(found, 1);
                } else {
                    this.tempSavedSearch.push(savedsearch);
                }
                $("#savedsearch_checkbox_" + savedsearch.id).prop("checked", found == -1);
            }
            DiscountNext.prototype.toggleVariant = function (evt, e, id, variantIndex, product) {
                var result = !$(e).find("#variant_checkbox_" + id).is(":checked");
                var isCheckboxCheck = evt.target.tagName == "INPUT";
                if (isCheckboxCheck) {
                    result = !result;
                }
                $("#variant_checkbox_" + id).prop('checked', result);

                var clazzCheckbox = ".next-input-wrapper:not(.hide) .variant_checkbox_product_" + product.id;
                var total = $(clazzCheckbox).length;
                var totalChecked = $(clazzCheckbox + ":checked").length;
                if (totalChecked > 0 && totalChecked < total) {
                    $("#product_checkbox_" + product.id).prop("indeterminate", true);
                }
                else if (totalChecked == total) {
                    $("#product_checkbox_" + product.id).prop("indeterminate", false);
                    $("#product_checkbox_" + product.id).prop("checked", true);
                }
                else if (totalChecked == 0) {
                    $("#product_checkbox_" + product.id).prop("indeterminate", false);
                    $("#product_checkbox_" + product.id).prop("checked", false);
                }
                var found = findProductIndex(product.id, this.tempProduct);

                if (found > -1) {
                    var variants = this.tempProduct[found].variants;
                    var variantToggle = product.variants[variantIndex];
                    var found2 = findIndex(variantToggle.id, variants);

                    if (found2 > -1) {
                        if (!result) {
                            if (variants.length == 1) {
                                this.tempProduct.splice(found, 1);
                            } else {
                                this.tempProduct[found].variants.splice(found2, 1);
                            }
                        }
                    } else {
                        if (result) {
                            this.tempProduct[found].variants.push(product.variants[variantIndex]);
                        }
                    }
                } else {
                    if (result) {
                        this.tempProduct.push({ product: product, variants: [product.variants[variantIndex]] });
                    }
                }
            }

            DiscountNext.prototype.addProduct = function () {
                for (var i = 0; i < this.tempProduct.length; i++) {
                    var data = this.tempProduct[i];
                    //Kiem tra xem đã có chưa
                    var found = findProductIndex(data.product.id, this.products);
                    if (found > -1) {
                        var exist = this.products[found];
                        if (exist.product.variants != null) {
                            for (var k = 0; k < data.variants.length; k++) {
                                var found2 = findIndex(data.variants[k].id, exist.product.variants);
                                if (found2 == -1) {
                                    exist.product.variants.push(data.variants[k]);
                                }
                            }
                            Array.prototype.push.apply(exist.variants, data.variants);
                        }
                    } else {
                        this.products.push(data);
                    }
                }

                var template = $('#product-add-template').html();
                var html = Mustache.render(template, {
                    datas: this.products
                });
                var $html = $(html);
                $(".product-resource").html($html);
                Bindings.bind($html[0]);

                this.searchProductModal.hide();
                this.tempProduct = [];

                Bindings.context(document.body).form._updateDirtyState();
            }
            DiscountNext.prototype.addCollection = function () {
                for (var i = 0; i < this.tempCollection.length; i++) {
                    var data = this.tempCollection[i];
                    //Kiem tra xem đã có chưa
                    var found = findIndex(data.id, this.collections);
                    if (found == -1) {
                        this.collections.push(data);
                    }
                }

                var template = $('#collection-add-template').html();
                var html = Mustache.render(template, {
                    datas: this.collections
                });
                var $html = $(html);
                $(".collection-resource").html($html);
                Bindings.bind($html[0]);

                this.searchCollectionModal.hide();
                this.tempCollection = [];

                Bindings.context(document.body).form._updateDirtyState();
            }
            DiscountNext.prototype.addProvince = function () {
                for (var i = 0; i < this.tempProvince.length; i++) {
                    var data = this.tempProvince[i];
                    //Kiem tra xem đã có chưa
                    var found = findIndex(data.id, this.provinces);
                    if (found == -1) {
                        this.provinces.push(data);
                    }
                }

                var template = $('#province-add-template').html();
                var html = Mustache.render(template, {
                    datas: this.provinces
                });
                var $html = $(html);
                $(".province-resource").html($html);
                Bindings.bind($html[0]);

                this.searchProvinceModal.hide();
                this.tempProvince = [];

                Bindings.context(document.body).form._updateDirtyState();
            }
            DiscountNext.prototype.addSavedSearch = function () {
                for (var i = 0; i < this.tempSavedSearch.length; i++) {
                    var data = this.tempSavedSearch[i];
                    //Kiem tra xem đã có chưa
                    var found = findIndex(data.id, this.savedsearchs);
                    if (found == -1) {
                        this.savedsearchs.push(data);
                    }
                }

                var template = $('#savedsearch-add-template').html();
                var html = Mustache.render(template, {
                    datas: this.savedsearchs
                });
                var $html = $(html);
                $(".savedsearch-resource").html($html);
                Bindings.bind($html[0]);

                this.searchSavedSearchModal.hide();
                this.tempSavedSearch = [];

                Bindings.context(document.body).form._updateDirtyState();
            }

            DiscountNext.prototype.removeProductSelected = function (productId) {
                var found = findProductIndex(productId, this.products);
                if (found > -1) {
                    this.products.splice(found, 1);
                    $(".product-selected-li-" + productId).remove();
                    Bindings.context(document.body).form._updateDirtyState();
                }
            }
            DiscountNext.prototype.removeCollectionSelected = function (collectionId) {
                var found = findIndex(collectionId, this.collections);
                if (found > -1) {
                    this.collections.splice(found, 1);
                    $(".collection-selected-li-" + collectionId).remove();
                    Bindings.context(document.body).form._updateDirtyState();
                }
            }
            DiscountNext.prototype.removeProvinceSelected = function (provinceId) {
                var found = findIndex(provinceId, this.provinces);
                if (found > -1) {
                    this.provinces.splice(found, 1);
                    $(".province-selected-li-" + provinceId).remove();
                    Bindings.context(document.body).form._updateDirtyState();
                }
            }
            DiscountNext.prototype.removeSavedSearchSelected = function (savedSearchId) {
                var found = findIndex(savedSearchId, this.savedsearchs);
                if (found > -1) {
                    this.savedsearchs.splice(found, 1);
                    $(".savedsearch-selected-li-" + savedSearchId).remove();
                    Bindings.context(document.body).form._updateDirtyState();
                }
            }
            DiscountNext.prototype.removeVariantSelected = function (variantId, productId) {
                var found = findProductIndex(productId, this.products);
                if (found > -1) {
                    var data = this.products[found];
                    var found2 = findIndex(variantId, data.variants);
                    if (found2 > -1) {
                        data.variants.splice(found2, 1);
                    }
                    if (data.variants.length == 0) {
                        this.products.splice(found, 1);
                        $(".product-selected-li-" + productId).remove();
                    } else {
                        $(".variant-selected-li-" + variantId).remove();
                    }
                    Bindings.context(document.body).form._updateDirtyState();
                }
            }

            DiscountNext.prototype.changeProductRoot = function (evt, e, productId) {
                var result = !$(e).find("#product_checkbox_" + productId).is(":checked");
                var isCheckboxCheck = evt.target.tagName == "INPUT";
                if (isCheckboxCheck) {
                    result = !result;
                }
                $("#product_checkbox_" + productId).prop('checked', result);
                var condition;
                if (result) {
                    condition = ":not(:checked)";
                } else {
                    condition = ":checked";
                }
                $(".variant_checkbox_product_" + productId + condition).each(function (index, ele) {
                    $(this).parents(".next-list__item").trigger("click");
                });
            }

            DiscountNext.prototype.checkProductAdded = function (productId) {
                return findProductIndex(productId, this.products) > -1;
            }
            DiscountNext.prototype.checkCollectionAdded = function (collectionId) {
                return findIndex(collectionId, this.collections) > -1;
            }
            DiscountNext.prototype.checkProvinceAdded = function (provinceId) {
                return findIndex(provinceId, this.provinces) > -1;
            }
            DiscountNext.prototype.checkSavedSearchAdded = function (savedSearchId) {
                return findIndex(savedSearchId, this.savedsearchs) > -1;
            }
            DiscountNext.prototype.checkVariantAdded = function (productId, variantId) {
                var found = findProductIndex(productId, this.products);
                if (found > -1) {
                    var product = this.products[found];
                    var found2 = findIndex(variantId, product.variants);
                    var added = found2 > -1;
                    if (added) {
                        var clazzCheckbox = ".variant_checkbox_product_" + productId;
                        var clazzCheckboxHide = ".next-input-wrapper.hide " + clazzCheckbox;
                        if ($(clazzCheckbox).length == $(clazzCheckboxHide).length) {
                            $("#product_checkbox_" + productId).parent(".next-input-wrapper").addClass("hide");
                        }
                    }
                    return added;
                }
                return false;
            }
            DiscountNext.prototype.matchesSearch = function (text) {
                var input = this.input;
                if (input) {
                    input = input.toLowerCase();
                    var keyword = Bizweb.Inflection.removeVietnamChar(input);
                    return text.indexOf(keyword) > -1;
                }
                return true;
            }

            DiscountNext.prototype.shareDiscount = function () {
                this.shareable_url_modal.show();
                var clipboard = new Clipboard('#promote-dropdown');

                clipboard.on('success', function (e) {
                    Bizweb.Flash.notice("Copy thành công");
                    e.clearSelection();
                });

            }

            return DiscountNext;
        }();
    }.call(this),
    function () {
        Bizweb.DatePickerSelect = function () {
            function DatePicker(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$this = $(element);
                var date = null;
                if (this.date == null) {
                    this.date = new Date();
                }
                this.$this.datepicker({
                    format: 'dd/mm/yyyy',
                    startDate: this.minDate,
                    todayHighlight: true,
                    language: 'vi-VN',
                    templates: {
                        leftArrow: '<i class="icon-arrow-left"></i>',
                        rightArrow: '<i class="icon-arrow-right"></i>'
                    },
                    autoclose: true
                })
            };

            return DatePicker;
        }();
    }.call(this),
    function () {
        Bizweb.TimePicker = function () {
            function TimePicker(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
                this.$this = $(element);
                //this.$this.timepicker(); 
            };

            return TimePicker;
        }();
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = function (e, t) {
                function n() {
                    this.constructor = e
                }
                for (var r in t) i.call(t, r) && (e[r] = t[r]);
                return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
            },
            i = {}.hasOwnProperty;

        Bizweb.EditCollection = function (parent) {
            function EditCollection(ele, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = ele;
                this.form = ele;
                this.opts = { alertUnsavedChanges: true, disabledUntilDirty: true };
                this.resourceName = 'collection';
                this.submit = e(this.submit, this);

                this.contentElement = document.getElementById("Content");

                EditCollection.__super__.constructor.call(this, this.form, this.opts);

                //$('form#formCollection').submit(function () {
                //    unSetAutoNumeric();
                //    return true;
                //});
            };

            t(EditCollection, parent);

            EditCollection.prototype.submit = function (e) {
                var t, i, n, r, o;
                var ckInstance = $(this.contentElement).ckeditorGet();
                if (ckInstance !== undefined) {
                    this.contentElement.value = ckInstance.getData();
                }
                return e.preventDefault(),
                    o = e.target,
                    t = {
                        httpRequestType: o.getAttribute("method"),
                        httpUrl: o.getAttribute("action"),
                        refreshOnErrorExcept: this.resourceName + "-image-drop",
                        useNativeEncoding: null != (null != (i = this.imageDrop) ? i.file : void 0),
                        success: function (e) {
                            return function () {
                                return e.imageDrop.file = null, e.imageDrop.dirty = false;
                            }
                        }(this)
                    }, r = new TurboGraft.Remote(t, this.form, o),
                        (null != (n = this.imageDrop) ? n.file : void 0)
                    && (r.formData.append("altImage", this.imageDrop.alt), r.formData.append("imageCollection", this.imageDrop.file)),
                    r.submit();
            }

            EditCollection.prototype.openUploadImage = function () {
                $("#collection-upload-image").click();
            }

            EditCollection.prototype.uploadImage = function () {
                var uploadImages = $('#collection-upload-image')[0].files;
                if (uploadImages.length > 0) {
                    $('.collection-image').remove();
                    this.showImageFromComputer();
                    $("#uploaded-images").html("Đã chọn ảnh");
                } else {
                    $("#uploaded-images").html("Up ảnh đại diện");
                }
            }

            EditCollection.prototype.showImageFromComputer = function () {
                var validExtensions = ["jpg", "png", "gif", "jpeg"]; //array of valid extensions
                var file = $('#collection-upload-image')[0].files[0];
                var size = file.size;
                var fileName = file.name;
                if (size <= 1024 * 1024) {
                    var fileNameExt = fileName.substr(fileName.lastIndexOf('.') + 1);
                    if ($.inArray(fileNameExt.toLowerCase(), validExtensions) != -1) {
                        var FR = new FileReader();
                        FR.onload = function (e) {
                            var template = $('#collection-image-template').html();
                            var html = Mustache.render(template, { "image": { largeImage: e.target.result, smallImage: e.target.result, uploadedImage: 0 } });
                            $("#btn-upload-collection-image").after(html);
                            Bindings.bind($(".upload-image").get(0), Bindings.context(document.body).editCollection);

                        };
                        FR.readAsDataURL(file);
                    }
                } else {
                    errors.push(fileName);
                }
            }

            EditCollection.prototype.bindImageInTemplate = function (src, uploadedImage) {
                var linkImagePreview = Bizweb.Utility.getThumb(src, "large");
                var linkImageEdit = Bizweb.Utility.getThumb(src, "small");
                var template = $('#collection-image-template').html();
                var html = Mustache.render(template, { "image": { largeImage: linkImagePreview, smallImage: linkImageEdit, uploadedImage: uploadedImage } });
                $("#btn-upload-collection-image").after(html);
                Bindings.bind($(".upload-image").get(0), Bindings.context(document.body).editCollection);
            }

            EditCollection.prototype.previewImage = function (path) {
                this.previewCollectionImageModal.show();
                $(".collection-image-show").attr("src", path);
            }

            EditCollection.prototype.deleteCollectionImage = function (uploadedImage) {
                var that = this;
                if (uploadedImage) {
                    $.ajax({
                        type: "POST",
                        url: '/admin/collections/DeleteImage',
                        data: $(".form-delete-collection-image").serialize(),
                        dataType: "json",
                        success: function (response) {
                            $('.collection-image').remove();
                            Bizweb.Flash.notice("Xóa ảnh thành công");
                            that.previewCollectionImageModal.hide();
                        },
                        error: function (error) {

                        }
                    });
                } else {
                    $('.collection-image').remove();
                    $('#collection-upload-image').val('');
                    $("#uploaded-images").html("Up ảnh đại diện");
                    that.previewCollectionImageModal.hide();
                    if (that.src_image != null) {
                        that.bindImageInTemplate(that.src_image, 1);
                    }
                }
            }

            EditCollection.prototype.showEditImageAlt = function (collectionId) {
                this.editCollectionImageAltModal.show();
                var sourceImage = $(".collection-image-detail").attr("src");
                $(".collection-image-modal").attr("src", sourceImage);

                var alt = $(".collection-image-detail").attr("alt");
                if (alt == 'null') alt = "";
                $('.form-edit-collection-image-alt input[name="altImage"]').val(alt);
                $('.form-edit-collection-image-alt input[name="collectionId"]').val(collectionId);
            }

            EditCollection.prototype.editCollectionImageAlt = function () {
                var collectionId = $('.form-edit-collection-image-alt input[name="collectionId"]').val();
                var alt = $('.form-edit-collection-image-alt input[name="altImage"]').val();

                if (alt.length > 255) {
                    Bizweb.Flash.error("Nội dung thẻ alt không được quá 255 ký tự");
                    return;
                }

                var that = this;

                if (collectionId > 0) {
                    Bizweb.Loading.start();
                    $.ajax({
                        url: '/admin/collections/UpdateAltImage',
                        type: 'POST',
                        data: $(".form-edit-collection-image-alt").serialize(),
                        global: false,
                        success: function (response) {
                            Bizweb.Flash.notice("Cập nhật ảnh đại diện thành công");
                            $(".collection-image-detail").attr("alt", alt);
                            $("#input-alt-image").val(alt);
                            that.editCollectionImageAltModal.hide();
                            Bizweb.Loading.stop();
                        },
                        error: function (data) {
                            if (data.responseJSON && data.responseJSON.error) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                                return;
                            }
                            Bizweb.Flash.error("Cập nhật thất bại");
                            Bizweb.Loading.stop();
                        }
                    })
                }
                else {
                    $(".collection-image-detail").attr("alt", alt);
                    $("#input-alt-image").val(alt);
                    that.editCollectionImageAltModal.hide();
                }
            }
            return EditCollection;
        }(Bizweb.Forms);
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.Dropdown
        //
        // Working with Dropdown, Dropdown form,...
        // ---------------------------------------------------------------------------------

        var openDropdown = function (btnActive) {
            btnActive.addClass("active");

            var dropdownContainer = getDropdownContainer(btnActive);
            dropdownContainer.removeClass("display-from-bottom").addClass("is-visible");

            btnActive.trigger("dropdown:show");
        };

        var getDropdownContainer = function (btnActive) {
            var dropDownName = btnActive.attr("data-dropdown");
            return $(dropDownName, btnActive);
        };

        var hideDropdown = function (btnActive) {
            if (btnActive.hasClass("active")) {
                var dropdownContainer = getDropdownContainer(btnActive);
                dropdownContainer.removeClass("is-visible");
                btnActive.removeClass("active").trigger("dropdown:hide");
            }
        };

        $(document).on("click", function (e) {
            var clickedElement = $(e.target);
            var clickedLink = clickedElement.closest("a");
            var btnActive = clickedElement.closest("[data-dropdown]");
            if (btnActive.length > 0) {
                e.preventDefault();
                Bizweb.Dropdown.trigger(btnActive);
            }
            else if (clickedLink.length > 0 && !clickedLink.hasClass("keep-open") || !clickedElement.closest(".dropdown").length > 0 && !clickedElement.hasClass("keep-open")) {
                Bizweb.Dropdown.hide();
            }
        });

        Bizweb.Dropdown = {
            trigger: function (btnActive) {
                if (btnActive.hasClass("active"))
                    hideDropdown(btnActive)
                else
                    openDropdown(btnActive);
            },
            hide: function () {
                return $("[data-dropdown]").each(function () {
                    return hideDropdown($(this))
                })
            }
        }
    }.call(this),
    function () {
        Bizweb.RedirectsBulkActions = function () {
            function RedirectsBulkActions(element, options) {
                RedirectsBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, RedirectsBulkActions);

            RedirectsBulkActions.prototype.showDeleteRedirectModal = function (id) {
                this.deleteRedirectModal.show();
                $('.form-delete-redirect input[name="id"]').val(id);
            }

            RedirectsBulkActions.prototype.deleteRedirect = function () {
                var id = $('.form-delete-redirect input[name="id"]').val();
                $.ajax({
                    type: "POST",
                    url: '/admin/settings/Redirects/Delete',
                    data: $(".form-delete-redirect").serialize(),
                    dataType: "json",
                    success: function (response) {
                        Bizweb.Modal.hide();
                        window.location.href = window.location.href;
                    },
                    error: function (error) {

                    }
                });
            }

            return RedirectsBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.RedirectsURL = function () {
            function RedirectsURL(e, b) {
                if (b) {
                    var property;
                    for (property in b) this[property] = b[property];
                }
                this.ele = e;
            };

            RedirectsURL.prototype.addRedirect = function () {
                this.addRedirectModal.show();
            }

            return RedirectsURL;
        }();
    }.call(this),
    function () {
        Bizweb.SingleDropdown = function () {
            function SingleDropdown(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.Type = "collection";
                if (options["type"] != null)
                    this.Type = options["type"];

                this.element = element;

                this.init();
                this.timer = null;
                this.request = null;
                this.isLoaded = false;
            };

            SingleDropdown.closeAllOpenDropdown = function () {
                $(".single-dropdown.is-visible").removeClass("is-visible");
            }

            SingleDropdown.checkFocus = function (e) {
                var clickedElement = $(e.target);
                if (clickedElement.closest(".single-dropdown").length == 0 && clickedElement.find(".dropdown-toggle").length > 0) {
                    SingleDropdown.closeAllOpenDropdown();
                }
            }

            SingleDropdown.prototype.dropdown = function () {
                SingleDropdown.closeAllOpenDropdown();

                var that = this;
                if (!this.isLoaded) {
                    $.ajax({
                        type: "GET",
                        url: _urlMappings[this.Type],
                        success: function (data) {
                            that.isLoaded = true;
                            $(that.element).append(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                            Bindings.refreshImmediately();
                        },
                        error: function (error) {
                        },
                        complete: function () {
                            $(that.element).find(".single-dropdown").toggleClass('is-visible');
                        }
                    });
                } else {
                    $(this.element).find(".single-dropdown").toggleClass('is-visible');
                }
            }

            SingleDropdown.prototype.suggest = function () {
                var that = this;
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.Type] + "?query=" + query;
                this.page = 1;

                if (this.timer != null) {
                    clearTimeout(this.timer);
                }

                this.timer = setTimeout(function () {
                    if (this.request != null) {
                        this.request.abort();
                    }
                    this.request = $.ajax({
                        url: url,
                        type: "GET",
                        success: function (data) {
                            $(that.element).find(".single-suggest-result").html(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                        }
                    });
                }, 1000);
            }

            SingleDropdown.prototype.toggle = function (id, name, alias) {
                if (this.valueType === "alias") {
                    if (this.themeSettingId) {
                        var validSettingId = this.removeJQInvalidCharacter(this.themeSettingId);
                        $('#setting-' + validSettingId).val(alias);
                        $('#setting-' + validSettingId).attr('setting-text', name);
                        $('#setting-' + validSettingId).trigger('change');
                    }
                    $(this.element).find("[type='hidden']").val(alias);
                }
                else
                    $(this.element).find(".single-dropdown-select-id").val(id);

                $(this.element).find(".choosed-single").html(name);
                $(this.element).find(".single-dropdown-select-name").val(name);

                this.hideDropdown();
            }

            SingleDropdown.prototype.removeJQInvalidCharacter = function (str) {
                return str.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
            }

            SingleDropdown.prototype.hideDropdown = function () {
                if ($(this.element).find(".single-dropdown").hasClass('is-visible'))
                    $(this.element).find(".single-dropdown").removeClass('is-visible');
            }

            SingleDropdown.prototype.init = function () {
                var itemName = $(this.element).find(".choosed-single").html();
                if (itemName) {
                    $(this.element).find(".choosed-single").html(this.itemName);
                }
            }

            SingleDropdown.prototype.next = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.Type] + "?query=" + query;
                this.page = this.page + 1;
                this.next_page = url + "&page=" + (this.page);
                this.loadUrl(this.next_page);
            }

            SingleDropdown.prototype.prev = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.Type] + "?query=" + query;
                this.page = this.page - 1;
                this.prev_page = url + "&page=" + (this.page);
                this.loadUrl(this.prev_page);
            }

            SingleDropdown.prototype.loadUrl = function (url) {
                var that = this;
                $.ajax({
                    url: url,
                    success: function (data) {
                        $(that.element).find(".single-suggest-result").html(data);
                        Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                    }
                });
            }

            return SingleDropdown;
        }();
    }.call(this),
    function () {
        var i = function (e) {
            return e && e.__esModule ? e : {
                "default": e
            }
        },
        n = i($),
        s = i(_),
        a = 300,
        u = {
            OVERLAY: "theme-preview__overlay",
            IFRAME: "theme-preview__iframe"
        };

        Bizweb.ThemeSelect = function () {
            function ThemeSelect(e, b) {
                if (b) {
                    var property;
                    for (property in b) this[property] = b[property];
                }
                this.ele = e;

                this.node = e;
                var i = s["default"].throttle(this.scaleFrames, a);
                (0, n["default"])(window).off("resize", i.bind(this)).on("resize", i.bind(this))
            };

            ThemeSelect.prototype.showPublishTheme = function (id, role, name) {
                this.publishThemeModal.show();
                $('.form-publish-theme .theme-name').html(name);
                $('.form-publish-theme input[name=id]').val(id);
                this.publishTheme('main');
            }

            ThemeSelect.prototype.deleteTheme = function (id, name) {
                this.deleteThemeModal.show();
                $('.form-delete-theme .theme-name').html(name);
                $('.form-delete-theme input[name=id]').val(id);
            }

            ThemeSelect.prototype.publishTheme = function (role) {
                $('.btn-publish-theme').removeClass('disabled');
                $('.theme-role').removeClass('theme-role-selected');
                $('.role-' + role).addClass('theme-role-selected');
                $('.form-publish-theme input[name=role]').val(role);
            }

            ThemeSelect.prototype.unpublishTheme = function (themeId) {
                $.ajax({
                    type: 'POST',
                    url: '/admin/topic/UnPublishTheme',
                    data: { mobileThemeId: themeId },
                    success: function (data) {
                        window.location.href = window.location.href;
                        Bizweb.Flash.notice("Topics đã được ẩn");
                    },
                    error: function (data) {

                    }
                });
            }

            ThemeSelect.prototype.enableUploadThemeSubmit = function () {
                if ($('#uploadTheme')[0].files.length > 0) {
                    $('.btn-upload-theme').removeClass('disabled');
                }
            }

            ThemeSelect.prototype.uploadTheme = function () {
                $('.btn-upload-theme').addClass('disabled');
            }

            ThemeSelect.prototype.showCopyTheme = function (themeId, themeName) {
                this.copyThemeModal.show();
                $("#themeCopyId").val(themeId);
                $("#themeCopyName").val(themeName + " - Copy");
            }

            ThemeSelect.prototype.scaleFrames = function () {
                (0, n["default"])(this.node).find("." + u.OVERLAY).each(function (e, t) {
                    var i = (0, n["default"])(t).width(),
                        r = (0, n["default"])(t).find("." + u.IFRAME),
                        o = r.width(),
                        s = 1;
                    s = i <= o ? 1 - (o - i) / o : 1 + (i - o) / i, r.css("transform", "scale(" + s + ")")
                })
            }

            return ThemeSelect;
        }();
    }.call(this),
    function () {
        var applyObjectToEvent = function (event, context) {
            return function () {
                return event.apply(context, arguments)
            }
        }
        Bizweb.FilterAndSavedSearchWithDropDown = function () {
            function FilterAndSavedSearchWithDropDown(element, options) {
                FilterAndSavedSearchWithDropDown.base.constructor.call(this, element, options);
                this.element = element;
                this.isValid = false;
                this.$filterForm = $("#frmFilter");
                this.page = 1;
                this.isLoaded = false;
            }
            extend(Bizweb.FilterAndSavedSearch, FilterAndSavedSearchWithDropDown);

            FilterAndSavedSearchWithDropDown.optionsNeedingValue = ["greater_than", "less_than", "equals", "not_equals"];
            FilterAndSavedSearchWithDropDown.prototype.getUrlByKey = function () {
                return this.filterKey.toLowerCase().substring(0, this.filterKey.length - 2);
            }

            FilterAndSavedSearchWithDropDown.closeAllOpenDropdown = function () {
                $(".single-dropdown").removeClass("is-visible");
            }

            FilterAndSavedSearchWithDropDown.prototype.dropdown = function () {
                //FilterAndSavedSearchWithDropDown.closeAllOpenDropdown();

                var that = this;
                this.page = 1;
                if (!this.isLoaded) {
                    $.ajax({
                        type: "GET",
                        url: _urlMappings[this.getUrlByKey()],
                        success: function (data) {
                            that.isLoaded = true;
                            $(that.element).find(".result-dropdown").append(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                        },
                        error: function (error) {

                        },
                        complete: function () {
                            if ($(that.element).find(".single-dropdown").hasClass('is-visible'))
                                $(that.element).find(".single-dropdown").removeClass('is-visible');
                            else
                                $(that.element).find(".single-dropdown").addClass('is-visible');
                        }
                    });
                } else {
                    if ($(this.element).find(".single-dropdown").hasClass('is-visible')) {
                        $(this.element).find(".single-dropdown").removeClass('is-visible');
                    } else {
                        $(this.element).find(".single-dropdown").addClass('is-visible');
                    }
                }
            }
            FilterAndSavedSearchWithDropDown.prototype.suggest = function () {
                var timeout;
                var that = this;
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.getUrlByKey()] + "?query=" + query;
                if (!this.page || this.page == 0) {
                    this.page = 1;
                }

                if (this.timer != null) {
                    clearTimeout(this.timer);
                }

                this.timer = setTimeout(function () {
                    if (this.request != null) {
                        this.request.abort();
                    }
                    this.request = $.ajax({
                        url: url,
                        type: "GET",
                        success: function (data) {
                            $(that.element).find(".single-suggest-result").html(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                        }
                    });
                }, 500);
            }
            FilterAndSavedSearchWithDropDown.prototype.next = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.getUrlByKey()] + "?query=" + query;
                this.page = this.page + 1;
                this.next_page = url + "&page=" + (this.page);
                this.loadUrl(this.next_page);
            }
            FilterAndSavedSearchWithDropDown.prototype.prev = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.getUrlByKey()] + "?query=" + query;
                this.page = this.page - 1;
                this.prev_page = url + "&page=" + (this.page);
                this.loadUrl(this.prev_page);
            }
            FilterAndSavedSearchWithDropDown.prototype.loadUrl = function (url) {
                var that = this;
                $.ajax({
                    url: url,
                    success: function (data) {
                        $(that.element).find(".single-suggest-result").html(data);
                        Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                    }
                });
            }
            FilterAndSavedSearchWithDropDown.prototype.toggle = function (id, name, alias) {
                if (this.valueType === "alias")
                    $(this.element).find("[type='hidden']").val(alias);
                else
                    $(this.element).find(".choosed-single-id").val(id);

                $("#frmFilter").find("input[name='" + this.filterKey + "']").val(id);

                $(this.element).find(".choosed-single").html(name);
                if ($(this.element).find(".single-dropdown").hasClass('is-visible')) {
                    $(this.element).find(".single-dropdown").toggleClass('is-visible');
                }
                this.option = id;
                Bindings.refresh();
            }

            FilterAndSavedSearchWithDropDown.prototype.hideDropdown = function () {
                if ($(this.element).find(".single-dropdown").hasClass('is-visible'))
                    $(this.element).find(".single-dropdown").removeClass('is-visible');
            }

            FilterAndSavedSearchWithDropDown.prototype.checkFocus = function (e) {
                var clickedElement = $(e.target);
                if (clickedElement.closest(".single-dropdown").length == 0 && clickedElement.find(".dropdown-toggle").length > 0) {
                    this.hideDropdown();
                }
            }

            FilterAndSavedSearchWithDropDown.prototype.init = function () {
                var itemName = $(this.element).find(".choosed-single").html();
                if (itemName) {
                    $(this.element).find(".choosed-single").html(this.itemName);
                }
            }

            return FilterAndSavedSearchWithDropDown;
        }();
    }.call(this),
    function () {
        Bizweb.ProductFilterAndSavedSearch = function () {
            function ProductFilterAndSavedSearch(element, options) {
                ProductFilterAndSavedSearch.base.constructor.call(this, element, options);

                this.submitQuery = _.debounce(this.submitQuery, 300)
                this.page = 1;
                this.isLoaded = false;
            };
            extend(Bizweb.FilterAndSavedSearchWithDropDown, ProductFilterAndSavedSearch);

            ProductFilterAndSavedSearch.optionsNeedingValue = ["greater_than", "less_than", "equals", "not_equals"];

            // BEGIN: ProductFilterAndSavedSearch - Public Functions
            ProductFilterAndSavedSearch.prototype.dropdown = function () {
                //ProductFilterAndSavedSearch.closeAllOpenDropdown();
                var that = this;
                this.page = 1;
                if (!this.isLoaded) {
                    $.ajax({
                        type: "GET",
                        url: _urlMappings["collection"],
                        success: function (data) {
                            that.isLoaded = true;
                            $(that.element).find(".result-dropdown").append(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                        },
                        error: function (error) {
                        },
                        complete: function () {
                            if ($(that.element).find(".single-dropdown").hasClass('is-visible'))
                                $(that.element).find(".single-dropdown").removeClass('is-visible');
                            else
                                $(that.element).find(".single-dropdown").addClass('is-visible');
                        }
                    });
                } else {
                    if ($(this.element).find(".single-dropdown").hasClass('is-visible')) {
                        $(this.element).find(".single-dropdown").removeClass('is-visible');
                    } else {
                        $(this.element).find(".single-dropdown").addClass('is-visible');
                    }
                }
            }
            ProductFilterAndSavedSearch.prototype.suggest = function () {
                var timeout;
                var that = this;
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings["collection"] + "?query=" + query;
                this.page = 1;

                if (this.timer != null) {
                    clearTimeout(this.timer);
                }

                this.timer = setTimeout(function () {
                    if (this.request != null) {
                        this.request.abort();
                    }
                    this.request = $.ajax({
                        url: url,
                        type: "GET",
                        success: function (data) {
                            $(that.element).find(".single-suggest-result").html(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                        }
                    });
                }, 500);
            }
            ProductFilterAndSavedSearch.prototype.next = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings["collection"] + "?query=" + query;
                this.page = this.page + 1;
                this.next_page = url + "&page=" + (this.page);
                this.loadUrl(this.next_page);
            }
            ProductFilterAndSavedSearch.prototype.prev = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings["collection"] + "?query=" + query;
                this.page = this.page - 1;
                this.prev_page = url + "&page=" + (this.page);
                this.loadUrl(this.prev_page);
            }
            ProductFilterAndSavedSearch.prototype.loadUrl = function (url) {
                var that = this;
                $.ajax({
                    url: url,
                    success: function (data) {
                        $(that.element).find(".single-suggest-result").html(data);
                        Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                    }
                });
            }
            ProductFilterAndSavedSearch.prototype.toggle = function (id, name) {
                $(this.element).find(".choosed-single-id").val(id);
                $("#frmFilter").find("input[name='collectionId']").val(id);
                $(this.element).find(".choosed-single").html(name);
                if ($(this.element).find(".single-dropdown").hasClass('is-visible')) {
                    $(this.element).find(".single-dropdown").toggleClass('is-visible');
                }
                this.option = id;
                Bindings.refresh();
            }
            // END: ProductFilterAndSavedSearch - Public Functions

            ProductFilterAndSavedSearch.name = "ProductFilterAndSavedSearch";
            return ProductFilterAndSavedSearch;
        }();
    }.call(this),
    function () {
        Bizweb.OrderFilterAndSavedSearch = function () {
            function OrderFilterAndSavedSearch(element, options) {
                OrderFilterAndSavedSearch.base.constructor.call(this, element, options);
                this.element = element;
                this.isValid = false;
                this.$filterForm = $("#frmFilter");
                this.page = 1;
                this.isLoaded = false;
            }
            extend(Bizweb.FilterAndSavedSearchWithDropDown, OrderFilterAndSavedSearch);

            OrderFilterAndSavedSearch.optionsNeedingValue = ["greater_than", "less_than", "equals", "not_equals"];

            OrderFilterAndSavedSearch.closeAllOpenDropdown = function () {
                $(".single-dropdown").removeClass("is-visible");
            }
            OrderFilterAndSavedSearch.prototype.resetFilter = function () {
                this.option = "";
                this.value = "";
                this.isValid = false;
                $(".filter-builder .filter-select").val("");
            }
            OrderFilterAndSavedSearch.prototype.resetValue = function () {
                this.value = "";
                this.isValid = false;
            }
            OrderFilterAndSavedSearch.prototype.dropdown = function () {
                //OrderFilterAndSavedSearch.closeAllOpenDropdown();

                var that = this;
                this.page = 1;
                if (!this.isLoaded) {
                    $.ajax({
                        type: "GET",
                        url: _urlMappings["customer"],
                        success: function (data) {
                            that.isLoaded = true;
                            $(that.element).find(".result-dropdown").append(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                        },
                        error: function (error) {

                        },
                        complete: function () {
                            if ($(that.element).find(".single-dropdown").hasClass('is-visible'))
                                $(that.element).find(".single-dropdown").removeClass('is-visible');
                            else
                                $(that.element).find(".single-dropdown").addClass('is-visible');
                        }
                    });
                } else {
                    if ($(this.element).find(".single-dropdown").hasClass('is-visible'))
                        $(this.element).find(".single-dropdown").removeClass('is-visible');
                    else
                        $(this.element).find(".single-dropdown").addClass('is-visible');
                }
            }

            OrderFilterAndSavedSearch.prototype.suggest = function () {
                var timeout;
                var that = this;
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings["customer"] + "?query=" + query;
                if (!this.page || this.page == 0) {
                    this.page = 1;
                }

                if (this.timer != null) {
                    clearTimeout(this.timer);
                }

                this.timer = setTimeout(function () {
                    if (this.request != null) {
                        this.request.abort();
                    }
                    this.request = $.ajax({
                        url: url,
                        type: "GET",
                        success: function (data) {
                            $(that.element).find(".single-suggest-result").html(data);
                            Bindings.bind($(that.element).find(".single-dropdown").get(0), that);
                        }
                    });
                }, 500);
            }

            OrderFilterAndSavedSearch.prototype.toggle = function (id, name) {
                $(this.element).find(".choosed-single-id").val(id);
                $("#frmFilter").find("input[name='CustomerId']").val(id);
                $(this.element).find(".choosed-single").html(name);
                if ($(this.element).find(".single-dropdown").hasClass('is-visible')) {
                    $(this.element).find(".single-dropdown").toggleClass('is-visible');
                }
                this.option = id;
                Bindings.refresh();
            }
            return OrderFilterAndSavedSearch;
        }();
    }.call(this),
    function () {
        Bizweb.OrderBulkActions = function () {
            function OrderBulkActions(element, options) {
                OrderBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, OrderBulkActions);

            OrderBulkActions.prototype.fulfillOrders = function () {
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionFulfillOrders + '?' + $("#frmBulkActions").serialize(),
                    global: false,
                    success: function (data) {
                        $("#bizweb-modal").html(data);
                        $("#bizweb-modal").modal({ backdrop: 'static' });
                        $("#bizweb-modal").modal("show");
                        Bindings.unbind($("#bizweb-modal")[0]);
                        Bindings.bind($("#bizweb-modal")[0]);
                    }
                }).always(function () {
                    Bizweb.Loading.stop();
                });
            }

            OrderBulkActions.prototype.archiveOrders = function () {
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionArchiveOrders,
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    global: false,
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                Bizweb.Flash.notice(data.result.message);
                            });
                        }, time);
                    }
                });
            }

            OrderBulkActions.prototype.unarchiveOrders = function () {
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionUnArchiveOrders,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                Bizweb.Flash.notice(data.result.message);
                            });
                        }, time);
                    }
                });
            }

            OrderBulkActions.prototype.printOrders = function () {
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionPrintOrders,
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    global: false,
                    success: function (data) {
                        if (data.contents != null && data.contents.length > 0) {
                            var html = '';
                            var contents = [];

                            html += '<style type="text/css">@media all{.page-break{display:none;}}@media print{.page-break{float:none;border:none;width:100%;clear:both;display:block;page-break-before:always;}}</style>';
                            for (i = 0; i < data.contents.length; i++) {
                                contents.push('<div>' + data.contents[i] + '</div>');
                            }
                            html += contents.join('<div class="page-break"></div>');

                            window.frames["print_frame"].document.body.innerHTML = html;
                            window.frames["print_frame"].window.focus();
                            window.frames["print_frame"].window.print();
                        }
                    },
                    error: function (error) {
                        if (422 == error.status && !!error.responseJSON) {
                            Bizweb.Flash.error(!!error.responseJSON.message ? error.responseJSON.message : "In đơn hàng không thành công");
                        } else {
                            Bizweb.Flash.error("In đơn hàng không thành công");
                        }
                    }
                }).always(function () {
                    Bizweb.Loading.stop();
                });
            }

            OrderBulkActions.prototype.quickViewOrder = function (orderId) {
                var that = this;
                var lineOrder = $(that.element).find("#quick-view-order-" + orderId);
                var detailLineOrder = $(lineOrder).children("td");
                if (detailLineOrder.length > 0) {
                    if ($(lineOrder).hasClass("panel-quick-view-open")) {
                        _.prepareTransition($(lineOrder)).removeClass("panel-quick-view-open");
                        $(that.element).find("#fa-quick-view-" + orderId).removeClass("fa-angle-double-down");
                        $(that.element).find("#fa-quick-view-" + orderId).addClass("fa-angle-double-right");
                    }
                    else {
                        $(document).find(".panel-quick-view").removeClass("panel-quick-view-open");
                        $(document).find(".fa-quick-view").removeClass("fa-angle-double-down");
                        $(that.element).find("#fa-quick-view-" + orderId).addClass("fa-angle-double-down");
                        _.prepareTransition($(lineOrder)).addClass("panel-quick-view-open");
                    }
                }
                else {
                    $.ajax({
                        url: "/admin/orders/QuickOderProcessing",
                        type: "GET",
                        dataType: "html",
                        data: {
                            id: orderId
                        },
                        success: function (html) {
                            $(lineOrder).html(html);
                            Bindings.unbind($("#quick-view-order-" + orderId)[0]);
                            Bindings.bind($("#quick-view-order-" + orderId)[0]);

                            $(document).find(".panel-quick-view").removeClass("panel-quick-view-open");
                            $(document).find(".fa-quick-view").removeClass("fa-angle-double-down");
                            $(that.element).find("#fa-quick-view-" + orderId).addClass("fa-angle-double-down");
                            _.prepareTransition($(lineOrder)).addClass('panel-quick-view-open');
                        }
                    });
                }
            }

            return OrderBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.CheckoutBulkActions = function () {
            function CheckoutBulkActions(element, options) {
                CheckoutBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, CheckoutBulkActions);

            CheckoutBulkActions.prototype.archiveCheckouts = function () {
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionArchiveCheckouts,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                Bizweb.Flash.notice(data.result.message);
                            });
                        }, time);
                    }
                });
            }

            CheckoutBulkActions.prototype.unarchiveCheckouts = function () {
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionUnArchiveCheckouts,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                Bizweb.Flash.notice(data.result.message);
                            });
                        }, time);
                    }
                });
            }

            return CheckoutBulkActions;
        }();
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        }, t = function (e, t) {
            function n() {
                this.constructor = e
            }
            for (var r in t) i.call(t, r) && (e[r] = t[r]);
            return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
        }, i = {}.hasOwnProperty;

        Bizweb.EditArticle = function (parent) {
            function EditArticle(ele, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = ele;
                this.form = ele;
                this.opts = { alertUnsavedChanges: true, disabledUntilDirty: true };
                this.resourceName = 'article';
                this.submit = e(this.submit, this);

                this.contentElement = document.getElementById("Content");

                EditArticle.__super__.constructor.call(this, this.form, this.opts);
            };

            t(EditArticle, parent);

            EditArticle.prototype.submit = function (e) {
                var t, i, n, r, o;
                var ckInstance = $(this.contentElement).ckeditorGet();
                if (ckInstance !== undefined) {
                    this.contentElement.value = ckInstance.getData();
                }
                return e.preventDefault(),
                    o = e.target,
                    t = {
                        httpRequestType: o.getAttribute("method"),
                        httpUrl: o.getAttribute("action"),
                        refreshOnErrorExcept: this.resourceName + "-image-drop",
                        useNativeEncoding: null != (null != (i = this.imageDrop) ? i.file : void 0),
                        success: function (e) {
                            return function () {
                                return e.imageDrop.file = null, e.imageDrop.dirty = false;
                            }
                        }(this)
                    }, r = new TurboGraft.Remote(t, this.form, o),
                        (null != (n = this.imageDrop) ? n.file : void 0)
                    && (r.formData.append("altImage", this.imageDrop.alt), r.formData.append("imageArticle", this.imageDrop.file)),
                    r.submit();
            }

            EditArticle.prototype.openUploadImage = function () {
                $("#article-upload-image").click();
            }

            EditArticle.prototype.uploadImage = function () {
                var uploadImages = $('#article-upload-image')[0].files;
                if (uploadImages.length > 0) {
                    $('.article-image').remove();
                    $("#uploaded-images").html("Đã chọn ảnh");
                    this.showImageFromComputer();
                } else {
                    $("#uploaded-images").html("Up ảnh đại diện");
                }

            }

            EditArticle.prototype.showImageFromComputer = function () {
                var validExtensions = ["jpg", "png", "gif", "jpeg"]; //array of valid extensions
                var file = $('#article-upload-image')[0].files[0];
                var size = file.size;
                var fileName = file.name;
                if (size <= 1024 * 1024) {
                    var fileNameExt = fileName.substr(fileName.lastIndexOf('.') + 1);
                    if ($.inArray(fileNameExt.toLowerCase(), validExtensions) != -1) {
                        var FR = new FileReader();
                        FR.onload = function (e) {
                            var template = $('#article-image-template').html();
                            var html = Mustache.render(template, { "image": { largeImage: e.target.result, smallImage: e.target.result, uploadedImage: 0 } });
                            $("#btn-upload-article-image").after(html);
                            Bindings.bind($(".upload-image").get(0), Bindings.context(document.body).editArticle);

                        };
                        FR.readAsDataURL(file);
                    }
                } else {
                    errors.push(fileName);
                }
            }

            EditArticle.prototype.previewImage = function (path) {
                this.previewImageModal.show();
                $(".image-show").attr("src", path);
            }

            EditArticle.prototype.bindImageInTemplate = function (src, uploadedImage) {
                var linkImagePreview = Bizweb.Utility.getThumb(src, "large");
                var linkImageEdit = Bizweb.Utility.getThumb(src, "small");
                var template = $('#article-image-template').html();
                var html = Mustache.render(template, { "image": { largeImage: linkImagePreview, smallImage: linkImageEdit, uploadedImage: uploadedImage } });
                $("#btn-upload-article-image").after(html);
                Bindings.bind($(".upload-image").get(0), Bindings.context(document.body).editArticle);
            }

            EditArticle.prototype.deleteArticleImage = function (uploadedImage) {
                var that = this;
                if (uploadedImage) {
                    $.ajax({
                        type: "POST",
                        url: '/admin/articles/DeleteImage',
                        data: $(".form-delete-article-image").serialize(),
                        dataType: "json",
                        success: function (response) {
                            $('.article-image').remove();
                            Bizweb.Flash.notice("Xóa ảnh đại diện bài viết thành công");
                            that.previewImageModal.hide();
                        },
                        error: function (error) {
                            Bizweb.Flash.error("Xóa ảnh đại diện bài viết thất bại");
                        }
                    });
                } else {
                    $('.article-image').remove();
                    $('#article-upload-image').val('');
                    $("#uploaded-images").html("Up ảnh đại diện");
                    that.previewImageModal.hide();
                    if (that.src_image != null) {
                        that.bindImageInTemplate(that.src_image, 1);
                    }
                }
            }

            EditArticle.prototype.showEditImageAlt = function (articleId) {
                this.editArticleImageAltModal.show();
                var sourceImage = $(".article-image-detail").attr("src");
                $(".article-image-modal").attr("src", sourceImage);

                var alt = $(".article-image-detail").attr("alt");
                if (alt == 'null') alt = "";
                $('.form-edit-article-image-alt input[name="altImage"]').val(alt);
                $('.form-edit-article-image-alt input[name="articleId"]').val(articleId);
            }

            EditArticle.prototype.editArticleImageAlt = function () {
                var articleId = $('.form-edit-article-image-alt input[name="articleId"]').val();
                var alt = $('.form-edit-article-image-alt input[name="altImage"]').val();

                if (alt.length > 255) {
                    Bizweb.Flash.error("Nội dung thẻ alt không được quá 255 ký tự");
                    return;
                }

                var that = this;

                if (articleId > 0) {
                    Bizweb.Loading.start();
                    $.ajax({
                        url: '/admin/articles/UpdateAltImage',
                        type: 'post',
                        data: $(".form-edit-article-image-alt").serialize(),
                        global: false,
                        success: function (response) {
                            Bizweb.Flash.notice("Cập nhật ảnh đại diện thành công");
                            $(".article-image-detail").attr("alt", alt);
                            $("#input-alt-image").val(alt);
                            that.editArticleImageAltModal.hide();
                            Bizweb.Loading.stop();
                        },
                        error: function (data) {
                            if (data.responseJSON && data.responseJSON.error) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                                return;
                            }
                            Bizweb.Flash.error("Cập nhật thất bại");
                            Bizweb.Loading.stop();
                        }
                    })
                }
                else {
                    $(".article-image-detail").attr("alt", alt);
                    $("#input-alt-image").val(alt);
                    that.editArticleImageAltModal.hide();
                }
            }

            EditArticle.prototype.toggleGoToTopButton = function () {
                var published = $("input:radio[name='active'][value='true']").is(':checked');
                if (published == true) {
                    $('.top-blog').removeClass('disabled');
                } else {
                    $('.top-blog').addClass('disabled');
                }
            }

            return EditArticle;
        }(Bizweb.Forms);
    }.call(this),
    function () {
        Bizweb.Comment = function () {
            function Comment(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            Comment.prototype.updateComment = function (action, id) {
                Bizweb.Loading.start();
                var button = $(this.element).find(".action-comment");
                var text = button.text();
                button.addClass("disabled").html(Bizweb.LOADING);
                $.ajax({
                    url: Bizweb.routes.comments + "/" + action + "/" + id,
                    type: 'post',
                    global: false,
                    success: function (response) {
                        Bizweb.Utility.loadAjax(window.location.href, ".edit-article", function () {

                        });
                    },
                    error: function (data) {
                        if (data.responseJSON && data.responseJSON.error) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            return;
                        }
                        Bizweb.Flash.error("Cập nhật thất bại");
                        Bizweb.Loading.stop();
                        button.removeClass("disabled").html(text);
                    }
                })
            }

            return Comment;
        }();
    }.call(this),
    function () {
        Bizweb.Inventory = function () {
            function t(t) {
                this.oldQuantity = t, this.manualSet = !1, this.amount = null;
            }
            return t.name = "Inventory", t.prototype.useManualUpdate = function () {
                return this.manualSet = !0
            }, t.prototype.useRelativeUpdate = function () {
                return this.manualSet = !1
            }, t.prototype.usingManualUpdate = function () {
                return this.manualSet
            }, t.prototype.inventoryHasChanged = function () {
                return this.amount != "" && this.amount != null && (this.manualSet || !this.manualSet && this.amount != 0);
            }, t.prototype.newQuantity = function () {
                if (!Bizweb.Utility.isNumeric(this.amount)) {
                    this.amount = 0;
                    if (!Bizweb.Utility.isNumeric(this.oldQuantity)) {
                        this.oldQuantity = 0;
                    }
                    return 0;
                }
                return this.manualSet ? parseInt(this.amount) : parseInt(this.oldQuantity) + parseInt(this.amount)
            }, t.prototype.updateVariant = function (form) {
                var that = this;
                var $form = $(form);
                $.ajax({
                    url: $form.attr("action"),
                    type: "POST",
                    dataType: "json",
                    data: JSON.stringify({
                        inventory_quantity: that.newQuantity(),
                        id: that.id
                    }),
                    success: function (data, textStatus, xhr) {
                        if (xhr.status == 200) {
                            that.oldQuantity = data.inventory_quantity;
                            that.amount = 0; that.manualSet = !1;
                            Bizweb.Flash.notice("Cập nhật kho thành công");
                        }
                    },
                    error: function () {
                        Bizweb.Flash.error("Cập nhật không thành công");
                    }
                });
                return false;
            }, t
        }()
    }.call(this),
    function () {
        Bizweb.VariantsBulkActions = function () {
            function VariantsBulkActions(element, options) {
                VariantsBulkActions.base.constructor.call(this, element, options);
            }
            extend(Bizweb.BulkActions, VariantsBulkActions);

            VariantsBulkActions.prototype.inventoryPolicyContinue = function () {
                this.BulkVariantsInventoryPolicyContinue = '/admin/products/BulkVariantsInventoryPolicyContinue';
                var that = this;
                $.ajax({
                    url: this.BulkVariantsInventoryPolicyContinue,
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        if (data.message) {
                            Bizweb.Flash.notice(data.message);
                        }
                        that.uncheckAllBulkActionItems();
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            }

            VariantsBulkActions.prototype.inventoryPolicyDeny = function () {
                this.BulkVariantsInventoryPolicyDeny = '/admin/products/BulkVariantsInventoryPolicyDeny';
                $.ajax({
                    url: this.BulkVariantsInventoryPolicyDeny,
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        if (data.message) {
                            Bizweb.Flash.notice(data.message);
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            }

            VariantsBulkActions.prototype.updateInventoryVariants = function (productId, productName) {
                if (productId == 0) {
                    $.ajax({
                        url: this.urlBulkUpdateQuantity + '?' + $("#frmBulkActions").serialize(),
                        success: function (data) {
                            $("#bizweb-modal").html(data);
                            $("#bizweb-modal").modal("show");
                            Bindings.bind($("#bizweb-modal")[0], Bindings.context(document.body).variantsInventory);
                        }
                    })
                } else {
                    $.ajax({
                        url: this.urlBulkUpdateQuantity + '?' + $("#frmBulkActions").serialize() + '&productId=' + productId + '&productName=' + productName,
                        success: function (data) {
                            $("#bizweb-modal").html(data);
                            $("#bizweb-modal").modal("show");
                            Bindings.bind($("#bizweb-modal")[0], Bindings.context(document.body).variantsInventory);
                        }
                    })
                }
            }

            return VariantsBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.BulkVariantsUpdateInventory = function () {
            function BulkVariantsUpdateInventory(element, options) {
                this.manualSet = !1;
                this.amount = null;
            }

            BulkVariantsUpdateInventory.prototype.usingManualUpdate = function () {
                $('input[name=SetInventoryQuantity]').val(this.manualSet);
                return this.manualSet;
            }

            BulkVariantsUpdateInventory.prototype.useRelativeUpdate = function () {
                this.manualSet = !1;
                $('input[name=SetInventoryQuantity]').val(this.manualSet);
            }

            BulkVariantsUpdateInventory.prototype.useManualUpdate = function () {
                this.manualSet = !0;
                $('input[name=SetInventoryQuantity]').val(this.manualSet);

            }

            BulkVariantsUpdateInventory.prototype.newQuantity = function (oldQuantity) {
                if (!Bizweb.Utility.isNumeric(this.amount)) {
                    this.amount = null;
                    return 0;
                }
                return this.manualSet ? parseInt(this.amount) : parseInt(oldQuantity) + parseInt(this.amount);
            }

            BulkVariantsUpdateInventory.prototype.inventoryHasChanged = function () {
                return this.amount != "" && this.amount != null && (this.manualSet || !this.manualSet && this.amount != 0);
            }

            return BulkVariantsUpdateInventory;
        }();
    }.call(this),
    function () {
        Bizweb.HoverIntent = function (t, e) {
            $(t).hoverIntent({
                sensitivity: 7,
                interval: 100,
                timeout: 100,
                over: function () {
                    var t;
                    return t = $(this), !t.hasClass("disabled") && (t.addClass("active"), e) ? t.find(e).addClass("is-visible") : void 0
                },
                out: function () {
                    var t;
                    return t = $(this).removeClass("active"), e && (t = t.find(e)), t.removeClass("is-visible")
                }
            })
        }
    }.call(this),
    function () {
        Bizweb.CustomerBubble = function () {
            function t(t, e) {
                var n, o;
                this.node = t, o = new Bizweb.HoverIntent(this.node, e), n = $(this.node), n.find("img").on("error", function () {
                    return $(this).removeAttr("src")
                }), n.one("mouseenter", function () {
                    return n.find("img[data-src]").each(function (t, e) {
                        var n;
                        return n = $(e), n.attr("src", n.attr("data-src"))
                    })
                })
            }
            return t.name = "CustomerBubble", t
        }()
    }.call(this),
    function () {
        Bizweb.ThemeSettingLanguage = function () {
            function ThemeSettingLanguage(element, options) {
                if (this.role == "main") {
                    this.isMainTheme = true;
                }
                this.otherLanguage = false;
                this.otherLanguageCustomRegion = false;
                this.showFilterBar();
            }

            ThemeSettingLanguage.prototype.openSettingLanguage = function () {
                this.changeThemeLanguageModal.show();
                var currentLanguage = $('select[name=themeLanguage]').val();
                if (currentLanguage == "other") {
                    this.otherLanguage = true;
                } else {
                    this.otherLanguage = false;
                }
            }

            ThemeSettingLanguage.prototype.openSettingLanguageCategory = function (el) {
                $(".filter-tab").removeClass("filter-tab-active");
                $(el).addClass("filter-tab-active");
            }

            ThemeSettingLanguage.prototype.addSettingToFormSettingThemeLanguage = function (settingId) {
                var $formThemeSetting = $("#frmThemeSettingLanguage");
                var $formThemeSettingSubmit = $("#frmThemeSettingLanguageSubmit");
                var $settingItem = $formThemeSetting.find("#" + settingId);
                var value = $settingItem.val();
                var $settingItemSubmit = $formThemeSetting.find("#frm-setting-item-" + settingId);
                if ($settingItemSubmit.length !== 0) {
                    $settingItemSubmit.remove();
                }

                var encodeValue = this.utf8_encode(value);
                encodeValue = escape(encodeValue).replace(/\+/g, '%2B');;
                var htmlSetting = "<input type='hidden' class='frm-setting-item' name='SettingLanguages[" + settingId + "]' value='" + encodeValue + "' id='frm-setting-item-" + settingId + "' setting-id='" + settingId + "'/>";

                $("#frmThemeSettingLanguageSubmit input").remove('#frm-setting-item-' + settingId);
                $formThemeSettingSubmit.append($(htmlSetting));
            }

            ThemeSettingLanguage.prototype.utf8_encode = function (argString) {

                if (argString === null || typeof argString === 'undefined') {
                    return '';
                }

                var string = (argString + '');
                var utftext = '',
                    start, end, stringl = 0;

                start = end = 0;
                stringl = string.length;
                for (var n = 0; n < stringl; n++) {
                    var c1 = string.charCodeAt(n);
                    var enc = null;

                    if (c1 < 128) {
                        end++;
                    } else if (c1 > 127 && c1 < 2048) {
                        enc = String.fromCharCode(
                            (c1 >> 6) | 192, (c1 & 63) | 128
                        );
                    } else if ((c1 & 0xF800) != 0xD800) {
                        enc = String.fromCharCode(
                            (c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128
                        );
                    } else {
                        // surrogate pairs
                        if ((c1 & 0xFC00) != 0xD800) {
                            throw new RangeError('Unmatched trail surrogate at ' + n);
                        }
                        var c2 = string.charCodeAt(++n);
                        if ((c2 & 0xFC00) != 0xDC00) {
                            throw new RangeError('Unmatched lead surrogate at ' + (n - 1));
                        }
                        c1 = ((c1 & 0x3FF) << 10) + (c2 & 0x3FF) + 0x10000;
                        enc = String.fromCharCode(
                            (c1 >> 18) | 240, ((c1 >> 12) & 63) | 128, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128
                        );
                    }
                    if (enc !== null) {
                        if (end > start) {
                            utftext += string.slice(start, end);
                        }
                        utftext += enc;
                        start = end = n + 1;
                    }
                }

                if (end > start) {
                    utftext += string.slice(start, stringl);
                }

                return utftext;
            }

            ThemeSettingLanguage.prototype.showFilterBar = function () {
                var lengthSearchBar = 0;
                var tabIndexStop = 0;
                var listTabFallDown = [];
                lengthSearchBar += $("#filter-tab-all").width();
                var lengthTabList = $(".filter-tab-list").width();
                var $dropdownHiddenSearch = $('#dropdown-hidden-search');
                $('#filter-tab-list').find('.filter-tab-item').each(function () {
                    var $this = $(this);
                    lengthSearchBar += $this.width();
                    if (lengthSearchBar >= lengthTabList - 100) {
                        listTabFallDown.push($this);
                        lengthSearchBar -= $this.width();
                    } else {

                    }
                })
                if (listTabFallDown.length > 0) {
                    for (var i = 0; i < listTabFallDown.length; i++) {
                        var tab = listTabFallDown[i];
                        var name = tab.attr('data-tab-name');
                        var category = tab.attr('data-tab-category');
                        var themeId = tab.attr('data-tab-themeId');

                        $dropdownHiddenSearch.append(this.generateHiddenTabItem(themeId, category, name));
                        tab.remove();
                    }
                    $("#hidden-search").width(lengthTabList - lengthSearchBar);
                    $("#hidden-search").show();
                }
            }

            ThemeSettingLanguage.prototype.generateHiddenTabItem = function (themeId, category, name) {
                return '<li> <a href="/admin/topic/language/' + themeId + "?category=" + category + '" class="" bind-event-click="">' + name + '</a></li>';
            }

            ThemeSettingLanguage.prototype.submitFormSettingThemeLanguage = function () {
                $.ajax({
                    url: '/admin/topic/language',
                    type: "POST",
                    data: $("#frmThemeSettingLanguageSubmit").serialize(),
                    success: function (result) {
                        if (result.error) {
                            Bizweb.Flash.error(result.error);
                        } else {
                            Bizweb.Flash.notice("Tùy biến ngôn ngữ giao diện thành công.");
                        }
                    }
                });
            }

            ThemeSettingLanguage.prototype.changeThemeLanguage = function (el) {
                var choosedLanguage = $(el).val();
                if (choosedLanguage == "other") {
                    this.otherLanguage = true;
                } else {
                    this.otherLanguage = false;
                }
                $("input[name=themeLanguageRegion]").val("");
            }

            ThemeSettingLanguage.prototype.selectRegion = function (el) {
                var choosedLanguage = $(el).val();
                if (choosedLanguage == "custom") {
                    this.otherLanguageCustomRegion = true;
                } else {
                    this.otherLanguageCustomRegion = false;
                }

                $("input[name=themeLanguageRegion]").val("");
            }

            return ThemeSettingLanguage;
        }();
    }.call(this),
    function () {
        var applyObjectToEvent = function (event, object) {
            return function () {
                return event.apply(object, arguments)
            }
        }

        Bizweb.ThemeSettingsV2 = function () {
            function ThemeSettingsV2(e, b) {
                if (b) {
                    var property;
                    for (property in b) this[property] = b[property];
                }
                this.ele = e;
                this.changes = 0;
                this.canUndo = false;
                this.settings = [];
                this.changeSteps = [];
                this.undoing = false;
                this.originValues = {};
                this.applyPresetValues = {};
                this.undoAll = false;
                //text hien thi cua cac dropdown tuong ung vs value cua setting[]
                this.settingDropdowns = [];
                this.previewSize = "desktop";
                this.viewportSize = "desktop";
                this.openCurrentSection();
                this.presetPreview = false;
                this.initIframe();
                this.initialLoad();
                this.action = _.debounce(this.action, 600);
                this.stylesheetRequests = [];
                window.addEventListener('message', this.receiverMessage.bind(this));
                this.isSaved = false;
            }

            ThemeSettingsV2.prototype.receiverMessage = function (e) {
                var that = this;
                if (e.origin.toLowerCase().indexOf("bizweb") >= 0) {
                    var dataReceiver = JSON.parse(e.data);
                    if (dataReceiver.message === "requestStylesheets") {
                        that.requestStylesheets(dataReceiver.data);
                    }
                    if (dataReceiver.message === "navigate") {
                        that.updateIframeLocation(dataReceiver.data.path);
                    }
                }
            }

            ThemeSettingsV2.prototype.requestStylesheets = function (e) {
                var that = this;
                e.urls.forEach(function (entry) {
                    var r;
                    r = $.ajax({
                        url: entry
                    });
                    r.done(function (i, o, a) {
                        if (o === "success") {
                            that.postMessageData("stylesheetReceived", {
                                url: entry,
                                value: i
                            })
                        }
                    });
                });
            }

            ThemeSettingsV2.prototype.openCurrentSection = function () {
                var sectionId = this.current_section;
                if (sectionId >= 0) {
                    $('.theme-editor__panel').removeClass('theme-editor__panel--is-visible theme-editor__panel--is-active');
                    _.prepareTransition($('#panel-' + sectionId)).addClass('theme-editor__panel--is-visible theme-editor__panel--is-active');
                }
            }

            ThemeSettingsV2.prototype.openSection = function (sectionId) {
                $('.theme-editor__panel').removeClass('theme-editor__panel--is-visible theme-editor__panel--is-active');
                _.prepareTransition($('#panel-' + sectionId)).addClass('theme-editor__panel--is-visible theme-editor__panel--is-active');
                this.current_section = sectionId;
            }

            ThemeSettingsV2.prototype.closeSection = function () {
                _.prepareTransition($('.theme-editor__panel')).removeClass('theme-editor__panel--is-visible theme-editor__panel--is-active');
                this.current_section = -1;
            }

            ThemeSettingsV2.prototype.openUploadTmpImage = function (settingImgId) {
                var idUploadTmpImage = this.removeJQInvalidCharacter(settingImgId);
                $("#uploadTmpImage-" + idUploadTmpImage).click();
            }

            ThemeSettingsV2.prototype.removeJQInvalidCharacter = function (str) {
                return str.replace(/[^a-z0-9\s]/gi, '').replace(/[_\s]/g, '-');
            }

            ThemeSettingsV2.prototype.saveChanges = function () {
                $('#btnSaveSetting').addClass("disabled is-loading");
                $('#btnRemoveSetting').addClass("disabled is-loading");
                $('#btnUndo').addClass("disabled is-loading");
                Bizweb.Loading.start();
                var themeId = this.id;
                var currentSection = this.current_section;
                var that = this;
                $("#frmThemeSettings").find("input[name=CurrentSection]").val(this.current_section);
                $.ajax({
                    url: '/admin/topic/SaveSettingChanges',
                    type: "POST",
                    global: false,
                    data: $("#frmThemeSettings").serialize(),
                    success: function (result) {
                        Bizweb.Loading.stop();
                        $('#btnSaveSetting').addClass("disabled is-loading");
                        $('#btnRemoveSetting').addClass("disabled is-loading");
                        $('#btnUndo').addClass("disabled is-loading");
                        Bizweb.Flash.notice("Tất cả thay đổi đã được lưu");
                        window.location.href = "/admin/topic/editor/?id=" + themeId + "&currentSection=" + currentSection;
                        //Bizweb.Utility.loadAjax("/admin/topic/editor/?id=" + themeId + "&currentSection=" + currentSection, "#theme-editor-sidebar", function () {
                        //    NProgress.done();
                        //    Bizweb.Flash.notice("Tất cả thay đổi đã được lưu");
                        //    that.reload();
                        //});
                        //that.isSaved = true;
                        //$("#btnSaveSetting").prop('disabled', true);
                        //Bizweb.Flash.notice("Tất cả thay đổi đã được lưu");
                        //NProgress.done();
                        //that.reload();
                        //Bizweb.Modal.hide();
                    },
                    error: function (data) {
                        Bizweb.Loading.stop();
                        $('#btnSaveSetting').removeClass("disabled is-loading");
                        $('#btnRemoveSetting').removeClass("disabled is-loading");
                        $('#btnUndo').removeClass("disabled is-loading");

                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Đã xảy ra lỗi khiến quá trình lưu tài nguyên thất bại.");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            }

            ThemeSettingsV2.prototype.uploadTmpImage = function (settingImgId) {
                var idUploadTmpImage = this.removeJQInvalidCharacter(settingImgId);
                var themeId = this.id;
                var that = this;
                var formData = new FormData();
                var totalFiles = $("#uploadTmpImage-" + idUploadTmpImage)[0].files.length;
                if (totalFiles <= 0) {
                    Bizweb.Flash.error("Không tìm thấy ảnh!");
                    return;
                }

                this.progressUploadImage.show();
                var elem = document.getElementById("myBar");
                var width = 1;
                var id = setInterval(frame, 10);
                function frame() {
                    if (width >= 100) {
                        clearInterval(id);
                    } else {
                        width++;
                        elem.style.width = width + '%';
                    }
                }

                for (var i = 0; i < totalFiles; i++) {
                    var file = document.getElementById("uploadTmpImage-" + idUploadTmpImage).files[i];
                    formData.append("mediaImage", file);
                }
                formData.append("themeId", themeId);
                formData.append("settingId", settingImgId);

                requestUploadImage = $.ajax({
                    type: "POST",
                    url: '/admin/topic/createImgeTmp',
                    data: formData,
                    contentType: false,
                    processData: false,
                    global: false,
                    success: function (response) {
                        if (response.error) {
                            alert(response.error);
                            return;
                        }
                        var $imageFiles = $("#uploadTmpImage-" + idUploadTmpImage);
                        $imageFiles.val('');
                        //that.progressUploadImage.hide();
                        that.showImgTmp(response.setting_id, response.public_url);
                    },
                    error: function (error) {

                    }
                });
            }

            ThemeSettingsV2.prototype.cancelRequestUploadImage = function () {
                requestUploadImage.abort();
            }

            ThemeSettingsV2.prototype.showImgTmp = function (settingImgId, publicUrl) {
                var idUploadTmpImage = this.removeJQInvalidCharacter(settingImgId);
                var linkImage = publicUrl;

                $('img#img-setting-' + idUploadTmpImage).attr('src', linkImage);
                $('#setting-' + idUploadTmpImage).val(publicUrl);
                $('#setting-' + idUploadTmpImage).trigger('change');
            }

            ThemeSettingsV2.prototype.submitFormSettingTheme = function () {
                Bizweb.Loading.start();
                $('#btnSaveSetting').addClass("disabled is-loading");
                $('#btnRemoveSetting').addClass("disabled is-loading");
                $('#btnUndo').addClass("disabled is-loading");
                var that = this;
                $.ajax({
                    url: '/admin/topic/overridereditor',
                    type: "POST",
                    data: $("#frmThemeSettings").serialize(),
                    global: false,
                    success: function (result) {
                        Bizweb.Loading.stop();
                        $('#btnSaveSetting').removeClass("disabled is-loading");
                        $('#btnRemoveSetting').removeClass("disabled is-loading");
                        $('#btnUndo').removeClass("disabled is-loading");
                        that.reload();
                        Bizweb.Modal.hide();
                    }
                });
            }

            ThemeSettingsV2.prototype.action = function (settingId, settingType, element) {
                this.overrideThemeEditor(settingId, settingType, element);
            };

            ThemeSettingsV2.prototype.overrideThemeEditor = function (settingId, settingType, element) {
                if (!this.undoing && !this.undoAll) {
                    var originSetting = {};

                    var validJQSettingId = this.removeJQInvalidCharacter(settingId);

                    if (this.originValues[settingId] == null) {
                        var startValue = $('#setting-' + validJQSettingId).attr('start-value');
                        var originV = $('#setting-' + validJQSettingId).attr('origin-value');
                        var originValue = originSetting.OriginValue = originV;
                        originSetting.SettingId = settingId;
                        originSetting.SettingType = settingType;
                        originSetting.StartValue = startValue;
                        var settingTypeHasTextDifValue = ['collection', 'blog', 'page'];
                        if ($.inArray(settingType, settingTypeHasTextDifValue) > -1) {
                            var startText = $('#setting-' + validJQSettingId).attr('start-text');
                            originSetting.StartText = startText;
                        } else {
                            originSetting.StartText = startValue;
                        }

                        this.originValues[settingId] = originSetting;
                    } else {
                        var originValue = this.originValues[settingId].OriginValue;
                    }

                    switch (settingType) {
                        case "text":
                        case "textarea":
                        case "radio":
                        case "color":
                            var value = $(element).val();
                            break;
                        case "collection":
                        case "blog":
                        case "page":
                        case "product":
                        case "article":
                            var value = $(element).val();
                            var text = $('#setting-' + validJQSettingId).attr('setting-text');
                            break;
                        case "checkbox":
                            var value = $(element).is(":checked");
                            break;
                        case "select":
                        case "snippet":
                            var value = $('#setting-' + validJQSettingId + ' option:selected').val();
                            break;
                        case "link_list":
                        case "font":
                            var value = $('#setting-' + validJQSettingId + ' option:selected').val();
                            break;
                        case "image":
                            var value = $(element).val();
                            break;
                    }

                    this.addSettingToFormSettingTheme(settingId, settingType, value, originValue);

                    if (this.settings[settingId] == null)
                        this.settings[settingId] = [];
                    this.settings[settingId].push(value);

                    var settingTypeHasTextDifValue = ['collection', 'blog', 'page'];
                    if ($.inArray(settingType, settingTypeHasTextDifValue) > -1) {
                        if (text != undefined && text != '') {
                            if (this.settingDropdowns[settingId] == null)
                                this.settingDropdowns[settingId] = [];
                            this.settingDropdowns[settingId].push(text);
                        }
                    }

                    var changeStepDetail = {};
                    changeStepDetail.SettingType = settingType;
                    changeStepDetail.SettingId = settingId;
                    this.changeSteps.push(changeStepDetail);

                    this.canUndo = true;
                    if (settingType !== "color") {
                        this.submitFormSettingTheme();
                    }
                    else {
                        if (validJQSettingId.indexOf("checkout") != -1) {
                            this.submitFormSettingTheme();
                        }
                    }
                }

                if (this.changeSteps.length == 0) {
                    this.canUndo = false;
                }
                this.undoing = false;
            }

            function invertHex(hexnum) {
                hexnum = hexnum.replace(/#/g, "");
                if (hexnum.length != 6) {
                    console.error("Hex color must be six hex numbers in length.");
                    return false;
                }

                hexnum = hexnum.toUpperCase();
                var splitnum = hexnum.split("");
                var resultnum = "";
                var simplenum = "FEDCBA9876".split("");
                var complexnum = new Array();
                complexnum.A = "5";
                complexnum.B = "4";
                complexnum.C = "3";
                complexnum.D = "2";
                complexnum.E = "1";
                complexnum.F = "0";

                for (i = 0; i < 6; i++) {
                    if (!isNaN(splitnum[i])) {
                        resultnum += simplenum[splitnum[i]];
                    } else if (complexnum[splitnum[i]]) {
                        resultnum += complexnum[splitnum[i]];
                    } else {
                        console.error("Hex colors must only include hex numbers 0-9, and A-F");
                        return false;
                    }
                }

                return "#" + resultnum;
            }

            ThemeSettingsV2.prototype.addSettingToFormSettingTheme = function (settingId, settingType, value, originValue) {
                var $formThemeSetting = $("#frmThemeSettings");
                var frmSettingId = this.removeJQInvalidCharacter(settingId);
                var $settingItem = $formThemeSetting.find("#frm-setting-item-" + frmSettingId);
                if ($settingItem.length !== 0) {
                    $settingItem.remove();
                    this.changes--;
                }
                if (value != originValue) {
                    var encodeValue = this.utf8_encode(value);
                    encodeValue = escape(encodeValue).replace(/\+/g, '%2B');
                    var htmlSetting = "<input type='hidden' class='frm-setting-item' name='Settings[" + settingId + "]' value='" + encodeValue + "' id='frm-setting-item-" + frmSettingId + "' setting-id='" + settingId + "' setting-type='" + settingType + "'/>";


                    $formThemeSetting.append($(htmlSetting));
                    this.changes++;
                    if (this.changes > 0) {
                        $('.btn-remove-changes').removeAttr('disabled');
                        $('.btn-save-changes').removeAttr('disabled');
                        $('.btn-remove-changes').removeClass('disabled');
                        $('.btn-save-changes').removeClass('disabled');
                    }
                }
            }

            ThemeSettingsV2.prototype.utf8_encode = function (argString) {

                if (argString === null || typeof argString === 'undefined') {
                    return '';
                }

                var string = (argString + '');
                var utftext = '',
                    start, end, stringl = 0;

                start = end = 0;
                stringl = string.length;
                for (var n = 0; n < stringl; n++) {
                    var c1 = string.charCodeAt(n);
                    var enc = null;

                    if (c1 < 128) {
                        end++;
                    } else if (c1 > 127 && c1 < 2048) {
                        enc = String.fromCharCode(
                            (c1 >> 6) | 192, (c1 & 63) | 128
                        );
                    } else if ((c1 & 0xF800) != 0xD800) {
                        enc = String.fromCharCode(
                            (c1 >> 12) | 224, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128
                        );
                    } else {
                        // surrogate pairs
                        if ((c1 & 0xFC00) != 0xD800) {
                            throw new RangeError('Unmatched trail surrogate at ' + n);
                        }
                        var c2 = string.charCodeAt(++n);
                        if ((c2 & 0xFC00) != 0xDC00) {
                            throw new RangeError('Unmatched lead surrogate at ' + (n - 1));
                        }
                        c1 = ((c1 & 0x3FF) << 10) + (c2 & 0x3FF) + 0x10000;
                        enc = String.fromCharCode(
                            (c1 >> 18) | 240, ((c1 >> 12) & 63) | 128, ((c1 >> 6) & 63) | 128, (c1 & 63) | 128
                        );
                    }
                    if (enc !== null) {
                        if (end > start) {
                            utftext += string.slice(start, end);
                        }
                        utftext += enc;
                        start = end = n + 1;
                    }
                }

                if (end > start) {
                    utftext += string.slice(start, stringl);
                }

                return utftext;
            }

            ThemeSettingsV2.prototype.changeSettingValue = function (settingId, settingType, value, originValue, text) {
                this.setSettingValue(settingType, settingId, value, text);

                this.addSettingToFormSettingTheme(settingId, settingType, value, originValue);

            }

            ThemeSettingsV2.prototype.setSettingValue = function (settingType, settingId, value, text) {
                var validJQSettingId = this.removeJQInvalidCharacter(settingId);
                switch (settingType) {
                    case "text":
                    case "textarea":
                        $('#setting-' + validJQSettingId).val(value);
                        break;
                    case "color":
                        $('#setting-' + validJQSettingId).spectrum("set", value);
                        //$('.setting-minicolor-' + validJQSettingId).spectrum("set", value);
                        break;
                    case "collection":
                    case "blog":
                    case "page":
                        $('#setting-' + validJQSettingId).val(value);
                        $('#setting-' + validJQSettingId).attr('setting-text', text);
                        $('input.choosed-single-setting-' + validJQSettingId).val(value);
                        $('span.choosed-single-setting-' + validJQSettingId).html(text);
                        break;
                    case "radio":
                        var settingRadios = $(".theme-editor__settings__radio input[id=setting-" + validJQSettingId + "]").each(function () {
                            var input = $(this); // This is the jquery object of the input, do what you will
                        });
                        //var settingRadios = $('#setting-' + validJQSettingId);
                        for (var i = 0; i < settingRadios.length; i++) {
                            if ($(settingRadios[i]).val() == value) {
                                $(settingRadios[i]).prop("checked", true);
                            }
                        }
                        break;
                    case "checkbox":
                        if (value === "true" || value === "True") {
                            $('#setting-' + validJQSettingId).iCheck('check');
                        } else if (value === "false" || value === "False") {
                            $('#setting-' + validJQSettingId).iCheck('uncheck');
                        } else {
                            $('#setting-' + validJQSettingId).iCheck('uncheck');
                        }
                        break;
                    case "select":
                    case "font":
                    case "link_list":
                    case "snippet":
                        $('#setting-' + validJQSettingId).val(value);
                        break;
                    case "image":
                        $('#setting-' + validJQSettingId).val(value);
                        this.showImgTmp(settingId, value);
                        break;
                }
            }

            ThemeSettingsV2.prototype.undo = function () {
                this.undoing = true;
                var changeStep = this.changeSteps.length;

                var settingId = this.changeSteps[changeStep - 1].SettingId;
                var settingType = this.changeSteps[changeStep - 1].SettingType;

                var validJQSettingId = this.removeJQInvalidCharacter(settingId);

                if (settingType == "clearChanges") {
                    return this.undoAfterClearChanges();
                } else if (settingType == "applyPreset") {
                    return this.undoAfterApplyPreset();
                }
                else {
                    var originValue = this.originValues[settingId].OriginValue;
                    var startValue = this.originValues[settingId].StartValue;
                    var startText = this.originValues[settingId].StartText;

                    this.settings[settingId].splice(-1, 1);
                    var settingTypeHasTextDifValue = ['collection', 'blog', 'page'];
                    if ($.inArray(settingType, settingTypeHasTextDifValue) > -1) {
                        this.settingDropdowns[settingId].splice(-1, 1);
                    }

                    var lengthSettingValues = this.settings[settingId].length;
                    if (lengthSettingValues == 0) {
                        var prevSettingValue = startValue;
                        var text = startText;
                    } else {
                        var prevSettingValue = this.settings[settingId][lengthSettingValues - 1];
                        if ($.inArray(settingType, settingTypeHasTextDifValue) > -1) {
                            var text = this.settingDropdowns[settingId][lengthSettingValues - 1];
                        } else {
                            var text = "";
                        }
                    }

                    this.setSettingValue(settingType, settingId, prevSettingValue, text);

                    this.addSettingToFormSettingTheme(settingId, settingType, prevSettingValue, originValue);

                    this.changeSteps.splice(-1, 1);
                    if (this.changeSteps.length == 0) {
                        this.canUndo = false;
                    }
                }
                this.submitFormSettingTheme();

                switch (settingType) {
                    case "radio":
                        this.undoing = false;
                        break;
                    case "checkbox":
                        this.undoing = false;
                        break;
                    case "color":
                        this.undoing = false;
                        break;
                    default:
                        this.undoing = false;
                        break;
                }

                //if (this.changes == 0) {
                //    if (this.isSaved == true) {
                //        this.changes = 1;
                //            $('.btn-remove-changes').removeAttr('disabled');
                //            $('.btn-save-changes').removeAttr('disabled');
                //            $('.btn-remove-changes').removeClass('disabled');
                //            $('.btn-save-changes').removeClass('disabled');
                //            this.isSaved = false;
                //        }
                //    }
            }

            ThemeSettingsV2.prototype.undoAfterApplyPreset = function () {
                var $that = this;
                this.undoAll = true;
                $.each(this.applyPresetValues, function (index) {
                    var settingId = this.SettingId;
                    var settingType = this.SettingType;
                    var originValue = this.OriginValue;
                    var startValue = this.StartValue;

                    $that.settings[settingId].splice(-1, 1);
                    if ($that.settingDropdowns[settingId] != null && $that.settingDropdowns[settingId].length > 0) {
                        $that.settingDropdowns[settingId].splice(-1, 1);
                    }

                    var lengthSettingValues = $that.settings[settingId].length;
                    if (lengthSettingValues == 0) {
                        var prevSettingValue = startValue;
                        var text = startText;
                    } else {
                        var prevSettingValue = $that.settings[settingId][lengthSettingValues - 1];
                        var text = $that.settingDropdowns[settingId][lengthSettingValues - 1];
                    }

                    $that.changeSettingValue(settingId, settingType, prevSettingValue, originValue);
                });

                this.changeSteps.splice(-1, 1);
                if (this.changeSteps.length == 0) {
                    this.canUndo = false;
                }

                this.submitFormSettingTheme();
                this.undoAll = false;
            }

            ThemeSettingsV2.prototype.undoAfterClearChanges = function () {
                var $that = this;
                this.undoAll = true;
                $.each(this.originValues, function (index) {
                    var settingId = this.SettingId;
                    var settingType = this.SettingType;
                    var originValue = this.OriginValue;
                    var startText = $that.originValues[settingId].StartText;

                    $that.settings[settingId].splice(-1, 1);
                    if ($that.settingDropdowns[settingId] != null && $that.settingDropdowns[settingId].length > 0) {
                        $that.settingDropdowns[settingId].splice(-1, 1);
                    }


                    var lengthSettingValues = $that.settings[settingId].length;
                    if (lengthSettingValues == 0) {
                        var prevSettingValue = startValue;
                        var text = startText;
                    } else {
                        var prevSettingValue = $that.settings[settingId][lengthSettingValues - 1];
                        if ($that.settingDropdowns[settingId] != null) {
                            var text = $that.settingDropdowns[settingId][lengthSettingValues - 1];
                        } else {
                            var text = startText;
                        }

                    }

                    $that.changeSettingValue(settingId, settingType, prevSettingValue, originValue, text);
                });

                this.changeSteps.splice(-1, 1);
                if (this.changeSteps.length == 0) {
                    this.canUndo = false;
                }

                this.submitFormSettingTheme();
                this.undoAll = false;
            }

            ThemeSettingsV2.prototype.clearChanges = function () {
                this.undoAll = true;

                var that = this;
                var $frmSettingChanges = $("#frmThemeSettings").find('.frm-setting-item');
                for (var i = 0; i < $frmSettingChanges.length; i++) {
                    var settingItem = $frmSettingChanges[i];
                    var settingId = $(settingItem).attr('setting-id');
                    var settingType = $(settingItem).attr('setting-type');
                    if (that.originValues[settingId] != undefined) {
                        var originValue = that.originValues[settingId].OriginValue;
                        var startValue = that.originValues[settingId].StartValue;
                        var startText = this.originValues[settingId].StartText;
                    } else {
                        var validJQSettingId = this.removeJQInvalidCharacter(settingId);
                        var originSetting = {};
                        var originValue = originSetting.OriginValue = $('#setting-' + validJQSettingId).attr('origin-value');
                        var startValue = $('#setting-' + validJQSettingId).attr('start-value');
                        var startText = $('#setting-' + validJQSettingId).attr('start-text');
                        originSetting.SettingId = settingId;
                        originSetting.SettingType = settingType;
                        originSetting.StartValue = startValue;
                        that.originValues[settingId] = originSetting;
                    }
                    that.changeSettingValue(settingId, settingType, startValue, originValue, startText);
                    this.settings[settingId].push(originValue);

                    var settingTypeHasTextDifValue = ['collection', 'blog', 'page'];
                    if ($.inArray(settingType, settingTypeHasTextDifValue) > -1) {
                        if (startText != undefined && startText != '') {
                            if (this.settingDropdowns[settingId] == null)
                                this.settingDropdowns[settingId] = [];
                            this.settingDropdowns[settingId].push(startText);
                        }
                    }

                }

                this.changes = 0;
                var changeStepDetail = {};
                changeStepDetail.SettingType = "clearChanges";
                changeStepDetail.SettingId = "";
                this.changeSteps.push(changeStepDetail);
                that.presetPreview = false;
                this.undoAll = false;

                var removeAllChangeItems = $("#frmThemeSettings").find('.frm-setting-item');
                for (var i = 0; i < removeAllChangeItems.length; i++) {
                    var settingItem = removeAllChangeItems[i];
                    $(settingItem).remove();
                }
                this.submitFormSettingTheme();
            }

            ThemeSettingsV2.prototype.changeColor = function (settingId, settingType, element) {
                this.postMessageData("changeColor", {
                    key: $(e).data("color-setting"),
                    value: e.value
                });
            }

            ThemeSettingsV2.prototype.postMessageData = function (message, data) {
                var postData = JSON.stringify({
                    message: message,
                    data: data
                });

                this.iframe.contentWindow.postMessage(postData, window.location);

                if (data != null)
                    return data.callbackId

                return void 0;
            };

            ThemeSettingsV2.prototype.showClearChangesModal = function () {
                this.clearChangesModal.show();
            }

            ThemeSettingsV2.prototype.showDeletePresetModal = function (preset) {
                this.deletePresetModal.show();
                $('#delete-preset').val(preset);
                $('#frm-delete-preset').find('.preset-name').html(preset);
            }

            ThemeSettingsV2.prototype.deletePreset = function () {
                var preset = $('#frm-delete-preset').find('input[name=preset]').val();
                $.ajax({
                    url: '/admin/topic/deletepreset',
                    type: "POST",
                    data: $("#frm-delete-preset").serialize(),
                    success: function (result) {
                        $('#presets-list ul').find('#preset-' + preset).remove();
                        if ($('#presets-list ul li').length == 0) {
                            $('#presets-list').removeClass("theme-editor__card");
                        }
                        Bizweb.Modal.hide();
                        Bizweb.Flash.notice("Xóa thiết lập mẫu thành công!");
                    }
                });
            }

            ThemeSettingsV2.prototype.saveCurrentPreset = function () {
                this.saveCurrentPresetModal.show();
            }

            ThemeSettingsV2.prototype.saveCurrentSettingBeforeApplyPreset = function (themeId, preset) {
                var btnClearChanges = $('.btn-remove-changes').attr('disabled');
                var btnSaveChanges = $('.btn-save-changes').attr('disabled');
                if (btnClearChanges != 'disabled' && btnSaveChanges != 'disabled') {
                    this.applyPresetModal.show();
                    $('#apply-preset').val(preset);
                } else {
                    this.applyPreset(themeId, preset);
                }
            }

            ThemeSettingsV2.prototype.applyPresetWithoutSaving = function (themeId) {
                var preset = $('#apply-preset').val();
                this.applyPreset(themeId, preset);
            }

            ThemeSettingsV2.prototype.applyPreset = function (themeId, preset) {
                $("#frmThemeSettings").find("input[name=CurrentSection]").val(this.current_section);
                Bizweb.Loading.start();
                this.undoAll = true;
                var that = this;
                $.ajax({
                    url: '/admin/topic/ApplyPreset',
                    type: "POST",
                    global: false,
                    data: {
                        preset: preset,
                        themeId: themeId
                    },
                    success: function (result) {
                        for (var i = 0; i < result.length; i++) {
                            var settingId = result[i].setting_id;
                            var validJQSettingId = that.removeJQInvalidCharacter(settingId);
                            var settingType = $('#setting-' + validJQSettingId).attr('setting-type');
                            var originValue = $('#setting-' + validJQSettingId).attr('origin-value');
                            var startValue = $('#setting-' + validJQSettingId).attr('start-value');

                            var value = result[i].value;
                            var text = value;
                            that.changeSettingValue(settingId, settingType, value, originValue, value);

                            if (that.settings[settingId] == null)
                                that.settings[settingId] = [];
                            that.settings[settingId].push(value);

                            var settingTypeHasTextDifValue = ['collection', 'blog', 'page'];
                            if ($.inArray(settingType, settingTypeHasTextDifValue) > -1) {
                                if (text != undefined && text != '') {
                                    if (that.settingDropdowns[settingId] == null)
                                        that.settingDropdowns[settingId] = [];
                                    that.settingDropdowns[settingId].push(text);
                                }
                            }

                            var applyPresetValue = {};
                            applyPresetValue.OriginValue = originValue;
                            applyPresetValue.SettingId = settingId;
                            applyPresetValue.SettingType = settingType;
                            applyPresetValue.StartValue = startValue;
                            that.applyPresetValues[settingId] = applyPresetValue;
                        }

                        that.undoAll = false;
                        var changeStepDetail = {};
                        changeStepDetail.SettingType = "applyPreset";
                        changeStepDetail.SettingId = "";
                        that.changeSteps.push(changeStepDetail);
                        Bizweb.Loading.stop();
                        that.submitFormSettingTheme();
                        that.presetPreview = true;
                    }
                });

            }

            ThemeSettingsV2.prototype.changeThemePreviewMode = function (element) {
                var modePreview = $(element).attr('data-preview');
                this.previewSize = modePreview;
                this.viewportSize = modePreview;
                $(document).find("#theme-editor").removeClass("theme-editor--fullscreen");
                $(document).find('.theme-editor__iframe-wrapper').attr('data-preview-window', modePreview);
            };

            ThemeSettingsV2.prototype.previewThemeFullScreen = function () {
                var $editor = $(document).find("#theme-editor");
                $editor.addClass("theme-editor--fullscreen");
                this.viewportSize = 'fullscreen';
            }

            ThemeSettingsV2.prototype.showPreset = function () {
                _.prepareTransition($('#presets-panel')).addClass('theme-editor__panel--is-visible theme-editor__panel--is-active');
            };

            ThemeSettingsV2.prototype.closePreset = function () {
                if (this.changes > 0) {
                    this.clearChanges();
                }
                $("#presets-list ul li button").removeClass("is-selected");

                $("#applyPreset").prop('disabled', true);

                _.prepareTransition($('#presets-panel')).removeClass('theme-editor__panel--is-visible theme-editor__panel--is-active');
            }

            ThemeSettingsV2.prototype.openclearPresetModal = function () {
                this.clearPresetModal.show();

            }

            ThemeSettingsV2.prototype.clearPresetApply = function () {
                Bizweb.Utility.loadAjax(window.location.href, "#theme-editor-sidebar", function () {
                    Bizweb.Flash.notice("Hủy bỏ thành công thiết lập mẫu được áp dụng");
                    that.reload();
                });
            }

            ThemeSettingsV2.prototype.previewPreset = function (element, themeId, preset) {
                $("#presets-list ul li button").removeClass("is-selected");
                $('#apply-preset').val(preset);
                $(element).addClass('is-selected');
                this.applyPreset(themeId, preset);
            }

            ThemeSettingsV2.prototype.confirmApplyPreset = function () {
                this.saveChanges();
                $('#applyPreset').addClass("disabled is-loading");
            }

            ThemeSettingsV2.prototype.initIframe = function () {
                Bizweb.Loading.start();
                var e;
                e = document.getElementById("theme-editor-iframe");
                e.outerHTML = e.outerHTML.replace("<div ", "<iframe ").replace("</div>", "</iframe>");
                this.iframe = document.getElementById("theme-editor-iframe");
            };

            ThemeSettingsV2.prototype.initialLoad = function () {
                var that = this;
                this.iframe.setAttribute("src", this.currentLocation());
                this.iframe.onload = function () {
                    that.postMessageData("reloadedIframe", "");
                    Bizweb.Loading.stop();
                };
            };

            ThemeSettingsV2.prototype.loadIframe = function (f) {
                var that = this;
                //f.src = this.currentLocation();
                f.setAttribute("src", this.currentLocation());
                f.onload = function () {
                    that.syncScrollPosition(that.iframe, that.iframeForReload);
                    var t = that.iframe;
                    that.iframe = that.iframeForReload;
                    that.iframeForReload = null;
                    that.removeIframe(t);
                    that.postMessageData("reloadedIframe", "");
                    Bizweb.Loading.stop();
                };
            };

            ThemeSettingsV2.prototype.reload = function () {
                Bizweb.Loading.start();
                this.isReloading = !0;
                this.iframeForReload = this.cloneIframe(this.iframe);
                this.loadIframe(this.iframeForReload);

            };

            ThemeSettingsV2.prototype.cloneIframe = function (e) {
                var t;
                return t = e.cloneNode(!1), t.removeAttribute("src"), e.parentNode.appendChild(t), Twine.bind(t), t
            };

            ThemeSettingsV2.prototype.removeIframe = function (e) {
                Twine.unbind(e);
                e.onload = null;
                $(e).slideUp({ duration: 1000, queue: false })
                    .fadeOut({ duration: 10, queue: false })
                    .promise().done(function () {
                        e.parentNode.removeChild(e);
                    })
                //$(e).fadeOut(100, function () { e.parentNode.removeChild(e); });
            }

            ThemeSettingsV2.prototype.syncScrollPosition = function (e, t) {
                var n;
                n = e.contentWindow.scrollY;
                t.contentWindow.scrollBy(0, n);
            };

            ThemeSettingsV2.prototype.currentLocation = function () {
                var e, t, n;
                return n = this.iframe.getAttribute("data-src"), "/" === location.hash.charAt(1) ? (e = location.hash.substr(1), t = n.slice(n.indexOf("/?") + 1), location.protocol + "//" + location.host + e + t) : n
            };

            ThemeSettingsV2.prototype.updateIframeLocation = function (t) {
                var e;
                return e = location.protocol + "//" + location.host + location.pathname + location.search, "/" !== t && (e += "#" + t), window.history.replaceState({
                    path: t
                }, "", e)
            }

            return ThemeSettingsV2;
        }();
    }.call(this),
    function () {
        Bizweb.ThemeEditorPreviewV2 = function () {
            function ThemeEditorPreviewV2() {

            }

            ThemeEditorPreviewV2.prototype.previewThemeFullScreen = function () {
                var $editor = $(document).find("#theme-editor");
                if ($editor.hasClass("theme-editor--fullscreen")) {
                    $editor.removeClass("theme-editor--fullscreen");
                }
                else {
                    $editor.addClass("theme-editor--fullscreen");
                }
            }

            return ThemeEditorPreviewV2;
        }();
    }.call(this),
    function () {
        var applyObjectToEvent = function (event, context) {
            return function () {
                return event.apply(context, arguments)
            }
        }

        Bizweb.SingleSelectRemoteSourceAutocomplete = function () {
            function SingleSelectRemoteSourceAutocomplete(element, options) {
                this.closePopover = applyObjectToEvent(this.closePopover, this);

                this.element = element;
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.allItems = [];
                this.suggestItems = [];
                this.initSelectItems();

                $('body').on('click', this.closePopover);
                var that = this;
                $(element).focusout(function (event) {
                    that.closePopover(event);
                });
            }

            SingleSelectRemoteSourceAutocomplete.prototype.initSelectItems = function () {
                var items = $(this.element).find(".next-list__item");
                if (this.allItems.length <= 0) {
                    for (var i = 0; i < items.length; i++) {
                        var item = items[i];
                        var value = $(item).attr('item-value');
                        this.allItems.push(value);
                    }
                }
                this.suggestItems = this.allItems;
                this.showSelected();
            }

            SingleSelectRemoteSourceAutocomplete.prototype.suggest = function (key, showAllItems) {
                this.suggestItems = [];
                var items = $(this.element).find(".next-list--toggles");
                $(items).empty();
                if ($.trim(key).length == 0 || showAllItems == true) {
                    this.suggestItems = this.allItems;
                } else {
                    for (var i = 0; i < this.allItems.length; i++) {
                        var item = this.allItems[i];
                        if (item.toLowerCase().search(key.toLowerCase()) > -1) {
                            this.suggestItems.push(item);
                        }
                    }
                }

                this.showSuggestItems(key, showAllItems);

                $(this.element).find(".next-popover").addClass('next-popover--is-active');
                $(this.element).find(".next-popover").addClass('next-popover--is-positioned-beneath');
            }

            SingleSelectRemoteSourceAutocomplete.prototype.showSuggestItems = function (key, showAllItems) {
                var that = this;
                var items = $(this.element).find(".next-list--toggles");
                var addNew = this.getSuggestNewItem(-1, key);
                var addSuggestNew = $(addNew);
                items.append(addSuggestNew);
                Bindings.bind(addSuggestNew[0], that);
                var hasItemMatchKey = false;
                for (var i = 0; i < this.suggestItems.length; i++) {
                    var item = this.suggestItems[i];
                    if (item == key) {
                        hasItemMatchKey = true;
                    }
                    var suggestItem = that.getSuggestItem(i, item);
                    var appendItem = $(suggestItem);
                    items.append(appendItem);
                    Bindings.bind(appendItem[0], that);
                }
                if (hasItemMatchKey)
                    addSuggestNew.remove();
                if ($.trim(key).length == 0)
                    addSuggestNew.remove();

                this.showSelected();
            }

            SingleSelectRemoteSourceAutocomplete.prototype.getSuggestNewItem = function (index, value) {
                var item = '<li><a bind-event-click="selectSuggestion(this)" class="next-list__item next-list__item--promoted-action" item-value="' + htmlEscape(value) + '"><div class="next-grid next-grid--no-outside-padding next-grid--compact"><div class="next-grid__cell next-grid__cell--no-flex"><i class="gi gi-plus pull-left next-icon next-icon--12"></i></div><div class="next-grid__cell"><strong> Thêm </strong>"' + htmlEscape(value) + '"</div></div></a></li>';
                return item;
            }

            SingleSelectRemoteSourceAutocomplete.prototype.getSuggestItem = function (index, value) {
                var item = '<li><a bind-event-click="selectSuggestion(this)" class="next-list__item" item-value="' + htmlEscape(value) + '"><div class="next-grid next-grid--no-outside-padding next-grid--compact"><div class="next-grid__cell next-grid__cell--no-flex"><i class="gi pull-left gi-ok next-icon next-icon--12"></i></div><div class="next-grid__cell">' + htmlEscape(value) + '</div></div></a></li>';
                return item;
            }

            SingleSelectRemoteSourceAutocomplete.prototype.inputChanged = function (event) {
                if (event.keyCode != 13) {
                    var key = $(this.element).find('.next-field--connected').val();
                    this.suggest(key, false);
                }
            }

            SingleSelectRemoteSourceAutocomplete.prototype.showSelected = function () {
                $('.next-list__item').removeClass('next-list__item--is-applied');
                $('.next-list__item').removeClass('next-list__item--is-selected');

                var items = $(this.element).find(".next-list__item");
                var selectedValue = $(this.element).find('.next-field--connected').val();
                for (var i = 0; i < items.length; i++) {
                    var item = items[i];
                    var value = $(item).attr('item-value');
                    if (value == selectedValue) {
                        $(item).addClass('next-list__item--is-applied');
                        $(item).addClass('next-list__item--is-selected');
                    }
                }
            }

            SingleSelectRemoteSourceAutocomplete.prototype.selectInputValue = function (event) {
                if (event.keyCode == 13) {
                    var value = $(this.element).find('.next-field--connected').val();
                    this.selectValue(value);
                }
            }

            SingleSelectRemoteSourceAutocomplete.prototype.selectSuggestion = function (item) {
                var value = $(item).attr('item-value');
                this.selectValue(htmlUnescape(value));
            }

            SingleSelectRemoteSourceAutocomplete.prototype.selectValue = function (value) {
                $(this.element).find('.next-field--connected').val(value);

                $(".next-popover").removeClass('next-popover--is-active');
                $(".next-popover").removeClass('next-popover--is-positioned-beneath');
                this.showSelected();
            }

            SingleSelectRemoteSourceAutocomplete.prototype.togglePopover = function () {
                this.showSelected();
                var display = $(".next-popover-" + this.type).hasClass('next-popover--is-active');
                if (display) {
                    $(".next-popover").removeClass('next-popover--is-active');
                    $(".next-popover").removeClass('next-popover--is-positioned-beneath');
                } else {
                    var key = $(this.element).find('.next-field--connected').val();
                    this.suggest(key, true);
                }
            }

            SingleSelectRemoteSourceAutocomplete.prototype.closePopover = function (event) {
                var eventId = $(event.target).attr('id');
                var type = this.type;
                if ((eventId != ('btn-toggle-popover-' + this.type)) && (eventId != ('fa-toggle-' + this.type)) && eventId != type) {
                    $(".next-popover-" + type).removeClass('next-popover--is-active');
                    $(".next-popover-" + type).removeClass('next-popover--is-positioned-beneath');
                }
            }
            return SingleSelectRemoteSourceAutocomplete;
        }();
    }.call(this),
    function () {
        Bizweb.AddSavedSearch = function () {
            function AddSavedSearch(element, options) {
                this.id = null;
                this.name = null;
            }

            AddSavedSearch.prototype.showCreateSavedSearch = function () {
                $("#div-update-saved-search").hide();
                $("#div-create-saved-search").show();
            }

            AddSavedSearch.prototype.showUpdateSavedSearch = function () {
                $("#div-create-saved-search").hide();
                $("#div-update-saved-search").show();
            }

            AddSavedSearch.prototype.submitForm = function () {
                //if (!$('#frm-saved-search').valid()) {
                //    return;
                //}

                if ($('#create-saved-search').length == 0 || $('#create-saved-search').prop("checked")) {
                    var name = $('input[name=Name]').val();
                    $("#savedSearchSave").addClass("disabled").addClass("is-loading");
                    $('#frm-saved-search').submit();
                } else {
                    var overrideId = $('#override-saved-search').val();
                    if (overrideId <= 0) {
                        Bizweb.Flash.error("Chọn kết quả tìm kiếm lưu đè");
                        return false;
                    } else {
                        $(".btn-add").addClass("disabled").html(Bizweb.LOADING);
                        $('#frm-saved-search').submit();
                    }
                }
            }

            return AddSavedSearch;
        }();
    }.call(this),
    function () {
        var e = function (segments, url) {
            var uri = new URI(url);

            if (url == null)
                url = "";

            var segment = uri.segment();
            var i = segment.slice(0, segments.length);

            if (Common.difference(segments, i).length > 0) {
                var n, s;
                for (n = s = 0; s < segments.length; n = ++s) {
                    var o = segments[n];
                    var segment = uri.segment();
                    segment.splice(n, 0, o);
                    uri.segment(segment);
                }
            }

            return uri;
        };

        var buildUrl = function (uri) {
            var url;
            url = uri.path() + uri.search() + uri.hash();

            if (url[0] !== "/")
                url = "/" + url;

            return url;
        };

        Bizweb.Path = {
            admin: function (location) {
                return buildUrl(e(["admin"], location))
            },
            app: function (appAlias, location) {
                return buildUrl(e(["admin", "apps", appAlias], location))
            }
        }
    }.call(this),
    function () {
        var applyObjectToEvent = function (event, context) {
            return function () {
                return event.apply(context, arguments)
            }
        }

        Bizweb.MultipleDropdown = function () {
            function MultipleDropdown(element, options) {
                this.checkFocus = applyObjectToEvent(this.checkFocus, this);

                $(document).on("click", this.checkFocus);


                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                if (options["type"] != null)
                    this.Type = options["type"];

                this.element = element;
                this.timer = null;
                this.request = null;
                this.isLoaded = false;
            };

            MultipleDropdown.prototype.checkFocus = function (e) {
                var clickedElement = $(e.target);
                if (clickedElement.closest(".dropdown").length == 0 && clickedElement.find(".dropdown-toggle").length > 0) {
                    this.hideDropdown();
                }
            }

            MultipleDropdown.prototype.dropdown = function () {
                var that = this;
                if (!this.isLoaded) {
                    $.ajax({
                        type: "GET",
                        url: _urlMultipleMappings[this.Type],
                        success: function (data) {
                            that.isLoaded = true;
                            $(that.element).append(data);
                            Bindings.bind($(that.element).find(".dropdown").get(0), that);
                        },
                        error: function (error) {

                        },
                        complete: function () {
                            if ($(that.element).find(".dropdown").hasClass('is-visible'))
                                $(that.element).find(".dropdown").removeClass('is-visible');
                            else
                                $(that.element).find(".dropdown").addClass('is-visible');
                        }
                    });
                } else {
                    if ($(this.element).find(".dropdown").hasClass('is-visible'))
                        $(this.element).find(".dropdown").removeClass('is-visible');
                    else
                        $(this.element).find(".dropdown").addClass('is-visible');
                }
            }

            MultipleDropdown.prototype.suggest = function () {
                var that = this;
                var query = $(this.element).find(".query").val();
                var url = _urlMultipleSuggestMappings[this.Type] + "query=" + query;
                this.page = 1;

                if (this.timer != null) {
                    clearTimeout(this.timer);
                }

                this.timer = setTimeout(function () {
                    if (this.request != null) {
                        this.request.abort();
                    }
                    this.request = $.ajax({
                        url: url,
                        type: "GET",
                        success: function (data) {
                            $(that.element).find(".multiple-suggest-result").html(data);
                            Bindings.bind($(that.element).find(".dropdown").get(0), that);
                        }
                    });
                }, 1000);
            }

            MultipleDropdown.prototype.hideDropdown = function () {
                if ($(this.element).find(".dropdown").hasClass('is-visible'))
                    $(this.element).find(".dropdown").removeClass('is-visible');
            }


            MultipleDropdown.prototype.next = function () {
                var query = $(this.element).find(".query").val();
                var url = _urlMultipleSuggestMappings[this.Type] + "query=" + query;
                this.page = this.page + 1;
                this.next_page = url + "&page=" + (this.page);
                this.loadUrl(this.next_page);
            }

            MultipleDropdown.prototype.prev = function () {
                var query = $(this.element).find(".query").val();
                var url = _urlMultipleSuggestMappings[this.Type] + "query=" + query;
                this.page = this.page - 1;
                this.prev_page = url + "&page=" + (this.page);
                this.loadUrl(this.prev_page);
            }

            MultipleDropdown.prototype.loadUrl = function (url) {
                var that = this;
                var that = this;
                $.ajax({
                    url: url,
                    success: function (data) {
                        $(that.element).find(".multiple-suggest-result").html(data);
                        Bindings.bind($(that.element).find(".dropdown").get(0), that);
                    }
                });
            }

            return MultipleDropdown;
        }();
    }.call(this),
    function () {
        Bizweb.CollectionMultipleDropdown = function () {
            function CollectionMultipleDropdown(element, options) {
                CollectionMultipleDropdown.base.constructor.call(this, element, options);
            };

            extend(Bizweb.MultipleDropdown, CollectionMultipleDropdown);

            CollectionMultipleDropdown.prototype.toggle = function (id, name, image) {
                var existCollection = $(".list-collection table tr[collection-id='" + id + "']").length > 0;
                if (existCollection) {
                    this.removeCollection(id);
                }
                else {
                    var thumb = Bizweb.Utility.getThumb(image, "thumb");
                    var html = '<tr collection-id="' + id + '">' +
                        '<td class="pl-none">' +
                        '<img src="' + (thumb != "" ? thumb : "/assets/images/no-image-50-50.png") + '" class="' + (thumb != "" ? "" : "image-is-blank") + '"/>' +
                        '</td>' +
                        '<td>' +
                        '<a href="/admin/collections/' + id + '">' + name + '</a>' +
                        '</td>' +
                        '<td class="pr-none" style="width: 80px; text-align:right;">' +
                        '<a bind-event-click="removeCollection(' + id + ')" href="javascript:void(0)">' +
                        '<i class="gi gi-remove"></i>' +
                        '</a>' +
                        '<input type="hidden" name="collectionId" value="' + id + '"/>' +
                        '</td>' +
                        '</tr>';
                    $(".list-collection table tbody").append(html);
                    Bindings.bind($(".list-collection")[0]);

                    $(".collection-select[collection-id='" + id + "']").addClass("added-ico");
                }

                var addedCount = $(".list-collection").find("table tr").length;
                if (addedCount > 0) {
                    $(".no-colection-found").hide();
                }
                else {
                    $(".no-colection-found").show();
                }
            }

            CollectionMultipleDropdown.prototype.removeCollection = function (id) {
                $(".list-collection table tr[collection-id='" + id + "']").remove();
                $(".collection-select[collection-id='" + id + "']").removeClass("added-ico");
                var addedCount = $(".list-collection").find("table tr").length;
                if (addedCount > 0) {
                    $(".no-colection-found").hide();
                }
                else {
                    $(".no-colection-found").show();
                }
            }

            return CollectionMultipleDropdown;
        }();
    }.call(this),
    function () {
        Bizweb.ProductMultipleDropdown = function () {
            function ProductMultipleDropdown(element, options) {
                ProductMultipleDropdown.base.constructor.call(this, element, options);
            };

            extend(Bizweb.MultipleDropdown, ProductMultipleDropdown);

            ProductMultipleDropdown.prototype.existProductId = function (productId) {
                return this.product_ids.indexOf(productId) > -1;
            }

            ProductMultipleDropdown.prototype.toggle = function (productId, name, image) {
                var that = this;
                var collectionId = this.collectionId;
                var count = $(".list-product table tr").length;
                var limit = $('.sort-products-context').attr('product-limit');

                if (this.product_ids.indexOf(productId) > -1) {
                    var collectId = $(".list-product table tr[product-id='" + productId + "']").attr('collect-id');
                    that.deleteProduct(collectId, collectionId, productId);
                }
                else {
                    $("#frmAddProduct input[name='productId']").val(productId);
                    $("#frmAddProduct input[name='collectionId']").val(collectionId);
                    $.ajax({
                        url: '/admin/collections/AddProduct',
                        type: "POST",
                        data: $("#frmAddProduct").serialize(),
                        success: function (data) {
                            that.product_ids.push(productId);
                            if (count < limit) {
                                var addedProductHtml = that.generateAddedProductItem(collectionId, productId, name, image, data.id, data.position);
                                $(".list-product table tbody").append(addedProductHtml);
                                var addedProduct = $(".list-product table tr[product-id='" + productId + "']");
                                var sortOrder = $('select[name=SortOrder]').val();
                                if (sortOrder == "manual") {
                                    var index = addedProduct.attr('product-position');
                                    addedProduct.prepend(that.enableDragProduct(index));
                                }
                                Bindings.bind(addedProduct.get(0), Bindings.context(document.body).editCollection.sortProducts);
                            } else {
                                $('.btn-next').removeClass("disabled");
                            }
                            $(".product-dropdown .product-suggest-result li[product-id='" + productId + "']").addClass("added-ico");
                            $('.no-product-found').hide();
                            Bizweb.Flash.notice("Cập nhật danh mục thành công");
                        }
                    });
                }
            }

            ProductMultipleDropdown.prototype.deleteProduct = function (collectId, collectionId, productId) {
                Bindings.context(document.body).editCollection.sortProducts.removeProduct(collectId, collectionId, productId);
                var index = this.product_ids.indexOf(productId);
                if (index >= 0) {
                    this.product_ids.splice(index, 1);
                }
            }

            ProductMultipleDropdown.prototype.generateAddedProductItem = function (collectionId, productId, productName, productImage, collectId, index) {
                var limit = $('.sort-products-context').attr('product-limit');
                var imgSrc = "/assets/images/no-image-50-50.png";
                if (productImage != '') {
                    imgSrc = Bizweb.Utility.getThumb(productImage, "thumb");
                }

                return '<tr product-id="' + productId + '" class="product-item product-image" product-position="' + index + '" id="collect-' + collectId + '" collect-id ="' + collectId + '" >' +
                    '<td class="pl-none"><img src="' + imgSrc + '" class="' + (productImage != "" ? "" : "image-is-blank") + '" /></td>' +
                    '<td class=""><a href="/admin/products/' + productId + '">' + productName + '</a></td>' +
                    '<td class="pr-none"><a bind-event-click="removeProduct(' + collectId + ',' + collectionId + ',' + productId + ')" href="javascript:void(0)" id="remove-collect-' + collectId + '"><i class="gi gi-remove"></i></a><input type="hidden" name="productIds" value="' + productId + '" /></td>' +
                    '</tr>';
            }

            ProductMultipleDropdown.prototype.generateInputProduct = function (productId, collectId) {
                return '<input type="hidden" name="productIds" value="' + productId + '" product-id="' + productId + '" collect-id="' + collectId + '" />';
            }

            ProductMultipleDropdown.prototype.enableDragProduct = function (index) {
                return '<td class="pl-none"><span class="col-sm-3 dragable-product-item"> <input type="hidden" class="product-option-sort" name="product.sort" value="' + index + '"/><i class="ico-drag-handle"></i></span></td>';
            }

            return ProductMultipleDropdown;
        }();
    }.call(this),
    function () {
        Bizweb.CustomersImportAndExport = function () {
            function CustomersImportAndExport(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            CustomersImportAndExport.prototype.showExportCustomers = function () {
                this.exportCustomersModal.show();
                var formFilter = $('#frmFilter');
                var formExport = $('#form-export-customers');
                var formBulkAction = $('#frmBulkActions');
                var countAddedInputs = this.copyFromFormToAnother(formFilter, formExport);
                var countAddedInputIds = this.copyOnlyInputNameFromFormToAnother(formBulkAction, formExport, "ids");
                if (countAddedInputIds <= 0) {
                    $('#exportCustomersType-selected-customers').attr("disabled", "disabled");
                }
                $('#customers-match-current-search').html(this.customers_match_current_search + " ");
                if (countAddedInputs < 1) {
                    $('#exportCustomersType-current-search').attr("disabled", "disabled");
                }
            }

            CustomersImportAndExport.prototype.exportCustomers = function () {
                var that = this;
                var formExport = $('#form-export-customers');
                $.ajax({
                    url: '/admin/customers/Export',
                    type: "POST",
                    data: formExport.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        } else {
                            Bizweb.Flash.notice(result.success);
                        }
                        that.exportCustomersModal.hide();
                    }
                });
            }

            CustomersImportAndExport.prototype.copyFromFormToAnother = function (formA, formB) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).val()) {
                        $('[name=' + $(this).attr('name') + ']', formB).val($(this).val());
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            CustomersImportAndExport.prototype.copyOnlyInputNameFromFormToAnother = function (formA, formB, inputName) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).attr('name') == inputName) {
                        var value = $(this).attr('value');
                        formB.append("<input type='hidden' name='" + inputName + "' value='" + value + "' />");
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            CustomersImportAndExport.prototype.enableButtonImport = function () {
                var fileUpload = $('#importCustomersFileUpload').val();

                if (fileUpload != undefined && fileUpload != '') {
                    $('.btn-import-customers').prop('disabled', false);
                } else {
                    $('.btn-import-customers').prop('disabled', true);
                }

            }

            CustomersImportAndExport.prototype.openFileImportCustomers = function () {
                this.importCustomersModal.show();
                $('#importCustomersFileUpload').val('');
            }

            CustomersImportAndExport.prototype.importCustomers = function () {
                $('#form-import-customers').submit();
            }

            return CustomersImportAndExport;
        }();
    }.call(this),
    function () {
        Bizweb.SaleChannel = function () {
            function SaleChannel(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            SaleChannel.prototype.remove = function (id) {
                var that = this;
                $(".btn-add-channel").addClass("disabled").html(Bizweb.LOADING);
                Bizweb.Loading.start();
                $.ajax({
                    url: Bizweb.routes.channels + "/remove/" + id,
                    type: "POST",
                    global: false,
                    success: function (data) {
                        window.location.reload();
                    },
                    error: function (data) {
                        $(".btn-add-channel").removeClass("disabled").html("Thêm mới " + that.name);
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        Bizweb.Loading.stop();
                    }
                });
            }

            return SaleChannel;
        }();
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };
        Bizweb.KeyboardSelector = function () {
            function e(e, n) {
                this._keypressHandler = t(this._keypressHandler, this), this.cssClass = n, $(e).on("keydown", this._keypressHandler)
            }
            var n;
            return e.name = "KeyboardSelector", n = {
                enter: 13,
                up: 38,
                down: 40
            }, e.prototype.bind = function (t, e) {
                return this.selectedIndex = null, this.$lastSelectedNode = null, this.children = $(t).find(e).toArray(), this
            }, e.prototype._keypressHandler = function (t) {
                switch (t.which) {
                    case n.enter:
                        this._selectOption();
                        break;
                    case n.up:
                        this._focusPreviousOption();
                        break;
                    case n.down:
                        this._focusNextOption();
                        break;
                    default:
                        return !0
                }
                return !1
            }, e.prototype._selectOption = function () {
                var t;
                return null != (t = this.$lastSelectedNode) ? t.trigger("click") : void 0
            }, e.prototype._focusPreviousOption = function () {
                return null != this.children ? this.focusOption(this.$lastSelectedNode && 0 !== this.selectedIndex ? this.selectedIndex - 1 : this.children.length - 1) : void 0
            }, e.prototype._focusNextOption = function () {
                return null != this.children ? this.focusOption(this.$lastSelectedNode && this.selectedIndex !== this.children.length - 1 ? this.selectedIndex + 1 : 0) : void 0
            }, e.prototype.focusOption = function (t) {
                var e;
                return null != (e = this.$lastSelectedNode) && e.removeClass(this.cssClass), this.selectedIndex = t, this.$lastSelectedNode = $(this.children[this.selectedIndex]), this.$lastSelectedNode.addClass(this.cssClass)
            }, e
        }()
    }.call(this),
    function () {
        var t = [].slice;
        Bizweb.dedupedXHR = function (e, n) {
            var o, i;
            return null == n && (n = null), o = null, i = null,
                function () {
                    var r, a, s;
                    return a = 1 <= arguments.length ? t.call(arguments, 0) : [], "pending" === (null != o ? o.state() : void 0) && o.abort(), null != n ? (s = this, clearTimeout(i), r = function () {
                        return o = e.apply(s, a)
                    }, i = setTimeout(r, n)) : o = e.apply(this, a)
                }
        }
    }.call(this),
    function () {
        Bizweb.Partial = function () {
            function t(t, e, n) {
                this.node = t, this.partial_container_id = e, this.options = null != n ? n : {
                    replace: !1
                }, this.$container = $("#" + this.partial_container_id)
            }
            return t.name = "Partial", t.prototype.loadPartial = function (t) {
                var e;
                return null == t && (t = Bindings.context(this.node)), e = this.node.getAttribute("href"), this.fetchHTML(e, t)
            }, t.prototype.fetchHTML = function (t, e) {
                var n, o = this;
                return n = $.ajax({
                    dataType: "html",
                    url: t
                }), n.done(function (t) {
                    return o.show(t, e)
                }), n.fail(Bizweb.handleError)
            }, t.prototype.show = function (t, e) {
                var n;
                return n = $(t), this.$container = this.options.replace ? this.$container.html(n) : this.$container.append(n), Bindings.bind(this.$container.children().last()[0], e).refreshImmediately()
            }, t
        }()
    }.call(this),
    function () {
        var t = {}.hasOwnProperty,
            e = function (e, n) {
                function o() {
                    this.constructor = e
                }
                for (var i in n) t.call(n, i) && (e[i] = n[i]);
                return o.prototype = n.prototype, e.prototype = new o, e.__super__ = n.prototype, e
            };
        Bizweb.ResourceDropdown = function (t) {
            function n(t, e, n) {
                this.node = t, this.partial_container_id = e, this.options = null != n ? n : {
                    replace: !1
                }, this.$node = $(t), this.$container = $("#" + this.partial_container_id), this.initialized = !1, this.submitQuery = _.debounce(Bizweb.dedupedXHR(this.submitQuery), 300)
            }
            return e(n, t), n.name = "ResourceDropdown", n.prototype.renderDropdown = function () {
                return this.initialized ? void 0 : (this.loadPartial(), this.initialized = !0)
            }, n.prototype.focus = function () {
                return this.$node.focus()
            }, n.prototype.submitQuery = function (t, e, n) {
                var o;
                return t || (t = this.$node.attr("href")), t += t.indexOf("?", 0) >= 0 ? "&" : "?", t += "query=" + e, o = $.ajax({
                    dataType: "html",
                    url: t
                }), o.done(function (t, e, o) {
                    return Page.refresh({
                        response: o,
                        onlyKeys: n
                    })
                }), o.fail(Bizweb.handleError), Bindings.refresh(), o
            }, n
        }(Bizweb.Partial)
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        },
            e = {}.hasOwnProperty,
            n = function (t, n) {
                function o() {
                    this.constructor = t
                }
                for (var i in n) e.call(n, i) && (t[i] = n[i]);
                return o.prototype = n.prototype, t.prototype = new o, t.__super__ = n.prototype, t
            };
        Bizweb.SearchDropdown = function (e) {
            function o(e, n, i, r, a, name, isRender) {
                this.refreshKeys = r, this.clearSearchQuery = t(this.clearSearchQuery, this), o.__super__.constructor.call(this, e, n, a), this.query = "", $("#" + i).on("dropdown:hide", this.clearSearchQuery)
                if (isRender) {
                    this.renderDropdown();
                    $("#" + i).trigger("focus");
                }
            }
            return n(o, e), o.name = name, o.prototype.clearSearchQuery = function () {
                return this.query.length ? (this.query = "", this.submitQuery()) : void 0
            }, o.prototype.submitQuery = function (t) {
                var e = this;
                return Bindings.unbind(this.$container[0]), o.__super__.submitQuery.call(this, typeof (t) == "string" ? t : null, this.query, this.refreshKeys).done(function () {
                    return Bindings.bind(e.$container[0]), "" !== e.query && null != t ? t.focusOption(0) : void 0
                })
            }, o.prototype.fetchHTML = function () {
                var t = this;
                return Bindings.unbind(this.$container[0]), o.__super__.fetchHTML.apply(this, arguments).done(function () {
                    return Bindings.bind(t.$container[0])
                })
            }, o
        }(Bizweb.ResourceDropdown)
    }.call(this),
    function () {
        var applyObjectToEvent = function (event, object) {
            return function () {
                return event.apply(object, arguments)
            }
        }

        Bizweb.DraftBuilder = function () {
            function DraftBuilder(element, options) {
                if (options) {
                    var property;
                    for (property in options) this[property] = options[property];
                }

                this.line_items = [];
                this.shipping_methods = [];
                this.default_customer = { id: 0, shipping_address: null, billing_address: null }
                this.customer = this.default_customer;
                this.hasCustomerInfo = this.customer.id != 0;
                this.default_address = { last_name: null, first_name: null, address1: null, province: null, province_code: null, country: null, country_code: null };
                this.no_shipping_address = true;
                this.no_billing_address = true;
                this.is_discount_percent = false;
                this.reason_discount = "";
                this.email = "";
                this.discount = 0;
                this.isDiscountPercent = false;
                this.reason_discount = "";
                this.apply_discount = null;
                this.isShippingInVietnam = false;
                this.resetAddress();
                this.custom_shipping_name = null;
                this.custom_shipping_fee = null;
                this.shipping_custom = true;
                this.shipping_value = "custom";
                this.validDraftOrder = true;
                this.isCreating = false;
                this.copyOrderId = 0;
                this.cancelSourceOrder = null;
                this.isShippingCustom = applyObjectToEvent(this.isShippingCustom, this);
                this.ajaxGetShipping = null;
                this.discount_target_type = null;
                this.cusEmail = "";
                if (this.copy_order) {
                    this.copyOrderId = this.copy_order.id;
                    this._bindFromOrder(this.copy_order);
                }

                initAutoNumeric();
            };

            DraftBuilder.prototype._bindFromOrder = function (order) {
                var that = this;
                this.email = order.email;
                this.note = order.note;
                this.tags = order.tags;
                this.cusEmail = order.email;

                if (order.customer) {
                    this.customer = order.customer;
                    this.cusEmail = order.customer.email;
                }

                if (order.shipping_address) {
                    this._bindShippingAddress(order.shipping_address);
                    this.no_shipping_address = false;
                }

                if (order.billing_address) {
                    this._bindBillingAddress(order.billing_address);
                    this.no_billing_address = false;
                }

                if (order.line_items) {
                    order.line_items.forEach(function (item, index) {
                        item.id = item.variant_id;
                        item.name = item.title;
                        item.title = item.variant_title;

                        if (item.image && item.image.src)
                            item.image = item.image.src;

                        that._addLineItem(item);

                        if (item.total_discount > 0)
                            that._applyDiscountLineItem(index, item.total_discount, item.discount_code);
                    });
                }

                this.hasCustomerInfo = true;
                Bindings.unbind($(".order-sidebar")[0]);
                Bindings.bind($(".order-sidebar")[0], this);
                Bindings.refreshImmediately();

                if (order.shipping_lines && order.shipping_lines.length > 0) {
                    that.shipping_custom = that.shipping_custom_tmp = false;
                    that.shipping_name = order.shipping_lines[0].title;
                    that.shipping_fee = parseFloat(order.shipping_lines[0].price);
                }

                if (order.discount_codes && order.discount_codes.length > 0) {
                    if (!!order.discount_codes[0].custom) {
                        this.discount = this.discount_tmp = order.discount_codes[0].amount;
                        this.reason_discount = this.reason_discount = order.discount_codes[0].code;
                        this.is_discount_percent = this.is_discount_percent = false;
                    }
                    else {
                        this.apply_discount = {};
                        this.apply_discount.amount = order.discount_codes[0].amount;
                        this.apply_discount.code = this.apply_discount_code_input = order.discount_codes[0].code;
                        this.apply_discount.type = order.discount_codes[0].type;
                    }
                }

                this.getShippingMethods(function (data) {
                    if (order.shipping_lines && order.shipping_lines.length > 0) {
                        var selectedShippingMethod;
                        if (data.shipping_methods && data.shipping_methods.length > 0) {
                            for (var i = 0; i < data.shipping_methods.length; i++) {
                                var shippingMethod = data.shipping_methods[i];
                                if (shippingMethod.name == order.shipping_lines[0].title)
                                    selectedShippingMethod = shippingMethod;
                            }
                        }

                        if (selectedShippingMethod) {
                            that.shipping_custom = that.shipping_custom_tmp = false;
                            that.shipping_name = order.shipping_lines[0].title;
                            that.shipping_fee = parseFloat(selectedShippingMethod.fee);
                            $(".shipping-methods-select").find('input[type="radio"][shipping-name="' + that.shipping_name + '"]').iCheck('check');
                            $(".btn-apply-shipping").removeClass("disabled");
                        }
                        else {
                            that.shipping_custom = that.shipping_custom_tmp = true;
                            that.shipping_name = that.custom_shipping_name = that.custom_shipping_name_tmp = order.shipping_lines[0].title;
                            that.shipping_fee = that.custom_shipping_fee = that.custom_shipping_fee_tmp = parseFloat(order.shipping_lines[0].price);
                            $(".shipping-methods-select").find('input[type="radio"][value="custom"]').iCheck('check');
                            $(".btn-apply-shipping").removeClass("disabled");
                        }

                        that.hasShipping = true;
                    }

                    $(document).click();
                });
            }

            DraftBuilder.prototype.resetShipping = function () {
                this.shipping_name = "";
                this.shipping_fee = 0;
                this.isShippingInVietnam = false;
            }

            DraftBuilder.prototype.resetApplyDiscount = function () {
                this.discount_tmp = this.discount;
                this.reason_discount_tmp = this.reason_discount;
                this.isDiscountPercentTmp = this.is_discount_percent;

                initAutoNumeric();
            }

            DraftBuilder.prototype.addLineItem = function (variant) {
                var lineItem = this._addLineItem(variant);

                Bizweb.Modal.hide();

                if (lineItem) {
                    $(".line_item_" + lineItem.item_index).find(".line_item_quantity").focus().select();
                    $(document).click();

                    this.getShippingMethods();
                }
            }

            DraftBuilder.prototype._addLineItem = function (variant) {
                variant.quantity = this.getRoundQuantity(variant.quantity);

                if (typeof (variant.price) == "string") {
                    variant.price = parseFloat(variant.price);
                }

                if (variant.title == undefined) {
                    variant.title = "";
                }

                if (variant.id > 0) {
                    var tr = $(".variant_id_" + variant.id);
                    var itemIndex = $(tr).attr("item-index");
                    if (tr.length > 0) {
                        var lineItemQuantity = tr.find(".line_item_quantity");
                        var quantity = this.getRoundQuantity(lineItemQuantity.val());
                        if (isNaN(quantity)) {
                            quantity = 1;
                        }
                        this.line_items[itemIndex].quantity = quantity;
                        Bindings.bind($(".line_item_" + itemIndex).get(0), this);
                        Bindings.refreshImmediately();
                        tr.find(".line_item_quantity").focus().select();
                        $(document).click();
                        return;
                    }
                }

                variant.item_index = this.line_items.length;
                variant.money_format = this.money_format;

                if (!variant.reason_discount)
                    variant.reason_discount = "";
                if (!variant.is_discount_percent)
                    variant.is_discount_percent = false;
                if (!variant.discount_value)
                    variant.discount_value = 0;
                if (!variant.total_discount)
                    variant.total_discount = 0;
                if (!variant.discount_reason)
                    variant.discount_reason = "";
                if (!variant.discount)
                    variant.discount = false;

                variant.reason_discount_tmp = "";
                variant.is_discount_percent_tmp = false;
                variant.discount_value_tmp = 0;

                if (variant.grams == null || variant.grams == undefined) {
                    variant.grams = 0;
                }

                if (variant.product && variant.product.options.length == 1 && variant.product.variants.length == 1 && variant.product.options[0].name == "Title" && variant.product.variants[0].option1 == "Default Title")
                    variant.is_default = true;

                this.line_items.push(variant);

                var template = $('#line-item-template').html();
                var html = Mustache.render(template, { "line_item": variant });
                $("#line_item_rows").append(html);
                Bindings.bind($(".line_item_" + variant.item_index).get(0), this);

                return variant;
            }

            DraftBuilder.prototype.validateLineItemQuantity = function (index) {
                var roundQuantity = this.getRoundQuantity(this.line_items[index].quantity);
                if (parseInt(roundQuantity) < 1) {
                    roundQuantity = 1;
                }
                this.line_items[index].quantity = roundQuantity;
                this.getShippingMethods();
            }

            DraftBuilder.prototype.getRoundQuantity = function (quantity) {
                var roundQuantity = Math.floor(Math.abs(quantity));
                if (parseInt(roundQuantity) < 1) {
                    return 1;
                }
                return roundQuantity;
            }

            DraftBuilder.prototype.removeDiscountLineItem = function (index) {
                this.line_items[index].discount_value = this.line_items[index].total_discount = 0;
                this.line_items[index].is_discount_percent = false;
                this.line_items[index].discount_reason = "";
                this.line_items[index].discount = false;

                $(".line_item_" + index + "_price").html(money(this.line_items[index].price, this.money_format).replace(" ", ""));

                Bizweb.UIPopover.deactivate();
            }

            DraftBuilder.prototype.isValidDiscountLineItem = function (index) {
                var discount = $(".line-item-discount-value-" + index).val();
                if (!!discount) {
                    discount = discount.replace(',', '').replace('.', '');
                }
                if (Bizweb.Utility.isNumeric(discount)) {
                    if (parseInt(discount) > 0) {
                        if (this.line_items[index].is_discount_percent_tmp) {
                            if (parseInt(discount) > 100)
                                return false;
                        }
                        return true;
                    } else {
                        return false;
                    }
                }
            }

            DraftBuilder.prototype.applyDiscountLineItem = function (index) {
                var discount_value = $(".line-item-discount-value-" + index).val();
                discount_value = discount_value.replace(',', '').replace('.', '');
                var discount_reason = $(".line-item-discount-reason-" + index).val();
                this._applyDiscountLineItem(index, discount_value, discount_reason);

                Bizweb.UIPopover.deactivate();

                this.getShippingMethods();
            }

            DraftBuilder.prototype._applyDiscountLineItem = function (index, value, reason) {
                this.line_items[index].discount_value = value;
                this.line_items[index].discount_reason = reason;
                this.line_items[index].is_discount_percent = this.line_items[index].is_discount_percent_tmp;
                if (this.line_items[index].is_discount_percent) {
                    if (this.line_items[index].discount_value > 100) {
                        this.validDraftOrder = false;
                    }
                    this.line_items[index].total_discount = (this.line_items[index].discount_value * this.line_items[index].price) / 100;
                } else {
                    this.line_items[index].total_discount = this.line_items[index].discount_value;
                }

                if (this.line_items[index].total_discount > this.line_items[index].price)
                    this.line_items[index].total_discount = this.line_items[index].price;

                this.line_items[index].discount = true;
            }

            DraftBuilder.prototype.resetApplyDiscountLineItem = function (index) {
                this.line_items[index].discount_value_tmp = this.line_items[index].discount_value;
                this.line_items[index].discount_reason_tmp = this.line_items[index].discount_reason;
                this.line_items[index].is_discount_percent_tmp = this.line_items[index].is_discount_percent;
            }

            DraftBuilder.prototype.getShippingMethods = function (callback) {
                var that = this;
                var currentShippingMethods = $(".shipping-method-radio");
                for (var i = 0; i < currentShippingMethods.length; i++) {
                    var shippingMethod = currentShippingMethods[i];
                    $(shippingMethod).remove();
                }

                if (this.shipping_address_provinceId > 0 || this.shipping_address_province_code != '') {
                    if (this.ajaxGetShipping) {
                        this.ajaxGetShipping.abort();
                    }

                    this.ajaxGetShipping = $.ajax({
                        url: "/admin/draft_orders/GetShippingMethods",
                        type: "POST",
                        data: {
                            provinceId: that.shipping_address_provinceId,
                            districtId: that.shipping_address_districtId,
                            provinceCode: that.shipping_address_province_code,
                            districtCode: that.shipping_address_district_code,
                            totalPrice: that.caculateTotalLineItemPrice(),
                            totalWeight: that.caculateTotalWeight(),
                            currentShippingMethod: that.shipping_name,
                            discountCode: (that.apply_discount && !that.apply_discount.unexisted ? that.apply_discount.code : null),
                            lineItems: that.rebuildCurrentLineItems(),
                            email: that.cusEmail
                        },
                        success: function (data) {
                            if (data && !data.error) {
                                if (data.shipping_methods && data.shipping_methods.length > 0) {
                                    that.shipping_methods = data.shipping_methods;

                                    var template = $('#shipping-methods-template').html();
                                    var html = Mustache.render(template, { "shipping-methods": that.shipping_methods });

                                    $(".shipping-method-fee-radio").before(html);

                                    $(".shipping-methods-select").find('input[type="checkbox"], input[type="radio"]').iCheck({
                                        checkboxClass: 'icheckbox_minimal-blue',
                                        radioClass: 'iradio_minimal-blue'
                                    });
                                    $(".shipping-methods-select").find('input[type="checkbox"], input[type="radio"]').on('ifChecked', function (event) {
                                        Bindings.refreshImmediately();
                                    });

                                    Bindings.unbind($(".shipping-methods-select").get(0));
                                    Bindings.bind($(".shipping-methods-select").get(0));

                                    that.checkCurrentShippingMethod();
                                }
                                else {
                                    that.shipping_methods = [];
                                    that.checkCurrentShippingMethod();
                                }

                                if (that.apply_discount) {
                                    if (data.applied_discount) {
                                        that.apply_discount.amount = data.applied_discount.amount;
                                        that.apply_discount.type = data.applied_discount.value_type;
                                        that.apply_discount.unexisted = false;
                                        that.apply_discount.value = data.applied_discount.value;
                                    }
                                    else {
                                        that.apply_discount.unexisted = true;
                                        that.apply_discount_code_input = "";
                                        that.apply_discount.amount = 0;
                                        that.apply_discount.type = "";
                                        that.apply_discount.value = 0;
                                    }
                                }

                                that.discount_target_type = data.discount_target_type;
                            }

                            if (callback) callback(data);
                        },
                        complete: function (data) {
                            this.ajaxGetShipping = undefined;
                        }
                    });
                } else {
                    that.shipping_methods = [];
                    that.checkCurrentShippingMethod();
                }
            }

            DraftBuilder.prototype.recalculateCopiedDiscount = function (callback) {
                var that = this;

                if (that.apply_discount && !that.apply_discount.unexisted) {
                    $.ajax({
                        url: "/admin/draft_orders/GetShippingMethods",
                        type: "POST",
                        data: {
                            provinceId: that.shipping_address_provinceId,
                            districtId: that.shipping_address_districtId,
                            provinceCode: that.shipping_address_province_code,
                            districtCode: that.shipping_address_district_code,
                            totalPrice: that.caculateTotalLineItemPrice(),
                            totalWeight: that.caculateTotalWeight(),
                            currentShippingMethod: that.shipping_name,
                            discountCode: (that.apply_discount && !that.apply_discount.unexisted ? that.apply_discount.code : null),
                            lineItems: that.rebuildCurrentLineItems(),
                            email: that.cusEmail
                        },
                        success: function (data) {
                            if (data && !data.error) {
                                if (data.applied_discount) {
                                    that.apply_discount.amount = data.applied_discount.amount;
                                    that.apply_discount.type = data.applied_discount.value_type;
                                    that.apply_discount.unexisted = false;
                                    that.apply_discount.value = data.applied_discount.value;
                                }
                                else {
                                    that.apply_discount.unexisted = true;
                                    that.apply_discount_code_input = "";
                                    that.apply_discount.amount = 0;
                                    that.apply_discount.type = "";
                                    that.apply_discount.value = 0;
                                }
                            }

                            if (callback) callback();
                        }
                    });
                }
            }

            DraftBuilder.prototype.checkCurrentShippingMethod = function () {
                if (this.shipping_methods == null) {
                    this.shipping_methods = [];
                    return;
                }

                var validCurrentShippingMethod = false;
                if (this.shipping_custom) {
                    validCurrentShippingMethod = true;
                } else {
                    for (var i = 0; i < this.shipping_methods.length; i++) {
                        var shippingMethod = this.shipping_methods[i];
                        if (!this.shipping_custom && shippingMethod.name == this.shipping_name && shippingMethod.fee == this.shipping_fee) {
                            validCurrentShippingMethod = true;
                        }
                    }
                }

                if (!validCurrentShippingMethod) {
                    if (this.shipping_value == "free")
                        return;

                    this.hasShipping = false;
                    this.shipping_name = null;
                    this.shipping_fee = 0;
                    this.shipping_value = "custom";
                }
            }

            DraftBuilder.prototype.caculateTotalWeight = function () {
                var totalWeight = 0;
                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined) {
                        totalWeight += (this.line_items[i].grams) * this.line_items[i].quantity;
                    }
                }
                return totalWeight;
            }

            DraftBuilder.prototype.checkDiscountLineItemType = function (index) {
                return this.line_items[index].is_discount_percent;
            }

            DraftBuilder.prototype.removeLineItem = function (index) {
                this.line_items[index] = null;
                Bindings.unbind($("#line_item_rows").get(0));
                Bindings.bind($("#line_item_rows").get(0));
                $(".line_item_" + index).remove();

                Bindings.refreshImmediately();

                this.getShippingMethods();
            }

            DraftBuilder.prototype.checkNewLineItem = function (variant) {
                if (variant.price) {
                    variant.price = parseFloat(variant.price.toString().replace(/,/g, ""));
                }
                return !isNaN(variant.price) && variant.name && variant.price !== "" && (variant.price >= 0);
            }

            DraftBuilder.prototype.getCountLineItems = function () {
                var length = 0;
                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined)
                        length++;
                }
                return length;
            }

            DraftBuilder.prototype.bindSrc = function () {
                var url = "https://secure.gravatar.com/avatar/";
                var defaultImage = "?s=60&d=https%3A%2F%2Fbizweb.dktcdn.net%2Fassets%2Fadmin%2Fno-gravatar.png";
                if (this.customer && this.customer.email) {
                    var hash = CryptoJS.MD5(this.customer.email);
                    return url + hash + ".jpg" + defaultImage;
                }
                else {
                    return url + defaultImage;
                }
            }

            DraftBuilder.prototype.selectCustomer = function (customer) {
                if (customer.default_address == null) {
                    customer.default_address = this.default_address;
                    this.no_shipping_address = this.no_billing_address = true;
                } else {
                    this.no_shipping_address = this.no_billing_address = false;
                }

                this._bindShippingAddress(customer.default_address);
                this._bindBillingAddress(customer.default_address);
                this.hasCustomerInfo = true;
                this.email = customer.email;
                this.cusEmail = customer.email;
                this.customer = customer

                Bindings.unbind($(".order-sidebar")[0]);
                Bindings.bind($(".order-sidebar")[0]);
                Bindings.refreshImmediately();
                this.applyDiscount();
            }

            DraftBuilder.prototype._bindShippingAddress = function (address) {
                var addressNameFirst = address.first_name != null ? address.first_name : "";
                var addressNameLast = address.last_name != null ? address.last_name : "";
                var addressName = (addressNameLast + " " + addressNameFirst).trim();

                this.shipping_address_name = addressName;
                this.shipping_address_first_name = address.first_name;
                this.shipping_address_last_name = address.last_name;
                this.shipping_address_province = address.province;
                this.shipping_address_phone = address.phone;
                this.shipping_address_country = address.country;
                this.shipping_address_country_code = address.country_code;
                this.shipping_address_address1 = address.address1;
                this.shipping_address_city = address.city ? address.city : address.province;
                this.shipping_address_province_code = address.province_code;
                this.shipping_address_districtId = 0;
                this.shipping_address_district_code = address.district_code;
                this.shipping_address_district = address.district;
                this.shipping_address_company = address.company;
                this.shipping_address_zip = address.zip;
            }

            DraftBuilder.prototype._bindBillingAddress = function (address) {
                var addressNameFirst = address.first_name != null ? address.first_name : "";
                var addressNameLast = address.last_name != null ? address.last_name : "";
                var addressName = (addressNameLast + " " + addressNameFirst).trim();

                this.billing_address_name = addressName;
                this.billing_address_first_name = address.first_name;
                this.billing_address_last_name = address.last_name;
                this.billing_address_province = address.province;
                this.billing_address_phone = address.phone;
                this.billing_address_country = address.country;
                this.billing_address_country_code = address.country_code;
                this.billing_address_address1 = address.address1;
                this.billing_address_province_code = address.province_code;
                this.billing_address_districtId = 0;
                this.billing_address_district_code = address.district_code;
                this.billing_address_district = address.district;
                this.billing_address_company = address.company;
                this.billing_address_zip = address.zip;
                this.billing_address_city = address.city ? address.city : address.province;
            }

            DraftBuilder.prototype.isSameAddress = function () {
                if (!this.isNullAddress(this.getShippingAddress()) || !this.isNullAddress(this.getBillingAddress())) {
                    return _.equal(this.getShippingAddress(), this.getBillingAddress());
                }
                return true;
            }

            DraftBuilder.prototype.isNullAddress = function (address) {
                if (address.name != undefined && address.name.trim().length > 0)
                    return false;
                if (address.address1 != undefined && address.address1.trim().length > 0)
                    return false;
                if (address.province != undefined && address.province.trim().length > 0)
                    return false;
                if (address.country != undefined && address.country.trim().length > 0)
                    return false;
                if (address.phone != undefined && address.phone.trim().length > 0)
                    return false;
                return true;
            }

            DraftBuilder.prototype.getShippingAddress = function () {
                var address = {};
                address.name = this.shipping_address_name;
                address.province = this.shipping_address_province;
                address.phone = this.shipping_address_phone;
                address.country = this.shipping_address_country;
                address.address1 = this.shipping_address_address1;
                return address;
            }

            DraftBuilder.prototype.invalidShippingAddress = function () {
                var address = {};
                address.name = this.shipping_address_name_tmp;
                address.province = this.shipping_address_province_tmp;
                address.phone = this.shipping_address_phone_tmp;
                address.country = this.shipping_address_country_tmp;
                address.address1 = this.shipping_address_address1_tmp;
                return this.isNullAddress(address);
            }

            DraftBuilder.prototype.getBillingAddress = function () {
                var address = {};
                address.name = this.billing_address_name;
                address.province = this.billing_address_province;
                address.phone = this.billing_address_phone;
                address.country = this.billing_address_country;
                address.address1 = this.billing_address_address1;
                return address;
            }

            DraftBuilder.prototype.invalidBillingAddress = function () {
                var address = {};
                address.name = this.billing_address_name_tmp;
                address.province = this.billing_address_province_tmp;
                address.phone = this.billing_address_phone_tmp;
                address.country = this.billing_address_country_tmp;
                address.address1 = this.billing_address_address1_tmp;
                return this.isNullAddress(address);
            }

            DraftBuilder.prototype.updateBillingAddress = function () {
                $('#showErrorAddressDraft').find('.ui-banner__title').text("");
                $('#showErrorAddressDraft').find('.ui-type-container ul').empty();
                if ($('#showErrorAddressDraft').hasClass('hide')) {

                } else {
                    $('#showErrorAddressDraft').addClass('hide');
                }

                var htmlError = "";
                var countError = 0;

                if (this.customerAddress.address_last_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Họ không được dài quá 50 ký tự</li>"
                }

                if (this.customerAddress.address_first_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tên không được dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_company.length > 50) {
                    countError += 1;
                    htmlError += "<li>Công ty không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_phone.length > 15) {
                    countError += 1;
                    htmlError += "<li>Số điện thoại không dài quá 15 ký tự</li>";
                }

                if (this.customerAddress.address_address1.length > 255) {
                    countError += 1;
                    htmlError += "<li>Địa chỉ không dài quá 255 ký tự</li>";
                }

                if (!!this.customerAddress.address_city && this.customerAddress.address_city.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tỉnh / Thành phố không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_zip.length > 20) {
                    countError += 1;
                    htmlError += "<li>Postal / Zip Code phố không dài quá 20 ký tự</li>";
                }

                if (countError === 0) {
                    this.billing_address_name = (this.customerAddress.address_last_name + " " + this.customerAddress.address_first_name).trim();
                    this.billing_address_first_name = this.customerAddress.address_first_name;
                    this.billing_address_last_name = this.customerAddress.address_last_name;
                    this.billing_address_company = this.customerAddress.address_company;
                    this.billing_address_zip = this.customerAddress.address_zip;
                    this.billing_address_phone = this.customerAddress.address_phone;
                    this.billing_address_address1 = this.customerAddress.address_address1;
                    this.billing_address_city = this.customerAddress.address_city;
                    this.billing_address_countryId = this.customerAddress.country_id;
                    this.billing_address_country = $("#CountryId option:selected").text();
                    if (this.customerAddress.have_city) {
                        this.billing_address_province = $("#provinceSlt option:selected").text();
                        this.billing_address_provinceId = this.customerAddress.province_id;
                        this.billing_address_districtId = this.customerAddress.district_id;
                        this.billing_address_district = $("#districtSlt option:selected").text();
                    }
                    else {
                        this.billing_address_city = this.customerAddress.city;
                        this.billing_address_province = this.customerAddress.city;
                        this.billing_address_district = "";
                        this.billing_address_provinceId = 0;
                        this.billing_address_province_code = "";
                        this.billing_address_districtId = 0;
                        this.billing_address_district_code = "";
                        this.billing_address_district = "";
                    }

                    Bizweb.Modal.hide();
                    Bindings.bind($(".order-sidebar")[0], this);
                    this.no_billing_address = false;
                } else {
                    $('#showErrorAddressDraft').find('.ui-banner__title').text("Có " + countError + " lỗi:");
                    $('#showErrorAddressDraft').find('.ui-type-container ul').append(htmlError);
                    $('#showErrorAddressDraft').removeClass('hide');
                }
            }

            DraftBuilder.prototype.resetBillingAddress = function () {
                var that = this;
                $.ajax({
                    url: Bizweb.routes.draftorders + "/address?callback=updateBillingAddress",
                    type: "GET",
                    data: {
                        firstName: this.billing_address_first_name,
                        lastName: this.billing_address_last_name,
                        company: this.billing_address_company,
                        zip: this.billing_address_zip,
                        phone: this.billing_address_phone,
                        address1: this.billing_address_address1,
                        city: this.billing_address_city,
                        countryId: this.billing_address_countryId,
                        countryCode: this.billing_address_country_code,
                        provinceId: this.billing_address_provinceId,
                        provinceCode: this.billing_address_province_code,
                        districtId: this.billing_address_districtId,
                        districtCode: this.billing_address_district_code,
                    },
                    success: function (content) {
                        var billingModel = new Bizweb.Modal();
                        billingModel.show({ content: content });
                    }
                });
            }

            DraftBuilder.prototype.updateShippingAddress = function () {
                $('#showErrorAddressDraft').find('.ui-banner__title').text("");
                $('#showErrorAddressDraft').find('.ui-type-container ul').empty();
                if ($('#showErrorAddressDraft').hasClass('hide')) {

                } else {
                    $('#showErrorAddressDraft').addClass('hide');
                }

                var htmlError = "";
                var countError = 0;

                if (this.customerAddress.address_last_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Họ không được dài quá 50 ký tự</li>"
                }

                if (this.customerAddress.address_first_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tên không được dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_company.length > 50) {
                    countError += 1;
                    htmlError += "<li>Công ty không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_phone.length > 15) {
                    countError += 1;
                    htmlError += "<li>Số điện thoại không dài quá 15 ký tự</li>";
                }

                if (this.customerAddress.address_address1.length > 255) {
                    countError += 1;
                    htmlError += "<li>Địa chỉ không dài quá 255 ký tự</li>";
                }

                if (!!this.customerAddress.address_city && this.customerAddress.address_city.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tỉnh / Thành phố không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_zip.length > 20) {
                    countError += 1;
                    htmlError += "<li>Postal / Zip Code phố không dài quá 20 ký tự</li>";
                }

                if (countError === 0) {
                    this.shipping_address_name = (this.customerAddress.address_last_name + " " + this.customerAddress.address_first_name).trim();
                    this.shipping_address_first_name = this.customerAddress.address_first_name;
                    this.shipping_address_last_name = this.customerAddress.address_last_name;
                    this.shipping_address_company = this.customerAddress.address_company;
                    this.shipping_address_zip = this.customerAddress.address_zip;
                    this.shipping_address_phone = this.customerAddress.address_phone;
                    this.shipping_address_address1 = this.customerAddress.address_address1;
                    this.shipping_address_city = this.customerAddress.address_city;
                    this.shipping_address_countryId = this.customerAddress.country_id;
                    this.shipping_address_country = $("#CountryId option:selected").text();
                    if (this.customerAddress.have_city) {
                        this.shipping_address_province = $("#provinceSlt option:selected").text();
                        this.shipping_address_provinceId = this.customerAddress.province_id;
                        this.shipping_address_districtId = this.customerAddress.district_id;
                        this.shipping_address_district = $("#districtSlt option:selected").text();
                    }
                    else {
                        this.shipping_address_city = this.customerAddress.city;
                        this.shipping_address_province = this.customerAddress.city;
                        this.shipping_address_district = "";
                        this.shipping_address_provinceId = 0;
                        this.shipping_address_province_code = "";
                        this.shipping_address_districtId = 0;
                        this.shipping_address_district_code = "";
                        this.shipping_address_district = "";
                    }


                    Bizweb.Modal.hide();
                    Bindings.bind($(".order-sidebar")[0], this);
                    this.no_shipping_address = false;

                    this.getShippingMethods();
                } else {
                    $('#showErrorAddressDraft').find('.ui-banner__title').text("Có " + countError + " lỗi:");
                    $('#showErrorAddressDraft').find('.ui-type-container ul').append(htmlError);
                    $('#showErrorAddressDraft').removeClass('hide');
                }
            }

            DraftBuilder.prototype.resetShippingAddress = function () {
                var that = this;
                $.ajax({
                    url: Bizweb.routes.draftorders + "/address?callback=updateShippingAddress",
                    type: "GET",
                    data: {
                        firstName: this.shipping_address_first_name,
                        lastName: this.shipping_address_last_name,
                        company: this.shipping_address_company,
                        zip: this.shipping_address_zip,
                        phone: this.shipping_address_phone,
                        address1: this.shipping_address_address1,
                        city: this.shipping_address_city,
                        countryId: this.shipping_address_countryId,
                        countryCode: this.shipping_address_country_code,
                        provinceId: this.shipping_address_provinceId,
                        provinceCode: this.shipping_address_province_code,
                        districtId: this.shipping_address_districtId,
                        districtCode: this.shipping_address_district_code,
                    },
                    success: function (content) {
                        var shippingModel = new Bizweb.Modal();
                        shippingModel.show({ content: content });
                    }
                });
            }

            DraftBuilder.prototype.isValidPaid = function () {
                return this.validDraftOrder && (this.getCountLineItems() > 0);
            }

            DraftBuilder.prototype.isValid = function () {
                return this.validDraftOrder && (this.getCountLineItems() > 0);
            }

            DraftBuilder.prototype.isValidPending = function () {
                return this.validDraftOrder && (this.getCountLineItems() > 0) && (this.caculateTotalPrice() > 0);
            }

            DraftBuilder.prototype.createDraftOrder = function (financialStatus) {
                var that = this;
                this.isCreating = true;

                $('.btn-save-draft-order').addClass("disabled is-loading");

                var draftOrder = {};
                if (this.hasCustomerInfo) {
                    draftOrder.customerId = this.customer.id;
                    draftOrder.email = this.email;

                    if (!this.no_shipping_address) {
                        draftOrder.shippingAddress = {};
                        draftOrder.shippingAddress.firstName = this.shipping_address_first_name;
                        draftOrder.shippingAddress.lastName = this.shipping_address_last_name;
                        draftOrder.shippingAddress.name = this.shipping_address_name;
                        draftOrder.shippingAddress.phone = this.shipping_address_phone;
                        draftOrder.shippingAddress.address1 = this.shipping_address_address1;
                        draftOrder.shippingAddress.country = this.shipping_address_country;
                        draftOrder.shippingAddress.countryId = this.shipping_address_countryId;
                        draftOrder.shippingAddress.countryCode = this.shipping_address_country_code;
                        draftOrder.shippingAddress.city = this.shipping_address_city;
                        draftOrder.shippingAddress.province = this.shipping_address_province;
                        draftOrder.shippingAddress.provinceId = this.shipping_address_provinceId;
                        draftOrder.shippingAddress.provinceCode = this.shipping_address_provinceCode;
                        draftOrder.shippingAddress.districtId = this.shipping_address_districtId;
                        draftOrder.shippingAddress.districtCode = this.shipping_address_district_code;
                        draftOrder.shippingAddress.district = this.shipping_address_district;
                        draftOrder.shippingAddress.company = this.shipping_address_company;
                        draftOrder.shippingAddress.zip = this.shipping_address_zip;
                    }

                    if (!this.no_billing_address) {
                        draftOrder.billingAddress = {};
                        draftOrder.billingAddress.firstName = this.billing_address_first_name;
                        draftOrder.billingAddress.lastName = this.billing_address_last_name;
                        draftOrder.billingAddress.name = this.billing_address_name;
                        draftOrder.billingAddress.phone = this.billing_address_phone;
                        draftOrder.billingAddress.address1 = this.billing_address_address1;
                        draftOrder.billingAddress.country = this.billing_address_country;
                        draftOrder.billingAddress.countryId = this.billing_address_countryId;
                        draftOrder.billingAddress.countryCode = this.billing_address_country_code;
                        draftOrder.billingAddress.city = this.billing_address_city;
                        draftOrder.billingAddress.province = this.billing_address_province;
                        draftOrder.billingAddress.provinceId = this.billing_address_provinceId;
                        draftOrder.billingAddress.provinceCode = this.billing_address_provinceCode;
                        draftOrder.billingAddress.districtId = this.billing_address_districtId;
                        draftOrder.billingAddress.districtCode = this.billing_address_district_code;
                        draftOrder.billingAddress.district = this.billing_address_district;
                        draftOrder.billingAddress.company = this.billing_address_company;
                        draftOrder.billingAddress.zip = this.billing_address_zip;
                    }
                }

                if (this.hasShipping) {
                    draftOrder.shippingLine = {};
                    draftOrder.shippingLine.code = draftOrder.shippingLine.title = this.shipping_name;
                    draftOrder.shippingLine.price = this.shipping_fee;
                    draftOrder.shippingLine.custom = this.shipping_custom;
                }

                draftOrder.financialStatus = financialStatus;
                draftOrder.note = this.note;

                //get all tags
                var tags = new Array();
                $(".next-token-list :input[name='Tags[]']").each(function () {
                    var input = $(this); // This is the jquery object of the input, do what you will
                    tags.push(input.val());
                });

                draftOrder.tags = tags;
                draftOrder.isSendMail = this.isSendMail;
                draftOrder.discountTargetType = this.discount_target_type;

                if (this.discount || (this.apply_discount && this.apply_discount.amount > 0)) {
                    draftOrder.appliedDiscount = {};

                    if (this.apply_discount) {
                        draftOrder.appliedDiscount.title = this.apply_discount.code;
                        draftOrder.appliedDiscount.value = this.apply_discount.value;
                        draftOrder.appliedDiscount.valueType = this.apply_discount.type;
                        draftOrder.appliedDiscount.custom = false;
                        draftOrder.appliedDiscount.amount = this.apply_discount.amount
                        draftOrder.appliedDiscount.unexisted = this.apply_discount.unexisted;
                    }
                    else {
                        draftOrder.appliedDiscount.description = this.reason_discount;
                        draftOrder.appliedDiscount.value = this.discount;

                        if (this.is_discount_percent) {
                            draftOrder.appliedDiscount.valueType = "percentage";
                        } else {
                            draftOrder.appliedDiscount.valueType = "fixed_amount";
                        }
                        draftOrder.appliedDiscount.custom = true;
                    }
                }

                draftOrder.lineItems = this.rebuildCurrentLineItems();

                if (draftOrder.lineItems == null || draftOrder.lineItems.length == 0) {
                    Bizweb.Flash.error("Đơn hàng phải có sản phẩm.");
                    $('.btn-save-draft-order').removeClass("disabled is-loading");
                    return;
                }
                if (this.email && !validateEmail(this.email)) {
                    Bizweb.Flash.error("Email không đúng định dạng.");
                    return;
                }

                $.ajax({
                    type: 'POST',
                    url: "/admin/draft_orders/create",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(draftOrder),
                    dataType: "json",
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }

                        if (financialStatus == null || financialStatus == '') {
                            Bizweb.Flash.notice("Tạo đơn hàng nháp thành công!");
                        }
                        var draftOrderId = result.id;
                        setTimeout(function () {
                            window.location.href = "/admin/draft_orders/" + draftOrderId;
                        }, 1000);
                    },
                    error: function (data) {
                        $('.btn-save-draft-order').removeClass("disabled is-loading");
                        that.isCreating = false;
                        Bizweb.Flash.error(data.responseJSON != null ? data.responseJSON.error : "Có lỗi xảy ra");
                    }
                });
            }

            DraftBuilder.prototype.rebuildCurrentLineItems = function () {
                var lineItems = [];

                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined) {
                        var line_item = this.line_items[i];
                        var lineItem = {};
                        lineItem.quantity = line_item.quantity;
                        lineItem.productId = line_item.product_id;
                        lineItem.variantId = line_item.id;
                        lineItem.variantTitle = line_item.title;
                        lineItem.title = line_item.name;
                        lineItem.requiresShipping = line_item.requires_shipping;
                        lineItem.price = line_item.price;
                        lineItem.grams = line_item.grams;
                        if (line_item.discount) {
                            lineItem.appliedDiscount = {};
                            lineItem.appliedDiscount.value = line_item.discount_value;
                            lineItem.appliedDiscount.description = line_item.discount_reason;
                            if (line_item.is_discount_percent) {
                                lineItem.appliedDiscount.valueType = "percentage";
                            } else {
                                lineItem.appliedDiscount.valueType = "dollar";
                            }
                        }

                        lineItems.push(lineItem);
                    }
                }

                return lineItems;
            }

            DraftBuilder.prototype.resetAddress = function () {
                this.shipping_address_name = "";
                this.shipping_address_first_name = "";
                this.shipping_address_last_name = "";
                this.shipping_address_province = "";
                this.shipping_address_phone = "";
                this.shipping_address_country = "";
                this.shipping_address_address1 = "";
                this.shipping_address_city = "";
                this.shipping_address_provinceId = 0;
                this.shipping_address_districtId = 0;
                this.shipping_address_district = "";
                this.shipping_address_zip = "";
                this.shipping_address_company = "";
                this.shipping_address_country_code = "";
                this.shipping_address_countryId = 0;

                this.billing_address_first_name = "";
                this.billing_address_last_name = "";
                this.billing_address_name = "";
                this.billing_address_province = "";
                this.billing_address_phone = "";
                this.billing_address_country = "";
                this.billing_address_address1 = "";
                this.billing_address_city = "";
                this.billing_address_provinceId = 0;
                this.billing_address_districtId = 0;
                this.billing_address_district = "";
                this.billing_address_zip = "";
                this.billing_address_company = "";
                this.billing_address_country_code = "";
                this.billing_address_countryId = 0;
                this.no_shipping_address = true;
                this.no_billing_address = true;
                this.hasShipping = false;
                this.shipping_name = "";
                this.shipping_fee = 0;
            }

            DraftBuilder.prototype.removeCustomer = function () {
                this.customer = this.default_customer;
                this.hasCustomerInfo = false;
                this.email = "";
                this.cusEmail = "";
                this.resetAddress();
                this.getShippingMethods();
            }

            DraftBuilder.prototype.resetOrderEmail = function () {
                this.email_tmp = this.customer.email;

                this.editEmailModal.show();
            }

            DraftBuilder.prototype.updateEmail = function () {
                var emailTmp = $("input#order_email").val();
                if (emailTmp && !validateEmail(emailTmp)) {
                    Bizweb.Flash.error("Email không đúng định dạng.");
                    return;
                }
                this.email = emailTmp;
                this.editEmailModal.hide();
            }

            DraftBuilder.prototype.caculateTotalLineItemPrice = function () {
                var totalPrice = 0;
                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined) {
                        totalPrice += (this.line_items[i].price - this.line_items[i].total_discount) * this.line_items[i].quantity;
                    }
                }
                return totalPrice;
            }

            DraftBuilder.prototype.isValidDiscount = function () {
                if (this.getCountLineItems() > 0) {
                    if (this.apply_discount_code_input)
                        return true;

                    var discount = this.discount_tmp;
                    var discountType = this.isDiscountPercentTmp;
                    if (discount) {
                        discount = parseFloat(discount.toString().replace(/,/g, ""));
                    }
                    if (Bizweb.Utility.isNumeric(discount)) {
                        if (parseInt(discount) > 0) {
                            if (discountType) {
                                if (parseInt(discount) <= 100)
                                    return true;
                            } else {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }

            DraftBuilder.prototype.applyDiscount = function () {
                var that = this;

                if (this.apply_discount_code_input) {
                    this.apply_discount = {};
                    this.apply_discount.code = this.apply_discount_code_input;
                    this.discount = this.discount_tmp = 0;
                    this.reason_discount = this.reason_discount_tmp = "";
                }
                else {
                    this.apply_discount = null;
                    this.apply_discount_code_input = "";
                    this.discount = this.discount_tmp;
                    this.reason_discount = this.reason_discount_tmp;
                    this.is_discount_percent = this.isDiscountPercentTmp;

                    if (this.discount) {
                        this.discount = parseFloat(this.discount.toString().replace(/,/g, ""));
                    }
                }

                Bizweb.UIPopover.deactivate();

                this.getShippingMethods(function () {
                    $(".shipping-methods-select").find('input[type="radio"][shipping-name="' + that.shipping_name + '"]').iCheck('check');
                    $(".btn-apply-shipping").removeClass("disabled");
                });

                reSetAutoNumeric();
            }

            DraftBuilder.prototype.caculateDiscount = function () {
                var discount = 0;

                if (this.apply_discount) {
                    discount = this.apply_discount.amount ? this.apply_discount.amount : 0;
                }
                else {
                    var totalLineItemPrice = this.caculateTotalLineItemPrice();
                    if (this.is_discount_percent) {
                        discount = totalLineItemPrice * this.discount / 100;
                    }
                    else {
                        discount = parseFloat(this.discount);
                    }
                }

                return discount;
            }

            DraftBuilder.prototype.caculateTotalPrice = function () {
                var totalLineItemPrice = this.caculateTotalLineItemPrice();
                if (this.discount_target_type == 'shipping_line') {
                    return totalLineItemPrice - this.caculateDiscount() + this.shipping_fee;
                }
                else {
                    return totalLineItemPrice - Math.min(this.caculateDiscount(), totalLineItemPrice) + this.shipping_fee;
                }
            }

            DraftBuilder.prototype.caculateSubtotalPrice = function () {
                var totalLineItemPrice = this.caculateTotalLineItemPrice();
                return totalLineItemPrice - Math.min(this.caculateDiscount(), totalLineItemPrice);
            }

            DraftBuilder.prototype.removeDiscount = function () {
                this.apply_discount = null;
                this.apply_discount_code_input = "";
                this.discount = 0;
                this.reason_discount = "";
                this.discount_tmp = 0;
                this.reason_discount_tmp = "";
                this.is_discount_percent = this.isDiscountPercentTmp = false;
                Bizweb.UIPopover.deactivate();
            }

            DraftBuilder.prototype.canSaveShippingRate = function () {
                var shippingSelected = $("input[name='shippingMethod']:checked").val();
                if (shippingSelected == "custom") {
                    var shipping_name = $("#customShippingName").val();
                    var shipping_fee = parseFloat($("#customShippingFee").val());

                    return shipping_name != "" && Bizweb.Utility.isNumeric(shipping_fee);
                }
                else {
                    return true;
                }
            }

            DraftBuilder.prototype.setShippingLine = function () {
                unSetAutoNumeric();
                var shippingSelected = this.shipping_value = $("input[name='shippingMethod']:checked").val();
                if (shippingSelected == "custom") {
                    this.shipping_custom = this.shipping_custom_tmp = true;
                    var shipping_name = $("#customShippingName").val();
                    var shipping_fee = parseFloat($("#customShippingFee").val());
                    if (!shipping_name.trim()) {
                        shipping_name = "Tùy chọn";
                    }
                    if (!Bizweb.Utility.isNumeric(shipping_fee)) {
                        shipping_fee = 0;
                    }
                    this.shipping_name = this.custom_shipping_name = shipping_name;
                    this.shipping_fee = this.custom_shipping_fee = shipping_fee;
                }
                else {
                    this.shipping_custom = this.shipping_custom_tmp = false;
                    this.shipping_name = $("input[name='shippingMethod']:checked").attr("shipping-name");
                    this.shipping_fee = parseFloat($("input[name='shippingMethod']:checked").attr("fee"));
                }
                this.recalculateCopiedDiscount();
                this.hasShipping = true;
                reSetAutoNumeric();
                Bizweb.UIPopover.deactivate();
            }

            DraftBuilder.prototype.isValidShippingFee = function () {
                var shippingSelected = this.shipping_value = $("input[name='shippingMethod']:checked").val();
                if (shippingSelected == "custom") {
                    this.shipping_custom = this.shipping_custom_tmp = true;
                    var shipping_name = $("#customShippingName").val();
                    var shipping_fee = unFomatPrice($("#customShippingFee").val());
                    if (!shipping_name.trim())
                        return false;
                }
                else {
                    var shipping_fee = parseFloat($("input[name='shippingMethod']:checked").attr("fee"));
                }

                if (!Bizweb.Utility.isNumeric(shipping_fee)) {
                    return false;
                } else {
                    if (shipping_fee < 0) {
                        return false;
                    }
                }

                return true;
            }

            DraftBuilder.prototype.isShippingCustom = function () {
                var shippingSelected = $("input[name='shippingMethod']:checked").val();

                if (shippingSelected == "custom") {
                    this.shipping_custom_tmp = true;
                } else {
                    this.shipping_custom_tmp = false;
                }
            }

            DraftBuilder.prototype.resetShippingLine = function () {
                this.custom_shipping_name_tmp = this.custom_shipping_name;
                this.custom_shipping_fee_tmp = this.custom_shipping_fee;
                this.shipping_custom_tmp = this.shipping_custom;

                $('input[name="shippingMethod"][value="' + this.shipping_value + '"]').iCheck('check');

                initAutoNumeric();
            }

            DraftBuilder.prototype.removeShipping = function () {
                this.hasShipping = false;
                this.shipping_name = "";
                this.shipping_fee = 0;
                Bizweb.UIPopover.deactivate();

                if (this.apply_discount) {
                    this.recalculateCopiedDiscount();
                }
            }

            DraftBuilder.prototype.quickCreateCustomer = function () {
                $("#bizweb-modal .btn-default.btn-primary").addClass("disabled").html(Bizweb.LOADING);
                this.isCustomerInVietnam = true;
                var that = this;
                var formQuickAddCustomer = $('#form-quick-add-customer');
                //if (!formQuickAddCustomer.valid()) {
                //    return;
                //}
                $.ajax({
                    url: '/admin/customers/quickcreate',
                    type: "POST",
                    data: formQuickAddCustomer.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                        } else if (result.id != null && result.id > 0) {
                            that.selectCustomer(result);
                            Bizweb.Modal.hide();
                        }
                    }
                });
            }

            DraftBuilder.prototype.selectShippingMethod = function (name) {
                if (name === "custom")
                    $(".shipping-methods-select").find('input[type="radio"][value="custom"]').iCheck('check');
                else
                    $(".shipping-methods-select").find('input[type="radio"][shipping-name="' + name + '"]').iCheck('check');
            }

            return DraftBuilder;
        }()
    }.call(this),
    function () {
        var applyObjectToEvent = function (event, object) {
            return function () {
                return event.apply(object, arguments)
            }
        }

        Bizweb.DraftBuilderEdit = function () {
            function DraftBuilderEdit(element, options) {
                if (options) {
                    var property;
                    for (property in options) this[property] = options[property];
                }

                this.line_items = [];
                this.shipping_methods = [];
                this.default_customer = { id: 0, shipping_address: null, billing_address: null }
                this.customer = this.default_customer;
                this.hasCustomerInfo = this.customer.id != 0;
                this.default_address = { last_name: null, first_name: null, address1: null, province: null, province_code: null, country: null, country_code: null };
                this.no_shipping_address = true;
                this.no_billing_address = true;
                this.is_discount_percent = false;
                this.reason_discount = "";
                this.email = "";
                this.discount = 0;
                this.isDiscountPercent = false;
                this.reason_discount = "";
                this.apply_discount = null;
                this.isShippingInVietnam = false;
                this.resetAddress();
                this.custom_shipping_name = null;
                this.custom_shipping_fee = null;
                this.shipping_custom = true;
                this.shipping_value = "custom";
                this.validDraftOrder = true;
                this.isCreating = false;
                this.draftOrderId = 0;
                this.cancelSourceOrder = null;
                this.isShippingCustom = applyObjectToEvent(this.isShippingCustom, this);
                this.ajaxGetShipping = null;
                this.discount_target_type = null;
                this.cusEmail = "";

                if (this.draft_order) {
                    this.draftOrderId = this.draft_order.id;
                    this._bindFromOrder(this.draft_order);
                }

                this.markPaymentOrder();

                initAutoNumeric();
            };

            DraftBuilderEdit.prototype._bindFromOrder = function (order) {
                var that = this;
                this.email = order.email;
                this.note = order.note;
                this.cusEmail = order.email;

                if (order.customer) {
                    this.customer = order.customer;
                    this.cusEmail = order.customer.email;
                }

                if (order.shipping_address) {
                    this._bindShippingAddress(order.shipping_address);
                    this.no_shipping_address = false;
                }

                if (order.billing_address) {
                    this._bindBillingAddress(order.billing_address);
                    this.no_billing_address = false;
                }

                if (order.line_items) {
                    order.line_items.forEach(function (item, index) {
                        item.id = item.variant_id;
                        item.name = item.title;
                        item.title = item.variant_title;

                        if (item.image && item.image.src)
                            item.image = item.image.src;

                        that._addLineItem(item);

                        if (item.total_discount > 0)
                            that._applyDiscountLineItem(index, item.total_discount, item.discount_code);
                    });
                }

                this.hasCustomerInfo = order.customer != null;
                Bindings.unbind($(".order-sidebar")[0]);
                Bindings.bind($(".order-sidebar")[0], this);
                Bindings.refreshImmediately();

                if (order.shipping_line) {
                    that.shipping_custom = that.shipping_custom_tmp = false;
                    that.shipping_name = order.shipping_line.title;
                    that.shipping_fee = parseFloat(order.shipping_line.price);
                }

                if (order.applied_discount) {
                    //console.log(order.discount_codes[0]);
                    if (!!order.applied_discount.custom) {
                        this.discount = this.discount_tmp = order.applied_discount.amount;
                        this.reason_discount = order.applied_discount.description;
                        this.is_discount_percent = this.is_discount_percent = false;
                    }
                        //else if (order.source_name != "bizweb_draft_order") {
                        //    this.apply_discount = {};
                        //    this.apply_discount.amount = order.applied_discount.amount;
                        //    this.apply_discount.code = this.apply_discount_code_input = order.applied_discount.title;
                        //    this.apply_discount.type = order.applied_discount.type;
                        //}
                    else {
                        this.apply_discount = {};
                        this.apply_discount.amount = order.applied_discount.amount;
                        this.apply_discount.code = this.apply_discount_code_input = order.applied_discount.title;
                        this.apply_discount.type = order.applied_discount.type;
                        this.apply_discount.value = order.applied_discount.value;
                    }
                }

                this.getShippingMethods(function (data) {
                    if (order.shipping_line) {
                        var selectedShippingMethod;
                        if (data.shipping_methods && data.shipping_methods.length > 0) {
                            for (var i = 0; i < data.shipping_methods.length; i++) {
                                var shippingMethod = data.shipping_methods[i];
                                if (shippingMethod.name == order.shipping_line.title)
                                    selectedShippingMethod = shippingMethod;
                            }
                        }

                        if (selectedShippingMethod) {
                            that.shipping_custom = that.shipping_custom_tmp = false;
                            that.shipping_name = order.shipping_line.title;
                            that.shipping_fee = parseFloat(selectedShippingMethod.fee);
                            $(".shipping-methods-select").find('input[type="radio"][shipping-name="' + that.shipping_name + '"]').iCheck('check');
                            $(".btn-apply-shipping").removeClass("disabled");
                        }
                        else {
                            that.shipping_custom = that.shipping_custom_tmp = true;
                            that.shipping_name = that.custom_shipping_name = that.custom_shipping_name_tmp = order.shipping_line.title;
                            that.shipping_fee = that.custom_shipping_fee = that.custom_shipping_fee_tmp = parseFloat(order.shipping_line.price);
                            $(".shipping-methods-select").find('input[type="radio"][value="custom"]').iCheck('check');
                            $(".btn-apply-shipping").removeClass("disabled");
                        }

                        that.hasShipping = true;
                    }

                    $(document).click();
                });
            }

            DraftBuilderEdit.prototype.resetShipping = function () {
                this.shipping_name = "";
                this.shipping_fee = 0;
                this.isShippingInVietnam = false;
            }

            DraftBuilderEdit.prototype.resetApplyDiscount = function () {
                this.discount_tmp = this.discount;
                this.reason_discount_tmp = this.reason_discount;
                this.isDiscountPercentTmp = this.is_discount_percent;

                initAutoNumeric();
            }

            DraftBuilderEdit.prototype.addLineItem = function (variant) {
                var lineItem = this._addLineItem(variant);

                Bizweb.Modal.hide();

                if (lineItem) {
                    $(".line_item_" + lineItem.item_index).find(".line_item_quantity").focus().select();
                    $(document).click();

                    this.getShippingMethods();
                }
            }

            DraftBuilderEdit.prototype._addLineItem = function (variant) {
                variant.quantity = this.getRoundQuantity(variant.quantity);

                if (typeof (variant.price) == "string") {
                    variant.price = parseFloat(variant.price);
                }

                if (variant.title == undefined || variant.title == 'Default Title') {
                    variant.title = "";
                }

                if (variant.id > 0) {
                    var tr = $(".variant_id_" + variant.id);
                    var itemIndex = $(tr).attr("item-index");
                    if (tr.length > 0) {
                        var lineItemQuantity = tr.find(".line_item_quantity");
                        var quantity = this.getRoundQuantity(lineItemQuantity.val());
                        if (isNaN(quantity)) {
                            quantity = 1;
                        }
                        this.line_items[itemIndex].quantity = quantity;
                        Bindings.bind($(".line_item_" + itemIndex).get(0), this);
                        Bindings.refreshImmediately();
                        tr.find(".line_item_quantity").focus().select();
                        $(document).click();
                        return;
                    }
                }

                variant.item_index = this.line_items.length;
                variant.money_format = this.money_format;

                if (!variant.reason_discount)
                    variant.reason_discount = "";
                if (!variant.is_discount_percent)
                    variant.is_discount_percent = false;
                if (!variant.discount_value)
                    variant.discount_value = 0;
                if (!variant.total_discount)
                    variant.total_discount = 0;
                if (!variant.discount_reason)
                    variant.discount_reason = "";
                if (!variant.discount)
                    variant.discount = false;

                variant.reason_discount_tmp = "";
                variant.is_discount_percent_tmp = false;
                variant.discount_value_tmp = 0;

                if (variant.applied_discount != null) {
                    if (variant.applied_discount.value_type == "percentage") {
                        variant.total_discount = variant.applied_discount.value;
                        variant.discount_value = variant.applied_discount.value;
                        variant.is_discount_percent = true;
                        variant.is_discount_percent_tmp = true;
                    }
                }

                if (variant.grams == null || variant.grams == undefined) {
                    variant.grams = 0;
                }

                if (variant.product && variant.product.options.length == 1 && variant.product.variants.length == 1 && variant.product.options[0].name == "Title" && variant.product.variants[0].option1 == "Default Title")
                    variant.is_default = true;

                this.line_items.push(variant);

                var template = $('#line-item-template').html();
                var html = Mustache.render(template, { "line_item": variant });
                $("#line_item_rows").append(html);
                Bindings.bind($(".line_item_" + variant.item_index).get(0), this);

                return variant;
            }

            DraftBuilderEdit.prototype.validateLineItemQuantity = function (index) {
                var roundQuantity = this.getRoundQuantity(this.line_items[index].quantity);
                if (parseInt(roundQuantity) < 1) {
                    roundQuantity = 1;
                }
                this.line_items[index].quantity = roundQuantity;
                this.getShippingMethods();
            }

            DraftBuilderEdit.prototype.getRoundQuantity = function (quantity) {
                var roundQuantity = Math.floor(Math.abs(quantity));
                if (parseInt(roundQuantity) < 1) {
                    return 1;
                }
                return roundQuantity;
            }

            DraftBuilderEdit.prototype.removeDiscountLineItem = function (index) {
                this.line_items[index].discount_value = this.line_items[index].total_discount = 0;
                this.line_items[index].is_discount_percent = false;
                this.line_items[index].discount_reason = "";
                this.line_items[index].discount = false;

                $(".line_item_" + index + "_price").html(money(this.line_items[index].price, this.money_format).replace(" ", ""));

                Bizweb.UIPopover.deactivate();
            }

            DraftBuilderEdit.prototype.isValidDiscountLineItem = function (index) {
                var discount = $(".line-item-discount-value-" + index).val();
                if (!!discount) {
                    discount = discount.replace(",", "").replace(".", "");
                }
                if (Bizweb.Utility.isNumeric(discount)) {
                    if (parseInt(discount) > 0) {
                        if (this.line_items[index].is_discount_percent_tmp) {
                            if (parseInt(discount) > 100)
                                return false;
                        }
                        return true;
                    } else {
                        return false;
                    }
                }
            }

            DraftBuilderEdit.prototype.applyDiscountLineItem = function (index) {
                var discount_value = $(".line-item-discount-value-" + index).val();
                var discount_reason = $(".line-item-discount-reason-" + index).val();
                this._applyDiscountLineItem(index, discount_value, discount_reason);

                Bizweb.UIPopover.deactivate();

                this.getShippingMethods();
            }

            DraftBuilderEdit.prototype._applyDiscountLineItem = function (index, value, reason) {
                this.line_items[index].discount_value = value;
                this.line_items[index].discount_reason = reason;
                this.line_items[index].is_discount_percent = this.line_items[index].is_discount_percent_tmp;
                if (this.line_items[index].is_discount_percent) {
                    if (this.line_items[index].discount_value > 100) {
                        this.validDraftOrder = false;
                    }
                    this.line_items[index].total_discount = (this.line_items[index].discount_value * this.line_items[index].price) / 100;
                } else {
                    this.line_items[index].total_discount = this.line_items[index].discount_value;
                }

                if (this.line_items[index].total_discount > this.line_items[index].price)
                    this.line_items[index].total_discount = this.line_items[index].price;

                this.line_items[index].discount = true;
            }

            DraftBuilderEdit.prototype.resetApplyDiscountLineItem = function (index) {
                this.line_items[index].discount_value_tmp = this.line_items[index].discount_value;
                this.line_items[index].discount_reason_tmp = this.line_items[index].discount_reason;
                this.line_items[index].is_discount_percent_tmp = this.line_items[index].is_discount_percent;
            }

            DraftBuilderEdit.prototype.getShippingMethods = function (callback) {
                var that = this;
                var currentShippingMethods = $(".shipping-method-radio");
                for (var i = 0; i < currentShippingMethods.length; i++) {
                    var shippingMethod = currentShippingMethods[i];
                    $(shippingMethod).remove();
                }

                if (this.shipping_address_provinceId > 0 || this.shipping_address_province_code != '') {
                    if (this.ajaxGetShipping) {
                        this.ajaxGetShipping.abort();
                    }

                    this.ajaxGetShipping = $.ajax({
                        url: "/admin/draft_orders/GetShippingMethods",
                        type: "POST",
                        data: {
                            provinceId: that.shipping_address_provinceId,
                            districtId: that.shipping_address_districtId,
                            provinceCode: that.shipping_address_province_code,
                            districtCode: that.shipping_address_district_code,
                            totalPrice: that.caculateTotalLineItemPrice(),
                            totalWeight: that.caculateTotalWeight(),
                            currentShippingMethod: that.shipping_name,
                            discountCode: (that.apply_discount && !that.apply_discount.unexisted ? that.apply_discount.code : null),
                            //discountCode: (that.apply_discount ? that.apply_discount.code : null),
                            lineItems: that.rebuildCurrentLineItems(),
                            email: that.cusEmail
                        },
                        success: function (data) {
                            if (data && !data.error) {
                                if (data.shipping_methods && data.shipping_methods.length > 0) {
                                    that.shipping_methods = data.shipping_methods;

                                    var template = $('#shipping-methods-template').html();
                                    var html = Mustache.render(template, { "shipping-methods": that.shipping_methods });

                                    $(".shipping-method-fee-radio").before(html);

                                    $(".shipping-methods-select").find('input[type="checkbox"], input[type="radio"]').iCheck({
                                        checkboxClass: 'icheckbox_minimal-blue',
                                        radioClass: 'iradio_minimal-blue'
                                    });
                                    $(".shipping-methods-select").find('input[type="checkbox"], input[type="radio"]').on('ifChecked', function (event) {
                                        Bindings.refreshImmediately();
                                    });

                                    Bindings.unbind($(".shipping-methods-select").get(0));
                                    Bindings.bind($(".shipping-methods-select").get(0));

                                    that.checkCurrentShippingMethod();
                                }
                                else {
                                    that.shipping_methods = [];
                                    that.checkCurrentShippingMethod();
                                }

                                if (that.apply_discount) {
                                    if (data.applied_discount) {
                                        that.apply_discount.amount = data.applied_discount.amount;
                                        that.apply_discount.type = data.applied_discount.value_type;
                                        that.apply_discount.unexisted = false;
                                        that.apply_discount.value = data.applied_discount.value;

                                    }
                                    else {
                                        that.apply_discount.unexisted = true;
                                        that.apply_discount_code_input = "";
                                        that.apply_discount.amount = 0;
                                        that.apply_discount.type = "";
                                        that.apply_discount.value = 0;
                                    }
                                }

                                that.discount_target_type = data.discount_target_type;
                            }

                            if (callback) callback(data);
                        },
                        complete: function (data) {
                            this.ajaxGetShipping = undefined;
                        }
                    });
                } else {
                    that.shipping_methods = [];
                    that.checkCurrentShippingMethod();
                }
            }

            DraftBuilderEdit.prototype.recalculateCopiedDiscount = function (callback) {
                var that = this;

                if (that.apply_discount && !that.apply_discount.unexisted) {
                    $.ajax({
                        url: "/admin/draft_orders/GetShippingMethods",
                        type: "POST",
                        data: {
                            provinceId: that.shipping_address_provinceId,
                            districtId: that.shipping_address_districtId,
                            provinceCode: that.shipping_address_province_code,
                            districtCode: that.shipping_address_district_code,
                            totalPrice: that.caculateTotalLineItemPrice(),
                            totalWeight: that.caculateTotalWeight(),
                            currentShippingMethod: that.shipping_name,
                            discountCode: (that.apply_discount && !that.apply_discount.unexisted ? that.apply_discount.code : null),
                            lineItems: that.rebuildCurrentLineItems(),
                            email: that.cusEmail
                        },
                        success: function (data) {
                            if (data && !data.error) {
                                if (data.applied_discount) {
                                    that.apply_discount.amount = data.applied_discount.amount;
                                    that.apply_discount.type = data.applied_discount.value_type;
                                    that.apply_discount.unexisted = false;
                                }
                                else {
                                    that.apply_discount.unexisted = true;
                                    that.apply_discount_code_input = "";
                                    that.apply_discount.amount = 0;
                                    that.apply_discount.type = "";
                                    that.apply_discount.value = 0;
                                }
                            }

                            if (callback) callback();
                        }
                    });
                }
            }

            DraftBuilderEdit.prototype.checkCurrentShippingMethod = function () {
                if (this.shipping_methods == null) {
                    this.shipping_methods = [];
                    return;
                }

                var validCurrentShippingMethod = false;
                if (this.shipping_custom) {
                    validCurrentShippingMethod = true;
                } else {
                    for (var i = 0; i < this.shipping_methods.length; i++) {
                        var shippingMethod = this.shipping_methods[i];
                        if (!this.shipping_custom && shippingMethod.name == this.shipping_name && shippingMethod.fee == this.shipping_fee) {
                            validCurrentShippingMethod = true;
                        }
                    }
                }

                if (!validCurrentShippingMethod) {
                    if (this.shipping_value == "free")
                        return;

                    this.hasShipping = false;
                    this.shipping_name = null;
                    this.shipping_fee = 0;
                    this.shipping_value = "custom";
                }
            }

            DraftBuilderEdit.prototype.caculateTotalWeight = function () {
                var totalWeight = 0;
                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined) {
                        totalWeight += (this.line_items[i].grams) * this.line_items[i].quantity;
                    }
                }
                return totalWeight;
            }

            DraftBuilderEdit.prototype.checkDiscountLineItemType = function (index) {
                return this.line_items[index].is_discount_percent;
            }

            DraftBuilderEdit.prototype.removeLineItem = function (index) {
                this.line_items[index] = null;
                Bindings.unbind($("#line_item_rows").get(0));
                Bindings.bind($("#line_item_rows").get(0));
                $(".line_item_" + index).remove();

                Bindings.refreshImmediately();

                this.getShippingMethods();
            }

            DraftBuilderEdit.prototype.checkNewLineItem = function (variant) {
                if (variant.price) {
                    variant.price = parseFloat(variant.price.toString().replace(/,/g, ""));
                }
                return !isNaN(variant.price) && variant.name && variant.price !== "" && (variant.price >= 0);
            }

            DraftBuilderEdit.prototype.getCountLineItems = function () {
                var length = 0;
                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined)
                        length++;
                }
                return length;
            }

            DraftBuilderEdit.prototype.bindSrc = function () {
                var url = "https://secure.gravatar.com/avatar/";
                var defaultImage = "?s=60&d=https%3A%2F%2Fbizweb.dktcdn.net%2Fassets%2Fadmin%2Fno-gravatar.png";
                if (this.customer && this.customer.email) {
                    var hash = CryptoJS.MD5(this.customer.email);
                    return url + hash + ".jpg" + defaultImage;
                }
                else {
                    return url + defaultImage;
                }
            }

            DraftBuilderEdit.prototype.selectCustomer = function (customer) {
                if (customer.default_address == null) {
                    customer.default_address = this.default_address;
                    this.no_shipping_address = this.no_billing_address = true;
                } else {
                    this.no_shipping_address = this.no_billing_address = false;
                }

                this._bindShippingAddress(customer.default_address);
                this._bindBillingAddress(customer.default_address);
                this.hasCustomerInfo = true;
                this.email = customer.email;
                this.cusEmail = customer.email;
                this.customer = customer

                Bindings.unbind($(".order-sidebar")[0]);
                Bindings.bind($(".order-sidebar")[0]);
                Bindings.refreshImmediately();
                this.applyDiscount();
            }

            DraftBuilderEdit.prototype._bindShippingAddress = function (address) {
                var addressNameFirst = address.first_name != null ? address.first_name : "";
                var addressNameLast = address.last_name != null ? address.last_name : "";
                var addressName = (addressNameLast + " " + addressNameFirst).trim();

                this.shipping_address_name = addressName;
                this.shipping_address_first_name = address.first_name;
                this.shipping_address_last_name = address.last_name;
                this.shipping_address_province = address.province;
                this.shipping_address_phone = address.phone;
                this.shipping_address_country = address.country;
                this.shipping_address_country_code = address.country_code;
                this.shipping_address_address1 = address.address1;
                this.shipping_address_city = address.city ? address.city : address.province;
                this.shipping_address_province_code = address.province_code;
                this.shipping_address_districtId = 0;
                this.shipping_address_district_code = address.district_code;
                this.shipping_address_district = address.district;
                this.shipping_address_company = address.company;
                this.shipping_address_zip = address.zip;
            }

            DraftBuilderEdit.prototype._bindBillingAddress = function (address) {
                var addressNameFirst = address.first_name != null ? address.first_name : "";
                var addressNameLast = address.last_name != null ? address.last_name : "";
                var addressName = (addressNameLast + " " + addressNameFirst).trim();

                this.billing_address_name = addressName;
                this.billing_address_first_name = address.first_name;
                this.billing_address_last_name = address.last_name;
                this.billing_address_province = address.province;
                this.billing_address_phone = address.phone;
                this.billing_address_country = address.country;
                this.billing_address_country_code = address.country_code;
                this.billing_address_address1 = address.address1;
                this.billing_address_province_code = address.province_code;
                this.billing_address_districtId = 0;
                this.billing_address_district_code = address.district_code;
                this.billing_address_district = address.district;
                this.billing_address_company = address.company;
                this.billing_address_zip = address.zip;
                this.billing_address_city = address.city ? address.city : address.province;
            }

            DraftBuilderEdit.prototype.isSameAddress = function () {
                if (!this.isNullAddress(this.getShippingAddress()) || !this.isNullAddress(this.getBillingAddress())) {
                    return _.equal(this.getShippingAddress(), this.getBillingAddress());
                }
                return true;
            }

            DraftBuilderEdit.prototype.isNullAddress = function (address) {
                if (address.name != undefined && address.name.trim().length > 0)
                    return false;
                if (address.address1 != undefined && address.address1.trim().length > 0)
                    return false;
                if (address.province != undefined && address.province.trim().length > 0)
                    return false;
                if (address.country != undefined && address.country.trim().length > 0)
                    return false;
                if (address.phone != undefined && address.phone.trim().length > 0)
                    return false;
                return true;
            }

            DraftBuilderEdit.prototype.getShippingAddress = function () {
                var address = {};
                address.name = this.shipping_address_name;
                address.province = this.shipping_address_province;
                address.phone = this.shipping_address_phone;
                address.country = this.shipping_address_country;
                address.address1 = this.shipping_address_address1;
                return address;
            }

            DraftBuilderEdit.prototype.invalidShippingAddress = function () {
                var address = {};
                address.name = this.shipping_address_name_tmp;
                address.province = this.shipping_address_province_tmp;
                address.phone = this.shipping_address_phone_tmp;
                address.country = this.shipping_address_country_tmp;
                address.address1 = this.shipping_address_address1_tmp;
                return this.isNullAddress(address);
            }

            DraftBuilderEdit.prototype.getBillingAddress = function () {
                var address = {};
                address.name = this.billing_address_name;
                address.province = this.billing_address_province;
                address.phone = this.billing_address_phone;
                address.country = this.billing_address_country;
                address.address1 = this.billing_address_address1;
                return address;
            }

            DraftBuilderEdit.prototype.invalidBillingAddress = function () {
                var address = {};
                address.name = this.billing_address_name_tmp;
                address.province = this.billing_address_province_tmp;
                address.phone = this.billing_address_phone_tmp;
                address.country = this.billing_address_country_tmp;
                address.address1 = this.billing_address_address1_tmp;
                return this.isNullAddress(address);
            }

            DraftBuilderEdit.prototype.updateBillingAddress = function () {
                $('#showErrorAddressDraft').find('.ui-banner__title').text("");
                $('#showErrorAddressDraft').find('.ui-type-container ul').empty();
                if ($('#showErrorAddressDraft').hasClass('hide')) {

                } else {
                    $('#showErrorAddressDraft').addClass('hide');
                }

                var htmlError = "";
                var countError = 0;

                if (this.customerAddress.address_last_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Họ không được dài quá 50 ký tự</li>"
                }

                if (this.customerAddress.address_first_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tên không được dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_company.length > 50) {
                    countError += 1;
                    htmlError += "<li>Công ty không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_phone.length > 15) {
                    countError += 1;
                    htmlError += "<li>Số điện thoại không dài quá 15 ký tự</li>";
                }

                if (this.customerAddress.address_address1.length > 255) {
                    countError += 1;
                    htmlError += "<li>Địa chỉ không dài quá 255 ký tự</li>";
                }

                if (!!this.customerAddress.address_city && this.customerAddress.address_city.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tỉnh / Thành phố không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_zip.length > 20) {
                    countError += 1;
                    htmlError += "<li>Postal / Zip Code phố không dài quá 20 ký tự</li>";
                }

                if (countError === 0) {
                    this.billing_address_name = (this.customerAddress.address_last_name + " " + this.customerAddress.address_first_name).trim();
                    this.billing_address_first_name = this.customerAddress.address_first_name;
                    this.billing_address_last_name = this.customerAddress.address_last_name;
                    this.billing_address_company = this.customerAddress.address_company;
                    this.billing_address_zip = this.customerAddress.address_zip;
                    this.billing_address_phone = this.customerAddress.address_phone;
                    this.billing_address_address1 = this.customerAddress.address_address1;
                    this.billing_address_city = this.customerAddress.address_city;
                    this.billing_address_countryId = this.customerAddress.country_id;
                    this.billing_address_country = $("#CountryId option:selected").text();
                    if (this.customerAddress.have_city) {
                        this.billing_address_province = $("#provinceSlt option:selected").text();
                        this.billing_address_provinceId = this.customerAddress.province_id;
                        this.billing_address_districtId = this.customerAddress.district_id;
                        this.billing_address_district = $("#districtSlt option:selected").text();
                    }
                    else {
                        this.billing_address_city = this.customerAddress.city;
                        this.billing_address_province = this.customerAddress.city;
                        this.billing_address_district = "";
                        this.billing_address_provinceId = 0;
                        this.billing_address_province_code = "";
                        this.billing_address_districtId = 0;
                        this.billing_address_district_code = "";
                        this.billing_address_district = "";
                    }
                    Bizweb.Modal.hide();
                    Bindings.bind($(".order-sidebar")[0], this);
                    this.no_billing_address = false;
                } else {
                    $('#showErrorAddressDraft').find('.ui-banner__title').text("Có " + countError + " lỗi:");
                    $('#showErrorAddressDraft').find('.ui-type-container ul').append(htmlError);
                    $('#showErrorAddressDraft').removeClass('hide');
                }
            }

            DraftBuilderEdit.prototype.resetBillingAddress = function () {
                var that = this;
                $.ajax({
                    url: Bizweb.routes.draftorders + "/address?callback=updateBillingAddress",
                    type: "GET",
                    data: {
                        firstName: this.billing_address_first_name,
                        lastName: this.billing_address_last_name,
                        company: this.billing_address_company,
                        zip: this.billing_address_zip,
                        phone: this.billing_address_phone,
                        address1: this.billing_address_address1,
                        city: this.billing_address_city,
                        countryId: this.billing_address_countryId,
                        countryCode: this.billing_address_country_code,
                        provinceId: this.billing_address_provinceId,
                        provinceCode: this.billing_address_province_code,
                        districtId: this.billing_address_districtId,
                        districtCode: this.billing_address_district_code,
                    },
                    success: function (content) {
                        var billingModel = new Bizweb.Modal();
                        billingModel.show({ content: content });
                    }
                });
            }

            DraftBuilderEdit.prototype.updateShippingAddress = function () {
                $('#showErrorAddressDraft').find('.ui-banner__title').text("");
                $('#showErrorAddressDraft').find('.ui-type-container ul').empty();
                if ($('#showErrorAddressDraft').hasClass('hide')) {

                } else {
                    $('#showErrorAddressDraft').addClass('hide');
                }

                var htmlError = "";
                var countError = 0;

                if (this.customerAddress.address_last_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Họ không được dài quá 50 ký tự</li>"
                }

                if (this.customerAddress.address_first_name.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tên không được dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_company.length > 50) {
                    countError += 1;
                    htmlError += "<li>Công ty không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_phone.length > 15) {
                    countError += 1;
                    htmlError += "<li>Số điện thoại không dài quá 15 ký tự</li>";
                }

                if (this.customerAddress.address_address1.length > 255) {
                    countError += 1;
                    htmlError += "<li>Địa chỉ không dài quá 255 ký tự</li>";
                }

                if (!!this.customerAddress.address_city && this.customerAddress.address_city.length > 50) {
                    countError += 1;
                    htmlError += "<li>Tỉnh / Thành phố không dài quá 50 ký tự</li>";
                }

                if (this.customerAddress.address_zip.length > 20) {
                    countError += 1;
                    htmlError += "<li>Postal / Zip Code phố không dài quá 20 ký tự</li>";
                }

                if (countError === 0) {
                    this.shipping_address_name = (this.customerAddress.address_last_name + " " + this.customerAddress.address_first_name).trim();
                    this.shipping_address_first_name = this.customerAddress.address_first_name;
                    this.shipping_address_last_name = this.customerAddress.address_last_name;
                    this.shipping_address_company = this.customerAddress.address_company;
                    this.shipping_address_zip = this.customerAddress.address_zip;
                    this.shipping_address_phone = this.customerAddress.address_phone;
                    this.shipping_address_address1 = this.customerAddress.address_address1;
                    this.shipping_address_city = this.customerAddress.address_city;
                    this.shipping_address_countryId = this.customerAddress.country_id;
                    this.shipping_address_country = $("#CountryId option:selected").text();
                    if (this.customerAddress.have_city) {
                        this.shipping_address_province = $("#provinceSlt option:selected").text();
                        this.shipping_address_provinceId = this.customerAddress.province_id;
                        this.shipping_address_districtId = this.customerAddress.district_id;
                        this.shipping_address_district = $("#districtSlt option:selected").text();
                    }
                    else {
                        this.shipping_address_city = this.customerAddress.city;
                        this.shipping_address_province = this.customerAddress.city;
                        this.shipping_address_district = "";
                        this.shipping_address_provinceId = 0;
                        this.shipping_address_province_code = "";
                        this.shipping_address_districtId = 0;
                        this.shipping_address_district_code = "";
                        this.shipping_address_district = "";
                    }
                    Bizweb.Modal.hide();
                    Bindings.bind($(".order-sidebar")[0], this);
                    this.no_shipping_address = false;

                    this.getShippingMethods();
                } else {
                    $('#showErrorAddressDraft').find('.ui-banner__title').text("Có " + countError + " lỗi:");
                    $('#showErrorAddressDraft').find('.ui-type-container ul').append(htmlError);
                    $('#showErrorAddressDraft').removeClass('hide');
                }
            }

            DraftBuilderEdit.prototype.resetShippingAddress = function () {
                var that = this;
                $.ajax({
                    url: Bizweb.routes.draftorders + "/address?callback=updateShippingAddress",
                    type: "GET",
                    data: {
                        firstName: this.shipping_address_first_name,
                        lastName: this.shipping_address_last_name,
                        company: this.shipping_address_company,
                        zip: this.shipping_address_zip,
                        phone: this.shipping_address_phone,
                        address1: this.shipping_address_address1,
                        city: this.shipping_address_city,
                        countryId: this.shipping_address_countryId,
                        countryCode: this.shipping_address_country_code,
                        provinceId: this.shipping_address_provinceId,
                        provinceCode: this.shipping_address_province_code,
                        districtId: this.shipping_address_districtId,
                        districtCode: this.shipping_address_district_code,
                    },
                    success: function (content) {
                        var shippingModel = new Bizweb.Modal();
                        shippingModel.show({ content: content });
                    }
                });
            }

            DraftBuilderEdit.prototype.isValidPaid = function () {
                return this.validDraftOrder && (this.getCountLineItems() > 0);
            }

            DraftBuilderEdit.prototype.isValidPending = function () {
                return this.validDraftOrder && (this.getCountLineItems() > 0) && (this.caculateTotalPrice() > 0);
            }

            DraftBuilderEdit.prototype.isValid = function () {
                return this.validDraftOrder && (this.getCountLineItems() > 0);
            }

            DraftBuilderEdit.prototype.createDraftOrder = function (financialStatus) {
                var that = this;
                this.isCreating = true;

                var draftOrder = this.getDraftOrder(financialStatus);

                if (draftOrder.lineItems == null || draftOrder.lineItems.length == 0) {
                    Bizweb.Flash.error("Đơn hàng phải có sản phẩm.");
                    return;
                }
                if (this.email && !validateEmail(this.email)) {
                    Bizweb.Flash.error("Email không đúng định dạng.");
                    return;
                }

                $('.btn-save-draft-order').addClass("disabled is-loading");
                $.ajax({
                    type: 'POST',
                    url: "/admin/draft_orders/create",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(draftOrder),
                    dataType: "json",
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }
                        Bizweb.Flash.notice("Tạo đơn hàng mới thành công!");
                        var draftOrderId = result.id;
                        setTimeout(function () {
                            window.location.href = "/admin/draft_orders/" + draftOrderId;
                        }, 1000);
                    },
                    error: function (data) {
                        $('.btn-save-draft-order').removeClass("disabled is-loading");
                        that.isCreating = false;
                        Bizweb.Flash.error(data.responseJSON.error);
                    }
                });
            }

            DraftBuilderEdit.prototype.completeDraftOrder = function (financialStatus) {
                var that = this;

                var draftOrder = {};
                draftOrder.id = that.draftOrderId;
                draftOrder.paymentPending = (financialStatus == "pending");

                $('.btn-complete-draft-order').addClass("disabled is-loading");
                $.ajax({
                    type: 'POST',
                    url: "/admin/draft_orders/" + that.draftOrderId + "/complete",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(draftOrder),
                    dataType: "json",
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }
                        //Bizweb.Flash.notice("Tạo đơn hàng mới thành công!");
                        var orderId = result.id;
                        setTimeout(function () {
                            window.location.href = "/admin/orders/" + orderId;
                        }, 100);
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error);
                        $('.btn-complete-draft-order').addClass("disabled is-loading");
                    }
                });
            }

            DraftBuilderEdit.prototype.updateDraftOrder = function (financialStatus) {
                var that = this;
                this.isCreating = false;

                var draftOrder = this.getDraftOrder(financialStatus);

                if (draftOrder.lineItems == null || draftOrder.lineItems.length == 0) {
                    Bizweb.Flash.error("Đơn hàng phải có sản phẩm.");
                    return;
                }
                if (this.email && !validateEmail(this.email)) {
                    Bizweb.Flash.error("Email không đúng định dạng.");
                    return;
                }
                //if (this.apply_discount && this.apply_discount.code && this.apply_discount.amount == 0) {
                //    Bizweb.Flash.error("Mã khuyến mại không hợp lệ.");
                //    return;
                //}
                Bizweb.Loading.start();
                $('.btn-save-draft-order').addClass("disabled is-loading");
                $.ajax({
                    type: 'POST',
                    url: "/admin/draft_orders/" + that.draftOrderId,
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(draftOrder),
                    dataType: "json",
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }
                        //Bizweb.Utility.loadAjax(Bizweb.routes.draftorders + "/" + that.draftOrderId, ".page-content", function () {
                        //    Bizweb.Utility.changeUrl(Bizweb.routes.draftorders + "/" + that.draftOrderId);
                        //    Bizweb.Flash.notice("Cập nhật đơn hàng thành công!");
                        //    initAutoNumeric();
                        //});
                        Bizweb.Flash.notice("Cập nhật đơn hàng thành công!");
                        setTimeout(function () {
                            location.reload();
                        }, 100);

                    },
                    error: function (data) {
                        that.isCreating = false;
                        Bizweb.Flash.error(data.responseJSON.error);
                        Bizweb.Loading.stop();
                        $('.btn-save-draft-order').removeClass("disabled is-loading");
                    }
                });
            }

            DraftBuilderEdit.prototype.getDraftOrder = function (financialStatus) {
                var that = this;

                var draftOrder = {};
                if (this.hasCustomerInfo) {
                    draftOrder.customerId = this.customer.id;
                    draftOrder.email = this.email;

                    if (!this.no_shipping_address) {
                        draftOrder.shippingAddress = {};
                        draftOrder.shippingAddress.firstName = this.shipping_address_first_name;
                        draftOrder.shippingAddress.lastName = this.shipping_address_last_name;
                        draftOrder.shippingAddress.name = this.shipping_address_name;
                        draftOrder.shippingAddress.phone = this.shipping_address_phone;
                        draftOrder.shippingAddress.address1 = this.shipping_address_address1;
                        draftOrder.shippingAddress.country = this.shipping_address_country;
                        draftOrder.shippingAddress.countryId = this.shipping_address_countryId;
                        draftOrder.shippingAddress.countryCode = this.shipping_address_country_code;
                        draftOrder.shippingAddress.city = this.shipping_address_city;
                        draftOrder.shippingAddress.province = this.shipping_address_province;
                        draftOrder.shippingAddress.provinceId = this.shipping_address_provinceId;
                        draftOrder.shippingAddress.provinceCode = this.shipping_address_province_code;
                        draftOrder.shippingAddress.districtId = this.shipping_address_districtId;
                        draftOrder.shippingAddress.districtCode = this.shipping_address_district_code;
                        draftOrder.shippingAddress.district = this.shipping_address_district;
                        draftOrder.shippingAddress.company = this.shipping_address_company;
                        draftOrder.shippingAddress.zip = this.shipping_address_zip;
                    }

                    if (!this.no_billing_address) {
                        draftOrder.billingAddress = {};
                        draftOrder.billingAddress.firstName = this.billing_address_first_name;
                        draftOrder.billingAddress.lastName = this.billing_address_last_name;
                        draftOrder.billingAddress.name = this.billing_address_name;
                        draftOrder.billingAddress.phone = this.billing_address_phone;
                        draftOrder.billingAddress.address1 = this.billing_address_address1;
                        draftOrder.billingAddress.country = this.billing_address_country;
                        draftOrder.billingAddress.countryId = this.billing_address_countryId;
                        draftOrder.billingAddress.countryCode = this.billing_address_country_code;
                        draftOrder.billingAddress.city = this.billing_address_city;
                        draftOrder.billingAddress.province = this.billing_address_province;
                        draftOrder.billingAddress.provinceId = this.billing_address_provinceId;
                        draftOrder.billingAddress.provinceCode = this.billing_address_provinceCode;
                        draftOrder.billingAddress.districtId = this.billing_address_districtId;
                        draftOrder.billingAddress.districtCode = this.billing_address_district_code;
                        draftOrder.billingAddress.district = this.billing_address_district;
                        draftOrder.billingAddress.company = this.billing_address_company;
                        draftOrder.billingAddress.zip = this.billing_address_zip;
                    }
                }

                if (this.hasShipping) {
                    draftOrder.shippingLine = {};
                    draftOrder.shippingLine.code = draftOrder.shippingLine.title = this.shipping_name;
                    draftOrder.shippingLine.price = this.shipping_fee;
                    draftOrder.shippingLine.custom = this.shipping_custom;
                }

                //get all tags
                var tags = new Array();
                $(".next-token-list :input[name='Tags[]']").each(function () {
                    var input = $(this); // This is the jquery object of the input, do what you will
                    tags.push(input.val());
                });

                draftOrder.financialStatus = financialStatus == undefined ? '' : financialStatus;
                draftOrder.note = this.note;
                draftOrder.tags = tags;
                draftOrder.isSendMail = this.isSendMail;
                draftOrder.discountTargetType = this.discount_target_type;

                if (this.discount || (this.apply_discount && this.apply_discount.amount > 0)) {
                    draftOrder.appliedDiscount = {};

                    if (this.apply_discount) {
                        draftOrder.appliedDiscount.title = this.apply_discount.code;
                        draftOrder.appliedDiscount.value = this.apply_discount.value;
                        draftOrder.appliedDiscount.valueType = this.apply_discount.type;
                        draftOrder.appliedDiscount.custom = false;
                        draftOrder.appliedDiscount.amount = this.apply_discount.amount;
                    }
                    else {
                        draftOrder.appliedDiscount.description = this.reason_discount;
                        draftOrder.appliedDiscount.value = this.discount;

                        if (this.is_discount_percent) {
                            draftOrder.appliedDiscount.valueType = "percentage";
                        } else {
                            draftOrder.appliedDiscount.valueType = "fixed_amount";
                        }
                        draftOrder.appliedDiscount.custom = true;
                    }
                }

                draftOrder.lineItems = this.rebuildCurrentLineItems();

                return draftOrder;
            }

            DraftBuilderEdit.prototype.rebuildCurrentLineItems = function () {
                var lineItems = [];

                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined) {
                        var line_item = this.line_items[i];
                        var lineItem = {};
                        lineItem.quantity = line_item.quantity;
                        lineItem.productId = line_item.product_id;
                        lineItem.variantId = line_item.id;
                        lineItem.variantTitle = line_item.title;
                        lineItem.title = line_item.name;
                        lineItem.requiresShipping = line_item.requires_shipping;
                        lineItem.price = line_item.price;
                        lineItem.grams = line_item.grams;
                        if (line_item.discount) {
                            lineItem.appliedDiscount = {};
                            lineItem.appliedDiscount.value = line_item.discount_value;
                            lineItem.appliedDiscount.description = line_item.discount_reason;
                            if (line_item.is_discount_percent) {
                                lineItem.appliedDiscount.valueType = "percentage";
                            } else {
                                lineItem.appliedDiscount.valueType = "dollar";
                            }
                        }

                        lineItems.push(lineItem);
                    }
                }

                return lineItems;
            }

            DraftBuilderEdit.prototype.resetAddress = function () {
                this.shipping_address_name = "";
                this.shipping_address_first_name = "";
                this.shipping_address_last_name = "";
                this.shipping_address_province = "";
                this.shipping_address_phone = "";
                this.shipping_address_country = "";
                this.shipping_address_address1 = "";
                this.shipping_address_city = "";
                this.shipping_address_provinceId = 0;
                this.shipping_address_districtId = 0;
                this.shipping_address_district = "";
                this.shipping_address_zip = "";
                this.shipping_address_company = "";
                this.shipping_address_country_code = "";
                this.shipping_address_countryId = 0;

                this.billing_address_first_name = "";
                this.billing_address_last_name = "";
                this.billing_address_name = "";
                this.billing_address_province = "";
                this.billing_address_phone = "";
                this.billing_address_country = "";
                this.billing_address_address1 = "";
                this.billing_address_city = "";
                this.billing_address_provinceId = 0;
                this.billing_address_districtId = 0;
                this.billing_address_district = "";
                this.billing_address_zip = "";
                this.billing_address_company = "";
                this.billing_address_country_code = "";
                this.billing_address_countryId = 0;
                this.no_shipping_address = true;
                this.no_billing_address = true;
                this.hasShipping = false;
                this.shipping_name = "";
                this.shipping_fee = 0;
            }

            DraftBuilderEdit.prototype.removeCustomer = function () {
                this.customer = this.default_customer;
                this.hasCustomerInfo = false;
                this.email = "";
                this.cusEmail = "";
                this.resetAddress();
                this.getShippingMethods();
            }

            DraftBuilderEdit.prototype.resetOrderEmail = function () {
                this.email_tmp = this.customer.email;

                this.editEmailModal.show();
            }

            DraftBuilderEdit.prototype.updateEmail = function () {
                var emailTmp = $("input#order_email").val();
                if (emailTmp && !validateEmail(emailTmp)) {
                    Bizweb.Flash.error("Email không đúng định dạng.");
                    return;
                }
                this.email = emailTmp;
                this.editEmailModal.hide();
            }

            DraftBuilderEdit.prototype.caculateTotalLineItemPrice = function () {
                var totalPrice = 0;
                for (var i = 0; i < this.line_items.length; i++) {
                    if (this.line_items[i] != null && this.line_items[i].item_index != null && this.line_items[i].item_index != undefined) {
                        totalPrice += (this.line_items[i].price - this.line_items[i].total_discount) * this.line_items[i].quantity;
                    }
                }
                return totalPrice;
            }

            DraftBuilderEdit.prototype.isValidDiscount = function () {
                if (this.getCountLineItems() > 0) {
                    if (this.apply_discount_code_input)
                        return true;

                    var discount = this.discount_tmp;
                    var discountType = this.isDiscountPercentTmp;
                    if (discount) {
                        discount = parseFloat(discount.toString().replace(/,/g, ""));
                    }
                    if (Bizweb.Utility.isNumeric(discount)) {
                        if (parseInt(discount) > 0) {
                            if (discountType) {
                                if (parseInt(discount) <= 100)
                                    return true;
                            } else {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }

            DraftBuilderEdit.prototype.applyDiscount = function () {
                var that = this;

                if (this.apply_discount_code_input) {
                    this.apply_discount = {};
                    this.apply_discount.code = this.apply_discount_code_input;
                    this.discount = this.discount_tmp = 0;
                    this.reason_discount = this.reason_discount_tmp = "";
                }
                else {
                    this.apply_discount = null;
                    this.apply_discount_code_input = "";
                    this.discount = this.discount_tmp;
                    this.reason_discount = this.reason_discount_tmp;
                    this.is_discount_percent = this.isDiscountPercentTmp;

                    if (this.discount) {
                        this.discount = parseFloat(this.discount.toString().replace(/,/g, ""));
                    }
                }

                Bizweb.UIPopover.deactivate();

                this.getShippingMethods(function () {
                    $(".shipping-methods-select").find('input[type="radio"][shipping-name="' + that.shipping_name + '"]').iCheck('check');
                    $(".btn-apply-shipping").removeClass("disabled");
                });

                reSetAutoNumeric();
            }

            DraftBuilderEdit.prototype.caculateDiscount = function () {
                var discount = 0;

                if (this.apply_discount) {
                    discount = this.apply_discount.amount ? this.apply_discount.amount : 0;
                }
                else {
                    var totalLineItemPrice = this.caculateTotalLineItemPrice();
                    if (this.is_discount_percent) {
                        discount = totalLineItemPrice * this.discount / 100;
                    }
                    else {
                        discount = parseFloat(this.discount);
                    }
                }

                return discount;
            }

            DraftBuilderEdit.prototype.caculateTotalPrice = function () {
                var totalLineItemPrice = this.caculateTotalLineItemPrice();
                if (this.discount_target_type == 'shipping_line') {
                    return totalLineItemPrice - this.caculateDiscount() + this.shipping_fee;
                }
                else {
                    return totalLineItemPrice - Math.min(this.caculateDiscount(), totalLineItemPrice) + this.shipping_fee;
                }
            }

            DraftBuilderEdit.prototype.caculateSubtotalPrice = function () {
                var totalLineItemPrice = this.caculateTotalLineItemPrice();
                return totalLineItemPrice - Math.min(this.caculateDiscount(), totalLineItemPrice);
            }

            DraftBuilderEdit.prototype.removeDiscount = function () {
                this.apply_discount = null;
                this.apply_discount_code_input = "";
                this.discount = 0;
                this.reason_discount = "";
                this.discount_tmp = 0;
                this.reason_discount_tmp = "";
                this.is_discount_percent = this.isDiscountPercentTmp = false;
                Bizweb.UIPopover.deactivate();
            }

            DraftBuilderEdit.prototype.canSaveShippingRate = function () {
                var shippingSelected = $("input[name='shippingMethod']:checked").val();
                if (shippingSelected == "custom") {
                    var shipping_name = $("#customShippingName").val();
                    var shipping_fee = parseFloat($("#customShippingFee").val());

                    return shipping_name != "" && Bizweb.Utility.isNumeric(shipping_fee);
                }
                else {
                    return true;
                }
            }

            DraftBuilderEdit.prototype.setShippingLine = function () {
                unSetAutoNumeric();
                var shippingSelected = this.shipping_value = $("input[name='shippingMethod']:checked").val();
                if (shippingSelected == "custom") {
                    this.shipping_custom = this.shipping_custom_tmp = true;
                    var shipping_name = $("#customShippingName").val();
                    var shipping_fee = parseFloat($("#customShippingFee").val());
                    if (!shipping_name.trim()) {
                        shipping_name = "Tùy chọn";
                    }
                    if (!Bizweb.Utility.isNumeric(shipping_fee)) {
                        shipping_fee = 0;
                    }
                    this.shipping_name = this.custom_shipping_name = shipping_name;
                    this.shipping_fee = this.custom_shipping_fee = shipping_fee;
                }
                else {
                    this.shipping_custom = this.shipping_custom_tmp = false;
                    this.shipping_name = $("input[name='shippingMethod']:checked").attr("shipping-name");
                    this.shipping_fee = parseFloat($("input[name='shippingMethod']:checked").attr("fee"));
                }
                this.recalculateCopiedDiscount();
                this.hasShipping = true;
                reSetAutoNumeric();
                Bizweb.UIPopover.deactivate();
            }

            DraftBuilderEdit.prototype.isValidShippingFee = function () {
                var shippingSelected = this.shipping_value = $("input[name='shippingMethod']:checked").val();
                if (shippingSelected == "custom") {
                    this.shipping_custom = this.shipping_custom_tmp = true;
                    var shipping_name = $("#customShippingName").val();
                    var shipping_fee = unFomatPrice($("#customShippingFee").val());
                    if (!shipping_name.trim())
                        return false;
                }
                else {
                    var shipping_fee = parseFloat($("input[name='shippingMethod']:checked").attr("fee"));
                }

                if (!Bizweb.Utility.isNumeric(shipping_fee)) {
                    return false;
                } else {
                    if (shipping_fee < 0) {
                        return false;
                    }
                }

                return true;
            }

            DraftBuilderEdit.prototype.isShippingCustom = function () {
                var shippingSelected = $("input[name='shippingMethod']:checked").val();

                if (shippingSelected == "custom") {
                    this.shipping_custom_tmp = true;
                } else {
                    this.shipping_custom_tmp = false;
                }
            }

            DraftBuilderEdit.prototype.resetShippingLine = function () {
                this.custom_shipping_name_tmp = this.custom_shipping_name;
                this.custom_shipping_fee_tmp = this.custom_shipping_fee;
                this.shipping_custom_tmp = this.shipping_custom;

                $('input[name="shippingMethod"][value="' + this.shipping_value + '"]').iCheck('check');

                initAutoNumeric();
            }

            DraftBuilderEdit.prototype.removeShipping = function () {
                this.hasShipping = false;
                this.shipping_name = "";
                this.shipping_fee = 0;
                Bizweb.UIPopover.deactivate();

                if (this.apply_discount) {
                    this.recalculateCopiedDiscount();
                }
            }

            DraftBuilderEdit.prototype.quickCreateCustomer = function () {
                $("#bizweb-modal .btn-default.btn-primary").addClass("disabled").html(Bizweb.LOADING);
                this.isCustomerInVietnam = true;
                var that = this;
                var formQuickAddCustomer = $('#form-quick-add-customer');
                //if (!formQuickAddCustomer.valid()) {
                //    return;
                //}
                $.ajax({
                    url: '/admin/customers/quickcreate',
                    type: "POST",
                    data: formQuickAddCustomer.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                        } else if (result.id != null && result.id > 0) {
                            that.selectCustomer(result);
                            Bizweb.Modal.hide();
                        }
                    }
                });
            }

            DraftBuilderEdit.prototype.selectShippingMethod = function (name) {
                if (name === "custom")
                    $(".shipping-methods-select").find('input[type="radio"][value="custom"]').iCheck('check');
                else
                    $(".shipping-methods-select").find('input[type="radio"][shipping-name="' + name + '"]').iCheck('check');
            }

            DraftBuilderEdit.prototype.markPaymentOrder = function () {
                var that = this;
                setTimeout(function () {
                    if (that.mark_payment_order != null && that.mark_payment_order != "") {
                        switch (that.mark_payment_order) {
                            case "paid":
                                that.confirmPaidOrderModal.show();
                                break;
                            case "pending":
                                that.confirmPendingOrderModal.show();
                                break;
                            default:
                                break;
                        }
                        Bindings.refreshImmediately();
                    }
                }, 50);
            }

            DraftBuilderEdit.prototype.saveIfDirtyThenShow = function (modal) {
                var that = this;
                this.isCreating = false;

                var draftOrder = this.getDraftOrder('');

                if (draftOrder.lineItems == null || draftOrder.lineItems.length == 0) {
                    Bizweb.Flash.error("Đơn hàng phải có sản phẩm.");
                    return;
                }
                //if (this.apply_discount && this.apply_discount.code && this.apply_discount.amount == 0) {
                //    Bizweb.Flash.error("Mã khuyến mại không hợp lệ.");
                //    return;
                //}
                $('.btn-save-draft-order').addClass('disabled is-loading');
                $.ajax({
                    type: 'POST',
                    url: "/admin/draft_orders/" + that.draftOrderId,
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(draftOrder),
                    dataType: "json",
                    success: function (result) {
                        $('.btn-save-draft-order').removeClass('disabled is-loading');
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }

                        if (modal == 'markAsPaidModal') {
                            that.confirmPaidOrderModal.show();
                        } else if (modal == 'markAsPendingModal') {
                            that.confirmPendingOrderModal.show();
                        }
                    },
                    error: function (data) {
                        $('.btn-save-draft-order').removeClass('disabled is-loading');
                        that.isCreating = false;
                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Đã xảy ra lỗi khiến quá trình cập nhật đơn hàng thất bại.");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            }

            return DraftBuilderEdit;
        }()
    }.call(this),
    function () {
        Bizweb.CustomerAddress = function () {
            function CustomerAddress(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                $.provinces = $(options.province_slt);
                $.districts = $(options.district_slt);
                this.element = element;
            };

            CustomerAddress.prototype.changeCountry = function () {
                var that = this;
                $.ajax({
                    url: "/admin/countries/{0}/provinces".format(that.country_id),
                    success: function (data) {
                        if (data.length == 0) {
                            that.have_city = false;
                            $.provinces.empty();
                            $.districts.empty();
                        }
                        else {
                            var html = "";
                            for (var index in data) {
                                var province = data[index];
                                html += "<option value='" + province.id + "'>" + province.name + "</option>"
                            }
                            $.provinces.empty().html(html);
                            $.provinces.trigger("change");
                            that.have_city = true;
                        }
                    }
                });
            }

            CustomerAddress.prototype.changeProvince = function () {
                var that = this;
                $.ajax({
                    url: "/admin/provinces/{0}/districts".format(that.province_id),
                    success: function (data) {
                        if (data.length == 0) {
                            $.districts.empty();
                        }
                        else {
                            var html = "";
                            for (var index in data) {
                                var province = data[index];
                                html += "<option value='" + province.id + "'>" + province.name + "</option>"
                            }
                            $.districts.empty().html(html);
                            $.districts.trigger("change");
                        }
                    }
                });
            }

            return CustomerAddress;
        }();
    }.call(this),
    function () {
        Bizweb.ProductsImportAndExport = function () {
            function ProductsImportAndExport(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                if (this.show_change_notice) {
                    if (window.storageAvailable('localStorage')) {
                        var noticeRead = window.localStorage.getItem('file_import_notice_read');
                        if (noticeRead != null && noticeRead == 'true') {
                            this.show_change_notice = false;
                        }
                    }
                }

                this.element = element;
            };

            ProductsImportAndExport.prototype.setNoticeAsRead = function () {
                if (this.show_change_notice) {
                    if (window.storageAvailable('localStorage')) {
                        window.localStorage.setItem('file_import_notice_read', 'true');
                    }
                    this.show_change_notice = false;
                }
            }

            ProductsImportAndExport.prototype.showExportProducts = function () {
                this.exportProductsModal.show();
                var formFilter = $('#frmFilter');
                var formExport = $('#form-export-products');
                var formBulkAction = $('#frmBulkActions');
                var countAddedInputs = this.copyFromFormToAnother(formFilter, formExport);
                var countAddedInputIds = this.copyOnlyInputNameFromFormToAnother(formBulkAction, formExport, "ids");
                if (countAddedInputIds <= 0) {
                    $('#exportProductsType-selected-products').attr("disabled", "disabled");
                }
                $('#products-match-current-search').html(this.products_match_current_search + " ");
                if (countAddedInputs < 1) {
                    $('#exportProductsType-current-search').attr("disabled", "disabled");
                }
            }

            ProductsImportAndExport.prototype.exportProducts = function () {
                var that = this;
                var formExport = $('#form-export-products');
                $.ajax({
                    url: '/admin/products/Export',
                    type: "POST",
                    data: formExport.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        } else {
                            Bizweb.Flash.notice(result.success);
                        }
                        that.exportProductsModal.hide();
                    }
                });
            }

            ProductsImportAndExport.prototype.copyFromFormToAnother = function (formA, formB) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).val()) {
                        $('[name=' + $(this).attr('name') + ']', formB).val($(this).val());
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            ProductsImportAndExport.prototype.copyOnlyInputNameFromFormToAnother = function (formA, formB, inputName) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).attr('name') == inputName) {
                        var value = $(this).attr('value');
                        formB.append("<input type='hidden' name='" + inputName + "' value='" + value + "' />");
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            ProductsImportAndExport.prototype.openFileImportProducts = function () {
                this.importProductsModal.show();
                $('#importProductsFileUpload').val('');
            }

            ProductsImportAndExport.prototype.enableButtonImportProducts = function () {
                var fileUpload = $('#importProductsFileUpload').val();

                if (fileUpload != undefined && fileUpload != '') {
                    $('.btn-import-products').prop('disabled', false);
                } else {
                    $('.btn-import-products').prop('disabled', true);
                }
            }

            ProductsImportAndExport.prototype.importProducts = function () {
                $('#form-import-products').submit();
            }

            return ProductsImportAndExport;
        }();
    }.call(this),
    function () {
        Bizweb.Apps = function () {
            function Apps() {
            }

            Apps.prototype.buyApp = function (apikey) {
                $.ajax({
                    url: Bizweb.routes.apps + "/buyapp",
                    type: "POST",
                    data: {
                        apiKey: apikey
                    },
                    success: function (data) {
                        var url = "";
                        if (data != null && data.charge_id > 0)
                            url = Bizweb.routes.charges + "/" + data.charge_id;
                        if (data != null && data.redirect)
                            url = data.redirect;
                        Page.refresh({ url: url })
                    },
                    error: function (data) {
                        if (typeof data.responseJSON === "undefined") {
                            Bizweb.Flash.error("Thao tác thất bại");
                            return;
                        }

                        if (data.responseJSON.error !== null && data.responseJSON.error !== "")
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            }

            return Apps;
        }();
    }.call(this),
    function () {
        Bizweb.OrderEvent = function () {
            function OrderEvent(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };
            OrderEvent.prototype.resendMail = function (ele, eventId) {
                $(ele).addClass("disabled").html(Bizweb.LOADING);
                var orderId = this.order_id;
                $.ajax({
                    url: Bizweb.routes.orders + "/resendNotification?id=" + orderId + "&eventId=" + eventId,
                    type: "POST",
                    success: function (data) {
                        Bizweb.Flash.notice(data.message);
                        Bizweb.Modal.hide();
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        $(ele).removeClass("disabled").html("Xác nhận");
                    }
                });
            }

            OrderEvent.prototype.expanDetail = function (e, id) {
                var container = $(e).closest('#event_' + id);
                if ($(container).hasClass('ui-feed__item--revealed')) {
                    _.prepareTransition($(container)).removeClass('ui-feed__item--revealed');
                    _.prepareTransition($(container)).find('#event_detail_' + id).removeClass('ui-accordion--is-expanded');
                    _.prepareTransition($(container)).find('#event_detail_' + id).find('#ui-accordion__panel--' + id).removeClass('block');
                } else {
                    _.prepareTransition($(container)).addClass('ui-feed__item--revealed');
                    _.prepareTransition($(container)).find('#event_detail_' + id).addClass('ui-accordion--is-expanded');
                    _.prepareTransition($(container)).find('#event_detail_' + id).find('#ui-accordion__panel--' + id).addClass('block');
                }
            }
            return OrderEvent;
        }();
    }.call(this),
    function () {
        Bizweb.OrdersExport = function () {
            function OrdersExport(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            OrdersExport.prototype.showExportOrders = function () {
                this.exportOrdersModal.show();
                var formFilter = $('#frmFilter');
                var formExport = $('#form-export-orders');
                var formBulkAction = $('#frmBulkActions');
                var countAddedInputs = this.copyFromFormToAnother(formFilter, formExport);
                var countAddedInputIds = this.copyOnlyInputNameFromFormToAnother(formBulkAction, formExport, "ids");
                if (countAddedInputIds <= 0) {
                    $('#exportOrdersType-selected-orders').attr("disabled", "disabled");
                }
                $('#orders-match-current-search').html(this.orders_match_current_search + " ");
                if (countAddedInputs < 1) {
                    $('#exportOrdersType-current-search').attr("disabled", "disabled");
                }
            }

            OrdersExport.prototype.exportOrders = function () {
                $('#form-export-orders input[name=ExportTransactions]').val(false);
                this.submitFormExportOrders();
            }

            OrdersExport.prototype.exportOrderTransactions = function () {
                $('#form-export-orders input[name=ExportTransactions]').val(true);
                this.submitFormExportOrders();
            }

            OrdersExport.prototype.submitFormExportOrders = function () {
                var that = this;
                var formExport = $('#form-export-orders');
                $.ajax({
                    url: '/admin/orders/Export',
                    type: "POST",
                    data: formExport.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        } else {
                            Bizweb.Flash.notice(result.success);
                        }
                        that.exportOrdersModal.hide();
                    }
                });
            }

            OrdersExport.prototype.copyFromFormToAnother = function (formA, formB) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).val()) {
                        $('[name=' + $(this).attr('name') + ']', formB).val($(this).val());
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            OrdersExport.prototype.copyOnlyInputNameFromFormToAnother = function (formA, formB, inputName) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).attr('name') == inputName) {
                        var value = $(this).attr('value');
                        formB.append("<input type='hidden' name='" + inputName + "' value='" + value + "' />");
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            return OrdersExport;
        }();
    }.call(this),
    function () {
        Bizweb.ShipmentsExport = function () {
            function ShipmentsExport(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            ShipmentsExport.prototype.showExportShipments = function () {
                this.exportShipmentsModal.show();
                var formFilter = $('#frmFilter');
                var formExport = $('#form-export-shipments');
                var formBulkAction = $('#frmBulkActions');
                var countAddedInputs = this.copyFromFormToAnother(formFilter, formExport);
                var countAddedInputIds = this.copyOnlyInputNameFromFormToAnother(formBulkAction, formExport, "ids");
                if (countAddedInputIds <= 0) {
                    $('#exportShipmentsType-selected-shipments').attr("disabled", "disabled");
                }
                $('#shipments-match-current-search').html(this.shipments_match_current_search + " ");
                if (countAddedInputs < 1) {
                    $('#exportShipmentsType-current-search').attr("disabled", "disabled");
                }
            }

            ShipmentsExport.prototype.exportShipments = function () {
                this.submitFormExportShipments();
            }

            ShipmentsExport.prototype.submitFormExportShipments = function () {
                var that = this;
                var formExport = $('#form-export-shipments');
                $.ajax({
                    url: '/admin/shipments/Export',
                    type: "POST",
                    data: formExport.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        } else {
                            Bizweb.Flash.notice(result.success);
                        }
                        that.exportShipmentsModal.hide();
                    }
                });
            }

            ShipmentsExport.prototype.copyFromFormToAnother = function (formA, formB) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).val()) {
                        $('[name=' + $(this).attr('name') + ']', formB).val($(this).val());
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            ShipmentsExport.prototype.copyOnlyInputNameFromFormToAnother = function (formA, formB, inputName) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).attr('name') == inputName) {
                        var value = $(this).attr('value');
                        formB.append("<input type='hidden' name='" + inputName + "' value='" + value + "' />");
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            return ShipmentsExport;
        }();
    }.call(this),
    function () {
        Bizweb.CheckoutsExport = function () {
            function CheckoutsExport(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            CheckoutsExport.prototype.showExportCheckouts = function () {
                this.exportCheckoutsModal.show();
                var formFilter = $('#frmFilter');
                var formExport = $('#form-export-checkouts');
                var formBulkAction = $('#frmBulkActions');
                var countAddedInputs = this.copyFromFormToAnother(formFilter, formExport);
                var countAddedInputIds = this.copyOnlyInputNameFromFormToAnother(formBulkAction, formExport, "ids");
                if (countAddedInputIds <= 0) {
                    $('#exportCheckoutsType-selected-checkouts').attr("disabled", "disabled");
                }
                $('#checkouts-match-current-search').html(this.checkouts_match_current_search + " ");
                if (countAddedInputs < 1) {
                    $('#exportCheckoutsType-current-search').attr("disabled", "disabled");
                }
            }

            CheckoutsExport.prototype.exportCheckouts = function () {
                this.submitFormExportCheckouts();
            }

            CheckoutsExport.prototype.submitFormExportCheckouts = function () {
                var that = this;
                var formExport = $('#form-export-checkouts');
                $.ajax({
                    url: '/admin/checkouts/export',
                    type: "POST",
                    data: formExport.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        } else {
                            Bizweb.Flash.notice(result.success);
                        }
                        that.exportCheckoutsModal.hide();
                    }
                });
            }

            CheckoutsExport.prototype.copyFromFormToAnother = function (formA, formB) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).val()) {
                        $('[name=' + $(this).attr('name') + ']', formB).val($(this).val());
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            CheckoutsExport.prototype.copyOnlyInputNameFromFormToAnother = function (formA, formB, inputName) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).attr('name') == inputName) {
                        var value = $(this).attr('value');
                        formB.append("<input type='hidden' name='" + inputName + "' value='" + value + "' />");
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            return CheckoutsExport;
        }();
    }.call(this),
    function () {
        Bizweb.DraftOrdersExport = function () {
            function DraftOrdersExport(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
                this.element = element;
            };

            DraftOrdersExport.prototype.showExportDraftOrders = function () {
                this.exportDraftOrdersModal.show();
                var formFilter = $('#frmFilter');
                var formExport = $('#form-export-drafts');
                var formBulkAction = $('#frmBulkActions');
                var countAddedInputs = this.copyFromFormToAnother(formFilter, formExport);
                var countAddedInputIds = this.copyOnlyInputNameFromFormToAnother(formBulkAction, formExport, "ids");
                if (countAddedInputIds <= 0) {
                    $('#exportDraftOrdersType-selected-drafts').attr("disabled", "disabled");
                }
                $('#drafts-match-current-search').html(this.drafts_match_current_search + " ");
                if (countAddedInputs < 1) {
                    $('#exportDraftOrdersType-current-search').attr("disabled", "disabled");
                }
            }

            DraftOrdersExport.prototype.exportDraftOrders = function () {
                this.submitFormExportDraftOrders();
            }

            DraftOrdersExport.prototype.submitFormExportDraftOrders = function () {
                var that = this;
                var formExport = $('#form-export-drafts');
                $.ajax({
                    url: '/admin/draft_orders/export',
                    type: "POST",
                    data: formExport.serialize(),
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        } else {
                            Bizweb.Flash.notice(result.success);
                        }
                        that.exportDraftOrdersModal.hide();
                    }
                });
            }

            DraftOrdersExport.prototype.copyFromFormToAnother = function (formA, formB) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).val()) {
                        $('[name=' + $(this).attr('name') + ']', formB).val($(this).val());
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            DraftOrdersExport.prototype.copyOnlyInputNameFromFormToAnother = function (formA, formB, inputName) {
                var countAddedInputs = 0;
                $(':input[name]', formA).each(function () {
                    if ($(this).attr('name') == inputName) {
                        var value = $(this).attr('value');
                        formB.append("<input type='hidden' name='" + inputName + "' value='" + value + "' />");
                        countAddedInputs++;
                    }
                })
                return countAddedInputs;
            }

            return DraftOrdersExport;
        }();
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        Bizweb.GoogleAnalyticReportSettings = function () {
            function GoogleAnalyticReportSettings(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = element;
                this.saving = false;
                this.deleting = false;

                var currentInstance = this;
                this.gaOauthWindow = null;
                this.oauthButton = $('.ga-oauth-button');
                this.gaChangeView = $('.ga-change-view');
                this.gaSubmitChange = $('.ga-submit-change');
                this.gaDelete = $('.ga-delete');

                this.submitSettingChange = _.debounce(function () {
                    var view_id = "ga:" + currentInstance.ga_view_id;
                    Bizweb.Loading.start();
                    $.ajax({
                        url: "/admin/settings/store/UpdateGoogleAnalyticsViewId",
                        type: "POST",
                        dataType: "json",
                        data: {
                            viewId: view_id
                        },
                        global: false,
                        success: function (response) {
                            Bizweb.Flash.notice(response.message);
                            currentInstance.has_view_id = true;
                            if (window.storageAvailable('localStorage')) {
                                window.localStorage.setItem('gaReportCurrentViewId', view_id)
                            }
                            Page.refresh({ url: window.location, onlyKeys: ["ga-report"] });
                        },
                        error: function (error) {
                            Bizweb.Flash.notice(error.message);
                        },
                        complete: function () {
                            currentInstance.saving = false;
                            Bizweb.Loading.stop();
                            Bindings.refresh();
                        }
                    });
                }, 500);
                this.registEventListener = e(this.registEventListener, this);

                window.addEventListener("message", this.registEventListener);

                $(document).one("page:before-replace", function () {
                    window.removeEventListener("message", currentInstance.registEventListener);
                });
            }

            GoogleAnalyticReportSettings.prototype.registEventListener = function (event) {
                if (event.origin !== window.location.origin) return;
                if (event.data.authorization == true) {
                    $(".ga-oauth-button").prop('disabled', true);
                    this.gaOauthWindow.close();
                    this.resetAccountList();
                    this.gaChangeView.prop('disabled', true);
                    this.getAccountList();
                    this.has_view_id = false;
                }
            };

            GoogleAnalyticReportSettings.prototype.initOauthWindow = function () {
                this.gaOauthWindow = window.open('/admin/settings/store/gaoauth', 'Google Analytics Oauthentication', "width=450,height=800,scrollbars=yes");
            };

            GoogleAnalyticReportSettings.prototype.changeViewId = function () {
                this.gaChangeView.prop('disabled', true);
                this.getAccountList();
            };

            GoogleAnalyticReportSettings.prototype.saveChange = function () {
                this.saving = true;
                this.submitSettingChange();
            };

            GoogleAnalyticReportSettings.prototype.deleteSetting = function () {
                this.deleting = true;
                var currentInstance = this;
                $.ajax({
                    url: "/admin/settings/store/removegoogleanalyticssetting",
                    type: "POST",
                    dataType: "json",
                    success: function (response) {
                        $(".ga-view-menu.in").collapse('hide');
                        currentInstance.has_account = false;
                        currentInstance.has_view_id = false;
                        $(".ga-oauth-button").prop('disabled', false);
                        currentInstance.resetAccountList();
                        Bizweb.Flash.notice(response.message);
                    },
                    error: function (error) {
                        Bizweb.Flash.notice(error.message);
                    },
                    complete: function () {
                        currentInstance.deleting = false;
                        Bindings.refresh();
                    }
                });
            };

            GoogleAnalyticReportSettings.prototype.changeGaAcc = function (ele) {
                var id = $(ele).val();
                $('.ga-prop-select').addClass('hide');
                $('.ga-' + id).removeClass('hide');
                var propId = $('.ga-' + id).val();
                $('.ga-view-select').addClass('hide');
                $('.ga-' + propId).removeClass('hide');
                this.ga_view_id = $('.ga-' + propId).val();
                Bindings.refreshImmediately();
            };

            GoogleAnalyticReportSettings.prototype.changeGaProp = function (ele) {
                var propId = $(ele).val();
                $('.ga-view-select').addClass('hide');
                $('.ga-' + propId).removeClass('hide');
                this.ga_view_id = $('.ga-' + propId).val();
                Bindings.refreshImmediately();
            };

            GoogleAnalyticReportSettings.prototype.changeGaView = function (ele) {
                this.ga_view_id = $(ele).val();
                Bindings.refreshImmediately();
            };

            GoogleAnalyticReportSettings.prototype.resetAccountList = function () {
                $(".ga-account").empty();
                $("#prop-select-container").empty();
                $("#view-select-container").empty();
                this.ga_view_id = '';
            };

            GoogleAnalyticReportSettings.prototype.getAccountList = function () {
                var currentInstance = this;
                $.ajax({
                    url: "/admin/settings/store/googleanalyticsaccount",
                    type: "GET",
                    dataType: "json",
                    success: function (response) {
                        currentInstance.has_account = true;
                        var defaultViewId = currentInstance.ga_view_id;
                        var currentProp = null;
                        var currentAccount = null;
                        for (var i = 0; i < response.items.length; i++) {
                            var item = response.items[i];
                            var opt = document.createElement("option");
                            opt.value = item.id;
                            opt.innerHTML = item.name;
                            document.getElementsByClassName("ga-account")[0].appendChild(opt);
                            var propselect = document.createElement('select');
                            propselect.className = "ui-select hide js-no-dirty ga-prop-select ga-" + item.id;
                            propselect.setAttribute('bind-event-change', 'changeGaProp(this)');
                            propselect.setAttribute('data-form-dirty', 'false');
                            for (var j = 0; j < item.webProperties.length; j++) {
                                var property = item.webProperties[j];
                                var propOpt = document.createElement("option");
                                propOpt.value = property.id;
                                propOpt.innerHTML = property.name;
                                propselect.appendChild(propOpt)
                                var viewSelect = document.createElement("select");
                                viewSelect.className = "ui-select hide js-no-dirty ga-view-select ga-" + property.id;
                                viewSelect.setAttribute('bind-event-change', 'changeGaView(this)');
                                viewSelect.setAttribute('data-form-dirty', 'false');
                                for (var k = 0; k < property.profiles.length; k++) {
                                    var view = property.profiles[k];
                                    var viewOpt = document.createElement("option");
                                    viewOpt.value = view.id;
                                    if (defaultViewId && view.id == defaultViewId) {
                                        currentProp = property.id;
                                        currentAccount = item.id;
                                    }
                                    viewOpt.innerHTML = view.name;
                                    viewSelect.appendChild(viewOpt);
                                }
                                document.getElementById('view-select-container').appendChild(viewSelect);
                                Bindings.bind($('.ga-' + property.id).get(0))
                            }
                            document.getElementById('prop-select-container').appendChild(propselect);
                            Bindings.bind($('.ga-' + item.id).get(0))
                        }
                        $(".ga-view-menu").collapse('show');
                        if (defaultViewId) {
                            $(".ga-account").val(currentAccount);
                            $(".ga-" + currentAccount).val(currentProp).removeClass('hide');
                            $(".ga-" + currentProp).val(defaultViewId).removeClass('hide');
                        } else {
                            var gaSelectedAcc = $(".ga-account").val();
                            $(".ga-" + gaSelectedAcc).removeClass('hide');
                            var gaSelectedProp = $(".ga-" + gaSelectedAcc).val();
                            $(".ga-" + gaSelectedProp).removeClass('hide');
                            currentInstance.ga_view_id = $(".ga-" + gaSelectedProp).val();
                        }
                    },
                    error: function (error) {
                        currentInstance.has_account = true;
                        currentInstance.has_view_id = false;
                        currentInstance.oauthButton.prop('disabled', false);
                        currentInstance.gaChangeView.prop('disabled', false);
                        Bizweb.Flash.notice("Không lấy được thông tin Tài khoản Google Analytics");
                    },
                    complete: function () {
                        Bindings.refresh();
                    }
                });
            };

            return GoogleAnalyticReportSettings;
        }();
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };
        Bizweb.Drawer = function () {
            function Drawer(e) {
                this.drawerKeyup = t(this.drawerKeyup, this);
                this.$pager = $(".page-wrapper");
                this.$drawer = $(e);
                this.$parent = $("html, body");
                this.$wrapper = $(".page-content");
                this.isOpen = this.$drawer.hasClass(this.DRAWER_OPEN_CLASS);
                this.numOfOpenningOrder = 0;
                this.showOpenningOder();
            }

            Drawer.prototype.NO_SCROLLING_CLASS = "no-scrolling";
            Drawer.prototype.DRAWER_OPEN_CLASS = "nav-drawer-open";

            Drawer.prototype.toggle = function () {
                if (this.$pager.hasClass("had-minimized")) {
                    this.$pager.toggleClass("page-minimize");
                }
                else {
                    this.isOpen ? this.close() : this.open();
                }
            };

            Drawer.prototype.open = function () {
                if (this.isOpen)
                    return;

                _.prepareTransition(this.$drawer).addClass(this.DRAWER_OPEN_CLASS);
                //this.$drawer.addClass(this.DRAWER_OPEN_CLASS);
                this.$parent.addClass(this.NO_SCROLLING_CLASS);
                this.isOpen = true;
                this.$wrapper.on("touchmove.drawer", function () {
                    return !1
                });
                $(document).on("keyup.drawer", this.drawerKeyup);
                if ($('.next-nav__panel').height() <= $('.next-nav__list--primary').height()) {
                    $('.next-nav__panel').height($('.next-nav__list--primary').height());
                }
            };

            Drawer.prototype.close = function () {
                if (this.isOpen) {
                    _.prepareTransition(this.$drawer).removeClass(this.DRAWER_OPEN_CLASS);
                    //this.$drawer.removeClass(this.DRAWER_OPEN_CLASS);
                    this.$parent.removeClass(this.NO_SCROLLING_CLASS);
                    this.isOpen = false;
                    this.$wrapper.off(".drawer");
                    $(document).off(".drawer");
                }
            };

            Drawer.prototype.drawerKeyup = function (t) {
                if (t.keyCode === Bizweb.Keycodes.ESCAPE)
                    this.close();
            }

            Drawer.prototype.showOpenningOder = function () {
                var $this = this;
                $.ajax({
                    url: "/admin/orders/GetOpeningOrder",
                    global: false,
                    success: function (data) {
                        $this.numOfOpenningOrder = data.num_of_opening_order;
                        Bindings.refresh();
                    }
                })
            };

            Drawer.prototype.showSubMenu = function (e) {
                var $that = $(e);
                var category = $that.data("name");
                //if ($('.next-nav__panel--secondary').hasClass("next-nav__panel--secondary-open")) {
                //    $('.next-nav__panel--secondary').removeClass("next-nav__panel--secondary-open");
                //}
                //_.prepareTransition($('.next-nav__panel--secondary')).addClass("next-nav__panel--secondary-open");
                $('#sidebar--nav').addClass("next-nav--is-expanded");
                $('#sidebar--nav').find('a.active-temp').removeClass('active-temp');

                if ($($that).hasClass('active-temp')) {

                } else {
                    $($that).addClass('active-temp');
                }

                if (category == "orders") {
                    if ($('#NextNavOrders').hasClass("next-nav__list--is-open")) {
                        $('#NextNavOrders').removeClass("next-nav__list--is-open");
                        $('#sidebar--nav').find('a.active-temp').removeClass('active-temp');
                        $('#sidebar--nav').removeClass("next-nav--is-expanded");
                        _.prepareTransition($('.next-nav__panel--secondary')).removeClass("next-nav__panel--secondary-open");
                    }
                    else {
                        _.prepareTransition($('.next-nav__panel--secondary')).addClass("next-nav__panel--secondary-open");
                        $('#NextNavWebsite').removeClass("next-nav__list--is-open");
                        $('#NextNavProducts').removeClass("next-nav__list--is-open");
                        $('#NextNavOrders').addClass("next-nav__list--is-open");
                        //window.location.replace($('#NextNavOrders .next-nav__link:first').attr("href"));
                    }
                }
                else if (category == "website") {
                    if ($('#NextNavWebsite').hasClass("next-nav__list--is-open")) {
                        $('#NextNavWebsite').removeClass("next-nav__list--is-open");
                        $('#sidebar--nav').find('a.active-temp').removeClass('active-temp');
                        $('#sidebar--nav').removeClass("next-nav--is-expanded");
                        _.prepareTransition($('.next-nav__panel--secondary')).removeClass("next-nav__panel--secondary-open");
                    }
                    else {
                        _.prepareTransition($('.next-nav__panel--secondary')).addClass("next-nav__panel--secondary-open");
                        $('#NextNavOrders').removeClass("next-nav__list--is-open");
                        $('#NextNavProducts').removeClass("next-nav__list--is-open");
                        $('#NextNavWebsite').addClass("next-nav__list--is-open");
                        //window.location.replace($('#NextNavWebsite .next-nav__link:first').attr("href"));
                    }
                }
                else if (category == "products") {
                    if ($('#NextNavProducts').hasClass("next-nav__list--is-open")) {
                        $('#NextNavProducts').removeClass("next-nav__list--is-open");
                        $('#sidebar--nav').find('a.active-temp').removeClass('active-temp');
                        $('#sidebar--nav').removeClass("next-nav--is-expanded");
                        _.prepareTransition($('.next-nav__panel--secondary')).removeClass("next-nav__panel--secondary-open");
                    }
                    else {
                        _.prepareTransition($('.next-nav__panel--secondary')).addClass("next-nav__panel--secondary-open");
                        $('#NextNavOrders').removeClass("next-nav__list--is-open");
                        $('#NextNavWebsite').removeClass("next-nav__list--is-open");
                        $('#NextNavProducts').addClass("next-nav__list--is-open");
                        //window.location.replace($('#NextNavSettings .next-nav__link:first').attr("href"));
                    }
                }
            }

            Drawer.prototype.closeSubMenu = function () {
                $('#NextNavOrders').removeClass("next-nav__list--is-open");
                $('#NextNavWebsite').removeClass("next-nav__list--is-open");
                $('#NextNavProducts').removeClass("next-nav__list--is-open");
                $('#sidebar--nav').find('a.active-temp').removeClass('active-temp');
                $('#sidebar--nav').removeClass("next-nav--is-expanded");
                _.prepareTransition($('.next-nav__panel--secondary')).removeClass("next-nav__panel--secondary-open");
            }

            Drawer.prototype.showChannel = function () {
                var cnt = $(".hideSaleChannel").contents();
                $(".hideSaleChannel").replaceWith(cnt);

                $("#showMore").remove();
                //var elem = document.getElementById('showMore');
                //elem.parentNode.removeChild(elem);

                if ($('.next-nav__panel').height <= $('.next-nav__list--primary').height()) {
                    $('.next-nav__panel').height($('.next-nav__list--primary').height());
                }
            }

            Drawer.name = "Drawer";
            return Drawer;
        }()
    }.call(this),
    function () {
        Bizweb.FilePicker = function () {
            function FilePicker(e, options) {
                if (options) {
                    for (var property in options) {
                        this[property] = options[property];
                    }
                }

                this.ele = e;
                this.selectChanged = false;

                if (!this.selected_id)
                    this.selected_id = 0;
                else
                    this.selectChanged = true;
            };

            FilePicker.prototype.selectFile = function (seletedImageId, src) {
                this.selected_id = seletedImageId;
                this.selected_src = src;
                this.selectChanged = true;
            };
            FilePicker.prototype.chooseFile = function (options) {
                if (options && options.callback) {
                    callback({
                        id: this.selected_id,
                        src: this.selected_src
                    });
                }
                else if (Bindings.context(document.body).app) {
                    Bindings.context(document.body).app.host.filePickerConfirm({
                        id: this.selected_id,
                        src: this.selected_src
                    });
                }
            };
            FilePicker.prototype.cancelPicker = function () {
                if (Bindings.context(document.body).app) {
                    Bindings.context(document.body).app.host.filePickerCancel();
                }
            };
            FilePicker.prototype.next = function () {
                this.loadUrl(this.next_page);
            }
            FilePicker.prototype.prev = function () {
                this.loadUrl(this.prev_page);
            }
            FilePicker.prototype.loadUrl = function (url) {
                var that = this;

                Bindings.unbind($(".image-popup").get(0));

                $.ajax({
                    url: url,
                    success: function (data) {
                        $(that.ele).parent(".modal-dialog").html(data);
                        Bindings.bind($(".image-popup").get(0), this);
                    }
                });
            }
            FilePicker.prototype.uploadFile = function () {
                var that = this;
                var formData = new FormData();

                var totalFiles = $("#file-uploader")[0].files.length;
                if (totalFiles <= 0) {
                    return;
                }

                for (var i = 0; i < totalFiles; i++) {
                    var file = document.getElementById("file-uploader").files[i];
                    formData.append("mediaImages", file);
                }

                Bizweb.Loading.start();

                $.ajax({
                    type: "POST",
                    url: '/admin/settings/files/upload',
                    data: formData,
                    contentType: false,
                    processData: false,
                    global: false,
                    success: function (result) {
                        if (result.error) {
                            Bizweb.Flash.error(result.error);
                            Bizweb.Loading.stop();
                        }
                        else {
                            if (result.length > 0)
                                Bizweb.Utility.loadAjax("/admin/settings/files/picker?selectedId=" + result[0].id, "#bizweb-modal", Bizweb.Flash.notice("Cập nhật thành công"), { hide: false });
                            else
                                Bizweb.Utility.loadAjax("/admin/settings/files/picker", "#bizweb-modal", Bizweb.Flash.notice("Cập nhật thành công"), { hide: false });
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        Bizweb.Loading.stop();
                    }
                });
            }
            FilePicker.prototype.openFileUpload = function () {
                $("#file-uploader").click();
            }

            return FilePicker;
        }();
    }.call(this),
    function () {
        Bizweb.FilePickerV2 = function () {
            function FilePickerV2(e, options) {
                if (options) {
                    for (var property in options) {
                        this[property] = options[property];
                    }
                }

                this.selectedImage = [];
                this.numOfSelectedImage = 0;
                this.maxImageChoosed = 10;

                this.ele = e;
                this.selectChanged = false;

                if (this.selectedImage.length > 0) {
                    this.selectChanged = true;
                }
            };

            FilePickerV2.prototype.addOrRemoveBulkActionImage = function (imageId, imageSrc, ele) {
                var selectedBulkActionItems = this.numOfSelectedImage;
                if ($(ele).parent().hasClass("is-selected")) {
                    var index = this.selectedImage.indexOf(imageId);
                    $(ele).parent().removeClass("is-selected");
                    if (index > -1) {
                        this.selectedImage.splice(index, 1);
                    }
                    var removeBulkActionItem = document.getElementById("bulk-action-image-" + imageId);
                    if (removeBulkActionItem != null) {
                        removeBulkActionItem.parentNode.removeChild(removeBulkActionItem);
                        selectedBulkActionItems--;
                    }
                }
                else {
                    this.selectedImage.push(imageSrc);
                    var newBulkActionItem = document.createElement('input');
                    newBulkActionItem.type = "hidden";
                    newBulkActionItem.name = "src";
                    newBulkActionItem.value = imageSrc;
                    newBulkActionItem.id = "bulk-action-image-" + imageId;
                    document.getElementById("frmImageBulkActions").appendChild(newBulkActionItem);
                    if (parseFloat(selectedBulkActionItems) >= parseFloat(this.maxImageChoosed)) {
                        eleCheckBox.checked = false;
                        $(ele).parent().removeClass("is-selected");
                        Bizweb.Flash.error('Chỉ được chọn tối đa ' + this.maxImageChoosed + ' ảnh');
                        return;
                    }
                    selectedBulkActionItems++;
                    $(ele).parent().addClass("is-selected");
                }

                this.numOfSelectedImage = selectedBulkActionItems;
                if (this.selectedImage.length > 0) {
                    this.selectChanged = true;
                }
                else {
                    this.selectChanged = false;
                }
            }

            FilePickerV2.prototype.chooseFile = function (options) {
                if (options && options.callback) {
                    callback({
                        srcs: $("#frmImageBulkActions").serialize()
                    });
                }
                else if (Bindings.context(document.body).app) {
                    Bindings.context(document.body).app.host.filePickerConfirm({
                        srcs: $("#frmImageBulkActions").serialize()
                    });
                }
            };
            FilePickerV2.prototype.cancelPicker = function () {
                if (Bindings.context(document.body).app) {
                    Bindings.context(document.body).app.host.filePickerCancel();
                }
            };
            FilePickerV2.prototype.next = function () {
                this.loadUrl(this.next_page);
            }
            FilePickerV2.prototype.prev = function () {
                this.loadUrl(this.prev_page);
            }
            FilePickerV2.prototype.loadUrl = function (url) {
                var that = this;

                Bindings.unbind($(".image-popup").get(0));

                $.ajax({
                    url: url,
                    success: function (data) {
                        $(that.ele).closest(".parent-dialog").html(data);
                        Bindings.bind($(".image-popup").get(0), this);
                    }
                });
            }
            FilePickerV2.prototype.uploadFile = function () {
                var that = this;
                var formData = new FormData();

                var totalFiles = $("#file-uploader")[0].files.length;
                if (totalFiles <= 0) {
                    return;
                }

                for (var i = 0; i < totalFiles; i++) {
                    var file = document.getElementById("file-uploader").files[i];
                    formData.append("mediaImages", file);
                }
                Bizweb.Loading.start();

                $.ajax({
                    type: "POST",
                    url: '/admin/settings/files/upload',
                    data: formData,
                    contentType: false,
                    processData: false,
                    global: false,
                    success: function (result) {
                        if (result.error) {
                            Bizweb.Flash.error(result.error);
                            Bizweb.Loading.stop();
                        }
                        else {
                            if (result.length > 0)
                                Bizweb.Utility.loadAjax("/admin/settings/files/pickerV2?selectedId=" + result[0].id, "#bizweb-modal", Bizweb.Flash.notice("Cập nhật thành công"), { hide: false });
                            else
                                Bizweb.Utility.loadAjax("/admin/settings/files/pickerV2", "#bizweb-modal", Bizweb.Flash.notice("Cập nhật thành công"), { hide: false });
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        Bizweb.Loading.stop();
                    }
                });
            }
            FilePickerV2.prototype.openFileUpload = function () {
                $("#file-uploader").click();
            }

            return FilePickerV2;
        }();
    }.call(this),
    function () {
        var menuItemTemplate = '<tr linklist-id="{{ linklist.id }}"><td><a href="/admin/links/{{ linklist.id }}" target="_blank" rel="noopener noreferrer">{{ linklist.title }}</a></td><td style="text-align:right;"><a bind-event-click="removeMenu({{ linklist.id }})" href="javascript:void(0)"><svg class="next-icon next-icon--size-12"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#next-remove"></use></svg></a><input type="hidden" name="LinklistIds" value="{{ linklist.id }}" /></td></tr>';

        Bizweb.MenuPicker = function () {
            function MenuPicker(e, options) {
                if (options) {
                    for (var property in options) {
                        this[property] = options[property];
                    }
                }

                this.$container = $(e);
                this.$form = this.$container.parents('form');
                this.formContext = null;
                if (this.$form.size()) {
                    this.formContext = Bindings.context(this.$form.get(0));
                }

                if (!this.linklistIds)
                    this.linklistIds = [];
            };

            MenuPicker.prototype.removeMenu = function (linklistId) {
                this.$container.find("tr[linklist-id=" + linklistId + "]").remove();

                this.linklistIds = $.grep(this.linklistIds, function (value) {
                    return value != linklistId;
                });

                Bindings.refreshImmediately();

                if (this.formContext && this.formContext.form) {
                    this.formContext.form._updateDirtyState();
                }
            };
            MenuPicker.prototype.addToMenu = function (linklistId, linklistTitle) {
                if (!Common.include(this.linklistIds, linklistId)) {
                    this.linklistIds.push(linklistId);

                    var menuItem = menuItemTemplate.replace(/{{ linklist.id }}/g, linklistId).replace(/{{ linklist.title }}/g, linklistTitle);
                    this.$container.find("table.menu-container tbody").append(menuItem);

                    Bindings.refreshImmediately();
                    Bindings.unbind(this.$container.find("table.menu-container tbody").get(0));
                    Bindings.bind(this.$container.find("table.menu-container tbody").get(0));

                    if (this.formContext && this.formContext.form) {
                        this.formContext.form._updateDirtyState();
                    }
                }

                Bizweb.Modal.hide();
            };
            MenuPicker.prototype.createChildMenu = function (menuTitle) {
                var _this = this;

                $.ajax({
                    type: "POST",
                    url: '/admin/links/createjson',
                    data: {
                        title: menuTitle
                    },
                    success: function (result) {
                        if (result) {
                            _this.addToMenu(result.id, result.title);
                        }
                    },
                    error: function (data) {
                        if (data)
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        else
                            Bizweb.Flash.error("Thêm menu thất bại.");
                    }
                });
            };

            MenuPicker.name = "MenuPicker";
            return MenuPicker;
        }();
    }.call(this),
    function () {
        Bizweb.EnterUserPassword = function () {
            function t(t, e) {
                this.$parentForm = $(t), this.modal = e, this.passwordRequired = !1, this.showEmailChange = !1, this.showPasswordChange = !1, this.showLogoutOptions = !1
            }
            return t.prototype.expandEmailChange = function () {
                return this.showEmailChange = !0, this.flagPasswordAsRequired(!1)
            }, t.prototype.expandPasswordChange = function () {
                return this.showPasswordChange = !0, this.flagPasswordAsRequired(!0)
            }, t.prototype.flagPasswordAsRequired = function (t) {
                return this.passwordRequired = !Bizweb.currentUser.isEmployee, this.showLogoutOptions = t
            }, t.prototype.showOrSubmitModal = function () {
                return this.passwordRequired ? (this.modal.show(), $("#current_password").focus()) : this.$parentForm.submit()
            }, t.prototype.submitUserForm = function (t) {
                var e;
                return e = t.current_password.value, this.$parentForm.find("#user_current_password").val(e), t.revoke_mobile_access_tokens.checked && this.$parentForm.find("#user_revoke_mobile_access_tokens").val(!0), this.$parentForm.submit(), this.modal.hide()
            }, t
        }();
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = function (e, t) {
                function n() {
                    this.constructor = e
                }
                for (var r in t) i.call(t, r) && (e[r] = t[r]);
                return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
            },
            i = {}.hasOwnProperty;
        Bizweb.UserFormNoImage = function (i) {
            function n(t, i) {
                this.form = t, this.opts = null != i ? i : {}, this.submit = e(this.submit, this), n.__super__.constructor.apply(this, arguments)
            }
            return t(n, i), n.prototype.submit = function (e) {
                var t, i, n;
                return e.preventDefault(), n = e.target, t = {
                    httpRequestType: n.getAttribute("method"),
                    httpUrl: n.getAttribute("action"),
                    refreshOnSuccess: "user-form"
                }, i = new TurboGraft.Remote(t, this.form, n), i.submit()
            }, n
        }(Bizweb.Forms)
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };

        Bizweb.BulkEditor = function () {
            function e(e) {
                null == e && (e = {}),
                this._persistColumnState = t(this._persistColumnState, this),
                this.toggleStickyHeaders = t(this.toggleStickyHeaders, this),
                this.spreadsheetScrolled = t(this.spreadsheetScrolled, this),
                this.scrollerScrolled = t(this.scrollerScrolled, this),
                this.resizableMouseMove = t(this.resizableMouseMove, this),
                this.resizableMouseUp = t(this.resizableMouseUp, this),
                this.resizableMouseDown = t(this.resizableMouseDown, this),
                this.debouncedRedraw = _.debounce(this._redrawTable, 1e3, {
                    leading: !0,
                    trailing: !0
                }),
                this.submitting = !1,
                this.anyFormDirty = !1,
                this.resizing = !1,
                this.resizingCell = null,
                this.startResizingWidth = null,
                this.startResizingPosition = null,
                this.resourceName = e.resource_name,
                this.showColumns = e.show_columns || [],
                this.editColumns = e.edit_columns || [],
                this.ids = e.ids,
                this.search = e.search || {},
                this.metafieldTitles = e.metafield_titles,
                this.metafieldOptions = e.metafield_options,
                this.resourceTitle = e.resource_title,
                this._persistColumnState();

                this._datetimePicker = !1;
            }

            var i = 272;
            var o = "bulk";
            var r = "columns";
            var z = "[data-form-dirty]";
            var n = {
                BULK_FORM_BUTTON: "bulk-submit",
                DIRTY_FORM_BUTTON: "btn-primary",
                DIRTY_INDICATOR_CELL: "spreadsheet__cell--dirty-indicator",
                HIDDEN_INDICATOR: "spreadsheet__status-indicator--is-hidden",
                HEADER_GROUP: "spreadsheet__header-group",
                HIDDEN_HEADER_GROUP: "spreadsheet__header-group--is-hidden",
                FIXED_HEADER_GROUP: "spreadsheet__header-group--is-fixed",
                SPINDICATOR: "next-spinner",
                DIRTY: "spreadsheet__cell--has-changes",
                RESIZABLE_CELL: "spreadsheet__cell--resizable",
                RESIZABLE_HANDLE: "spreadsheet__resize-handle",
                SCROLLER: {
                    BASE: "spreadsheet-scroller",
                    SCROLLBAR: "spreadsheet-scroller__scroll-bar"
                }
            }

            e.goToBulkEditor = function (t, e) {
                var n = {
                    resourceName: t,
                    edit: e.defaultEditColumns,
                    show: e.defaultShowColumns
                };
                n.returnTo = e.returnTo;
                n.edit = this._fromSessionStorage("edit", t) || n.edit;
                n.show = this._fromSessionStorage("show", t) || n.show;
                e.useSearch ? (_.extend(n, URI().search(!0))) : n.ids = e.ids;
                e.customParams && _.merge(n, e.customParams);
                document.location.href = Bizweb.funcRoutes.bulk(n).html;
            }
            e._fromSessionStorage = function (t, e, n) {
                return null == n && (n = !1), sessionStorage.getItem("bulk-editor-" + t + "-" + e)
            }
            e.prototype.bind = function (t) {
                return this.node = t, this.$node = $(t), this.$headerGroup = $(this.node).find("." + n.HEADER_GROUP), this.$headerCells = this.$headerGroup.children(), this.$scroller = $(this.node).find("." + n.SCROLLER.SCROLLBAR), this.$scrollerContainer = $(this.node).find("." + n.SCROLLER.BASE), this.setInitialCellWidths(), this.addResizeHandles(), this.duplicateTableHeader(), this.setScrollerWidth(), $(window).on("scroll.bulk-editor", _.debounce(this.toggleStickyHeaders, 10)), this.$node.on("mousedown.bulk-editor", "." + n.RESIZABLE_HANDLE, this.resizableMouseDown), this.$node.on("mouseup.bulk-editor", this.resizableMouseUp), this.$node.on("mousemove.bulk-editor", _.debounce(this.resizableMouseMove, 10)), this.$scrollerContainer.on("scroll.bulk-editor", _.throttle(this.scrollerScrolled, 10)), this.$node.on("scroll.bulk-editor", _.throttle(this.spreadsheetScrolled, 10)), Page.onReplace(this.node, function () {
                    return $(window).off(".bulk-editor")
                })
            }
            e.prototype.resizableMouseDown = function (t) {
                var e;
                return this.resizing = !0, e = $(t.target.parentNode), this.resizingCell = e.index(), this.startResizingPosition = t.pageX, this.startResizingWidth = e.width()
            }
            e.prototype.resizableMouseUp = function () {
                var t;
                if (this.resizing) return this.resizing = !1, t = this.$headerCells.eq(this.resizingCell), SafeLocalStorage.set("bulk-editor-column-size-" + t.attr("title"), t.width())
            }
            e.prototype.resizableMouseMove = function (t) {
                var e;
                if (this.resizing) return e = this.startResizingWidth + (t.pageX - this.startResizingPosition), e > 100 ? (this.$headerCells.eq(this.resizingCell).css({
                    width: e,
                    "min-width": e
                }), this.$clonedHeaderCells.eq(this.resizingCell).css({
                    width: e,
                    "min-width": e
                }), this.$headerGroupClone.width(this.$headerGroup.width()), this.setScrollerWidth()) : void 0
            }
            e.prototype.setInitialCellWidths = function () {
                return this.$headerCells.each(function () {
                    var t, e;
                    return t = $(this), e = SafeLocalStorage.get("bulk-editor-column-size-" + t.attr("title"), null), e ? t.width(e) : void 0
                })
            }
            e.prototype.addResizeHandles = function () {
                var t;
                return t = $("<span>").addClass(n.RESIZABLE_HANDLE), this.$headerGroup.find("." + n.RESIZABLE_CELL).append(t)
            }
            e.prototype.duplicateTableHeader = function () {
                //return this.$headerGroup.width(this.$headerGroup.width()), this.$headerGroupClone = this.$headerGroup.clone(), this.$headerGroupClone.addClass(n.FIXED_HEADER_GROUP).addClass(n.HIDDEN_HEADER_GROUP), this.$headerGroup.after(this.$headerGroupClone), this.$clonedHeaderCells = this.$headerGroupClone.children()
            }
            e.prototype.setScrollerWidth = function () {
                return this.$scroller.width(this.$headerGroup.width())
            }
            e.prototype.scrollerScrolled = function () {
                return this.$node.scrollLeft(this.$scrollerContainer.scrollLeft())
            }
            e.prototype.spreadsheetScrolled = function () {
                return this.$scrollerContainer.scrollLeft(this.$node.scrollLeft()), this.scrollHeaderHorizontally()
            }
            e.prototype.scrollHeaderHorizontally = function () {
                //var t;
                //t = i - this.node.scrollLeft;
                //this.$headerGroupClone.css("left", t + "px");
            }
            e.prototype.toggleStickyHeaders = function () {
                //var t;
                //return t = $(window).scrollTop() + $(".header-row").height(), this.$headerGroupClone.toggleClass(n.HIDDEN_HEADER_GROUP, t <= this.node.offsetTop)
            }
            e.prototype.register = function (t, e) {
                return e.off("bindings:change"), e.on("input change paste", function (t) {
                    return function () {
                        return t._setDirty(e)
                    }
                }(this))
            }
            e.prototype.submitAll = function () {
                var t;
                this.submitting = !0;
                t = $(z + "." + n.BULK_FORM_BUTTON);
                this.submissionFailures = 0;
                this.submissionSuccesses = 0;
                t.length ? this.submitNextRow(t.toArray()) : (this.submitting = !1, this.anyFormDirty = !1, Bindings.refresh());
            }
            e.prototype.submitNextRow = function (rows) {
                if (rows.length === 0) {
                    this._finishSubmitting()
                }
                else {
                    var row = rows.shift();
                    var $form = $(row).closest("form");

                    if ($form[0].checkValidity()) {
                        $form.one("turbograft:remote:success", function (e) {
                            return function (n) {
                                e.submissionSuccesses++;
                                e.submitNextRow(rows)
                            }
                        }(this));
                        $form.one("turbograft:remote:fail", function (n) {
                            return function (i) {
                                var r, o, a;
                                n.submissionFailures++;
                                422 !== (null != i && null != (r = i.originalEvent) && null != (o = r.data) && null != (a = o.xhr) ? a.status : void 0) && n._handleSubmissionError($form);
                                n.submitNextRow(rows);
                            }
                        }(this));

                        this._setClean($form);
                        this._toggleSpindicate($form);
                        row.click();
                    }
                    else {
                        this.submissionFailures++;
                        this.submitNextRow(rows);
                    }
                }
            }
            e.prototype.fadeIndicators = function (t) {
                return $(t).one("transitionend webkitTransitionEnd oTransitionEnd", function () {
                    return $(t).addClass("hide")
                }), _.defer(function () {
                    return $(t).addClass(n.HIDDEN_INDICATOR)
                })
            }
            e.prototype.addColumn = function (t, e) {
                var n;
                if (!this.columnIsSelected(t)) return n = {
                    full_name: t
                }, null != e && (n.type = e), this.editColumns.push(n), this.debouncedRedraw()
            }
            e.prototype.removeColumn = function (t) {
                var e;
                return e = this._columnIndex(t), e >= 0 ? (this.editColumns.splice(e, 1), this.debouncedRedraw()) : void 0
            }
            e.prototype.columnIsSelected = function (t) {
                return this._columnIndex(t) >= 0
            }
            e.prototype._finishSubmitting = function () {
                var t = "";

                if ($("." + n.DIRTY_FORM_BUTTON + "." + n.BULK_FORM_BUTTON + ":enabled").length <= 0) {
                    this.anyFormDirty = !1;
                    Bizweb.Forms.makeClean();
                }

                if (this.submissionSuccesses) {
                    t = "Đã chỉnh sửa " + this.submissionSuccesses + " " + this.resourceTitle + ".";
                }

                if (this.submissionFailures) {
                    Bizweb.Flash.error("Chỉnh sửa " + this.submissionFailures + " " + this.resourceTitle + " thất bại. " + t)
                }
                else {
                    Bizweb.Flash.notice(t);
                }

                this.submitting = !1
                $('.ui-button--primary.ui-context-bar__actions-primary').removeClass('has-loading').removeClass('is-loading');
                setTimeout(function () {
                    Bizweb.Forms.makeClean();
                }, 50);
            }
            e.prototype._handleSubmissionError = function (t) {
                return this._toggleSpindicate(t), this._setDirty(t)
            }
            e.prototype._toggleSpindicate = function (t) {
                var e = t.find("." + n.DIRTY_INDICATOR_CELL);
                t.find("." + n.SPINDICATOR).toggleClass("next-spinner--is-hidden")
            }
            e.prototype._setDirty = function (t) {
                if (this._datetimePicker) {
                    return;
                }

                var e = t.find("." + n.DIRTY_INDICATOR_CELL);
                t.find("." + n.DIRTY_INDICATOR_CELL).addClass(n.DIRTY);
                this.anyFormDirty = !0;
                Bindings.refresh()
            }
            e.prototype._setClean = function (t) {
                return t.find("." + n.DIRTY_INDICATOR_CELL).removeClass(n.DIRTY)
            }
            e.prototype._redrawTable = function () {
                var t;
                return t = this.search, t.edit = this.editColumnsParam(), t.show = this.showColumnsParam(), t.ids = this.ids, t.resourceName = this.resourceName, Page.refresh({
                    queryParams: t,
                    onlyKeys: [o, r],
                    updatePushState: !1
                }, this._postRedrawCallback(t))
            }
            e.prototype._postRedrawCallback = function (t) {
                return this._replaceHistory(t), this._persistColumnState
            }
            e.prototype._persistColumnState = function () {
                return this._persistToSessionStorage("edit", this.editColumnsParam()), this._persistToSessionStorage("show", this.showColumnsParam()), this._persistToSessionStorage("metafield-titles", this.metafieldTitles ? JSON.stringify(this.metafieldTitles) : null), this._persistToSessionStorage("metafield-options", this.metafieldOptions ? JSON.stringify(this.metafieldOptions) : null)
            }
            e.prototype._persistToSessionStorage = function (t, e) {
                return e ? sessionStorage.setItem("bulk-editor-" + t + "-" + this.resourceName, e) : sessionStorage.removeItem("bulk-editor-" + t + "-" + this.resourceName)
            }
            e.prototype._replaceHistory = function (t) {
                var e, n;
                return e = $.param(t), e && (e = "?" + e), n = location.pathname + e, Page.replaceState(n)
            }
            e.prototype.showColumnsParam = function () {
                return this._columnsAsString(this.showColumns)
            }
            e.prototype.editColumnsParam = function () {
                return this._columnsAsString(this.editColumns)
            }
            e.prototype._columnsAsString = function (t) {
                return _.map(t, function (t) {
                    var e;
                    return e = "" + t.full_name, null != t.type && (e += ":" + t.type), e
                }).join(",")
            }
            e.prototype._columnIndex = function (t) {
                return _.findIndex(this.editColumns, function (e) {
                    return e.full_name === t
                })
            }
            e.prototype.initializePublishingDatetimePicker = function (t) {
                this._datetimePicker = !0;

                $('[data-rel=publish_datepicker]').datepicker({
                    format: 'yyyy-mm-dd',
                    autoclose: true,
                    todayHighlight: true
                });

                $('[data-rel=publish_timepicker]').timepicker2({
                    lang: {
                        am: 'sa', pm: 'ch', AM: 'SA', PM: 'CH', decimal: '.', mins: 'phút', hr: 'giờ', hrs: 'giờ'
                    }
                });

                this._datetimePicker = !1;
            }

            return e;
        }()
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };
        Bizweb.SpreadsheetNavigator = function () {
            function e(e) {
                this.node = e, this.focusCursor = t(this.focusCursor, this), this.applyMultiEdit = t(this.applyMultiEdit, this), this.customApplyMultiEdit = t(this.customApplyMultiEdit, this), this.multiselectDrag = t(this.multiselectDrag, this), this.stopDragging = t(this.stopDragging, this), this.startDragClick = t(this.startDragClick, this), this.clickHandler = t(this.clickHandler, this), this.preventClickIfShiftClicking = t(this.preventClickIfShiftClicking, this), this.keypressHandler = t(this.keypressHandler, this), this.outsideClickHandler = t(this.outsideClickHandler, this), $(this.node).on("keydown", this.keypressHandler), $(this.node).on("mousedown", this.clickHandler), $(this.node).on("click", this.preventClickIfShiftClicking), $(this.node).on("turbograft:remote:done", this.clearSelection), $(document).on("mouseup.spreadsheet", this.stopDragging), $(document).on("mousedown.spreadsheet", this.outsideClickHandler), this.multiEditing = !1, this.dragging = !1, this.autoFocusFirstCell(), Page.onReplace(this.node, function () {
                    return $(document).off("mousedown.spreadsheet", this.outsideClickHandler), $(document).off("mouseup.spreadsheet", this.stopDragging)
                })
            }

            var i = 9;
            var n = {
                CELL: "spreadsheet__cell",
                CELL_SELECTABLE: "spreadsheet__cell--selectable",
                HOVER_CELL: "spreadsheet__cell--visually-focused",
                CURSOR_CELL: "spreadsheet__cell--focused",
                ROW: "spreadsheet__row",
                ROW_GROUP: "spreadsheet__row-group"
            }

            e.prototype.autoFocusFirstCell = function () {
                var t;
                return t = this._cellInputElements($(".spreadsheet__cell--selectable:first")).first(), t.length ? (this._updateCursorCell(t.closest("." + n.CELL)), t.focus()) : void 0
            };
            e.prototype.outsideClickHandler = function (t) {
                return $(this.node).is(t.target) || 0 !== $(this.node).has(t.target).length ? !0 : (this.clearSelection(), !0)
            };
            e.prototype.keypressHandler = function (t) {
                var e, n;
                return n = t.which, this._ignoreKeypressHandler(t, n) ? !0 : (e = this._keyPressTargetCell(t), this._handleNavInput(e, n, t) ? !1 : this._handleMultiSelectInput(e, n, t) ? !1 : this._handleInput(e, n) ? !0 : !1)
            };
            e.prototype._ignoreKeypressHandler = function (t, e) {
                return $(t.target).is("textarea:focus") ? e === Bizweb.Keycodes.UP || e === Bizweb.Keycodes.DOWN || e === Bizweb.Keycodes.ENTER : void 0
            };
            e.prototype._handleNavInput = function (t, e, n) {
                if (n.metaKey || n.altKey) return !1;
                if (n.shiftKey && e !== Bizweb.Keycodes.TAB) return !1;
                switch (e) {
                    case Bizweb.Keycodes.UP:
                        this._hoverPreviousSimilarCell(t);
                        break;
                    case Bizweb.Keycodes.DOWN:
                        this._hoverNextSimilarCell(t);
                        break;
                    case Bizweb.Keycodes.LEFT:
                        if (!this.cursorActive()) return !1;
                        this._hoverPrevCell(t);
                        break;
                    case Bizweb.Keycodes.RIGHT:
                        if (!this.cursorActive()) return !1;
                        this._hoverNextCell(t);
                        break;
                    case Bizweb.Keycodes.TAB:
                        n.shiftKey ? this._hoverPrevCell(t) : this._hoverNextCell(t);
                        break;
                    case Bizweb.Keycodes.ESCAPE:
                        this._updateCursorCell(t);
                        break;
                    default:
                        return !1
                }
                return !0
            };
            e.prototype._handleMultiSelectInput = function (t, e, n) {
                if (!(n.metaKey || n.altKey || n.shiftKey)) return !1;
                switch (e) {
                    case Bizweb.Keycodes.UP:
                        return this._setHovered(this.$cursorCell), this._pushPrevSimilarCell(t), !0;
                    case Bizweb.Keycodes.DOWN:
                        return this._setHovered(this.$cursorCell), this._pushNextSimilarCell(t), !0
                }
            };
            e.prototype._handleInput = function (t, e) {
                return this.cursorActive() && (this.multiSelection() && (this._updateCursorCell(t, !1), this.bindMultiEdit()), e !== Bizweb.Keycodes.SHIFT && e !== Bizweb.Keycodes.COMMAND && (this._selectCellInputElement(t), e === Bizweb.Keycodes.ENTER)) ? !1 : !0
            };
            e.prototype.preventClickIfShiftClicking = function (t) {
                return this.preventClickEventOnCell ? (this.preventClickEventOnCell = !1, !1) : !0
            };
            e.prototype.clickHandler = function (t) {
                var e;
                return e = this._evtTargetCell(t), this._selectable(e) ? this.$cursorCell ? this.multiSelectionClick(t, e) ? !1 : this.startMultiEditClick(t, e) ? !0 : this.startDragClick(t, e) ? !1 : this.matchesCursor(e) ? (this._unsetHovered(this.$cursorCell), !0) : this._setNewCursorClick(t, e) : this._setNewCursorClick(t, e) : (this.clearSelection(), !0)
            };
            e.prototype.startDragClick = function (t, e) {
                var n, r;
                return n = t.offsetX || t.pageX - $(t.target).offset().left, r = t.offsetY || t.pageY - $(t.target).offset().top, this.matchesCursor(e) && i > n && e.height() - r < i ? (this.focusCursor(), this.dragging = !0, $(this.node).on("mousemove.spreadsheet", _.debounce(this.multiselectDrag, 10)), !0) : void 0
            };
            e.prototype.stopDragging = function () {
                return this.dragging && this.$cursorCell && this.focusCursor(), $(this.node).off("mousemove.spreadsheet"), this.dragging = !1, !0
            };
            e.prototype.multiselectDrag = function (t) {
                var e, n;
                return n = this._rowFor(this._evtTargetCell(t)), e = n.find(this._cellClassSelector(this.$cursorCell[0])), this.matchesCursor(e) && this.clearSelection(!1), e.length ? (this.clearSelection(!1), this.selectedCells = [this.$cursorCell[0]], this.clickedCellAboveCurrentCell(e, this.$cursorCell) ? this.highlightUpTowards(e) : this.highlightDownTowards(e)) : void 0
            };
            e.prototype._setNewCursorClick = function (t, e) {
                return this._updateCursorCell(e), t.preventDefault(), !1
            };
            e.prototype.startMultiEditClick = function (t, e) {
                return this.multiSelection() && this.selected(e[0]) && !this.multiEditing ? (this._setHovered(this.$cursorCell), this._updateCursorCell(e, !1), this.bindMultiEdit(), this._unsetHovered(this.$cursorCell), !0) : void 0
            };
            e.prototype.multiSelectionClick = function (t, e) {
                var n;
                return t.metaKey || t.altKey || t.shiftKey ? (this.matchesCursorColumn(e) ? t.shiftKey ? (n = this.$cursorCell, this.clearSelection(!1), this.selectedCells = [n[0]], this.clickedCellAboveCurrentCell(e, n) ? this.highlightUpTowards(e) : this.highlightDownTowards(e), this._updateCursorCell(n, !1), this.preventClickEventOnCell = !0) : (this._setHovered(this.$cursorCell), this._pushCell(e), this._setHovered(this.$cursorCell)) : this._updateCursorCell(e), !0) : !1
            };
            e.prototype.clickedCellAboveCurrentCell = function (t, e) {
                var i, r;
                return i = t.closest("." + n.ROW_GROUP).index(), r = e.closest("." + n.ROW_GROUP).index(), i === r ? t.closest("." + n.ROW).index() < e.closest("." + n.ROW).index() : r > i
            };
            e.prototype.highlightUpTowards = function (t) {
                var e, n;
                for (e = this._prevSimilarCell(this.$cursorCell), n = []; !this.selected(t[0]) ;) this.selectedCells.push(e[0]), this._setHovered(e), n.push(e = this._prevSimilarCell(e));
                return n
            };
            e.prototype.highlightDownTowards = function (t) {
                var e, n;
                for (e = this._nextSimilarCell(this.$cursorCell), n = []; !this.selected(t[0]) ;) this.selectedCells.push(e[0]), this._setHovered(e), n.push(e = this._nextSimilarCell(e));
                return n
            };
            e.prototype.matchesCursorColumn = function (t) {
                var e;
                return (null != (e = this.$cursorCell) ? e.length : void 0) ? t.filter(this._cellClassSelector(this.$cursorCell[0])).length > 0 : !1
            };
            e.prototype.matchesCursor = function (t) {
                return this.$cursorCell && this.$cursorCell.length ? t[0] === this.$cursorCell[0] : !1
            };
            e.prototype.customApplyMultiEdit = function () {
                var t, e, n, i, r, o, a, s;
                for (a = this.selectedCells, s = [], r = 0, o = a.length; o > r; r++) e = a[r], this.matchesCursor($(e)) || (t = $("[data-input-change]", e).first(), n = Bindings.context(t[0])[t.attr("context")], i = t.data("input-change"), s.push(n[i].apply(n, arguments)));
                return s
            };
            e.prototype.applyMultiEdit = function (t) {
                var e, n, i, r, o, a, s, u, l;
                if (this.selectedCells && (o = this._cellInputElements(this.$cursorCell).index(t.target), o >= 0)) {
                    for (n = $(t.target), l = "checkbox" === n[0].type ? n[0].checked : n[0].value, s = this.selectedCells, u = [], r = 0, a = s.length; a > r; r++) i = s[r], this.matchesCursor($(i)) || (e = this._cellInputElements($(i)), "checkbox" === n[0].type ? e[o].checked = l : $(e[o]).val(l), u.push(e.change()));
                    return u
                }
            };
            e.prototype.multiSelection = function () {
                var t;
                return (null != (t = this.selectedCells) ? t.length : void 0) > 1
            };
            e.prototype.selected = function (t) {
                return $.inArray(t, this.selectedCells) >= 0
            };
            e.prototype.clearSelection = function (t) {
                return null == t && (t = !0), this.selectedCells && this._unsetHovered($(this.selectedCells)), this.unbindMultiEdit(), this.selectedCells = null, t && this.stopDragging(), t ? this.clearCursor() : void 0
            };
            e.prototype.unbindMultiEdit = function () {
                return this.$cursorCell ? (this._cellInputElements(this.$cursorCell).off(".multiedit"), this.$cursorCell.off("spreadsheet-cell:change"), this.multiEditing = !1) : void 0
            };
            e.prototype.bindMultiEdit = function () {
                var t;
                return this.$cursorCell ? (this.multiEditing = !0, this.$cursorCell.data("custom-input") ? this.$cursorCell.on("spreadsheet-cell:change", this.customApplyMultiEdit) : (t = this._cellInputElements(this.$cursorCell), t.on("input.multiedit change.multiedit", this.applyMultiEdit))) : void 0
            };
            e.prototype.clearCursor = function (t) {
                var e;
                return null == t && (t = !0), null != (e = this.$cursorCell) && e.removeClass(n.CURSOR_CELL), t && this._unsetHovered(this.$cursorCell), this.$cursorCell = null
            };
            e.prototype.cursorActive = function () {
                var t;
                return null != (t = this.$cursorCell) ? t.hasClass(n.HOVER_CELL) : void 0
            };
            e.prototype.focusCursor = function () {
                return this._setHovered(this.$cursorCell), this.$cursorCell.focus()
            };
            e.prototype._unsetHovered = function (t) {
                return null != t ? t.removeClass(n.HOVER_CELL) : void 0
            };
            e.prototype._setHovered = function (t) {
                return null != t ? t.addClass(n.HOVER_CELL) : void 0
            };
            e.prototype._toggleSelectedCell = function (t, e) {
                var n;
                if (null == e && (e = !0), !this.selectedCells) return this.selectedCells = [t];
                if ((n = $.inArray(t, this.selectedCells)) < 0) return this.selectedCells.push(t), this._setHovered($(t));
                if (e) {
                    if (this.selectedCells.splice(n, 1), !this.matchesCursor($(t))) return this._unsetHovered($(t));
                    if (this.clearCursor($(t)), this.selectedCells.length) return this.$cursorCell = $(this.selectedCells).first()
                }
            };
            e.prototype._updateCursorCell = function (t, e) {
                var i;
                return null == e && (e = !0), e && this.clearSelection(), this.unbindMultiEdit(), null != (i = this.$cursorCell) && i.removeClass(n.CURSOR_CELL), this.$cursorCell = t, this.$cursorCell.addClass(n.CURSOR_CELL), this._toggleSelectedCell(t[0], e), this.focusCursor()
            };
            e.prototype._evtTargetCell = function (t) {
                return $(t.target).closest("." + n.CELL)
            };
            e.prototype._cellInputElements = function (t) {
                return t.find(":input").not("[type='hidden']")
            };
            e.prototype._keyPressTargetCell = function (t) {
                return this.$cursorCell || this._evtTargetCell(t)
            };
            e.prototype._pushPrevSimilarCell = function (t) {
                var e;
                return e = this._prevSimilarCell(t), (null != e ? e.length : void 0) && this.selectedCells.length > 1 && this.selected(e[0]) && this._toggleSelectedCell(t[0]), (null != e ? e.length : void 0) ? this._updateCursorCell(e, !1) : void 0
            };
            e.prototype._pushNextSimilarCell = function (t) {
                var e;
                return e = this._nextSimilarCell(t), (null != e ? e.length : void 0) && this.selectedCells.length > 1 && this.selected(e[0]) && this._toggleSelectedCell(t[0]), (null != e ? e.length : void 0) ? this._updateCursorCell(e, !1) : void 0
            };
            e.prototype._pushCell = function (t) {
                return this.selected(t[0]) ? this._toggleSelectedCell(t[0], !0) : this._updateCursorCell(t, !1)
            };
            e.prototype._hoverNextSimilarCell = function (t) {
                var e;
                return e = this._nextSimilarCell(t), (null != e ? e.length : void 0) ? this._updateCursorCell(e) : void 0
            };
            e.prototype._hoverPreviousSimilarCell = function (t) {
                var e;
                return e = this._prevSimilarCell(t), (null != e ? e.length : void 0) ? this._updateCursorCell(e) : void 0
            };
            e.prototype._hoverPrevCell = function (t) {
                var e;
                return e = this._prevCell(t), (null != e ? e.length : void 0) ? this._updateCursorCell(e) : void 0
            };
            e.prototype._hoverNextCell = function (t) {
                var e;
                return e = this._nextCell(t), (null != e ? e.length : void 0) ? this._updateCursorCell(e) : void 0
            };
            e.prototype._selectCellInputElement = function (t) {
                var i = t.find("[spreadsheet-popover-trigger]");
                if (i.length > 0) {
                    var n = i.siblings(".next-popover");
                    if (n.length > 0 && Bizweb.UIPopover["for"](n[0]).isActive()) {
                        i.click();
                    }
                }

                var e = t.find(":input").not("[type='hidden']").first();
                this._unsetHovered(this.$cursorCell);
                (null != e ? e.length : void 0) ? "SELECT" === e[0].tagName || "checkbox" === e[0].type ? e[0].focus() : e[0].select() : void 0
            };
            e.prototype._prevCell = function (t) {
                var e;
                return e = t.prev("." + n.CELL_SELECTABLE), e.length ? e : this._lastSelectableCellOf(this._prevSelectableRowFor(t))
            };
            e.prototype._nextCell = function (t) {
                var e;
                return e = t.next("." + n.CELL_SELECTABLE), e.length ? e : this._firstSelectableCellOf(this._nextSelectableRowFor(t))
            };
            e.prototype._prevSimilarCell = function (t, e) {
                var n, i;
                return e || (e = this._cellClassSelector(t[0])), n = this._prevRowFor(t), n.length ? (i = n.find(e), i.length ? i : this._prevSimilarCell(this._firstCellOf(n), e)) : void 0
            };
            e.prototype._nextSimilarCell = function (t, e) {
                var n, i;
                return e || (e = this._cellClassSelector(t[0])), n = this._nextRowFor(t), n.length ? (i = n.find(e), i.length ? i : this._nextSimilarCell(this._firstCellOf(n), e)) : void 0
            };
            e.prototype._lastCellOf = function (t) {
                return null != t ? t.find("." + n.CELL).last() : void 0
            };
            e.prototype._firstCellOf = function (t) {
                return null != t ? t.find("." + n.CELL).first() : void 0
            };
            e.prototype._lastSelectableCellOf = function (t) {
                return null != t ? t.find("." + n.CELL_SELECTABLE).last() : void 0
            };
            e.prototype._firstSelectableCellOf = function (t) {
                return null != t ? t.find("." + n.CELL_SELECTABLE).first() : void 0
            };
            e.prototype._prevRowFor = function (t) {
                var e;
                return e = this._prevGroupedRowFor(t), e.length ? e : this._lastRowOfGroup(this._prevRowGroupFor(t))
            };
            e.prototype._nextSelectableRowFor = function (t) {
                var e;
                return e = this._nextRowFor(t), e.length ? e.find("." + n.CELL_SELECTABLE).length ? e : this._nextSelectableRowFor(this._firstCellOf(e)) : null
            };
            e.prototype._prevSelectableRowFor = function (t) {
                var e;
                return e = this._prevRowFor(t), e.length ? e.find("." + n.CELL_SELECTABLE).length ? e : this._prevSelectableRowFor(this._lastCellOf(e)) : null
            };
            e.prototype._nextRowFor = function (t) {
                var e;
                return e = this._nextGroupedRowFor(t), e.length ? e : this._firstRowOfGroup(this._nextRowGroupFor(t))
            };
            e.prototype._nextRowGroupFor = function (t) {
                return $(this._rowGroupFor(t)).next()
            };
            e.prototype._prevRowGroupFor = function (t) {
                return $(this._rowGroupFor(t)).prev()
            };
            e.prototype._prevGroupedRowFor = function (t) {
                return $(this._rowFor(t)).prev("." + n.ROW)
            };
            e.prototype._nextGroupedRowFor = function (t) {
                return $(this._rowFor(t)).next("." + n.ROW)
            };
            e.prototype._lastRowOfGroup = function (t) {
                return $(t).find("." + n.ROW).last()
            };
            e.prototype._firstRowOfGroup = function (t) {
                return $(t).find("." + n.ROW).first()
            };
            e.prototype._rowFor = function (t) {
                return t.closest("." + n.ROW)
            };
            e.prototype._rowGroupFor = function (t) {
                return t.closest("." + n.ROW_GROUP)
            };
            e.prototype._selectable = function (t) {
                return null != t ? t.hasClass(n.CELL_SELECTABLE) : void 0
            };
            e.prototype._cellClassSelector = function (t) {
                var e;
                return e = t.className.split(" "), "." + _.difference(e, [n.HOVER_CELL, n.CURSOR_CELL]).join(".")
            }

            return e;
        }()
    }.call(this),
    function () {
        var t, e, n, i, r, o, a, s;
        t = "next-textarea--expanding", e = "only-when-printing", n = ["borderBottomWidth", "borderTopWidth", "borderLeftWidth", "borderRightWidth", "paddingTop", "paddingBottom", "textTransform", "whiteSpace", "wordBreak", "wordSpacing", "wordWrap", "letterSpacing", "lineHeight", "fontFamily", "fontSize", "fontSizeAdjust", "fontStyle", "fontVariant", "fontWeight", "boxSizing"], i = ["borderBottomWidth", "borderTopWidth", "paddingBottom", "paddingTop"], r = null, $(document).on("ready", function () {
            return $(document).on("focus." + t, "." + t, o).on("input." + t, "." + t, a), $(window).on("resize." + t, _.debounce(s, 50, {
                leading: !0
            }))
        }), $(document).on("ready page:load", function () {
            var e;
            return r = function () {
                var n, i, r, o;
                for (r = document.querySelectorAll("." + t), o = [], n = 0, i = r.length; i > n; n++) e = r[n], o.push(Bizweb.NextExpandingTextarea.forNode(e));
                return o
            }()
        }), o = function (t) {
            var e;
            return null != (e = $(t.target).data("next-expanding-textarea")) ? e.onFocus() : void 0
        }, a = function (t) {
            var e, n;
            return null != (e = $(t.target).data("next-expanding-textarea")) && e.resize(), null != (n = $(t.target).data("next-expanding-textarea")) ? n.updatePrintArea() : void 0
        }, s = function () {
            var t, e, n, i;
            for (n = [], t = 0, e = r.length; e > t; t++) i = r[t], n.push(i.resizeIfVisible());
            return n
        }, Bizweb.NextExpandingTextarea = function () {
            function t(t) {
                this.textArea = t, this.$textArea = $(this.textArea), this.$printArea = $('<div class="' + e + '"></div>'), this.$printArea.insertAfter(this.$textArea), this.updatePrintArea(), this.heightTester = this._newHeightTester(), this.$textArea.after(this.heightTester), this.$textArea.is(":visible") && (this._extraVerticalSpace = this._calculateVerticalSpace(), this.resize()), this.$textArea.data("next-expanding-textarea", this)
            }
            return t.forNode = function (t) {
                return $(t).data("next-expanding-textarea") || new Bizweb.NextExpandingTextarea(t)
            }, t.prototype.resize = function () {
                var t;
                return null == this._extraVerticalSpace && (this._extraVerticalSpace = this._calculateVerticalSpace()), this.heightTester.value = this.textArea.value || this.textArea.getAttribute("placeholder"), t = this.heightTester.scrollHeight + this._extraVerticalSpace, this.textArea.style.height = t + "px"
            }, t.prototype.resizeIfVisible = function () {
                return this.$textArea.is(":visible") ? this.resize() : void 0
            }, t.prototype.onFocus = function () {
                return null != this._extraVerticalSpace ? this._extraVerticalSpace : this._extraVerticalSpace = this.calculateVerticalSpace()
            }, t.prototype.updatePrintArea = function () {
                return this.$printArea.html(this.filterHTML(this.$textArea.val()))
            }, t.prototype.filterHTML = function (t) {
                return $("<div/>").text(t).html().replace(/\n/g, "<br>")
            }, t.prototype._calculateVerticalSpace = function () {
                var t;
                return t = window.getComputedStyle(this.textArea, null), i.reduce(function (e, n) {
                    return e += parseInt(t[n])
                }, 0)
            }, t.prototype._newHeightTester = function () {
                var t, e, i, r, o, a, s, u, l;
                if (t = document.createElement("textarea"), t.tabIndex = "-1", t.value = this.textArea.value, l = window.getComputedStyle(this.textArea, null), u = {
                    minHeight: 0,
                    height: 0,
                    position: "absolute",
                    minWidth: "100%",
                    visibility: "hidden",
                    zIndex: -1,
                    top: 0,
                    paddingLeft: "10px",
                    paddingRight: "10px",
                    pointerEvents: "none"
                }, null != (a = l.cssText) ? a.length : void 0) t.style.cssText = l.cssText;
                else
                    for (e = 0, i = n.length; i > e; e++) o = n[e], u[o] || (u[o] = l[o]);
                for (s in u) r = u[s], t.style[s] = r;
                return t.classList.add("js-no-dirty"), t
            }, t
        }()
    }.call(this),
    function () {
        Bizweb.SpreadsheetColumn = function () {
            function t(t, e, n) {
                this.node = t, this.bulkEditor = e, this.form = n, this.$cellNode = $(this.node).parents(".spreadsheet__cell")
            }
            return t.prototype.triggerCellChange = function (t, e) {
                var n;
                return null == e && (e = {}), n = {
                    action: t
                }, n = _.merge(n, e), this.form.$form.change(), this.$cellNode.trigger("spreadsheet-cell:change", n)
            }, t
        }()
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        },
            e = function (t, e) {
                function i() {
                    this.constructor = t
                }
                for (var r in e) n.call(e, r) && (t[r] = e[r]);
                return i.prototype = e.prototype, t.prototype = new i, t.__super__ = e.prototype, t
            },
            n = {}.hasOwnProperty;
        Bizweb.InventoryColumn = function (n) {
            function i(e, n, r, o, a) {
                this.quantityUpdated = t(this.quantityUpdated, this), this.adjustmentDecremented = t(this.adjustmentDecremented, this), this.adjustmentIncremented = t(this.adjustmentIncremented, this), this.adjustmentUpdated = t(this.adjustmentUpdated, this), i.__super__.constructor.call(this, e, n, r), this.inventoryOptions = new Bizweb.InventoryOptions(o, a, {
                    onAdjustmentUpdated: this.adjustmentUpdated,
                    onAdjustmentIncremented: this.adjustmentIncremented,
                    onAdjustmentDecremented: this.adjustmentDecremented,
                    onQuantityUpdated: this.quantityUpdated
                })
            }
            return e(i, n), i.prototype.updateInventory = function (t, e) {
                switch (e.action) {
                    case "adjustment":
                        return this.inventoryOptions.adjustment = e.adjustment, this.inventoryOptions.adjustmentUpdated();
                    case "increment":
                        return this.inventoryOptions.adjustment = this.inventoryOptions.adjustment + 1, this.inventoryOptions.adjustmentUpdated();
                    case "decrement":
                        return this.inventoryOptions.adjustment = this.inventoryOptions.adjustment - 1, this.inventoryOptions.adjustmentUpdated();
                    default:
                        return this.inventoryOptions.quantity = e.quantity, this.inventoryOptions.quantityUpdated()
                }
            }, i.prototype.adjustmentUpdated = function () {
                return this.triggerCellChange("adjustment", {
                    adjustment: this.inventoryOptions.adjustment
                })
            }, i.prototype.adjustmentIncremented = function () {
                return this.triggerCellChange("increment")
            }, i.prototype.adjustmentDecremented = function () {
                return this.triggerCellChange("decrement")
            }, i.prototype.quantityUpdated = function () {
                return this.triggerCellChange("update", {
                    quantity: this.inventoryOptions.quantity
                })
            }, i
        }(Bizweb.SpreadsheetColumn)
    }.call(this),
    function () {
        var n = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };
        var i = function (t, e) {
            function n() {
                this.constructor = t
            }
            for (var i in e) r.call(e, i) && (t[i] = e[i]);
            return n.prototype = e.prototype, t.prototype = new n, t.__super__ = e.prototype, t
        };
        var r = {}.hasOwnProperty;
        var e = '<li class="next-token next-token--clickable js-tag" data-tag="{{ tag }}"><span class="next-token__label js-tag-text">{{ tag }}</span></li>';
        var t = "<li>&nbsp;</li>";

        Bizweb.TagColumn = function (r) {
            function TagColumn(t, i, r) {
                this.tagRemoved = n(this.tagRemoved, this);
                this.tagAdded = n(this.tagAdded, this);

                TagColumn.__super__.constructor.call(this, t, i, r);

                this.$_tagShortlist = $("[data-tag-shortlist]", this.node).first();
                this._tagTemplate = e;
            }

            i(TagColumn, r);

            TagColumn.prototype.toggleTag = function (t, e) {
                var n;
                return n = e.tag, "addTag" === e.action ? this.taggable.addTag(n) : this.taggable.removeTag(n)
            };
            TagColumn.prototype.tagAdded = function (t) {
                this.redrawTagList();
                this.triggerCellChange("addTag", {
                    tag: t
                })
            };
            TagColumn.prototype.tagRemoved = function (t) {
                this.redrawTagList();
                this.triggerCellChange("removeTag", {
                    tag: t
                })
            };
            TagColumn.prototype.redrawTagList = function () {
                var e = "";
                var r = this.taggable.getTags();
                var n, i;
                for (n = 0, i = r.length; i > n; n++) {
                    var tag = r[n];

                    e += this._tagTemplate.replace(/{{ tag }}/g, tag);
                }

                this.$_tagShortlist.html(e);
                this.$_tagShortlist.append(t);
            }

            return TagColumn;
        }(Bizweb.SpreadsheetColumn)
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };
        Bizweb.TagitExtension = function () {
            function e(e, n) {
                this.options = null != n ? n : {}, this.hideErrorMessage = t(this.hideErrorMessage, this), this.onTagExists = t(this.onTagExists, this), this.onTagExceedsMaxLength = t(this.onTagExceedsMaxLength, this), this.$node = $(e), this.$tagIt = this.$node.find("[tagit]"), this.$errorTagTooltip = $(".tooltip-error", this.$node), this.placeholderText = this.options.placeholderText
            }
            return e.prototype.initTagit = function (t) {
                return null == t && (t = {}), this.$tagIt.tagit(_.defaults(t, this.options, {
                    caseSensitive: !1,
                    allowDuplicates: !1,
                    allowSpaces: !0,
                    animate: !1,
                    placeholderText: this.placeholderText,
                    onTagExceedsMaxLength: this.onTagExceedsMaxLength,
                    onTagExists: this.onTagExists
                }))
            }, e.prototype.getTags = function () {
                return this.$tagIt.tagit("assignedTags")
            }, e.prototype.onTagExceedsMaxLength = function (t, e) {
                return this.showErrorMessage(this.options.maxLengthError || "Giới hạn của tag là " + this.$tagIt.tagit("getTagMaxLength") + " ký tự.")
            }, e.prototype.onTagExists = function (t, e) {
                return this.showErrorMessage(this.options.tagExistsError || "Oops, Bạn đã chọn tag này rồi.")
            }, e.prototype.showErrorMessage = function (t) {
                var e = $("ul.next-token-list .tagit-new", this.$errorTagTooltip.parent());
                this.$errorTagTooltip.css("margin-left", e.position().left);
                this.$errorTagTooltip.css("top", e.position().top + e.height());
                this.errorMessage = t;
                Bindings.refreshImmediately();
                clearTimeout(this.errorTimeout);
                this.errorTimeout = setTimeout(this.hideErrorMessage, 5e3);
            }, e.prototype.hideErrorMessage = function () {
                clearTimeout(this.errorTimeout);
                null != this.errorMessage ? (this.errorMessage = null, Bindings.refreshImmediately()) : void 0
            }, e.prototype.showPlaceholderText = function () {
                return this.getTags().length ? this.$tagIt.find("input.ui-autocomplete-input").prop("placeholder", "") : this.$tagIt.find("input.ui-autocomplete-input").prop("placeholder", this.placeholderText)
            }, e
        }()
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        },
        e = function (t, e) {
            function i() {
                this.constructor = t
            }
            for (var r in e) n.call(e, r) && (t[r] = e[r]);
            return i.prototype = e.prototype, t.prototype = new i, t.__super__ = e.prototype, t
        }, n = {}.hasOwnProperty;
        Bizweb.Taggable = function (n) {
            function i(e, n) {
                this.addTagOnClick = t(this.addTagOnClick, this), this.removeTag = t(this.removeTag, this), this.addTag = t(this.addTag, this);
                var r;
                this.onTagsUpdated = n.onTagsUpdated, n.onTagsUpdated = null, this.onTagAdded = n.onTagAdded, n.onTagAdded = null, this.onTagRemoved = n.onTagRemoved, n.onTagRemoved = null, i.__super__.constructor.apply(this, arguments), this.placeholderText = null != (r = this.options.placeholderText) ? r : "Vintage, cotton, summer", this.$form = $(this.options.formSelector), this.errorMessage = null, this.setupTagIt(), this.$node.on("click", ".previous-tags .js-tag", this.addTagOnClick), this.previousTags = _.map($(".js-addtags .js-tag", this.$node), function (t) {
                    return Bizweb.Inflection.generateAlias(t.textContent.trim())
                }), this.checkIfEmpty()
            }
            return e(i, n), i.prototype.findFormObject = function () {
                var t, e, n, i;
                t = Bindings.context(this.$form[0]);
                for (e in t)
                    if (i = t[e], i instanceof Bizweb.Forms && (null != i && null != (n = i.$form) ? n[0] : void 0) === this.$form[0]) return i
            }, i.prototype.setupTagIt = function () {
                return this._initializing = !0, this.initTagit({
                    fieldName: this.options.fieldName,
                    tagMaxLength: this.options.tagMaxLength,
                    autocomplete: {
                        source: []
                    },
                    afterTagRemoved: this.afterTagRemoved.bind(this),
                    afterTagAdded: this.afterTagAdded.bind(this)
                }), this._initializing = !1
            }, i.prototype.setDirty = function () {
                var t;
                return this._initializing ? void 0 : (this.$form.trigger("change"), null != (t = this.findFormObject()) ? t.makeDirty() : void 0)
            }, i.prototype.checkIfEmpty = function () {
                return this.$tagIt ? (this.showPlaceholderText(), this.getTags().length || this.$hiddenEmptyNode ? this.$hiddenEmptyNode ? (this.$hiddenEmptyNode.remove(), delete this.$hiddenEmptyNode) : void 0 : (this.$hiddenEmptyNode = $("<input type='hidden' name='" + this.options.fieldName + "' value='' />"), this.$form.append(this.$hiddenEmptyNode))) : void 0
            }, i.prototype.addTag = function (t) {
                return this.$tagIt.tagit("createTag", t)
            }, i.prototype.removeTag = function (t) {
                return this.$tagIt.tagit("removeTagByLabel", t)
            }, i.prototype.addTagOnClick = function (t) {
                var e;
                return e = $(t.currentTarget), e.hasClass("next-token--is-disabled") ? void 0 : (this.$tagIt.tagit("createTag", e.text().trim()), e.addClass("next-token--is-disabled"))
            }, i.prototype.renderTag = function (t) {
                var e;
                return e = $("li.js-tag", this.$node).first().clone(), e.attr("data-tag", Bizweb.Inflection.generateAlias(t)).find("span").text(t), e.removeClass("next-token--is-disabled"), e
            }, i.prototype.addPreviousTag = function (t) {
                var e;
                if (t && -1 === this.previousTags.indexOf(Bizweb.Inflection.generateAlias(t))) return e = this.renderTag(t), this.getTags().indexOf(t) >= 0 && e.addClass("next-token--is-disabled"), $(".js-addtags", this.$node).append(e)
            }, i.prototype.showAllPreviousTags = function (t) {
                var e;
                return e = $.ajax({
                    url: this.options.allTagsUrl,
                    type: "GET",
                    dataType: "json"
                }), e.done(function (e) {
                    return function (n) {
                        var i, r, o, a;
                        for (o = n.tags, i = 0, r = o.length; r > i; i++) a = o[i], e.addPreviousTag(a);
                        return $(t.currentTarget).remove()
                    }
                }(this)), e.fail(Bizweb.handleError)
            }, i.prototype.afterTagRemoved = function (t, e) {
                var n;
                if (e.tagLabel) return n = $(".previous-tags li[data-tag=" + Bizweb.Inflection.generateAlias(e.tagLabel) + "]", this.$node), n.removeClass("next-token--is-disabled"), !n.length && e.tagLabel && this.addPreviousTag(e.tagLabel), this.hideErrorMessage(), this.checkIfEmpty(), this.setDirty(), this.fireTagRemovedCallback(e.tagLabel), this.fireTagsUpdatedCallback()
            }, i.prototype.afterTagAdded = function (t, e) {
                var n;
                if (!e.duringInitialization) return this.hideErrorMessage(), n = $(".previous-tags li[data-tag=" + Bizweb.Inflection.generateAlias(e.tagLabel) + "]", this.$node), n.addClass("next-token--is-disabled"), this.checkIfEmpty(), this.setDirty(), this.fireTagAddedCallback(e.tagLabel), this.fireTagsUpdatedCallback()
            }, i.prototype.fireTagsUpdatedCallback = function () {
                return "function" == typeof this.onTagsUpdated ? this.onTagsUpdated(this.getTags()) : void 0
            }, i.prototype.fireTagAddedCallback = function (t) {
                return "function" == typeof this.onTagAdded ? this.onTagAdded(t, this.getTags()) : void 0
            }, i.prototype.fireTagRemovedCallback = function (t) {
                return "function" == typeof this.onTagRemoved ? this.onTagRemoved(t, this.getTags()) : void 0
            }, i
        }(Bizweb.TagitExtension)
    }.call(this),
    function () {
        var t, e, n;
        moment.updateLocale("vi", {
            longDateFormat: {
                LT: "h:mma",
                L: "MM/DD/YYYY",
                l: "M/D/YYYY",
                LL: "MMMM Do YYYY",
                ll: "MMM D YYYY",
                LLL: "MMMM Do YYYY LT",
                lll: "MMM D YYYY LT",
                LLLL: "dddd, MMMM Do YYYY LT",
                llll: "ddd, MMM D YYYY LT"
            },
            calendar: {
                lastDay: "[Yesterday at] LT",
                sameDay: "[Today at] LT",
                nextDay: "[Tomorrow at] LT",
                lastWeek: "dddd [at] LT",
                nextWeek: "next dddd [at] LT",
                sameElse: "MMM D, LT"
            }
        }), e = function (t) {
            return moment.isMoment(t) ? t.format("YYYY-MM-DD HH:mm:ss") : t instanceof Date ? moment(t).format("YYYY-MM-DD HH:mm:ss") : t
        }, t = function () {
            function t(t) {
                this.moment = t
            }

            t.prototype.inShop = function () {
                return new t(this.moment.clone().tz(Bizweb.Time.shopTz))
            };
            t.prototype.inLocal = function () {
                return new t(this.moment.clone().tz(Bizweb.Time.localTz))
            };
            t.prototype.formatInShop = function (t, e) {
                var n, i;

                null == t && (t = "YYYY-MM-DD");
                null == e && (e = !1);

                i = this.inShop().moment;
                n = i.format(t);

                Bizweb.Time.isDifferentTimezone() && (t.match(/h|H/) || t.match(/LT/) || t.match(/l{3,}/i)) && !e && (n += " " + i.format("z"))

                return n
            };
            t.prototype.formatInLocal = function (t) {
                return null == t && (t = "YYYY-MM-DD"), this.inLocal().moment.format(t)
            }

            return t;
        }();
        Bizweb.Time = {
            shopTz: null != (n = Bizweb.store) ? n.settings.tzinfo : void 0,
            localTz: function () {
                return jstz.determine().name()
            }(),
            fromShop: function (n) {
                return new t(moment.tz(e(n), Bizweb.Time.shopTz))
            },
            fromLocal: function (n) {
                return new t(moment.tz(e(n), Bizweb.Time.localTz))
            },
            fromUTC: function (n) {
                return new t(moment.tz(e(n), "UTC"))
            },
            nowLocal: function () {
                return this.fromLocal(new Date)
            },
            nowShop: function () {
                return this.fromLocal(new Date).inShop()
            },
            isDifferentTimezone: function () {
                var t, e, n, i, r, o, a;
                for (a = moment.tz.zone(Bizweb.Time.shopTz), i = moment.tz.zone(Bizweb.Time.localTz), o = a.offsets, e = t = 0, n = o.length; n > t; e = ++t)
                    if (r = o[e], i.offsets[e] !== r) return !0;
                return !1
            },
            shopTimeToNext30MinuteIncrement: function () {
                var t, e;
                return e = this.nowShop(), t = e.moment, t.minute() < 30 ? t.minute(30) : t.minute(60), t.startOf("minute"), e
            },
            fullMonthDayFormat: "MMMM D",
            fullMonthDayYearFormat: "MMMM D, YYYY",
            shortMonthDayTimeFormat: "MMM D, LT",
            shortMonthDayYearTimeFormat: "MMM D, YYYY, LT",
            shortMonthDayYearFormat: "MMM D, YYYY"
        }
    }.call(this),
    function () {
        Bizweb.FuturePublishing = function () {
            function t(t, e) {
                if (e == null) {
                    e = {};
                }

                t = Bizweb.Time.fromShop(t);
                this.setPublishedAt(t);
                this.onPublishedAtChanged = e.onPublishedAtChanged;
                this.lastDate = this.publishDateString;
            }

            t.prototype.publishedChanged = function (t) {
                var e;
                return e = t.checked ? Bizweb.Time.nowShop() : null, this.setPublishedAt(e)
            }, t.prototype.dateChanged = function () {
                var t;
                if (this.date && this.time)
                    return t = moment(this.date + " " + this.time, "YYYY-MM-DD h:mma"), t.seconds(0), this.setPublishedAt(Bizweb.Time.fromShop(t))
            }, t.prototype.setPublishedAt = function (t) {
                this.isFuturePublished = false;

                if (t != null && t.moment.isValid()) {
                    this.published_at = t;
                    this.isFuturePublished = this.published_at.moment > Bizweb.Time.nowShop().moment;
                    this.published = !this.isFuturePublished;
                    this.publishDateString = t.formatInShop("YYYY-MM-DD HH:mm", true);
                    this.date = t.formatInShop("YYYY-MM-DD"), this.time = t.formatInShop("h:mma", !0)
                }
                else {
                    this.published_at = null
                    this.isFuturePublished = !1
                    this.published = !1
                    this.publishDateString = null
                    this.date = null
                    this.time = null
                }

                "function" == typeof this.onPublishedAtChanged ? this.onPublishedAtChanged(t) : void (0)
            }

            return t;
        }()
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        },
        e = function (t, e) {
            function i() {
                this.constructor = t
            }
            for (var r in e) n.call(e, r) && (t[r] = e[r]);
            return i.prototype = e.prototype, t.prototype = new i, t.__super__ = e.prototype, t
        }, n = {}.hasOwnProperty;
        Bizweb.PublishingColumn = function (n) {
            function i(e, n, r, o) {
                this.publishedAtChanged = t(this.publishedAtChanged, this), i.__super__.constructor.call(this, e, n, r), this.futurePublishing = new Bizweb.FuturePublishing(o, {
                    onPublishedAtChanged: this.publishedAtChanged
                })
            }
            return e(i, n), i.prototype.updatePublishedAt = function (t, e) {
                return this.futurePublishing.setPublishedAt(e.published_at)
            }, i.prototype.publishedAtChanged = function (t) {
                return this.triggerCellChange("update", {
                    published_at: t
                })
            }, i
        }(Bizweb.SpreadsheetColumn)
    }.call(this),
    function () {
        var t = function (t, e) {
            return function () {
                return t.apply(e, arguments)
            }
        };

        Bizweb.DashboardActivity = function () {
            function DashboardActivity() {
                this.nextPage = 2;
                this.isLoading = false;
                this.activityContainer = $(".activity-container");
                this.totalPages = parseInt($('#TotalPages').val());
            }

            DashboardActivity.prototype.loadMoreActivity = function () {
                var that = this;
                this.isLoading = true;

                $.ajax({
                    url: Bizweb.routes.activityFeed + "?page=" + that.nextPage,
                    complete: function () {
                        that.isLoading = false;
                    },
                    success: function (data) {
                        that.nextPage += 1;
                        that.activityContainer.append(data);
                        if (that.nextPage > that.totalPages) {
                            $('a.btn-load-more').hide();
                        }
                    }
                });
            };

            return DashboardActivity;
        }()
    }.call(this),
    function () {
        Bizweb.ShowImageModal = function () {
            function ShowImageModal(t, e, n, id) {
                this.aviary = e;
                this.fileName = n;
                this.id = id;
                this.modal = new Bizweb.Modal(t);
            }

            ShowImageModal.prototype.show = function (t) {
                if (t == null)
                    t = {};

                this.modal.show(t);
            }
            ShowImageModal.prototype.launchAviary = function (t, e) {
                var that = this;
                this.modal.hide()

                this.aviary.launchEditor(t, e, function (t) {
                    return function (e) {
                        $.ajax({
                            url: "/admin/settings/files/update",
                            data: {
                                id: that.id,
                                imageurl: e
                            },
                            method: "POST",
                            success: function () {
                                Bizweb.Flash.notice("Chỉnh sửa ảnh thành công.");
                                Bizweb.Utility.loadAjax(document.location.href, ".mediafiles");
                            },
                            error: function () {
                                Bizweb.Flash.error("Chỉnh sửa ảnh thất bại.");
                            }
                        });
                    }
                }(this))
            }

            return ShowImageModal;
        }()
    }.call(this),
    function () {
        // ---------------------------------------------------------------------------------
        // Bizweb Js API - Bizweb.LinkListContainer
        //
        // Working with Linklist Index page.
        // ---------------------------------------------------------------------------------

        var applyObjectToEvent = function (event, context) {
            return function () {
                return event.apply(context, arguments)
            }
        }

        Bizweb.LinkListContainer = function () {
            function LinkListContainer(element, linkListId, options) {
                this.linkListId = linkListId;
                this.$container = $(element);
                this.initializeSortable();
            };

            // BEGIN: LinkListContainer - Public Functions
            LinkListContainer.prototype.initializeSortable = function () {
                var that = this;

                //".link-list-group", this.$container
                this.linklist = $(".link-list-group", this.$container).sortable({
                    items: ".link-list-group-item",
                    placeholder: "ui-sortable__placeholder",
                    helper: "original",
                    opacity: .7,
                    update: this.submitNewSortOrder.bind(this),
                    start: function (event, element) {
                        element.placeholder.height(element.helper.height());
                    }
                })
            }
            LinkListContainer.prototype.submitNewSortOrder = function (t) {
                var that = this;
                this.setIndexForMultiObjectPost();

                $.ajax({
                    url: "/admin/links/order/" + this.linkListId,
                    dataType: "html",
                    type: "POST",
                    data: this.$container.find("form").serialize(),
                    complete: function () {
                        that.resetIndexForMultiObjectPost()
                    }
                });
            }
            LinkListContainer.prototype.setIndexForMultiObjectPost = function () {
                var linkContainers = this.$container.find(".link-list-group-item");

                for (var i = 0; i < linkContainers.length; i++) {
                    var inputs = $(linkContainers[i]).find(":input");
                    for (var j = 0; j < inputs.length; j++) {
                        var inputName = $(inputs[j]).attr("name");
                        if (typeof inputName !== "undefined" && inputName.indexOf("[]") >= 0) {
                            inputName = inputName.replace("[]", "[" + i + "]");
                            $(inputs[j]).attr("name", inputName);
                        }
                    }
                }
            };
            LinkListContainer.prototype.resetIndexForMultiObjectPost = function () {
                var linkContainers = this.$container.find(".link-list-group-item");

                for (var i = 0; i < linkContainers.length; i++) {
                    var inputs = $(linkContainers[i]).find(":input");
                    for (var j = 0; j < inputs.length; j++) {
                        var inputName = $(inputs[j]).attr("name");
                        if (typeof inputName !== "undefined") {
                            inputName = inputName.replace(/\[\d\]/g, "[]");
                            $(inputs[j]).attr("name", inputName);
                        }
                    }
                }
            };

            LinkListContainer.name = "LinkListContainer";
            return LinkListContainer;
        }();
    }.call(this),
    function () {
        Bizweb.DomainOperations = function () {
            function DomainOperations() {
            };

            DomainOperations.verifyDns = function () {
                return $.ajax({
                    url: Bizweb.routes.setting.domain + "/verify_configuration",
                    type: "GET",
                    global: false
                }).done(function (t, e, n) {
                    return Page.refresh({
                        response: n,
                        onlyKeys: ["domains-listing"]
                    })
                })
            }

            DomainOperations.submitSsl = function (form) {
                var $form = $(form);
                //if ($form.valid()) {
                var $button = $form.find("[type='submit']");
                var submitHtml = $button.html();
                var formData = new FormData($('#sslConfig')[0]);
                $button.addClass("disabled").html(Bizweb.LOADING);
                Bizweb.Loading.start();
                global: false,
                    $.ajax({
                        url: Bizweb.routes.setting.domain + "/certificate",
                        type: 'POST',
                        success: function (data) {
                            Bizweb.Utility.loadAjax(window.location.href, '.page-content-domains', function () {
                                Bizweb.Flash.notice(data.message);
                            });
                        },
                        error: function (data) {
                            if (data.responseJSON && data.responseJSON.error) {
                                Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                            }
                            else {
                                Bizweb.Flash.error("Cập nhật thông tin thất bại");
                            }
                            $button.removeClass("disabled").html(submitHtml);
                            Bizweb.Loading.stop();
                        },
                        data: formData,
                        cache: false,
                        contentType: false,
                        processData: false
                    });
            }
            //}

            return DomainOperations;
        }();
    }.call(this),
    function () {
        Bizweb.SetSessionViewOrder = function () {
            function SetSessionViewOrder() {
            }

            SetSessionViewOrder.prototype.set = function (value) {

                var query = window.location.search;
                var urlLoad = "/admin/orders" + query;

                Bizweb.Utility.setCookie("viewOrder", value, 365);

                Bizweb.Utility.loadAjax(urlLoad, ".page-order", function () {
                    Bizweb.Utility.changeUrl(urlLoad);
                });
            }

            SetSessionViewOrder.prototype.setCookieForTooltip = function () {
                Bizweb.Utility.setCookie("notifyNew", "close", 365);
                $('.popover').removeClass("showNotify");
            }

            return SetSessionViewOrder;
        }();
    }.call(this),
    function () {
        Bizweb.ShipmenEdit = function () {
            function ShipmenEdit(element, options) {
                this.$element = $(element);

                if (options) {
                    for (var property in options) this[property] = options[property];
                }
                initAutoNumeric();
            }

            ShipmenEdit.prototype.changeDeliverStatus = function (element) {
                this.deliverStatus = $(element).find(":selected").val();
                this.deliverStatusName = $(element).find(":selected").text();
            }
            ShipmenEdit.prototype.changePaymentStatus = function (element) {
                this.paymentStatus = $(element).find(":selected").val();
                this.paymentStatusName = $(element).find(":selected").text();
            }
            ShipmenEdit.prototype.updateShipmentDetails = function () {
                var that = this;
                var tags = $('input[name="Tags"]').val();
                var note = $('#Note').val();

                Bizweb.Loading.start();
                var button = $(".update-order-btn");
                button.addClass("disabled").html(Bizweb.LOADING);

                $.ajax({
                    url: "/admin/shipments/" + that.id,
                    data: { note: note, tags: tags },
                    type: "POST",
                    global: false,
                    success: function (data) {
                        var url = "/admin/shipments/" + that.id
                        Bizweb.Utility.loadAjax(url, ".shipments-info", function () {
                            if (data.message) {
                                Bizweb.Flash.notice(data.message);
                            } else {
                                Bizweb.Flash.notice("Cập nhật vận đơn thành công");
                            }
                        });
                    },
                    error: function (data) {
                        if (data.responseJSON && data.responseJSON.error) {
                            Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                        }
                        else {
                            Bizweb.Flash.error("Cập nhật thông tin thất bại");
                        }

                        button.removeClass("disabled").html("Lưu");
                        Bizweb.Loading.stop();
                    }
                });
            }

            return ShipmenEdit;
        }();
    }.call(this),
    function () {
        Bizweb.ShipmentBulkActions = function () {
            function ShipmentBulkActions(element, options) {
                ShipmentBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, ShipmentBulkActions);

            ShipmentBulkActions.prototype.archiveShipments = function () {
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionArchiveShipments,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                Bizweb.Flash.notice(data.result.message);
                            });
                        }, time);
                    }
                });
            }

            ShipmentBulkActions.prototype.unarchiveShipments = function () {
                var time = $("#frmBulkActions input[name='ids']").length * TIME_DELAY;
                if (time > 7000) {
                    time = 7000;
                }
                Bizweb.Loading.start();
                $.ajax({
                    url: this.urlBulkActionUnArchiveShipments,
                    type: "POST",
                    global: false,
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        setTimeout(function () {
                            Bizweb.Utility.loadAjax(window.location.href, ".page-content", function () {
                                Bizweb.Flash.notice(data.result.message);
                            });
                        }, time);
                    }
                });
            }

            ShipmentBulkActions.prototype.printShipments = function () {
                $.ajax({
                    url: this.urlBulkActionPrintShipments,
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        if (data.contents != null && data.contents.length > 0) {
                            var html = '';
                            var contents = [];
                            html += '<style type="text/css">@media all{.page-break{display:none;}}@media print{.page-break{float:none;border:none;width:100%;clear:both;display:block;page-break-before:always;}}</style>';
                            for (i = 0; i < data.contents.length; i++) {
                                contents.push('<div>' + data.contents[i] + '</div>');
                            }
                            html += contents.join('<div class="page-break"></div>');

                            var printwindow = window.frames["print_frame"];

                            var htmlNode = $('<div>' + html + '</div>');
                            htmlNode.find(".print_barcode").each(function () {
                                var barcode = $(this).attr("val");
                                $(this).JsBarcode(barcode, {
                                    width: 1,
                                    height: 40,
                                    quite: 10,
                                    format: "CODE128",
                                    displayValue: true,
                                    font: "monospace",
                                    textAlign: "center",
                                    fontSize: 12,
                                    backgroundColor: "",
                                    lineColor: "#000"
                                }
                                )
                            });
                            if (!!htmlNode["0"]) {
                                printwindow.document.body.innerHTML = htmlNode["0"].innerHTML;
                            } else {
                                printwindow.document.body.innerHTML = html;
                            }

                            setTimeout(function () { // wait until all resources loaded 
                                printwindow.document.close(); // necessary for IE >= 10
                                printwindow.focus(); // necessary for IE >= 10
                                printwindow.print(); // change window to winPrint
                                printwindow.close(); // change window to winPrint
                            }, 250);
                        }
                    },
                    error: function (error) {
                        Bizweb.Flash.error("In vận đơn không thành công");
                    }
                });
            }

            return ShipmentBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.ShipmentAction = function () {
            function ShipmentAction(e, b) {
                if (b) {
                    var property;
                    for (property in b) this[property] = b[property];
                }
            }

            ShipmentAction.prototype.showModal = function (name) {
                this[name].show();
            };

            ShipmentAction.prototype.archiveShipment = function (url, isArchive) {
                var resultText = "";
                if (isArchive) {
                    resultText = "Lưu trữ";
                } else {
                    resultText = "Hủy lưu trữ";
                }
                $.ajax({
                    url: url,
                    type: "post",
                    data: { isArchive: isArchive },
                    success: function (result) {
                        if (result != "OK") {
                            Bizweb.Flash.notice(resultText + " phiếu giao hàng không thành công");
                        } else {
                            window.location.reload();
                        }
                    },
                    error: function (data) {
                        Bizweb.Flash.error(data.responseJSON.error.replace(/\n/g, '; ').replace(/; $/, ''));
                    }
                });
            };

            ShipmentAction.prototype.cancel = function (id) {
                this.shipmentId = id;
                this.cancelShipmentModal.show();
            }

            return ShipmentAction;
        }();
    }.call(this),
    function () {
        Bizweb.NotifyFeatures = function () {
            function NotifyFeatures(e, options) {
                if (options) {
                    var property;
                    for (property in options) this[property] = options[property];
                }

                this.$container = $(e);
            }

            NotifyFeatures.prototype.shouldShowFeatureInfo = function () {
                var cookieName = this.getFeatureCookieName(this.feature);
                var cookieValue = Bizweb.Utility.getCookie(cookieName);
                if (cookieValue === "false" || cookieValue === "False")
                    return false;

                return true;
            };

            NotifyFeatures.prototype.hideFeatureInfo = function () {
                var cookieName = this.getFeatureCookieName(this.feature);
                Bizweb.Utility.setCookie(cookieName, "false", 365);
                this.$container.hide();
            };

            NotifyFeatures.prototype.getFeatureCookieName = function (feature) {
                if (!feature)
                    return;

                return "should_show_feature_" + feature;
            };

            return NotifyFeatures;
        }();
    }.call(this),
    function () {
        Bizweb.AdminNotificationBulkActions = function () {
            function AdminNotificationBulkActions(element, options) {
                AdminNotificationBulkActions.base.constructor.call(this, element, options);
            };

            extend(Bizweb.BulkActions, AdminNotificationBulkActions);

            AdminNotificationBulkActions.prototype.markAsRead = function () {
                $.ajax({
                    url: '/admin/adminnotifications/markAsRead',
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        if (data.content == "OK") {
                            Bizweb.Utility.loadAjax(window.location.href, '.adminNotification', function () {
                                Bizweb.Flash.notice("Đánh dấu đã đọc thành công!");
                            });
                        }
                        else {
                            Bizweb.Flash.error("Có lỗi xảy ra !");
                        }
                    },
                    error: function (error) {
                        Bizweb.Flash.error("Có lỗi xảy ra !");
                    }
                });
            }

            AdminNotificationBulkActions.prototype.markAsUnRead = function () {
                $.ajax({
                    url: '/admin/adminnotifications/markAsUnRead',
                    type: "POST",
                    data: $("#frmBulkActions").serialize(),
                    success: function (data) {
                        if (data.content == "OK") {
                            Bizweb.Utility.loadAjax(window.location.href, '.adminNotification', function () {
                                Bizweb.Flash.notice("Đánh dấu chưa đọc thành công!");
                            });
                        }
                        else {
                            Bizweb.Flash.error("Có lỗi xảy ra !");
                        }
                    },
                    error: function (error) {
                        Bizweb.Flash.error("Có lỗi xảy ra !");
                    }
                });
            }

            return AdminNotificationBulkActions;
        }();
    }.call(this),
    function () {
        Bizweb.TwoFactorAuth = function () {
            function TwoFactorAuth(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }
            };

            TwoFactorAuth.prototype.submitModalForm = function (e, t) {
                var i, n;
                i = $(e).serialize();
                var currentModel = this;
                var modalData = {};

                $.ajax({
                    url: e.getAttribute("action"),
                    type: e.getAttribute("method"),
                    data: i,
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }
                        $('#two_factor_auth_modal').html(result);
                        Bindings.bind($('#two_factor_auth_modal').get(0));
                        Bindings.refreshImmediately();
                    },
                    error: function (error) {
                        Bizweb.Flash.error("Có lỗi xảy ra !");
                    }
                });
            }

            TwoFactorAuth.prototype.submitDisableModalForm = function (e, t) {
                var i, n;
                i = $(e).serialize();

                $.ajax({
                    url: e.getAttribute("action"),
                    type: e.getAttribute("method"),
                    data: i,
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }
                        if (result == "OK") {
                            window.location.reload();
                            return;
                        }

                        Bizweb.Flash.error("Có lỗi xảy ra !");
                    },
                    error: function (error) {
                        Bizweb.Flash.error("Có lỗi xảy ra !");
                    }
                });
            }

            TwoFactorAuth.prototype.submitConfirmModalForm = function (e, t) {
                var that = this;
                var i, n;
                i = $(e).serialize();

                $.ajax({
                    url: e.getAttribute("action"),
                    type: e.getAttribute("method"),
                    data: i,
                    success: function (result) {
                        if (result.error != null) {
                            Bizweb.Flash.error(result.error);
                            return;
                        }
                        if (result == "") {
                            window.location.reload();
                            return;
                        }

                        Bizweb.Utility.loadAjax(window.location.href, '.user_two_factor_auth', function () {
                            $('#two_factor_auth_modal').html(result);
                            Bindings.bind($('#two_factor_auth_modal').get(0));
                            Bindings.refreshImmediately();
                        }, { hide: false });
                    },
                    error: function (error) {
                        Bizweb.Flash.error("Có lỗi xảy ra !");
                    }
                });
            }

            TwoFactorAuth.prototype.enablePrimaryBtn = function () {
                $('#two_factor_auth_modal').find(".btn-primary:last").removeAttr("disabled");
            }

            TwoFactorAuth.prototype.printCodes = function () {
                var html = '';
                var $modal = $('#two_factor_auth_modal').clone();
                $modal.find("#generate_new_code").remove();
                $modal.find(".ui-modal__header-actions").remove();
                $modal.find(".ui-modal__footer").remove();
                $modal.find(".tfa-confirm-info").remove();

                html = $modal.html();
                var printwindow = window.frames["print_frame"];

                printwindow.document.body.innerHTML = html;

                setTimeout(function () { // wait until all resources loaded 
                    printwindow.document.close(); // necessary for IE >= 10
                    printwindow.focus(); // necessary for IE >= 10
                    printwindow.print(); // change window to winPrint
                    printwindow.close(); // change window to winPrint
                }, 50);
            }

            return TwoFactorAuth;
        }();
    }.call(this),
    function () {
        var e;
        Bizweb.Scrolling = {
            scrollToElement: function (t, i) {
                var n, r, o, s;
                if (!(t.offsetHeight >= t.scrollHeight)) return r = e(i) - e(t), o = t.offsetHeight, s = t.scrollTop, n = i.offsetHeight, r < 0 ? t.scrollTop = s + r : r + n > o ? t.scrollTop = s + r - o + n : void 0
            }
        }, e = function (e) {
            return e.getBoundingClientRect().top + window.pageXOffset - document.documentElement.clientTop
        }
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        window.Bizweb.PaginatedPopoverKeyboardSelector = function () {
            function t(t, i, n, r) {
                this.childSelector = i, null == r && (r = {}), this.keypressHandler = e(this.keypressHandler, this), this.$input = $(t), this.selectedClass = r.selectedClass || "is-selected", this.selectedOptionId = "selected-option-" + _.uniqueId(), this.$popoverNode = $(n), this.$popoverPane = this.$popoverNode.find("." + Bizweb.UIPopover.CLASSES.PANE), this.popover = Bizweb.UIPopover["for"](this.$popoverNode[0]), this.$input.on("keydown", this.keypressHandler), this._setupAccessibility()
            }
            var i;
            return i = "popover-announce-selected", t.prototype.set = function (e, t) {
                if (null == t && (t = !1), this.clearSelection(), this.children = e.find(this.childSelector).toArray(), this._setupAccessibilitySelectionRoles(e), t && this.children.length) return this.focusOption(0)
            }, t.prototype.add = function (e) {
                return null == this.children && (this.children = []), this.children = this.children.concat(e.find(this.childSelector).toArray()), this._setupAccessibilitySelectionRoles(e)
            }, t.prototype.hasSelection = function () {
                return null != this.$lastSelectedNode && this.popover.isActive()
            }, t.prototype.clearSelection = function () {
                var e;
                return this.selectedIndex = null, null != (e = this.$lastSelectedNode) && e.removeClass(this.selectedClass).removeAttr("id"), this.$lastSelectedNode = null, $("#" + i).text("")
            }, t.prototype.clear = function () {
                return this.children = [], this.clearSelection()
            }, t.prototype.keypressHandler = function (e) {
                switch (e.which) {
                    case Bizweb.Keycodes.ENTER:
                        return this._selectOption(e);
                    case Bizweb.Keycodes.UP:
                        return this._focusPreviousOption(e);
                    case Bizweb.Keycodes.DOWN:
                        return this._focusNextOption(e)
                }
            }, t.prototype.focusOption = function (e) {
                var t, n;
                return _.isEmpty(this.children) ? this.clearSelection() : (this.selectedIndex = Math.max(Math.min(this.children.length - 1, e), 0), null != (t = this.$lastSelectedNode) && t.removeClass(this.selectedClass), null != (n = this.$lastSelectedNode) && n.removeAttr("id"), this.$lastSelectedNode = $(this.children[this.selectedIndex]), this.$lastSelectedNode.addClass(this.selectedClass), this.$lastSelectedNode.attr({
                    id: this.selectedOptionId
                }), this._scrollToSelectedNode(), this.popover.isActive() ? $("#" + i).text(this.$lastSelectedNode.text()) : void 0)
            }, t.prototype._setupAccessibilitySelectionRoles = function (e) {
                if (e.find("li").attr({
                    role: "option"
                }), e.is("li")) return e.attr({
                    role: "option"
                })
            }, t.prototype._setupAccessibility = function () {
                var e, t;
                if (e = this.$popoverNode.find("ul"), t = e.attr("id") || "popover-dropdown-" + _.uniqueId(), e.attr({
                    role: "listbox",
                    id: t
                }), this.$input.attr({
                    role: "combobox",
                        "aria-autocomplete": "list",
                        "aria-activedescendant": this.selectedOptionId,
                        "aria-controls": "popover-announce-selected",
                        "aria-owns": t,
                        "aria-haspopup": "false"
                }), !$("#" + i).length) return $("<div id='" + i + "' class='helper--visually-hidden' aria-live='polite'></div>").appendTo("body")
            }, t.prototype._selectOption = function (e) {
                var t;
                if (this.hasSelection()) return e.preventDefault(), null != (t = this.$lastSelectedNode) ? t.trigger("click") : void 0
            }, t.prototype._focusPreviousOption = function (e) {
                if (e.preventDefault(), !_.isEmpty(this.children)) return this.popover.isActive() ? this.$lastSelectedNode ? this.focusOption(this.selectedIndex - 1) : this.focusOption(0) : this._openAndAnnounceSelection()
            }, t.prototype._focusNextOption = function (e) {
                if (e.preventDefault(), !_.isEmpty(this.children)) return this.popover.isActive() ? this.$lastSelectedNode ? this.focusOption(this.selectedIndex + 1) : this.focusOption(0) : this._openAndAnnounceSelection()
            }, t.prototype._openAndAnnounceSelection = function () {
                var e;
                return this.popover.activate(), $("#" + i).text(null != (e = this.$lastSelectedNode) ? e.text() : void 0)
            }, t.prototype._scrollToSelectedNode = function () {
                var e, t;
                if (e = this.$lastSelectedNode, e.length && (t = e.closest(this.$popoverPane)[0])) return 0 === this.selectedIndex ? void (t.scrollTop = 0) : this.selectedIndex >= this.children.length - 1 ? void (t.scrollTop = t.scrollHeight) : Bizweb.Scrolling.scrollToElement(t, e[0])
            }, t
        }()
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        Bizweb.AutocompleteV2 = function () {
            function t(t, i, r) {
                var o;
                this.renderer = i, this.options = null != r ? r : {}, this._clearError = e(this._clearError, this), this.onScroll = e(this.onScroll, this), this.onMouseOut = e(this.onMouseOut, this), this.onFocusin = e(this.onFocusin, this), this.$node = $(t), this.options.maxLength && null == (o = this.options).maxLengthError && (o.maxLengthError = "Vượt quá " + this.options.maxLength + " ký tự cho phép"), this.$popoverNode = this.$node.find("." + Bizweb.UIPopover.CLASSES.BASE), this.$popoverPane = this.$node.find("." + Bizweb.UIPopover.CLASSES.PANE), this.$suggestionsContainer = this.$node.find(n), this.$input = this.$node.find("input:first"), this.$popoverNode.addClass(Bizweb.UIPopover.VARIANTS.BASE.NO_FOCUS), this.popover = Bizweb.UIPopover["for"](this.$popoverNode[0]), this.$node.on("mouseout", n, this.onMouseOut), this.$input.on("focusin", this.onFocusin), this.$input.on("click", !1), this.$popoverPane.on("scroll", this.onScroll), this.keyboardSelector = new Bizweb.PaginatedPopoverKeyboardSelector(this.$input[0], "[selectable]", this.$popoverNode[0], {
                    scrollPane: this.$popoverPane[0],
                    selectedClass: "next-list__item--is-selected"
                }), this.dedupedRenderWithInput = Bizweb.dedupedXHR(this.renderWithInput, 200), Bindings.afterBound(function (e) {
                    return function () {
                        return e.lastInput = e.input
                    }
                }(this))
            }
            var i, n, r;
            return n = ".js-autocomplete-suggestions", r = 500, i = 5e3, t.prototype.precompileTemplates = function (e) {
                var t;
                return t = _.pickBy(e, _.identity), _.mapValues(t, function (e) {
                    return Bizweb.Templates.precompile($(e).html())
                })
            },
                t.prototype.resetSuggestions = function () {
                    return this.renderWithInput()
                }, t.prototype.setInput = function (e) {
                    return this.input = this.lastInput = e
                }, t.prototype.inputChanged = function () {
                    var e;
                    if ((e = this.trimmedInput()) !== this.lastInput) return this.lastInput = e, this.dedupedRenderWithInput(e)
                }, t.prototype.checkInputMaxLength = function (e) {
                    if (this.options.maxLength) {
                        if (_.size(e) > this.options.maxLength) return this.showMaxLengthError(), !1;
                        this._clearError()
                    }
                    return !0
                }, t.prototype.renderWithInput = function (e) {
                    var t, i;
                    if (null == e && (e = ""),
                        this.checkInputMaxLength(e)) return t = !1, e && this.popover.activate(), Bindings.unbind(this.$suggestionsContainer[0]), this.$suggestionsContainer.empty(), this.keyboardSelector.clear(), i = this.renderer.inputChanged(e, function (e) {
                            return function (i, n) {
                                return null == n && (n = 0), t = !0, e.loadingResults = !1, e._appendAndBindRenderedContent(i, n), Bindings.refresh()
                            }
                        }(this)), t || (this.loadingResults = !0, Bindings.refreshImmediately(), this.popover.reposition()), i
                }, t.prototype.trimmedInput = function () {
                    var e, t;
                    return null != (e = null != (t = this.input) ? t.trim() : void 0) ? e : ""
                }, t.prototype.onFocusin = function (e) {
                    if (this._clearError(), this.resetSuggestions(), _.defer(function (e) {
                            return function () {
                                return e.$input.select()
                    }
                    }(this)), this.options.showSuggestionsOnFocus && (this._hasContent() || this.loadingResults)) return this.popover.activate(), e.stopPropagation()
                }, t.prototype.onMouseOut = function () {
                    return this.keyboardSelector.clearSelection()
                }, t.prototype.onScroll = function () {
                    var e, t;
                    if (!this.loadingResults && this.renderer.hasNextPage() && !(this.$popoverPane[0].scrollTop + this.$popoverPane[0].offsetHeight + r < this.$popoverPane[0].scrollHeight)) return e = !1, t = this.trimmedInput(), this.renderer.renderNextPage(function (i) {
                        return function (n) {
                            var r;
                            if (i.trimmedInput() === t) return e = !0, i.loadingResults = !1, r = $(n), _.each(r.filter("*"), function (e) {
                                return Bindings.bind(e, i)
                            }), i.$suggestionsContainer.append(r), i.keyboardSelector.add(r), Bindings.refresh()
                        }
                    }(this)), e ? void 0 : (this.loadingResults = !0, Bindings.refresh())
                }, t.prototype.showMaxLengthError = function () {
                    return this.showError(this.options.maxLengthError)
                }, t.prototype.showError = function (e) {
                    return this.errorMessage = e,
                        this.popover.deactivate(),
                        clearTimeout(this.errorTimeout),
                        this.errorTimeout = setTimeout(this._clearError, i), Bindings.refresh()
                }, t.prototype._clearError = function () {
                    var e;
                    if (e = !!this.errorMessage, this.errorMessage = null, e)
                        return Bindings.refresh()
                }, t.prototype._hasContent = function () {
                    return this.$suggestionsContainer.children("*").length > 0
                }, t.prototype._appendAndBindRenderedContent = function (e, t, i) {
                    return null == i && (i = !1), !i && this._isPopoverClosing() ? this.$popoverNode.one(Bizweb.UIPopover.EVENTS.DEACTIVATED, function (i) {
                        return function () {
                            return i._appendAndBindRenderedContent(e, t, !0)
                        }
                    }(this)) : (Bindings.unbind(this.$suggestionsContainer[0]), this.$suggestionsContainer.html(e), Bindings.bind(this.$suggestionsContainer[0]), this.keyboardSelector.set(this.$suggestionsContainer), this.keyboardSelector.focusOption(t), this._hasContent() ? void 0 : this.popover.deactivate())
                }, t.prototype._isPopoverClosing = function () {
                    return this.$popoverNode.hasClass(Bizweb.UIPopover.STATES.CONTAINER.DEACTIVATING)
                }, t
        }()
    }.call(this),
    function () {
        Bizweb.Templates = {
            precompile: function (e) {
                return _.template(e)
            },
            render: function (e, t) {
                return _.isFunction(e) ? e(t) : _.template(e)(t)
            },
            renderAndAppend: function (e, t, i) {
                return i.append(this.render(e, t))
            },
            renderAppendAndBind: function (e, t, i) {
                return Bizweb.Templates.renderAndAppend(e, t, i), Bindings.bind(i[0])
            },
            unbindAndRemove: function (e) {
                return Bindings.unbind(e[0]), e.remove()
            },
            renderSetAndBind: function (e, t, i) {
                return Bindings.unbind(i[0]), i.html(this.render(e, t)), Bindings.bind(i[0])
            }
        }
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = function (e, t) {
                function n() {
                    this.constructor = e
                }
                for (var r in t) i.call(t, r) && (e[r] = t[r]);
                return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
            },
            i = {}.hasOwnProperty;
        Bizweb.AutocompleteV2.RemoteMultiSelectAutocomplete = function (i) {
            function n(t, i, r, o, s) {
                var a, u, l;
                this.eventBus = r, null == s && (s = {});
                this._clearInput = e(this._clearInput, this);
                this._deleteValue = e(this._deleteValue, this);
                this._addValue = e(this._addValue, this);
                l = {
                    results: "#autocomplete-v2-suggestions-list-with-toggle-template",
                    noResults: "#autocomplete-v2-no-results-template"
                };
                s.templates && (l = _.merge(l, s.templates));
                l = this.precompileTemplates(l);
                s = _.defaults(s, {
                    values: [],
                    showSuggestionsOnFocus: !0
                });
                this.values = {};
                _.each(s.values, function (e) {
                    e.init = true
                });
                _.each(s.values, this._addValue);
                _.each(s.values, function (e) {
                    e.init = false
                });
                u = {
                    displayKey: s.displayKey,
                    detailsKey: s.detailsKey,
                    secondaryDetailsKey: s.secondaryDetailsKey
                };
                a = new Bizweb.AutocompleteV2.PaginatedRemoteRenderer(i, o, l, u);
                n.__super__.constructor.call(this, t, a, s);
                this.eventBus.on("value:removed", this._deleteValue);
                this.$input.on("blur", this._clearInput);
            }
            return t(n, i), n.prototype.isApplied = function (e) {
                return this.values[e]
            }, n.prototype.selectSuggestion = function (e) {
                return this.values[e.id] ? this.eventBus.trigger("value:removed", e) : this._addValue(e)
            }, n.prototype.deleteSuggestion = function (e) {
                return this.eventBus.trigger("value:removed", e);
            }, n.prototype._addValue = function (e) {
                this.values[e.id] = !0;
                this.eventBus.trigger("value:added", e);
            }, n.prototype._deleteValue = function (e, t) {
                return delete this.values[t.id], Bindings.refresh()
            }, n.prototype._clearInput = function () {
                return this.setInput(""), Twine.refresh()
            }, n
        }(Bizweb.AutocompleteV2)
    }.call(this),
    function () {
        Bizweb.AutocompleteV2.RendererTools = {
            fetchResource: function (e, t) {
                var i;
                return i = $.ajax({
                    dataType: "json",
                    method: "GET",
                    url: e
                }), i.done(function (e) {
                    return t(null, e)
                }), i.fail(function (e, i) {
                    if ("abort" !== i) return Bizweb.handleError(arguments), t(e)
                })
            },
            filterSourceArrayByInput: function (e, t) {
                var i, n, r, o, s, a;
                if (_.isEmpty(e) || !_.isArray(e)) return [
                    [], null
                ];
                if (!t) return [e, null];
                for (t = t.toLowerCase(), o = new RegExp("(^|\\s)" + Bizweb.escapeRegexpString(t), "i"), a = [], i = null, n = 0, r = e.length; n < r; n++) s = e[n], o.test(s) && (s.toLowerCase() === t && (i = _.size(a)), a.push(s));
                return [a, i]
            },
            sortSourceArray: function (e) {
                return _.sortBy(_.compact(e), function (e) {
                    return e.toLowerCase()
                })
            }
        }
    }.call(this),
    function () {
        Bizweb.AutocompleteV2.BasicRenderer = function () {
            function e(e, t) {
                this.templates = t, this.setSource(e)
            }
            return e.prototype.inputChanged = function (e, t) {
                var i, n, r, o, s;
                return o = Bizweb.AutocompleteV2.RendererTools.filterSourceArrayByInput(this.sourceArray, e), this.allSuggestions = o[0], n = o[1], this.renderedSuggestionCount = 0, _.isEmpty(this.allSuggestions) ? t(this.templates.noResults ? this.templates.noResults({
                    input: e
                }) : null) : (s = this.allSuggestions.slice(0, Bizweb.AUTOCOMPLETE_MAX_SIZE), this.renderedSuggestionCount = _.size(s), r = _.isNumber(n), r && n >= Bizweb.AUTOCOMPLETE_MAX_SIZE && (n = null), i = {
                    suggestions: s,
                    firstPage: !0,
                    hasMatchingSuggestion: r,
                    input: e
                }, t(this.templates.results(i), n)), null
            }, e.prototype.renderNextPage = function (e) {
                var t;
                return this.hasNextPage() ? (t = this.allSuggestions.slice(this.renderedSuggestionCount, this.renderedSuggestionCount + Bizweb.AUTOCOMPLETE_MAX_SIZE), this.renderedSuggestionCount += _.size(t), e(this.templates.results({
                    suggestions: t,
                    firstPage: !1
                }))) : e(null)
            }, e.prototype.hasNextPage = function () {
                return _.size(this.allSuggestions) > this.renderedSuggestionCount
            }, e.prototype.getSource = function () {
                return this.sourceArray
            }, e.prototype.setSource = function (e) {
                return this.sourceArray = Bizweb.AutocompleteV2.RendererTools.sortSourceArray(e)
            }, e
        }()
    }.call(this),
    function () {
        var e;
        e = /[|\\{}()[\]^$+*?.]/g, Bizweb.escapeRegexpString = function (t) {
            return t.replace(e, "\\$&")
        }
    }.call(this),
    function () {
        Bizweb.AutocompleteV2.CountryRenderer = function () {
            function e(e, t) {
                this.templates = t, this.setSource(e)
            }
            return e.prototype.inputChanged = function (e, t) {
                var i, n, r, o, s;
                return o = this.filterSourceArrayByInput(this.sourceArray, e), this.allSuggestions = o[0], n = o[1], this.renderedSuggestionCount = 0, _.isEmpty(this.allSuggestions) ? t(this.templates.noResults ? this.templates.noResults({
                    input: e
                }) : null) : (s = this.allSuggestions, this.renderedSuggestionCount = _.size(s), r = _.isNumber(n), i = {
                    suggestions: s,
                    firstPage: !0,
                    hasMatchingSuggestion: r,
                    input: e
                }, t(this.templates.results(i), n)), null
            }, e.prototype.filterSourceArrayByInput = function (e, t) {
                var i, n, r, o, s, a;
                if (_.isEmpty(e) || !_.isArray(e)) return [
                    [], null
                ];
                if (!t) return [e, null];
                for (t = t.toLowerCase(), o = new RegExp("(^|\\s)" + Bizweb.escapeRegexpString(t), "i"), a = [], i = null, n = 0, r = e.length; n < r; n++) s = e[n], (o.test(s.name) || o.test(s.code)) && (s.name.toLowerCase() !== t && s.code.toLowerCase() !== t || (i = _.size(a)), a.push(s));
                return [a, i]
            }, e.prototype.hasNextPage = function () {
                return !1
            }, e.prototype.getSource = function () {
                return this.sourceArray
            }, e.prototype.setSource = function (e) {
                return this.sourceArray = e
            }, e
        }()
    }.call(this),
    function () {
        var e = function (e, i) {
            function n() {
                this.constructor = e
            }
            for (var r in i) t.call(i, r) && (e[r] = i[r]);
            return n.prototype = i.prototype, e.prototype = new n, e.__super__ = i.prototype, e
        },
            t = {}.hasOwnProperty;
        Bizweb.AutocompleteV2.LazyLoadedBasicRenderer = function (t) {
            function i(e, t, n) {
                this.sourceUrl = e, this.resultsRoot = t, i.__super__.constructor.call(this, [], n)
            }
            return e(i, t), i.prototype.inputChanged = function (e, t) {
                return this.hasSource ? i.__super__.inputChanged.apply(this, arguments) : Bizweb.AutocompleteV2.RendererTools.fetchResource(this.sourceUrl, function (i) {
                    return function (n, r) {
                        if (!n) return i.hasSource = !0, i.setSource(r[i.resultsRoot]), i.inputChanged(e, t)
                    }
                }(this))
            }, i
        }(Bizweb.AutocompleteV2.BasicRenderer)
    }.call(this),
    function () {
        Bizweb.AutocompleteV2.PaginatedRemoteRenderer = function () {
            function e(e, t, i, n) {
                this.sourceUrl = e, this.resultsRoot = t,
                this.templates = i, null == n && (n = {}),
                this.displayKey = n.displayKey || "title",
                this.detailsKey = n.detailsKey || !1,
                this.secondaryDetailsKey = n.secondaryDetailsKey || !1
            }
            return e.prototype.inputChanged = function (e, t) {
                return this.input = e, this.input || !this.hasSource ? this._fetchAndRenderPage(this.input, t) : (this._renderCachedFirstPage(t), null)
            }, e.prototype.renderNextPage = function (e) {
                var t, i, n, r, o;
                if (!this.hasNextPage()) return e(null);
                r = Bizweb.UrlMangler.getURL(this.sourceUrl), n = this.nextPageParams;
                for (t in n) o = n[t], Bizweb.UrlMangler.addQuery(r, (i = {}, i["" + t] = o, i));
                return this.input && Bizweb.UrlMangler.addQuery(r, {
                    query: this.input
                }),
                    Bizweb.AutocompleteV2.RendererTools.fetchResource(r.href, function (t) {
                        return function (i, n) {
                            var r, o;
                            if (!i) return o = n[t.resultsRoot], t.nextPageParams = n.next_page_params, r = {
                                suggestions: o,
                                firstPage: !1,
                                displayKey: t.displayKey,
                                detailsKey: t.detailsKey,
                                secondaryDetailsKey: t.secondaryDetailsKey
                            }, e(t.templates.results(r))
                        }
                    }(this))
            }, e.prototype.hasNextPage = function () {
                return null != this.nextPageParams
            }, e.prototype._fetchAndRenderPage = function (e, t) {
                var i;
                return i = Bizweb.UrlMangler.getURL(this.sourceUrl), e && Bizweb.UrlMangler.addQuery(i, {
                    query: e
                }),
                    Bizweb.AutocompleteV2.RendererTools.fetchResource(i.href, function (i) {
                        return function (n, r) {
                            var o, s;
                            if (!n) return s = r[i.resultsRoot], i.nextPageParams = r.next_page_params, e ||
                                (i.hasSource = !0, i.defaultSuggestions = s,
                                i.defaultNextPageParams = i.nextPageParams), o = {
                                    suggestions: s,
                                    firstPage: !0,
                                    input: e,
                                    displayKey: i.displayKey,
                                    detailsKey: i.detailsKey,
                                    secondaryDetailsKey: i.secondaryDetailsKey
                                }, t(i.templates.results(o))
                        }
                    }(this))
            }, e.prototype._renderCachedFirstPage = function (e) {
                var t;
                return this.nextPageParams = this.defaultNextPageParams, t = {
                    suggestions: this.defaultSuggestions,
                    firstPage: !0,
                    input: "",
                    displayKey: this.displayKey,
                    detailsKey: this.detailsKey,
                    secondaryDetailsKey: this.secondaryDetailsKey
                }, e(this.templates.results(t))
            }, e
        }()
    }.call(this),
    function () {
        Bizweb.AutocompleteV2.ShippingZoneRenderer = function () {
            function e(e, t) {
                this.sourceArray = e, this.templates = t
            }
            return e.prototype.inputChanged = function (e, t) {
                return this.allSuggestions = this.filterSourceArrayByInput(this.sourceArray, e), t(_.isEmpty(this.allSuggestions) ? this.templates.noResults({
                    input: e
                }) : this.templates.results({
                    suggestions: this.allSuggestions,
                    input: e
                })), null
            }, e.prototype.filterSourceArrayByInput = function (e, t) {
                var i, n, r, o, s;
                if (!_.isArray(e) || _.isEmpty(e)) return [];
                if (!(t = t.trim())) return e;
                for (r = new RegExp("(^|\\s)" + Bizweb.escapeRegexpString(t), "i"), o = [], i = 0, n = e.length; i < n; i++) s = e[i], (r.test(s.name) || r.test(s.group)) && o.push(s);
                return o
            }, e.prototype.hasNextPage = function () {
                return !1
            }, e
        }()
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        Bizweb.AutocompleteV2.TagsRenderer = function () {
            function t(t, i, n) {
                this.sourceUrl = t, this.templates = i, this.eventBus = n, this._valueRemoved = e(this._valueRemoved, this), this._valueAdded = e(this._valueAdded, this), this.values = new Map, this.eventBus.on("value:added", this._valueAdded), this.eventBus.on("value:removed", this._valueRemoved)
            }
            var i;
            return i = 25, t.prototype.inputChanged = function (e, t) {
                var i, n, r, o, s, a;
                return null != this.sourceArray ? (e ? (o = Bizweb.AutocompleteV2.RendererTools.filterSourceArrayByInput(this._filterAndSortSuggestions(), e), this.allSuggestions = o[0], n = o[1]) : this.allSuggestions = this._defaultSuggestions(), this.renderedSuggestionCount = 0, _.isEmpty(this.allSuggestions) ? t(this.templates.noResults ? this.templates.noResults({
                    input: this._generateInputAddMessage(e)
                }) : null) : (s = this.allSuggestions.slice(0, Bizweb.AUTOCOMPLETE_MAX_SIZE), this.renderedSuggestionCount = _.size(s), r = _.isNumber(n) || this.hasValue(e), r && n >= Bizweb.AUTOCOMPLETE_MAX_SIZE && (n = null), i = {
                    suggestions: s,
                    firstPage: !0,
                    hasMatchingSuggestion: r,
                    input: this._generateInputAddMessage(e)
                }, t(this.templates.results(i), n)), null) : (a = Bizweb.UrlMangler.addQuery(Bizweb.UrlMangler.getURL(this.sourceUrl), {
                    order: "popularity"
                }).href, Bizweb.AutocompleteV2.RendererTools.fetchResource(a, function (i) {
                    return function (n, r) {
                        if (!n) return i.sourceArray = r.tags, i.inputChanged(e, t)
                    }
                }(this)))
            }, t.prototype.renderNextPage = function (e) {
                var t;
                return this.hasNextPage() ? (t = this.allSuggestions.slice(this.renderedSuggestionCount, this.renderedSuggestionCount + Bizweb.AUTOCOMPLETE_MAX_SIZE), this.renderedSuggestionCount += _.size(t), e(this.templates.results({
                    suggestions: t,
                    firstPage: !1
                }))) : e(null)
            }, t.prototype.hasNextPage = function () {
                return _.size(this.allSuggestions) > this.renderedSuggestionCount
            }, t.prototype.hasValue = function (e) {
                return this.values.has(e.toLowerCase())
            }, t.prototype._valueAdded = function (e, t) {
                return this.values.set(t.toLowerCase(), !0)
            }, t.prototype._valueRemoved = function (e, t) {
                return this.values["delete"](t.toLowerCase())
            }, t.prototype._defaultSuggestions = function () {
                return _.take(this._suggestionsWithoutSelectedValues(this.source), i)
            }, t.prototype._filterAndSortSuggestions = function () {
                return _.sortBy(this._suggestionsWithoutSelectedValues(), function (e) {
                    return e.toLowerCase()
                })
            }, t.prototype._suggestionsWithoutSelectedValues = function () {
                return _._reject(this.sourceArray, function (e) {
                    return function (t) {
                        return e.values.get(t.toLowerCase())
                    }
                }(this))
            }, t.prototype._generateInputAddMessage = function (e) {
                var t, i;
                return i = _.map(e.split(","), function (e) {
                    if (e = e.trim()) return '"' + e + '"'
                }), i = _.compact(i), t = i.shift(), i.length > 0 ? t + " và " + i.length + " tag khác" : t
            }, t
        }()
    }.call(this),
    function () {
        var e = function (e, i) {
            function n() {
                this.constructor = e
            }
            for (var r in i) t.call(i, r) && (e[r] = i[r]);
            return n.prototype = i.prototype, e.prototype = new n, e.__super__ = i.prototype, e
        },
            t = {}.hasOwnProperty;
        Bizweb.AutocompleteV2.SingleSelectRemoteSourceAutocomplete = function (t) {
            function i(e, t, n, r) {
                var o, s;
                s = {
                    results: "#autocomplete-v2-results-template",
                    noResults: "#autocomplete-v2-no-results-template"
                }, r.templates && (s = _.merge(s, r.templates)), s = this.precompileTemplates(s),
                o = new Bizweb.AutocompleteV2.LazyLoadedBasicRenderer(t, n, s),
                i.__super__.constructor.call(this, e, o, r)
            }
            return e(i, t), i.prototype.selectSuggestion = function (e) {
                return this.setInput(e), this.popover.deactivate(), this.resetSuggestions()
            }, i.prototype.selectHeader = function () {
                return this.popover.deactivate(), this.resetSuggestions()
            }, i.prototype.togglePopover = function (e) {
                return this.popover.toggle(), this.$input.one("focusin", !1), this.$input.focus(), e.stopPropagation()
            }, i
        }(Bizweb.AutocompleteV2)
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = function (e, t) {
                function n() {
                    this.constructor = e
                }
                for (var r in t) i.call(t, r) && (e[r] = t[r]);
                return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
            },
            i = {}.hasOwnProperty;
        Bizweb.AutocompleteV2.TagsAutocomplete = function (i) {
            function n(t, i, r, o) {
                var s, a;
                this.eventBus = r, null == o && (o = {}), this._addValue = e(this._addValue, this), this._onKeydown = e(this._onKeydown, this), this._onPageFocusin = e(this._onPageFocusin, this), this.cleanUp = e(this.cleanUp, this), a = {
                    results: "#autocomplete-v2-tag-results-template",
                    noResults: "#autocomplete-v2-no-results-template"
                }, o.templates && (a = _.merge(a, o.templates)), a = this.precompileTemplates(a), o = _.defaults(o, {
                    values: [],
                    duplicateError: "You've already selected %s",
                    maxLength: 255,
                    showSuggestionsOnFocus: !0
                }), s = new Bizweb.AutocompleteV2.TagsRenderer(i, a, this.eventBus), _.each(o.values, this._addValue), n.__super__.constructor.call(this, t, s, o), this.$popoverNode.attr(Bizweb.UIPopover.ATTRS.PREFERRED_POSITION, Bizweb.UIPopover.POSITIONS.TOP), this.$input.on("keydown", this._onKeydown), $(document).on("focusin click", this._onPageFocusin), Page.onReplace(t, this.cleanUp)
            }
            return t(n, i), n.prototype.cleanUp = function () {
                return $(document).off("focusin click", this._onPageFocusin)
            }, n.prototype.selectSuggestion = function (e, t) {
                var i, n;
                return null != t && t.stopPropagation(), this._addValue(e), this.trimmedInput() ? (this._resetInput(), this.popover.deactivate(), this.resetSuggestions()) : (n = this.keyboardSelector.selectedIndex, i = this.$popoverPane.scrollTop(), this.resetSuggestions(), this.keyboardSelector.focusOption(n), this.$popoverPane.scrollTop(i))
            }, n.prototype.checkInputMaxLength = function (e) {
                if (this.options.maxLength) {
                    if (_.size(e) > this.options.maxLength && !_.includes(e, ",")) return this.showMaxLengthError(), !1;
                    this._clearError()
                }
                return !0
            }, n.prototype.selectHeader = function () {
                return this._addTagsFromInput()
            }, n.prototype.showDuplicateError = function (e) {
                return this.showError(this.options.duplicateError.replace("%s", Bizweb.String.humanizeList(e)))
            }, n.prototype._onPageFocusin = function (e) {
                if (!this.$node.find(e.target).length) return this._resetInput(), Bindings.refresh()
            }, n.prototype._onKeydown = function (e) {
                return e.which !== Bizweb.Keycodes.COMMA || e.shiftKey || e.altKey || e.ctrlKey || e.metaKey ? e.which === Bizweb.Keycodes.ENTER && this.trimmedInput() && !this.keyboardSelector.hasSelection() ? (e.preventDefault(), this._addTagsFromInput()) : void 0 : (e.preventDefault(), this._addTagsFromInput())
            }, n.prototype._resetInput = function () {
                return this.setInput("")
            }, n.prototype._addValue = function (e) {
                return this.eventBus.trigger("value:added", e)
            }, n.prototype._addTagsFromInput = function () {
                var e, t, i, n;
                if (n = this.trimmedInput()) return i = !1, e = [], t = [], _.each(n.split(","), function (n) {
                    return function (r) {
                        if (r = r.trim()) return n.options.maxLength && _.size(r) > n.options.maxLength ? (e.push(r), i = !0) : n.renderer.hasValue(r) ? (e.push(r), t.push(r)) : n._addValue(r)
                    }
                }(this)), this.setInput(e.join(", ")), _.isEmpty(t) ? i ? this.showMaxLengthError() : (this.popover.deactivate(), Bindings.refresh(), this.resetSuggestions(), void 0) : this.showDuplicateError(t)
            }, n
        }(Bizweb.AutocompleteV2)
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        Bizweb.TagDisplay = function () {
            function t(t) {
                this.tagRemoved = e(this.tagRemoved, this), this.tagAdded = e(this.tagAdded, this);
                var i;
                this.$node = $(t), this.$tagList = this.$node.find(".js-tag-list"), this.tags = new Map, this.$node.on("value:added", this.tagAdded), this.$node.on("value:removed", this.tagRemoved), i = $("#display-one-tag"), this.inputName = i.data("input-name"), this.tagTemplate = Bizweb.Templates.precompile(i.html())
            }
            return t.prototype.hasTags = function () {
                return this.tags.size > 0
            }, t.prototype.tagAdded = function (e, t) {
                var i;
                return this.tagRemoved(e, t), i = $(this.renderTag(t)).filter("li"), this.tags.set(t, i.prependTo(this.$tagList)), Bindings.bind(this.tags.get(t)[0], this), this.recalculateDirty()
            }, t.prototype.tagRemoved = function (e, t) {
                if (this.tags.has(t)) return Bindings.unbind(this.tags.get(t)[0]), this.tags.get(t).remove(), this.tags["delete"](t), this.recalculateDirty()
            }, t.prototype.recalculateDirty = function () {
                return this.$node.closest("form").trigger("change")
            }, t.prototype.removeTag = function (e) {
                var t;
                return t = $(e).find("input").val(), this.$node.trigger("value:removed", t)
            }, t.prototype.renderTag = function (e) {
                return Bizweb.Templates.render(this.tagTemplate, {
                    tag: e,
                    inputName: this.inputName
                })
            }, t
        }()
    }.call(this),
    function () {
        Bizweb.SeoFields = function () {
            function e(e, t) {
                var i;
                this._node = e, i = t.objectName, this.originalHandle = t.originalHandle, this._context = Bindings.context(this._node), this._objectName = i, this.object = this._context[this._objectName], this.newHandle = this.originalHandle, this._visible = !1
            }
            var t, i;
            return i = 70, t = 320, e.prototype.isVisible = function () {
                return this._visible
            }, e.prototype.show = function () {
                return this._visible = !0
            }, e.prototype.titlePlaceholder = function () {
                return (this.object.title || "").substr(0, i)
            }, e.prototype.descriptionPlaceholder = function () {
                return Bizweb.HTML.unsafeStripWithoutNbsp($('#Content').val()).replace(/(\r?\n|\r)/gm, ' ').trim().substr(0, t)
            }, e.prototype.defaultHandle = function () {
                return Bizweb.Inflection.generateAlias(this.object.title)
            },
                e.prototype.shouldShowGooglePreview = function () {
                    return this.googleTitle() && this.googleDescription();
                },
                e.prototype.googleTitle = function () {
                    var e;
                    return e = this.object.seo_title || this.object.title || "", Bizweb.Inflection.truncate(e, i)
                },
                e.prototype.googleDescription = function () {
                    var e;
                    return e = this.object.seo_description || Bizweb.HTML.unsafeStripWithoutNbsp($('#Content').val()).replace(/(\r?\n|\r)/gm, ' ').trim() || "", Bizweb.Inflection.truncate(e, t)
                }, e.prototype.googlePath = function () {
                    return this.newHandle || this.defaultHandle()
                }
              , e.prototype.newHandleWithDefault = function () {
                  return this.newHandle || this.defaultHandle()
              }, e.prototype.urlChanged = function () {
                  return this.newHandleWithDefault() !== this.originalHandle
              }, e.prototype.redirectSelected = function () {
                  return this.urlChanged() && this.object.seo_redirect
              }, e
        }()
    }.call(this),
    function () {
        Bizweb.AllTagsModal = function () {
            function e(e, t, i) {
                var n, r;
                this.$eventBus = e, this.currentTags = t, this.$activeTagsList = $(i).find(".js-tag-list"), this.tags = {}, n = $("#display-one-tag"), this.inputName = n.data("input-name"), this.tagTemplate = Bizweb.Templates.precompile(n.html());
                for (r in this.currentTags) this.addTagByString(r)
            }
            return e.prototype.isTagSelected = function (e) {
                var t;
                return t = e.getElementsByTagName("input")[0].value, null != this.tags[t]
            }, e.prototype.toggleTag = function (e) {
                var t;
                return t = $(e).find("input").val(), this.tags[t] ? this.removeTagByString(t) : this.addTagByString(t)
            }, e.prototype.addTagByString = function (e) {
                var t;
                return this.removeTagByString(e), t = $(this.renderTag(e)).filter("li"), this.tags[e] = t.prependTo(this.$activeTagsList), Bindings.bind(this.tags[e][0], this)
            }, e.prototype.removeTag = function (e) {
                var t;
                return t = $(e).find("input").val(), this.removeTagByString(t)
            }, e.prototype.removeTagByString = function (e) {
                if (this.tags[e]) return Bindings.unbind(this.tags[e][0]), this.tags[e].remove(), delete this.tags[e]
            }, e.prototype.renderTag = function (e) {
                return Bizweb.Templates.render(this.tagTemplate, {
                    tag: e,
                    inputName: this.inputName
                })
            }, e.prototype.confirmSelectedTags = function () {
                var e, t;
                for (t in this.currentTags) this.$eventBus.trigger("value:removed", t);
                e = [];
                for (t in this.tags) e.push(this.$eventBus.trigger("value:added", t));
                return e
            }, e
        }()
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = function (e, t) {
                function n() {
                    this.constructor = e
                }
                for (var r in t) i.call(t, r) && (e[r] = t[r]);
                return n.prototype = t.prototype, e.prototype = new n, e.__super__ = t.prototype, e
            },
            i = {}.hasOwnProperty;
        Bizweb.RemoteImageForm = function (i) {
            function n(t, i, r) {
                this.resourceName = t, this.form = i, this.opts = null != r ? r : {}, this.submit = e(this.submit, this), n.__super__.constructor.call(this, this.form, this.opts)
            }
            return t(n, i), n.prototype.submit = function (e) {
                var t, i, n, r, o;
                return e.preventDefault(), o = e.target, t = {
                    httpRequestType: o.getAttribute("method"),
                    httpUrl: o.getAttribute("action"),
                    refreshOnErrorExcept: this.resourceName + "-image-drop",
                    useNativeEncoding: null != (null != (i = this.imageDrop) ? i.file : void 0),
                    success: function (e) {
                        return function () {
                            return e.imageDrop.file = null
                        }
                    }(this)
                }, r = new TurboGraft.Remote(t, this.form, o),
                    (null != (n = this.imageDrop) ? n.file : void 0) && (r.formData.append(this.resourceName + "[image][alt]", this.imageDrop.alt), r.formData.append(this.resourceName + "[image][attachment]", this.imageDrop.file)), r.submit()
            }, n
        }(Bizweb.Forms)
    }.call(this),
    function () {
        var e, t, i, n = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        t = function () {
            return SafeLocalStorage.get("adjacent", {})
        }, e = function (e) {
            return t()[e] || {
                ids: [],
                params: {}
            }
        }, i = function (e, i, n) {
            var r;
            return r = t(), r[e] = {
                params: i,
                ids: n
            }, SafeLocalStorage.set("adjacent", r)
        }, Bizweb.AdjacentResources = function () {
            function t(t, i) {
                var r;
                this.type = t, this.id = i, this._fetch = n(this._fetch, this), r = e(this.type), this.ids = r.ids, this.params = r.params
            }
            return t.storeIndex = function (e, t, n) {
                return i(e, t, n)
            }, t.storeAndRedirect = function (e, t, n, r) {
                return i(t, n, r), Page.refresh({
                    url: e.href
                })
            }, t.lastSearchURI = function (t, i) {
                var n;
                return n = Bizweb.UrlMangler.getURL(t.href), n.search = Bizweb.UrlMangler.buildSearchString(_.merge(Bizweb.UrlMangler.parseSearchString(n.search), e(i).params)), n.href
            }, t.prototype.init = function (e) {
                var t, i, n;
                return i = $(e), t = i.find(".js-next-btn"), n = i.find(".js-prev-btn"), t.attr("href", this.nextURI(t)), n.attr("href", this.prevURI(n)), this
            }, t.prototype.index = function () {
                return this.ids.indexOf(this.id)
            }, t.prototype.nextURI = function (e) {
                var t, i;
                return this.ids.length ? (i = this.index()) === this.ids.length - 1 ? this.fetchNext(e) : (t = this.ids[i + 1], Bizweb.routes[this.type](t).html) : e.attr("href")
            }, t.prototype.prevURI = function (e) {
                var t, i;
                return this.ids.length ? 0 === (i = this.index()) ? this.fetchPrev(e) : (-1 === i && (i = this.ids.length), t = this.ids[i - 1], Bizweb.routes[this.type](t).html) : e.attr("href")
            }, t.prototype.fetchNext = function (e) {
                return this._fetch("next", function (t) {
                    return function (n) {
                        return e.on("click", function () {
                            return i(t.type, t.params = n.params, t.ids = n.ids)
                        }), n.ids.length ? t.ids = t.ids.concat(n.ids) : (t.ids.push(-1), i(t.type, t.params, t.ids)), Bindings.refresh()
                    }
                }(this)), e.attr("href")
            }, t.prototype.fetchPrev = function (e) {
                return this._fetch("prev", function (t) {
                    return function (n) {
                        return e.on("click", function () {
                            return i(t.type, t.params = n.params, t.ids = n.ids)
                        }), n.ids.length ? t.ids = n.ids.concat(t.ids) : (t.ids.unshift(-1), i(t.type, t.params, t.ids)), Bindings.refresh()
                    }
                }(this)), e.attr("href")
            }, t.prototype._fetch = function (e, t) {
                var i;
                return i = $.ajax({
                    url: Bizweb.routes[e + "_page_" + this.type + "s"]().json,
                    data: this.params,
                    dataType: "json"
                }), i.fail(Bizweb.handleError), i.done(t)
            }, t.prototype.isNextDisabled = function () {
                return -1 === this.ids[this.index() + 1]
            }, t.prototype.isPrevDisabled = function () {
                return -1 === this.ids[this.index() - 1]
            }, t
        }()
    }.call(this),
    function () {
        Bizweb.ImageDrop = function () {
            function e(e, t, i, n, r) {
                this.form = t,
                this.src = i,
                this.alt = n,
                this.updateUrl = r,
                this.initialAlt = this.alt,
                this.fileDragHelper = new Bizweb.FileDragHelper,
                this.dirty = !1,
                Page.onRefresh(this, e, function (e) {
                    return function (t) {
                        if (t.dirty)
                            return e.dirty = t.dirty,
                            e.src = t.src,
                            e.file = t.file,
                            e.alt = t.alt
                    }
                }(this))

                $('.image-drop-file-input').change(function (e) {
                    e.preventDefault();

                    var id = $(this).attr('id');
                    var file = document.getElementById(id).files[0];
                    var check = true;

                    if (file) {
                        var name = file.name;
                        switch (name.substring(name.lastIndexOf('.') + 1).toLowerCase()) {
                            case 'gif': case 'jpg': case 'png': case 'jpeg':
                                break;
                            default:
                                check = false;
                                break;
                        }
                        if (!check) {
                            return Bizweb.Flash.error("File upload không đúng định dạng"),
                              $(this).val(''), !0;
                        }

                        var size = parseFloat(file.size / 1024).toFixed(2);
                        if (size > 1024) {
                            return Bizweb.Flash.error("Kích thước file tối đa được upload là 1MB"),
                              $(this).val(''), !0;
                        }
                    }
                });
            }
            return e.prototype.dragging = function () {
                return this.fileDragHelper.dragging
            }, e.prototype.startDrag = function (e) {
                return this.fileDragHelper.start(e)
            }, e.prototype.dragOver = function (e) {
                return this.fileDragHelper.over(e)
            }, e.prototype.cancelDrag = function (e) {
                return this.fileDragHelper.cancel(e)
            }, e.prototype.fileInputChanged = function (e, t) {
                return this.updatePreviewAndHiddenInput(t.files[0])
            }, e.prototype.dropFile = function (e) {
                if (this.fileDragHelper.isFileDragEvent(e)) return this.updatePreviewAndHiddenInput(e.originalEvent.dataTransfer.files[0]), this.fileDragHelper.cancel(e)
            }, e.prototype.setImageSrc = function (e) {
                return this.alt = this.initialAlt = this.updateUrl = "", this.src = e, this.dirty = !0
            }, e.prototype.removeImage = function () {
                return this.file = null, this.setImageSrc("")
            }, e.prototype.cancelAltTextUpdate = function () {
                return Bizweb.Modal.hide(), this.alt = this.initialAlt
            },
                e.prototype.updatePreviewAndHiddenInput = function (e) {
                    var t;
                    if (e) return this.file = e, t = new FileReader, t.onload = function (e) {
                        return function (t) {
                            return e.setImageSrc(t.target.result), Bindings.refresh()
                        }
                    }(this), e instanceof Blob ? t.readAsDataURL(e) : void 0
                }, e.prototype.saveAltText = function () {
                    var e;
                    if (Bizweb.Modal.hide(), this.updateUrl) return e = $.ajax({
                        url: this.updateUrl,
                        method: "POST",
                        data: {
                            altImage: this.alt
                        }
                    }), e.success(function (e) {
                        return function () {
                            return e.initialAlt = e.alt, Bizweb.Flash.notice("Đã cập nhật ALT của ảnh")
                        }
                    }(this)), e.fail(function (e) {
                        var t;
                        try {
                            t = JSON.parse(e.responseText).errors.image.join(". ")
                        } catch (e) {
                            e,
                            t = "Cập nhật thất bại";
                        }
                        return Bizweb.Flash.error(t)
                    })
                }, e
        }()
    }.call(this),
    function () {
        var e, t, i, n = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        e = {
            BASE: "bulk-actions",
            CHECKBOX: "bulk-actions__select-all",
            HEADER: "ui-title-bar",
            CARD_SECTION: "next-card__section",
            UI_CARD_SECTION: "ui-card__section",
            TABLE_WRAPPER: "table-wrapper"
        }, i = {
            BASE: {
                STICKY: "bulk-actions--is-sticky"
            },
            CHECKBOX: {
                STICKY: "bulk-actions__select-all--is-sticky"
            }
        }, t = "bulk-operations", Bizweb.BulkOperations = function () {
            function r(i, r) {
                this.options = i, this.node = r, this.multiSelectClick = n(this.multiSelectClick, this), this.setMaxWidth = n(this.setMaxWidth, this), this.toggleStickyness = n(this.toggleStickyness, this), this.working = !1, this.multipageSelected = !1, this.selected = {}, this.shouldHideAllSelectedText = !1, this.initializeMultiSelect(), this.$headerRow = $("." + e.HEADER), this.$bulkActions = $("." + e.BASE), this.$selectAllCheckbox = $("." + e.CHECKBOX), this.$parent = this.$bulkActions.closest("." + e.TABLE_WRAPPER), this.$cardSection = this.$bulkActions.closest("." + e.CARD_SECTION + ", ." + e.UI_CARD_SECTION), $(window).on("scroll." + t, _.debounce(this.toggleStickyness, 10)).on("resize." + t, _.debounce(this.toggleStickyness, 10)), Bindings.afterBound(this.setMaxWidth), Page.onReplace(this.node, this.cleanup), Page.onRefresh(this, this.node, function (e) {
                    return function (t) {
                        var i, n;
                        n = t.selected;
                        for (i in e.selected) n[i] && (e.selected[i] = !0);
                        e.tableSelectBoxChanged()
                    }
                }(this))
            }
            return r.prototype.cleanup = function () {
                return $(window).off("." + t)
            }, r.prototype.toggleStickyness = function () {
                var e, t, n, r;
                return t = this.$parent.offset().top, e = t + this.$parent.height() - this.$bulkActions.height(), n = window.pageYOffset + this.$headerRow.outerHeight(), r = n > t && n < e, this.$bulkActions.toggleClass(i.BASE.STICKY, r), this.$selectAllCheckbox.toggleClass(i.CHECKBOX.STICKY, r), this.selfAlignBar(r)
            }, r.prototype.setMaxWidth = function () {
                return this.$bulkActions.width(this.$cardSection.outerWidth())
            }, r.prototype.getCssPropValue = function (e, t) {
                return parseInt(e.css(t).replace(/[^0-9\.]/g, ""), 10)
            }, r.prototype.selfAlignBar = function (e) {
                var t, i, n, r;
                return r = this.$cardSection.outerWidth(), t = this.getCssPropValue(this.$cardSection, "padding-left"), n = parseInt(this.$cardSection.offset().left, 10), e && this.selectedItems().length > 0 ? (i = this.getCssPropValue(this.$selectAllCheckbox, "padding-top"), this.$selectAllCheckbox.css("left", n + i + t + "px"), this.$bulkActions.css("left", n + "px"), this.$bulkActions.css("padding-left", t + "px"), this.$bulkActions.css("width", r)) : (this.$cardSection.css("padding-right"), this.$selectAllCheckbox.css("left", "auto"), this.$bulkActions.css("left", t + "px"), this.$bulkActions.css("padding-left", 0), this.$bulkActions.css("width", r - 2 * t + "px"))
            }, r.prototype.bulkActionChecked = function (e) {
                var t, i;
                i = !!e.checked;
                for (t in this.selected) this.selected[t] = i;
                return this.afterSelectionChange(), i ? this.toggleStickyness() : this.selfAlignBar(i)
            }, r.prototype.selectAll = function () {
                var e;
                for (e in this.selected) this.selected[e] = !0;
                return this.afterSelectionChange()
            }, r.prototype.deselectAll = function () {
                var e;
                for (e in this.selected) this.selected[e] = !1;
                return this.afterSelectionChange()
            }, r.prototype.allSelected = function () {
                var e;
                return 0 !== (e = _.size(this.selected)) && e === this.countSelected()
            }, r.prototype.noneSelected = function () {
                return 0 === this.countSelected()
            }, r.prototype.selectedItems = function () {
                var e, t, i;
                t = this.selected, i = [];
                for (e in t) t[e] && i.push(e);
                return i
            }, r.prototype.countSelected = function () {
                return _.size(this.selectedItems())
            }, r.prototype.multipageSelectAllItems = function () {
                return this.multipageSelected = !0
            }, r.prototype.afterSelectionChange = function () {
                this.multipageSelected = !1, this.tableSelectBoxChanged()
            }, r.prototype.clearMultipageSelection = function () {
                this.multipageSelected = !1
            }, r.prototype.tableSelectBoxChanged = function () {
                var e, t, i, n;
                return t = $(this.node), e = t.find("th.select input"), n = _.size(this.selected), i = this.countSelected(), i > 0 ? i < n ? e.prop("checked", !1).prop("indeterminate", !0) : e.prop("checked", !0).prop("indeterminate", !1) : e.prop("checked", !1).prop("indeterminate", !1), this.$selectAllCheckbox.blur()
            }, r.prototype.selectionChanged = function () {
                return this.afterSelectionChange(), this.toggleStickyness()
            }, r.prototype.appLink = function (e) {
                return "" + e + this.selectedItems().map(function (e) {
                    return "&ids%5B%5D=" + e
                }).join("")
            }, r.prototype.selectedItemsString = function (e) {
                var t, i;
                return t = this.multipageSelected ? this.countSelected() + "+" : this.countSelected(),
                    i = Bizweb.Inflection.humanize(e), Bizweb.Inflection.pluralizeWithCount(t, i, i)
            }, r.prototype.inflectOnCountSelected = function (e, t) {
                return Bizweb.Inflection.pluralize(this.countSelected(), e, t)
            }, r.prototype.startWorking = function () {
                return this.working = !0, Bizweb.UIPopover.deactivate(), Bizweb.Loading.start()
            }, r.prototype.stopWorking = function () {
                return this.working = !1, Bizweb.Loading.stop()
            }, r.prototype.isWorking = function () {
                return this.working
            }, r.prototype.hasSearch = function () {
                return "" !== window.location.search
            }, r.prototype.initializeMultiSelect = function () {
                return this.lastChecked = null, this.$items = $(this.node).find(".select input[type=checkbox]"), this.$items.on("click", this.multiSelectClick)
            }, r.prototype.multiSelectClick = function (e) {
                var t, i, n, r, o, s, a;
                if (!this.lastChecked) return void (this.lastChecked = e.target);
                if (e.shiftKey) {
                    for (a = this.$items.index(e.target), t = this.$items.index(this.lastChecked), s = this.$items.slice(Math.min(a, t), Math.max(a, t) + 1), i = r = 0, o = s.length; r < o; i = ++r) n = s[i], this.selected[n.value] = this.lastChecked.checked;
                    this.afterSelectionChange()
                }
                return this.lastChecked = e.target
            }, r.prototype.perform = function (e, t, i) {
                var n;
                null == i && (i = {}), n = {
                    operation: e
                }, n[this.options.parameterName] = this.selectedItems(),
                null != t && (n.value = t),
                this.multipageSelected && (n.multipage_select = !0),
                n.search = Bizweb.UrlMangler.parseSearchString(window.location.search), this.startWorking(),
                  that = this;
                e = $.ajax({
                    url: this.options.path,
                    type: "PUT",
                    data: n,
                    dataType: "json"
                }), e.done(function (e) {
                    return function () {
                        return !1 !== i.closeModal && Bizweb.Modal.hide(), "function" == typeof i.onSuccess && i.onSuccess(), e.stopWorking(),
                            Page.refresh(e.options.refresh ? {
                                onlyKeys: e.options.refresh
                            } : void 0, function () { that.deselectAll() })
                    }
                }(this)), e.fail(function (e) {
                    return function () {
                        return !1 !== i.closeModal && Bizweb.Modal.hide(), Bizweb.handleJsonError.apply(e, arguments), e.stopWorking(), Bindings.refresh()
                    }
                }(this))
            }, r
        }()
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        },
            t = [].indexOf || function (e) {
                for (var t = 0, n = this.length; t < n; t++)
                    if (t in this && this[t] === e) return t;
                return -1
            };
        Bizweb.CollectionProducts = function () {
            function n(t, n, i, r, o) {
                this.sortOrder = n, this.collectionId = i,
                this.type = r, this.pageSize = o,
                this._refreshProductsList = e(this._refreshProductsList, this),
                this.submitNewSortOrder = e(this.submitNewSortOrder, this),
                this.eventBus = $(t), this.originalPageSize = this.pageSize,
                this.loadedProductIds = [],
                this.eventBus.on("value:added", function (e) {
                    return function (t, n) {
                        return e.addProduct(n.id, n.init)
                    }
                }(this)), this.eventBus.on("value:removed", function (e) {
                    return function (t, n) {
                        return e.removeProduct(n.id)
                    }
                }(this)), this.debouncedRefreshProductList = _.debounce(this._refreshProductsList, 1e3), this._resetProductsAddedRemovedCount()
            }
            return n.prototype.REFRESH_KEYS = ["collection_products"], n.prototype.LARGE_PAGE_SIZE = 250, n.prototype.updateLoadedProductIds = function (e) {
                if (e) return this.loadedProductIds = _.uniq(_.merge(this.loadedProductIds, e))
            }, n.prototype.addProduct = function (e, init) {
                if (init) {
                    return;
                }
                var t;
                var data = {
                    collect: {
                        collection_id: this.collectionId,
                        product_id: e
                    }
                };
                if (!this.productSelected(e)) return this.loadedProductIds.push(e), Bizweb.Loading.start(), t = $.ajax({
                    url: "/admin/collects.json",
                    dataType: "json",
                    type: "POST",
                    data: JSON.stringify(data),
                    contentType: "application/json"
                }), t.success(function (t) {
                    return function () {
                        return t._afterProductAdded(e), t.debouncedRefreshProductList()
                    }
                }(this)), t.fail(function () {
                    return Bizweb.Loading.stop(), Bizweb.Flash.notice("There was an error adding the product to this collection")
                })
            }, n.prototype.removeProductOnClick = function (e) {
                return this.eventBus.trigger("value:removed", {
                    id: e
                })
            },
             n.prototype._updateIndexAfterDragging = function (e) {
                 return $(e.children).each(function (e, t) {
                     return $(t).find(".collection_item_enumeration").text(e + 1 + ".")
                 })
             }, n.prototype.removeProduct = function (e) {
                 var t, n;
                 if (!((t = this.loadedProductIds.indexOf(e)) < 0)) return this.loadedProductIds.splice(t, 1), Bizweb.Loading.start(), n = $.ajax({
                     url: "/admin/collects/" + e + "-" + this.collectionId + ".json",
                     type: "DELETE",
                     contentType: "application/json"
                 }), n.success(function (t) {
                     return function () {
                         return t._afterProductRemoved(e), t.debouncedRefreshProductList()
                     }
                 }(this)), n.fail(function (a) {
                     return console.log(a), Bizweb.Loading.stop(), Bizweb.Flash.notice("There was an error removing the product from this collection")
                 })
             },
             n.prototype.upToFistPosition = function (productId) {
                 if (this.sortOrder != "manual") {
                     return;
                 }
                 var n;
                 Bizweb.Loading.start(), n = $.ajax({
                     url: Bizweb.routes.collections + "/" + this.collectionId + "/push_top.json?product_id=" + productId,
                     type: "POST",
                     contentType: "application/json"
                 }), n.success(function (t) {
                     return function () {
                         return Bizweb.Flash.notice("Cập nhật thành công"), t.debouncedRefreshProductList()
                     }
                 }(this)), n.fail(function (a) {
                     return console.log(a), Bizweb.Loading.stop(), Bizweb.Flash.notice("There was an error removing the product from this collection")
                 })
             }, n.prototype.productSelected = function (e) {
                 return t.call(this.loadedProductIds, e) >= 0
             }, n.prototype.updateSortOrder = function () {
                 var e, t, y;
                 return Bizweb.Loading.start(), e = {}, y = { sort_order: this.sortOrder }, this.type == "smart_collection" ? e.smart_collection = y : e.custom_collection = y, t = $.ajax({
                     url: "/admin/" + this.type + "s/" + this.collectionId + ".json",
                     dataType: "json",
                     type: "PUT",
                     data: JSON.stringify(e),
                     contentType: "application/json"
                 }), t.success(function (e) {
                     return function () {
                         return e._refreshProductsList("Cập nhật danh mục thành công")
                     }
                 }(this)), t.fail(function () {
                     return Bizweb.Loading.stop(), Bizweb.Flash.notice("There was an error updating the collection order")
                 })
             },
             n.prototype.makeProductsSortable = function () {
                 if ("manual" === this.sortOrder)
                     return $("#collection-products-table").sortable({
                         handle: ".ui-sortable__handle",
                         placeholder: "ui-sortable__placeholder",
                         update: this.submitNewSortOrder.bind(this),
                         distance: 0,
                         start: function (e, t) {
                             return t.item.startIndex = t.item.index(),
                             t.placeholder.html(t.item.html())
                         },
                         helper: function (e, t) {
                             var n, i, r, o, a, s, u, l;
                             for (l = t[0],
                             s = l.getElementsByClassName("ui-sortable__item"),
                             i = l.cloneNode(!0),
                             i.style.width = "auto",
                             u = i.getElementsByClassName("ui-sortable__item"),
                             r = o = 0,
                             a = u.length; o < a; r = ++o)
                                 n = u[r],
                                 n.style.width = s[r].offsetWidth + "px";
                             return i
                         },
                         stop: function (e) {
                             return function (t, n) {
                                 return e._updateIndexAfterDragging(t.target),
                                 n.item.addClass("flash-highlight"),
                                 n.item.one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd", function () {
                                     return n.item.removeClass("flash-highlight")
                                 })
                             }
                         }(this)
                     })
             }, n.prototype.submitNewSortOrder = function (e, t) {
                 var ajax;
                 return ajax = $.ajax({
                     url: "/admin/collections/" + this.collectionId + "/order.json",
                     type: "PUT",
                     data: $("#collection-products-table").sortable("serialize", {
                         key: "products[]"
                     }) + "&sort_order=manual&page_size=" + this.pageSize + "&from_index=" + t.item.startIndex + "&to_index=" + t.item.index()
                 }), ajax.success(function () {
                     return Bizweb.Flash.notice("Sắp xếp thành công")
                 }),
                     ajax.fail(function () {
                         return Bizweb.Flash.notice("Sắp xếp thất bại")
                     })
             }, n.prototype.showMoreProducts = function (e, t, n, i) {
                 var r, o, a, s;
                 return Bizweb.Loading.start(),
                 this.loadingMoreProducts = !0,
                 s = "/admin/collections/" + this.collectionId + "/products_list",
                 o = $("#" + t),
                 r = $("#" + n),
                 a = $.ajax({
                     url: s,
                     dataType: "html",
                     type: "GET",
                     data: i || _.merge({}, this.nextPageParams, {
                         limit: this.LARGE_PAGE_SIZE
                     })
                 }),
                 a.done(function (e) {
                     return function (t, i, a) {
                         var s, u, l, c, d, h, p, f;
                         for (e.loadingMoreProducts = !1,
                         e.pageSize = e.pageSize < e.LARGE_PAGE_SIZE ? e.LARGE_PAGE_SIZE : e.pageSize + e.LARGE_PAGE_SIZE,
                         u = $(t).find("table").children(),
                         s = $(t).find("#" + n),
                         c = Bindings.context(o[0]),
                         d = 0,
                         p = u.length; d < p; d++)
                             l = u[d],
                             Bindings.bind(l, c);
                         return Bindings.bind(s[0], Bindings.context(r[0])),
                         r.html(s),
                         h = o.find(".collection_item_enumeration").last(),
                         h && (f = Number($(h).text()),
                         u.each(function (e, t) {
                             return $(t).find(".collection_item_enumeration").text(f + e + 1 + ".")
                         })),
                         Page.refresh({
                             response: a,
                             onlyKeys: ["next-product-page-params"]
                         }),
                         o.append(u),
                         null != e.nextPageParams && (e.title = "Hiện thêm " + e.LARGE_PAGE_SIZE + " sản phẩm"),
                          e.refreshTooltip(),
                         Bizweb.Loading.stop()

                     }
                 }(this)),
                 a.fail(function (e) {
                     return function () {
                         return e.loadingMoreProducts = !1,
                         Bizweb.Loading.stop(),
                         Bizweb.Flash.error("There was an error retrieving more products")
                     }
                 }(this))
             },
            n.prototype.refreshTooltip = function () {
                $("#collection-products-table").find(".tooltip").off("mouseenter").off("mouseleave").hover(function () {
                    $(this).toggleClass('is-active');
                })
            },
            n.prototype._afterProductAdded = function (e) {
                return this.productsAdded[e] = !0, delete this.productsRemoved[e]
            }, n.prototype._afterProductRemoved = function (e) {
                return this.productsRemoved[e] = !0, delete this.productsAdded[e]
            }, n.prototype._resetProductsAddedRemovedCount = function () {
                return this.productsAdded = {}, this.productsRemoved = {}
            }, n.prototype._refreshProductsList = function (e) {
                var t, n;
                return this.pageSize >= this.LARGE_PAGE_SIZE ? (this.pageSize = this.LARGE_PAGE_SIZE, t = {
                    limit: this.LARGE_PAGE_SIZE
                }) : (this.pageSize = this.originalPageSize, t = {}), n = $.ajax({
                    type: "GET",
                    url: "/admin/collections/" + this.collectionId,
                    data: t,
                    dataType: "html"
                }), n.always(function () {
                    return Bizweb.Loading.stop()
                }), n.done(function (t) {
                    return function (n, i, r) {
                        return Page.refresh({
                            response: r,
                            onlyKeys: t.REFRESH_KEYS
                        }, function () {
                            return e || (e = t._collectionAddRemoveMessage()), e && Bizweb.Flash.notice(e), t._resetProductsAddedRemovedCount()
                        })
                    }
                }(this))
            }, n.prototype._collectionAddRemoveMessage = function () {
                var e;
                return e = [], _.size(this.productsAdded) > 0 && e.push("Đã thêm " + _.size(this.productsAdded) + " sản phẩm"), _.size(this.productsRemoved) > 0 && e.push("Đã xóa " + _.size(this.productsRemoved) + " sản phẩm"), e.join(" và ")
            }, n
        }()
    }.call(this),
    function () {
        var e, t, n, i, r, o, a, s, u;
        i = !1, e = {
            DRAG_ENTER: "page-drop-zone:drag-enter",
            DRAG_OVER: "page-drop-zone:drag-over",
            DRAG_LEAVE: "page-drop-zone:drag-leave",
            DROP: "page-drop-zone:drop"
        }, r = function (e) {
            var t, n;
            return (null != (t = e.originalEvent.dataTransfer) && null != (n = t.types[0]) ? n.toLowerCase().indexOf("file") : void 0) >= 0
        }, t = function (e, t) {
            if (r(e)) return e.stopPropagation(), e.preventDefault(), t()
        }, o = function () {
            if (!i) return Bizweb.rootDispatcher.dispatch({
                type: e.DRAG_ENTER
            }), i = !0
        }, a = function () {
            return Bizweb.rootDispatcher.dispatch({
                type: e.DRAG_OVER
            })
        }, u = function () {
            if (i) return i = !1, Bizweb.rootDispatcher.dispatch({
                type: e.DRAG_LEAVE
            })
        }, s = function () {
            return i = !1, Bizweb.rootDispatcher.dispatch({
                type: e.DROP
            })
        }, n = function (e) {
            return null == e && (e = document), $(e).on("dragenter", function (e) {
                return t(e, o)
            }), $(e).on("dragover", function (e) {
                return t(e, a)
            }), $(e).on("drop", function (e) {
                return t(e, s)
            }), $(e).on("mouseleave", u)
        },
        window.Bizweb.PageDropZone = {
            EVENTS: e,
            initialize: n
        }
    }.call(this),
    function () {
        document.addEventListener("input", function (e) {
            if ("hidden" === e.target.type) return e.preventDefault(), e.stopPropagation()
        }, !0), $(document).on("turbograft:remote:init", function (e) {
            var t;
            if (t = $(e.originalEvent.data.initiator), t.hasClass("js-btn-loadable")) return t.addClass("is-loading disabled")
        }), $(document).on("turbograft:remote:success", function (e) {
            var t;
            return t = $(e.originalEvent.data.initiator), t.hasClass("js-btn-loadable") && t.removeClass("is-loading disabled"), t.trigger("success")
        }), $(document).on("turbograft:remote:fail", function (e) {
            var t;
            return t = $(e.originalEvent.data.initiator), t.hasClass("js-btn-loadable") && t.removeClass("is-loading disabled"), t.trigger("fail")
        }), $(document).on("turbograft:remote:always", function (e) {
            var t;
            return t = $(e.originalEvent.data.initiator), t.trigger("done", e.originalEvent.data.xhr.responseText)
        }), $(function () {
            var e;
            return e = $(document), Bizweb.PageDropZone.initialize(document), e.on("click", "a.disabled, a.btn-disabled", function (e) {
                e.preventDefault()
            }), e.on("click", ".select", function (e) {
                var t, n;
                n = e.target, "input" !== (null != (t = n.tagName) ? t.toLowerCase() : void 0) && $(this).children('input[type="checkbox"]:first:visible').click()
            }), e.on("click", "[data-highlight]", function () {
                return document.execCommand("selectAll", !1, null)
            })
        })
    }.call(this),
    function () {
        var e = function (e, i) {
            function n() {
                this.constructor = e
            }
            for (var r in i) t.call(i, r) && (e[r] = i[r]);
            return n.prototype = i.prototype, e.prototype = new n, e.__super__ = i.prototype, e
        },
            t = {}.hasOwnProperty;
        Bizweb.ForceDirtyStateForm = function (t) {
            function i(e, t, n) {
                var r;
                this.initiallyDirty = t, null == n && (n = {}), this.canEnableButtons = null == (r = n.canEnableButtons) || r, i.__super__.constructor.call(this, e, n), Bizweb.Forms._dirtyForm = this.initiallyDirty
            }
            return e(i, t), i.prototype.makeDirty = function () {
                if (Bizweb.Forms._dirtyForm = !0, this.canEnableButtons) return this.$primaryButtons.addClass("btn-primary"), this.$primaryButtons.removeClass("btn-disabled").removeAttr("disabled")
            }, i.prototype.makeClean = function () {
                if (!this.initiallyDirty) return Bizweb.Forms._dirtyForm = !1, this.$primaryButtons.removeClass("btn-primary"), this.$primaryButtons.addClass("btn-disabled").attr("disabled", "disabled")
            }, i
        }(Bizweb.Forms)
    }.call(this),
    function () {
        var e, t, n, i, r, o, a = [].slice;
        t = {
            TUTORIAL: ".js-tutorial-scroll",
            ERROR_BANNER: ".ui-banner--status-critical",
            ERROR_LIST: "#errors-list",
            ERROR_NOTICE: ".next-notice--critical",
            ERROR_BOX: ".box.errors",
            SUCCESS: ".ui-banner--status-success"
        }, e = "data-notice-announced", n = function () {
            var e, n;
            return n = Object.keys(t).map(function (e) {
                return t[e]
            }).join(", "), e = $(n).filter(function (e, t) {
                return !$(t).children(":first-child").is(":empty")
            }), e.attr({
                tabindex: -1,
                role: "alert"
            })
        }, i = function (e) {
            return Object.keys(t).map(function (n) {
                return e.filter(t[n]).first()
            }).filter(function (e) {
                return e.length
            }).shift()
        }, Bizweb.NoticeFocus = {
            send: function () {
                var e, t, n;
                return t = arguments[0], e = 2 <= arguments.length ? a.call(arguments, 1) : [], e.length ? null != (n = o[t]) ? n.apply(null, e) : void 0 : o[t]
            }
        }, o = {
            a11yNotices: n,
            getHighestPriorityNotice: i
        }, r = function (e) {
            var t, n;
            return n = e.offset(), t = $(window).height() / 2, $("html, body").animate({
                scrollTop: n.top - t
            }, 800)
        },
        $(document).on("ready page:load", function () {
            var o, a, test;
            if (o = n(), o.length) {
                a = i(o);
                test = a.attr(e);
                if (test) return;
                return setTimeout(function () {
                    return a.attr(e, !0), a.is(t.TUTORIAL) && r(a), a.focus()
                }, 1e3)
            }
        })
    }.call(this),
    function () {
        Bizweb.CommentOperations = function () {
            function e(e) {
                var t;
                this.refreshKeys = e, t = Bizweb.UrlMangler.parseSearchString(window.location.search).hideSpam, this.hideSpam = null == t || "true" === t
            }
            return e.prototype.toggleSpam = function () {
                return this.hideSpam = !this.hideSpam, Page.refresh({
                    queryParams: {
                        hideSpam: this.hideSpam ? "true" : "false"
                    },
                    onlyKeys: ["comments"]
                })
            }, e.prototype.perform = function (e, t) {
                var i;
                return i = $.ajax({
                    url: "/admin/comments/" + e + "/" + t,
                    type: "POST",
                    dataType: "json"
                }), i.done(function (e) {
                    return function () {
                        return Bizweb.Modal.hide(), Page.refresh({
                            onlyKeys: e.refreshKeys
                        })
                    }
                }(this)), i.fail(Bizweb.handleError)
            }, e
        }()
    }.call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        Bizweb.ContentEditor = function () {
            function ContentEditor(node, options) {
                this.options = null != options ? options : {};
                this.node = node;
                this.contentInput = $(this.node).find('textarea').get(0);

                this.onReplace = e(this.onReplace, this);
                this.initialize = e(this.initialize, this);

                Page.onReplace(this.contentInput, this.onReplace);

                this.initialize();
            }

            ContentEditor.prototype.onReplace = function () {
                try {
                    this.editor.destroy();
                }
                catch (e) {
                    console.log(e);
                }
            }

            ContentEditor.prototype.initialize = function () {
                var currentInstance = this;
                var textArea = $(this.contentInput);

                textArea.ckeditor();
                this.editor = textArea.ckeditorGet();
                $(document).one("page:before-replace", function () {
                    return textArea.off();
                });
                this.editor.on("instanceReady", function (ev) {
                    var blockTags = ['div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'pre', 'li', 'blockquote', 'ul', 'ol', 'table', 'thead', 'tbody', 'tfoot', 'td', 'th'];

                    for (var i = 0; i < blockTags.length; i++) {
                        ev.editor.dataProcessor.writer.setRules(blockTags[i], {
                            indent: false,
                            breakBeforeOpen: true,
                            breakAfterOpen: false,
                            breakBeforeClose: false,
                            breakAfterClose: false
                        });
                    }

                    this.on("key", _.debounce(function (ev) {
                        return currentInstance.updateValue(currentInstance.editor.getData());
                    }, 300));

                    //$(currentInstance.contentInput).trigger(Bizweb.Forms.RTE_INITIALIZED_EVENT);
                    try {
                        currentInstance.updateValue(this.getData());
                    }
                    catch (e) {
                        console.log(e)
                    }

                    Bindings.refresh();
                });
            }

            ContentEditor.prototype.updateValue = function (cValue) {
                if (typeof this.options.resource === undefined || this.options.resource == null) {
                    this.options.resource = Bindings.context(document.body)[this.options.resource_name];
                }
                return this.options.resource && (this.options.resource[this.options.key] = Bizweb.HTML.unsafeStripWithoutNbsp(cValue).replace(/(\r?\n|\r)/gm, ' ').trim()), Bindings.refresh();
            }

            return ContentEditor;
        }();
    }.call(this),
    function () {
        Bizweb.MenuItemDropDown = function () {
            function MenuItemDropDown(element, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = element;
                this.$ele = $(element);
                this.form = Bindings.context(document.body)[this.form_name];

                this.init();
                this.timer = null;
                this.request = null;
                this.isLoaded = false;
            };

            MenuItemDropDown.checkFocus = function (e) {
                var clickedElement = $(e.target);
                if (clickedElement.closest(".single-dropdown").length == 0 && clickedElement.parent(".dropdown-toggle").length == 0) {
                    MenuItemDropDown.closeAllOpenDropdown();
                }
            }

            MenuItemDropDown.closeAllOpenDropdown = function () {
                $(".single-dropdown.is-visible").removeClass("is-visible");
            }

            MenuItemDropDown.prototype.dropdown = function (ev) {
                MenuItemDropDown.closeAllOpenDropdown();

                ev.preventDefault();
                var that = this;
                if (!this.isLoaded) {
                    $.ajax({
                        type: "GET",
                        url: _urlMappings[this.type],
                        success: function (data) {
                            that.isLoaded = true;
                            that.$ele.append(data);
                            Bindings.bind(that.$ele.find(".single-dropdown").get(0), that);

                            Bindings.refresh();
                        },
                        error: function (error) {
                        },
                        complete: function () {
                            that.$ele.find(".single-dropdown").toggleClass('is-visible');
                        }
                    });
                } else {
                    this.$ele.find(".single-dropdown").toggleClass('is-visible');
                }
            }

            MenuItemDropDown.prototype.suggest = function () {
                var that = this;
                var query = this.$ele.find(".single-query").val();
                var url = _urlSuggestMappings[this.type] + "?query=" + query;
                this.page = 1;

                if (this.timer != null) {
                    clearTimeout(this.timer);
                }

                this.timer = setTimeout(function () {
                    if (this.request != null) {
                        this.request.abort();
                    }
                    this.request = $.ajax({
                        url: url,
                        type: "GET",
                        success: function (data) {
                            that.$ele.find(".single-suggest-result").html(data);
                            Bindings.bind(that.$ele.find(".single-dropdown").get(0), that);
                        }
                    });
                }, 1000);
            }

            MenuItemDropDown.prototype.toggle = function (id, name, alias) {
                if (this.valueType === "alias") {
                    this.$ele.find("[type='hidden']").val(alias);
                }
                else {
                    this.$ele.find(".single-dropdown-select-id").val(id);
                }

                this.$ele.find(".choosed-single").html(name);
                this.$ele.find(".single-dropdown-select-name").val(name);

                this.hideDropdown();

                this.form._updateDirtyState();
            }

            MenuItemDropDown.prototype.hideDropdown = function () {
                if (this.$ele.find(".single-dropdown").hasClass('is-visible')) {
                    this.$ele.find(".single-dropdown").removeClass('is-visible');
                }
            }

            MenuItemDropDown.prototype.init = function () {
                var itemName = $(this.element).find(".choosed-single").html();
                if (itemName) {
                    $(this.element).find(".choosed-single").html(this.itemName);
                }
            }

            MenuItemDropDown.prototype.next = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.type] + "?query=" + query;
                this.page = this.page + 1;
                this.next_page = url + "&page=" + (this.page);
                this.loadUrl(this.next_page);
            }

            MenuItemDropDown.prototype.prev = function () {
                var query = $(this.element).find(".single-query").val();
                var url = _urlSuggestMappings[this.type] + "?query=" + query;
                this.page = this.page - 1;
                this.prev_page = url + "&page=" + (this.page);
                this.loadUrl(this.prev_page);
            }

            MenuItemDropDown.prototype.loadUrl = function (url) {
                var that = this;
                $.ajax({
                    url: url,
                    success: function (data) {
                        that.$ele.find(".single-suggest-result").html(data);
                        Bindings.bind(that.$ele.find(".single-dropdown").get(0), that);
                    }
                });
            }

            return MenuItemDropDown;
        }();
    }.call(this);

    (function () {
        Bizweb.ChannelsActivationFunnel = function () {
            function e() { }
            return e.FUNNEL_NAME = "channel-activation-flow", e.VERSION = 5, e._renameChannel = function (e) {
                return e.replace(/\s+/g, "-").toLowerCase()
            }, e.channelsToPublish = function () {
                return $(".next-input-wrapper").filter(function () {
                    return "true" === $(this).children("#product_publications__published").val()
                }).find($(".next-label")).map(function () {
                    return $(this).text()
                })
            }, e.track = function (t) {
                var n, i;
                return null == t && (t = {}), n = {
                    funnel: e.FUNNEL_NAME,
                    version: e.VERSION
                }, t = $.extend(t, n), null != (i = window.analytics) ? i.track("insta_funnel", t) : void 0
            }, e.openChannelsModal = function (e) {
                return this.track({
                    step: "open-channels-modal-from-" + e,
                    depth: 1
                })
            }, e.channelsModalOpened = function () {
                return this.track({
                    step: "channels-modal-opened",
                    depth: 2
                })
            }, e.clickViewDetails = function (e) {
                var t;
                return t = this._renameChannel(e), this.track({
                    step: "click-view-details-" + t,
                    depth: 3
                })
            }, e.clickEligibilityReason = function (e) {
                return this.track({
                    step: "click-ineligibility-reason-" + e,
                    depth: 4
                })
            }, e.clickLearnMore = function (e) {
                var t;
                return t = this._renameChannel(e), this.track({
                    step: "click-learn-more-" + t,
                    depth: 5
                })
            }, e.clickAddChannelModal = function (e) {
                var t;
                return t = this._renameChannel(e), this.track({
                    step: "click-add-channel-" + t,
                    depth: 6
                })
            }, e.clickIndexAddChannelModal = function (e) {
                var t;
                return t = this._renameChannel(e), this.track({
                    step: "click-add-channel-from-index-" + t,
                    depth: 6
                })
            }, e.clickPublishProductOnChannel = function (e) {
                var t, n, i, r;
                for (r = [], n = 0, i = e.length; n < i; n++) t = e[n], r.push(this.track({
                    step: "click-publish-product-on-" + this._renameChannel(t),
                    depth: 7
                }));
                return r
            }, e
        }()
    }).call(this),
    function () {
        var e = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        Bizweb.AddChannelModal = function () {
            function t(t) {
                this.nodes = t, this._teardown = e(this._teardown, this), this._setup = e(this._setup, this), Bizweb.rootDispatcher.register(Bizweb.UIModal.EVENTS.SHOW, function (e) {
                    return function (t) {
                        return e._setup(t)
                    }
                }(this)), Bizweb.rootDispatcher.register(Bizweb.UIModal.EVENTS.HIDE, function (e) {
                    return function (t) {
                        return e._teardown(t)
                    }
                }(this)), this._setup()

                if (this.state) {
                    this.state.showSecondary = !1;
                }
            }
            return t.prototype.CLASSES = {
                detailsNodeIsActive: "is-active",
                primaryContent: "add-channel-modal__content--primary",
                secondaryContent: "add-channel-modal__content--secondary"
            }, t.prototype.FOCUSABLE_ELEMENTS = ["a", "area", "button", "iframe", "input", "select", "textarea"], t.prototype.nodes = {
                addChannelForm: null,
                addChannelSuccessCallback: null,
                container: null,
                modalBodies: {
                    primary: null,
                    secondary: null
                },
                parent: null
            }, t.prototype.state = {
                activeDetailsNode: null,
                selectedChannel: {
                    disabled: !1,
                    installPath: null,
                    addSuccessRedirectPath: null,
                    providerName: null,
                    title: "",
                    alias: ""
                },
                showSecondary: !1
            }, t.prototype.hideDetails = function () {
                return this.loadImages("." + this.CLASSES.primaryContent), this.state.showSecondary = !1, this._toggleFocusableElements(null, "." + this.CLASSES.primaryContent), this._toggleFocusableElements(-1, "." + this.CLASSES.secondaryContent)
            }, t.prototype.loadImages = function (e) {
                var t, n, i, r, o, a;
                for (r = e + " img", i = this.nodes.parent.querySelectorAll(r), a = [], t = 0, o = i.length; t < o; t++) n = i[t], n.dataset.src && (n.src = n.dataset.src), a.push(delete n.dataset.src);
                return a
            }, t.prototype.showDetails = function (e) {
                var t;
                return !!(t = this.nodes.parent.querySelector(e)) && (this.loadImages(e), this.state.selectedChannel = _.pick(t.dataset, ["disabled", "installPath", "addSuccessRedirectPath", "providerName", "title", "alias"]), this._updateAddChannelForm(), this._setActiveDetailsNode(t), this._toggleFocusableElements(-1, "." + this.CLASSES.primaryContent), this._toggleFocusableElements(null, "." + this.CLASSES.secondaryContent), this.state.showSecondary = !0, this.state.selectedChannel.disabled ? Bizweb.ChannelsActivationFunnel.clickViewDetails(this.state.selectedChannel.providerName) : Bizweb.ChannelsActivationFunnel.clickLearnMore(this.state.selectedChannel.providerName))
            }, t.prototype.addChannelFromIndex = function (e) {
                var t;
                return t = this.nodes.parent.querySelector(e), this.state.selectedChannel = _.pick(t.dataset, ["providerName"]), this.trackAddChannel()
            }, t.prototype.trackAddChannel = function (e) {
                return null == e && (e = ""), "index" === e ? Bizweb.ChannelsActivationFunnel.clickIndexAddChannelModal(this.state.selectedChannel.providerName) : Bizweb.ChannelsActivationFunnel.clickAddChannelModal(this.state.selectedChannel.providerName)
            }, t.prototype._setup = function (e) {
                var t, n, i, r, o, a, s;
                for (null == e && (e = null), a = Bizweb.UrlMangler.parseSearchString(window.location.search), a && a.highlight && "true" === this.nodes.container.dataset.startVisible ? (this.showDetails("#AddChannelModalChannel" + Bizweb.String.pascalCase(a.highlight)) || this.loadImages("." + this.CLASSES.primaryContent), this.nodes.modalBodies.primary.addEventListener("transitionend", function (e) {
                        return function () {
                            return e.nodes.container.dataset.startVisible = "false"
                }
                }(this))) : this.nodes.container.classList.contains("ui-modal--is-visible") && (this.loadImages("." + this.CLASSES.primaryContent), this._toggleFocusableElements(-1, "." + this.CLASSES.secondaryContent)), i = {}, s = document.querySelectorAll("[data-collapsible]"), r = 0, o = s.length; r < o; r++) t = s[r], n = t.id, n ? i[n] = new Bizweb.Collapsible(t) : console.log("This collapsible has been rejected because of mising ID");
                return Bizweb.ChannelsActivationFunnel.channelsModalOpened()
            }, t.prototype._teardown = function (e) {
                if (e.data.id === this.nodes.container.id) return this.hideDetails()
            }, t.prototype._setActiveDetailsNode = function (e) {
                return this.state.activeDetailsNode && this.state.activeDetailsNode.classList.remove(this.CLASSES.detailsNodeIsActive), this.state.activeDetailsNode = e, this.state.activeDetailsNode && this.state.activeDetailsNode.classList.add(this.CLASSES.detailsNodeIsActive), this.nodes.modalBodies.secondary.scrollTop = 0
            }, t.prototype._toggleFocusableElements = function (e, t) {
                var n, i, r, o, a;
                for (a = this.FOCUSABLE_ELEMENTS.map(function (e) {
                        return t + " " + e
                }).join(", "), o = document.querySelectorAll(a), n = 0, i = o.length; n < i; n++) r = o[n], e ? r.tabIndex = e : r.removeAttribute("tabindex");
                return this.nodes.container.focus()
            }, t.prototype._updateAddChannelForm = function () {
                return this.nodes.addChannelForm.action = this.state.selectedChannel.installPath, this.nodes.addChannelSuccessCallback.value = this.state.selectedChannel.addSuccessRedirectPath
            }, t
        }()
    }.call(this),
    function () {
        var r = "js-clipboard";
        function initClipboardNodes() {
            var e = document.querySelectorAll("." + r),
                t = [];
            return Array.from(e).forEach(function (e) {
                var i = initClipboard(e);
                t.push(i)
            }), t
        }

        function initClipboard(e) {
            var t = new Clipboard(e);
            return t.on("success", function () {
                Bizweb.Flash.notice("Copy thành công")
            }), t.on("error", function () {
                Bizweb.Flash.notice("Copy thất bại. Vui lòng thử lại.")
            }), t
        }

        document.addEventListener("DOMContentLoaded", function () {
            return (0, initClipboardNodes)()
        }), document.addEventListener("page:load", function () {
            return (0, initClipboardNodes)()
        })
    }.call(this);

    (function () {
        var e, t, i, n, a, o, s, r, l, u, h = function (e, t) {
            return function () {
                return e.apply(t, arguments)
            }
        };
        e = {
            TYPE: "data-collapsible",
            STATE: "data-collapsible-state",
            MAX_WIDTH: "data-collapsible-maxwidth",
            HIDDEN: "aria-hidden",
            BTN: {
                TARGET: "data-collapsible-target",
                EXPANDED: "aria-expanded",
                TEXT: {
                    EXPANDED: "data-collapsible-text--expanded",
                    COLLAPSED: "data-collapsible-text--collapsed"
                },
                ICON: {
                    EXPANDED: "data-collapsible-icon--expanded",
                    COLLAPSED: "data-collapsible-icon--collapsed"
                }
            }
        }, t = {
            BTN: {
                TEXT: "btn__text",
                ICON: "icon"
            }
        }, n = "collapsible:collapsed", a = "collapsible:expanded", s = {}, l = function (e) {
            return s[e.id]
        }, o = {}, r = function (t) {
            return o[t.getAttribute(e.BTN.TARGET)]
        }, Bizweb.Collapsible = function () {
            function t(t) {
                var i;
                this.node = t, this._finishTransition = h(this._finishTransition, this), this._getHeight = h(this._getHeight, this), this.node, this.id = this.node.id, this.id && (this.collapsed = "collapsed" === this.node.getAttribute(e.STATE), this.dismissible = "dismissible" === this.node.getAttribute(e.TYPE), i = this.node.getAttribute(e.MAX_WIDTH), this.maxwidth = i ? parseInt(i, 10) : void 0, this.activator = null, this._pairActivator(), this._toggleAtWidth(), this._trackWidthResize())
            }
            return t.DISPATCHER_COLLAPSED_ACTION = n, t.DISPATCHER_EXPANDED_ACTION = a, t._collapsibleRefs = s, t.getCollapsibleRefForNode = l, t._activatorRefs = o, t.getActivatorForNode = r, t.prototype.toggle = function (e) {
                return null == e && (e = !0), this.collapsed ? this.expand(e) : this.collapse(e)
            }, t.prototype.expand = function (t) {
                return null == t && (t = !0), this.collapsed ? (this.activator && this.activator.expand(), t ? (this.node.addEventListener("transitionend", this._finishTransition), this.node.classList.add("collapsible--has-transition"), this.node.style.height = this._getHeight(), this.node.offsetHeight, requestAnimationFrame(function (t) {
                    return function () {
                        return t.collapsed = !1, t.node.setAttribute(e.STATE, "expanded"), t.node.setAttribute(e.HIDDEN, "false"), Bizweb.rootDispatcher.dispatch(t._generateTransitionEvent())
                    }
                }(this))) : (this.collapsed = !1, this.node.setAttribute(e.STATE, "expanded"), this.node.setAttribute(e.HIDDEN, "false"), this.activator.ready = !0, Bizweb.rootDispatcher.dispatch(this._generateTransitionEvent()))) : this
            }, t.prototype.collapse = function (t) {
                return null == t && (t = !0), this.collapsed ? this : (this.activator && this.activator.collapse(), t ? (this.node.addEventListener("transitionend", this._finishTransition), this.node.classList.add("collapsible--has-transition"), this.node.style.height = this._getHeight(), this.node.offsetHeight, requestAnimationFrame(function (t) {
                    return function () {
                        return t.collapsed = !0, t.node.setAttribute(e.STATE, "collapsed"), t.node.setAttribute(e.HIDDEN, "true"), Bizweb.rootDispatcher.dispatch(t._generateTransitionEvent())
                    }
                }(this))) : (this.collapsed = !0, this.node.setAttribute(e.STATE, "collapsed"), this.node.setAttribute(e.HIDDEN, "true"), this.activator.ready = !0, Bizweb.rootDispatcher.dispatch(this._generateTransitionEvent()), this.dismissible && this.collapsed ? this.remove() : void 0))
            }, t.prototype.remove = function () {
                this.activator && this.activator.remove(), s[this.id] = null, this.node.parentNode.removeChild(this.node)
            }, t.prototype._getHeight = function () {
                var e;
                return e = this.node.scrollHeight, e += parseInt(window.getComputedStyle(this.node).getPropertyValue("margin-bottom"), 10), (e += parseInt(window.getComputedStyle(this.node).getPropertyValue("margin-top"), 10)) + "px"
            }, t.prototype._finishTransition = function (e) {
                if (e.target === this.node && "height" === e.propertyName && (this.node.removeEventListener("transitionend", this._finishTransition), this.node.classList.remove("collapsible--has-transition"), this.node.style.height = null, this.node.offsetHeight, this.activator.ready = !0, this.dismissible && this.collapsed)) return this.remove()
            }, t.prototype._generateTransitionEvent = function () {
                return {
                    type: this.collapsed ? n : a,
                    data: {
                        collapsibleInstance: this
                    }
                }
            }, t.prototype._pairActivator = function () {
                var t;
                if (t = document.querySelector("[" + e.BTN.TARGET + "='" + this.id + "']")) return o[this.id] = new i(t, this), this.activator = o[this.id]
            }, t.prototype._toggleAtWidth = function (e) {
                return null == e && (e = !1), this.maxwidth && (this.node.offsetWidth >= this.maxwidth ? (this.collapsed && this.expand(e), this.activator && this.activator.hide()) : this.activator && this.activator.show()), this
            }, t.prototype._trackWidthResize = function () {
                if (this.maxwidth) return window.addEventListener("resize", _.debounce(function (e) {
                    return function () {
                        return requestAnimationFrame(function () {
                            return e._toggleAtWidth()
                        })
                    }
                }(this), 50))
            }, t
        }(),
        i = function () {
            function i(i, n) {
                var a, o;
                this.node = i, this.collapsible = n, this._clickToToggle = h(this._clickToToggle, this), this.node, this.collapsible, this.target = this.collapsible.node, this.collapsed = "false" === this.node.getAttribute(e.BTN.EXPANDED), this.ready = !0, o = this.node.getElementsByClassName(t.BTN.TEXT)[0], this.text = {
                    node: o,
                    expanded: o ? o.getAttribute(e.BTN.TEXT.EXPANDED) : void 0,
                    collapsed: o ? o.getAttribute(e.BTN.TEXT.COLLAPSED) : void 0
                }, a = this.node.getElementsByClassName(t.BTN.ICON)[0], this.icon = {
                    node: a,
                    symbol: a ? a.getElementsByTagName("use")[0] : void 0,
                    expanded: a ? a.getAttribute(e.BTN.ICON.EXPANDED) : void 0,
                    collapsed: a ? a.getAttribute(e.BTN.ICON.COLLAPSED) : void 0
                }, this.node.addEventListener("click", this._clickToToggle)
            }
            return i._collapsibleRefs = s, i.getCollapsibleRefForNode = l, i._activatorRefs = o, i.getActivatorForNode = r, i.prototype.toggle = function () {
                return this.collapsed ? this.expand() : this.collapse()
            }, i.prototype.expand = function () {
                return this.collapsed ? (this.ready = !1, this.collapsed = !1, this.node.setAttribute(e.BTN.EXPANDED, "true"), this._toggleText(), this._toggleIcon(), this) : this
            }, i.prototype.collapse = function () {
                return this.collapsed ? this : (this.ready = !1, this.collapsed = !0, this.node.setAttribute(e.BTN.EXPANDED, "false"), this._toggleText(), this._toggleIcon(), this)
            }, i.prototype.remove = function () {
                this.node.removeEventListener("click", this._clickToToggle), o[this.node.getAttribute(e.BTN.TARGET)] = null, this.node.parentNode.removeChild(this.node)
            }, i.prototype.hide = function () {
                this.node.classList.add("hide")
            }, i.prototype.show = function () {
                this.node.classList.remove("hide")
            }, i.prototype._toggleText = function () {
                return this.text.expanded && this.text.collapsed && (this.text.node.innerHTML = this.collapsed ? this.text.collapsed : this.text.expanded), this
            }, i.prototype._toggleIcon = function () {
                return this.icon.expanded && this.icon.collapsed && (this.collapsed ? this.icon.symbol.setAttribute("xlink:href", "#" + this.icon.collapsed) : this.icon.symbol.setAttribute("xlink:href", "#" + this.icon.expanded)), this
            }, i.prototype._clickToToggle = function (e) {
                if (this.ready) return e.preventDefault(), document.body.contains(this.target) ? this.collapsible.toggle() : void 0
            }, i
        }(), u = function () {
            var t, i, n, a, o, r;
            for (o = document.querySelectorAll("[" + e.TYPE + "]"), r = [], n = 0, a = o.length; n < a; n++) t = o[n], i = t.id, i ? r.push(s[i] = new Bizweb.Collapsible(t)) : r.push(console.log("This collapsible has been rejected because of missing ID!"));
            return r
        }, $(document).on("ready page:load", u)
    }).call(this);

    (function () {
        Bizweb.VtpShippingAddressSetting = function () {
            function VtpShippingAddressSetting(element, form, options) {
                if (options != null) {
                    for (var option in options) {
                        this[option] = options[option];
                    }
                }

                this.element = element;
                this.$ele = $(element);
                this.form = form;

                this.$province = $(".vtp_address_select .provinceSlt");
                this.$district = $(".vtp_address_select .districtSlt");
                this.$ward = $(".vtp_address_select .wardSlt");

                this.district_cache = {}, this.ward_cache = {};
                this.cached_district_count = 0, this.cached_ward_count = 0;
            };

            VtpShippingAddressSetting.prototype.changeProvince = function () {
                var province_code = this.$province.val();

                if (!province_code) {
                    this.bindDistrict([], "");
                    this.bindWard([], "");
                    return false;
                }

                var cached_district = this.cached_district_count ? this.district_cache["p_" + province_code] : null;
                if (cached_district && cached_district.length) {
                    this.bindDistrict(cached_district, "");
                    this.bindWard([], "");
                } else {
                    var that = this;
                    $.ajax({
                        url: Bizweb.routes.vtp + "/getdistrict?province=" + province_code,
                        success: function (data) {
                            if (data != undefined && data != '' && data.length) {
                                that.populateDistrictCache(data, "p_" + province_code);
                                that.bindDistrict(data, "");
                                that.bindWard([], "");
                            }
                        }
                    });
                }
                this.form.makeDirty();
            }
            VtpShippingAddressSetting.prototype.changeDistrict = function () {
                var district_code = this.$district.val();

                if (!district_code) {
                    this.bindWard([], "");
                    return false;
                }

                var cached_ward = this.cached_ward_count ? this.ward_cache["d_" + district_code] : null;
                if (cached_ward && cached_ward.length) {
                    this.bindWard(cached_ward, "");
                } else {
                    var that = this;
                    $.ajax({
                        url: Bizweb.routes.vtp + "/getward?district=" + district_code,
                        success: function (data) {
                            if (data != undefined && data != '' && data.length) {
                                that.populateWardCache(data, "d_" + district_code);
                                that.bindWard(data, "");
                            }
                        }
                    });
                }
                this.form.makeDirty();
            }
            VtpShippingAddressSetting.prototype.populateDistrictCache = function (districts, provinceCode) {
                if (!!provinceCode) {
                    this.district_cache[provinceCode] = districts;
                    ++this.cached_district_count;
                }
            }
            VtpShippingAddressSetting.prototype.populateWardCache = function (wards, districtCode) {
                if (!!districtCode) {
                    this.ward_cache[districtCode] = wards;
                    ++this.cached_ward_count;
                }
            }
            VtpShippingAddressSetting.prototype.bindDistrict = function (districts, selected) {
                var districtOptionHtml = "<option value=''>Chọn quận / huyện</option>";
                for (var i = 0; i < districts.length; i++) {
                    var district = districts[i];
                    districtOptionHtml += "<option " + (selected == district.code ? "selected='selected'" : "") + " value='" + district.code + "'>" + district.name + "</option>";
                }

                this.$district.empty();
                this.$district.html(districtOptionHtml);
            }
            VtpShippingAddressSetting.prototype.bindWard = function (wards, selected) {
                var wardOptionHtml = "<option value=''>Chọn phường / xã</option>";
                for (var i = 0; i < wards.length; i++) {
                    var ward = wards[i];
                    wardOptionHtml += "<option " + (selected == ward.vtp_ward_id ? "selected='selected'" : "") + " value='" + ward.vtp_ward_id + "'>" + ward.vtp_ward_name + "</option>";
                }

                this.$ward.empty();
                this.$ward.html(wardOptionHtml);
            }

            return VtpShippingAddressSetting;
        }();
    }).call(this);
}